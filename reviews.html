<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Content Security Policy - Firebase iframe í—ˆìš© (ê°œì„ ëœ ë²„ì „) -->
    <meta http-equiv="Content-Security-Policy" content="frame-src 'self' https://www.google.com https://recaptcha.google.com https://kauth.kakao.com https://pricehunter-99a1b.firebaseapp.com https://*.firebaseapp.com https://*.googleapis.com https://apis.google.com; connect-src 'self' https://firestore.googleapis.com https://identitytoolkit.googleapis.com https://securetoken.googleapis.com https://firebasestorage.googleapis.com https://content-firebaseappcheck.googleapis.com https://www.googleapis.com https://*.firebaseio.com wss://*.firebaseio.com https://developers.kakao.com https://kapi.kakao.com https://kauth.kakao.com https://*.firebaseapp.com https://*.cloudfunctions.net https://api.emailjs.com https://www.gstatic.com https://*.gstatic.com https://firebasejs.com https://images.unsplash.com https://*.unsplash.com https://*.firebaseapp.com; script-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com https://www.gstatic.com https://*.gstatic.com https://firebasejs.com; img-src 'self' data: https: http: blob:;" />
    
    <title>ì‹¤ì œ ê³ ê° í›„ê¸° - PriceHunter</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3EğŸ”%3C/text%3E%3C/svg%3E">
    
    <!-- Tailwind CSS (ê°œë°œìš© - í”„ë¡œë•ì…˜ì—ì„œëŠ” ë¡œì»¬ íŒŒì¼ ì‚¬ìš© ê¶Œì¥) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Tailwind CSS ê°œë°œìš© ê²½ê³  ë¬´ì‹œ
        console.log('ğŸ¨ Tailwind CSS ë¡œë“œë¨ (ê°œë°œìš© CDN)');
    </script>
    
    <style>
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        .animate-fade-in-up { animation: fadeInUp 0.6s ease-out; }
        .animate-slide-in { animation: slideIn 0.5s ease-out; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- í—¤ë” -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 py-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <a href="index.html" class="flex items-center space-x-2 hover:opacity-80 transition">
                        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                        </svg>
                        <span class="text-xl font-bold">PriceHunter</span>
                    </a>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-sm opacity-90">ì‹¤ì œ ê³ ê° í›„ê¸°</span>
                    <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                </div>
            </div>
        </div>
    </header>

    <!-- ë¡œê·¸ì¸ í•„ìš” ì˜¤ë²„ë ˆì´ -->
    <div id="login-required-overlay" class="fixed inset-0 bg-white z-50 flex items-center justify-center">
        <div class="text-center p-8">
            <div class="text-6xl mb-6">ğŸ”’</div>
            <h2 class="text-3xl font-bold text-gray-800 mb-4">íšŒì›ê°€ì… í›„<br class="sm:hidden">ì´ìš©í•˜ì„¸ìš”</h2>
            <p class="text-lg text-gray-600 mb-8">ì‹¤ì œ ê³ ê° í›„ê¸°ë¥¼ ë³´ë ¤ë©´<br class="sm:hidden">íšŒì›ê°€ì…ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <a href="register.html" class="bg-gradient-to-r from-blue-600 to-purple-600 text-white px-8 py-3 rounded-full font-bold hover:from-blue-700 hover:to-purple-700 transition">
                    íšŒì›ê°€ì…í•˜ê¸°
                </a>
                <a href="index.html" class="border-2 border-gray-300 text-gray-700 px-8 py-3 rounded-full font-bold hover:bg-gray-50 transition">
                    í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°
                </a>
            </div>
        </div>
    </div>

    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <main class="max-w-7xl mx-auto px-4 py-8 hidden" id="main-content">
        <!-- í˜ì´ì§€ ì œëª© -->
        <div class="text-center mb-12 animate-fade-in-up">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-800 mb-4">
                ğŸ’ <span class="bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">ì‹¤ì œ ê³ ê° í›„ê¸°</span>
            </h1>
            <p class="text-xl text-gray-600 max-w-3xl mx-auto">
                PriceHunterë¥¼ í†µí•´ ì‹¤ì œë¡œ ì ˆì•½í•œ ê³ ê°ë“¤ì˜ ìƒìƒí•œ í›„ê¸°ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”
            </p>
            <div class="w-24 h-1 bg-gradient-to-r from-blue-400 to-purple-400 rounded-full mx-auto mt-6"></div>
        </div>

        <!-- í†µê³„ ì¹´ë“œ -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-12">
            <div class="bg-white rounded-2xl shadow-lg p-6 text-center card-hover animate-slide-in">
                <div class="text-3xl font-bold text-blue-600 mb-2" id="total-reviews">0</div>
                <div class="text-gray-600">ì´ í›„ê¸° ìˆ˜</div>
            </div>
            <div class="bg-white rounded-2xl shadow-lg p-6 text-center card-hover animate-slide-in" style="animation-delay: 0.1s">
                <div class="text-3xl font-bold text-green-600 mb-2" id="total-savings">0ì›</div>
                <div class="text-gray-600">ì´ ì ˆì•½ ê¸ˆì•¡</div>
            </div>
            <div class="bg-white rounded-2xl shadow-lg p-6 text-center card-hover animate-slide-in" style="animation-delay: 0.2s">
                <div class="text-3xl font-bold text-yellow-600 mb-2" id="avg-rating">0.0</div>
                <div class="text-gray-600">í‰ê·  í‰ì </div>
            </div>
            <div class="bg-white rounded-2xl shadow-lg p-6 text-center card-hover animate-slide-in" style="animation-delay: 0.3s">
                <div class="text-3xl font-bold text-purple-600 mb-2" id="avg-savings">0%</div>
                <div class="text-gray-600">í‰ê·  ì ˆì•½ë¥ </div>
            </div>
        </div>

        <!-- í•„í„° ë° ê²€ìƒ‰ -->
        <div class="bg-white rounded-2xl shadow-lg p-6 mb-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ì¹´í…Œê³ ë¦¬</label>
                    <select id="category-filter" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="">ì „ì²´</option>
                        <option value="ì „ìì œí’ˆ">ì „ìì œí’ˆ</option>
                        <option value="ê°€ì „ì œí’ˆ">ê°€ì „ì œí’ˆ</option>
                        <option value="ìƒí™œìš©í’ˆ">ìƒí™œìš©í’ˆ</option>
                        <option value="ì‚¬ë¬´ìš©í’ˆ">ì‚¬ë¬´ìš©í’ˆ</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">í‰ì </label>
                    <select id="rating-filter" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="">ì „ì²´</option>
                        <option value="5">â­â­â­â­â­ (5ì )</option>
                        <option value="4">â­â­â­â­ (4ì  ì´ìƒ)</option>
                        <option value="3">â­â­â­ (3ì  ì´ìƒ)</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ì •ë ¬</label>
                    <select id="sort-filter" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="newest">ìµœì‹ ìˆœ</option>
                        <option value="oldest">ì˜¤ë˜ëœìˆœ</option>
                        <option value="rating">í‰ì ìˆœ</option>
                        <option value="savings">ì ˆì•½ê¸ˆì•¡ìˆœ</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ê²€ìƒ‰</label>
                    <input type="text" id="search-input" placeholder="ì œí’ˆëª… ë˜ëŠ” í›„ê¸° ê²€ìƒ‰..." 
                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
            </div>
        </div>

        <!-- ë¡œë”© ìŠ¤í”¼ë„ˆ -->
        <div id="loading-spinner" class="text-center py-12">
            <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
            <p class="mt-4 text-gray-600">í›„ê¸°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>

        <!-- í›„ê¸° ê·¸ë¦¬ë“œ -->
        <div id="reviews-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-12 hidden">
            <!-- í›„ê¸° ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
        </div>

        <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
        <div id="pagination" class="flex justify-center items-center space-x-2 mb-12 hidden">
            <!-- í˜ì´ì§€ë„¤ì´ì…˜ ë²„íŠ¼ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
        </div>

        <!-- CTA ì„¹ì…˜ -->
        <div class="bg-gradient-to-r from-blue-600 to-purple-600 rounded-2xl p-8 text-center text-white">
            <h2 class="text-3xl font-bold mb-4">ë‚˜ë„ ì ˆì•½í•˜ê³  ì‹¶ë‹¤ë©´?</h2>
            <p class="text-xl mb-6 opacity-90">PriceHunterì™€ í•¨ê»˜ ìµœì €ê°€ë¥¼ ì°¾ì•„ë³´ì„¸ìš”!</p>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <a href="request-v2.html" class="bg-white text-blue-600 px-8 py-3 rounded-full font-bold hover:bg-gray-100 transition">
                    ìµœì €ê°€ ê²€ì¦ ì˜ë¢°í•˜ê¸°
                </a>
                <a href="write-review.html" class="bg-yellow-400 text-gray-800 px-8 py-3 rounded-full font-bold hover:bg-yellow-300 transition">
                    âœï¸ í›„ê¸° ì‘ì„±í•˜ê¸°
                </a>
                <a href="index.html" class="border-2 border-white text-white px-8 py-3 rounded-full font-bold hover:bg-white hover:text-blue-600 transition">
                    í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°
                </a>
            </div>
        </div>
    </main>

    <!-- í‘¸í„° -->
    <footer class="bg-gray-900 text-white py-12 mt-16">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <div class="flex items-center justify-center space-x-2 mb-4">
                <svg class="w-8 h-8 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <rect x="4" y="4" width="16" height="16" rx="4" stroke="currentColor"/>
                    <path d="M8 8h8M8 12h8M8 16h4" stroke-linecap="round"/>
                </svg>
                <span class="text-2xl font-bold text-blue-400">PriceHunter</span>
            </div>
            <p class="text-gray-400 mb-4">ìµœì €ê°€ ê²€ì¦ì˜ ìƒˆë¡œìš´ ê¸°ì¤€</p>
            <div class="flex justify-center space-x-6 text-sm text-gray-400">
                <a href="about.html" class="hover:text-white transition">íšŒì‚¬ ì†Œê°œ</a>
                <a href="contact.html" class="hover:text-white transition">ë¬¸ì˜í•˜ê¸°</a>
                <a href="support.html" class="hover:text-white transition">ê³ ê° ì§€ì›</a>
            </div>
        </div>
    </footer>

    <!-- ì‚¬ì§„ ëª¨ë‹¬ -->
    <div id="photo-modal" class="fixed inset-0 bg-black bg-opacity-75 z-50 hidden flex items-center justify-center">
        <div class="relative max-w-4xl max-h-full p-4">
            <button onclick="closePhotoModal()" class="absolute top-4 right-4 text-white text-2xl hover:text-gray-300 z-10">
                âœ•
            </button>
            <img id="modal-photo" src="" alt="í›„ê¸° ì‚¬ì§„" class="max-w-full max-h-full object-contain rounded-lg">
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
        import { getFirestore, collection, getDocs, query, where, orderBy, onSnapshot } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js';

        // Firebase ì„¤ì •
        const firebaseConfig = {
            apiKey: "AIzaSyDBZxKyMS7eeBTbPnbZkj0WWOZQHNldoL4",
            authDomain: "pricehunter-99a1b.firebaseapp.com",
            projectId: "pricehunter-99a1b",
            storageBucket: "pricehunter-99a1b.firebasestorage.app",
            messagingSenderId: "242265693919",
            appId: "1:242265693919:web:74234d942b82a51541136a",
            measurementId: "G-4BKLV4EVB9"
        };

        // Firebase ì´ˆê¸°í™”
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        // ì „ì—­ Firebase ì„¤ì •
        window.firebaseDb = db;
        window.firebaseFirestoreFunctions = {
            collection,
            getDocs,
            query,
            where,
            orderBy,
            onSnapshot
        };

        // ì „ì—­ ë³€ìˆ˜
        let allReviews = [];
        let filteredReviews = [];
        let currentPage = 1;
        const reviewsPerPage = 9;

        // Firebase ì´ˆê¸°í™” ëŒ€ê¸° í•¨ìˆ˜
        function waitForFirebase() {
            return new Promise((resolve) => {
                const checkFirebase = () => {
                    if (window.firebaseDb && window.firebaseFirestoreFunctions) {
                        console.log('âœ… Firebase ì´ˆê¸°í™” í™•ì¸ë¨');
                        resolve();
                    } else {
                        console.log('â³ Firebase ì´ˆê¸°í™” ëŒ€ê¸° ì¤‘...');
                        setTimeout(checkFirebase, 100);
                    }
                };
                checkFirebase();
            });
        }

        // DOM ìš”ì†Œ
        const loadingSpinner = document.getElementById('loading-spinner');
        const reviewsContainer = document.getElementById('reviews-container');
        const pagination = document.getElementById('pagination');

        // í›„ê¸° ë°ì´í„° ë¡œë“œ (í†µí•© ì‹œìŠ¤í…œ - ê°œì„ ëœ ë²„ì „)
        let reviewsUnsubscribe = null;
        let loadAttempts = 0;
        const maxLoadAttempts = 3;
        
        async function loadReviews() {
            try {
                loadingSpinner.classList.remove('hidden');
                loadAttempts++;
                
                console.log(`ğŸ”„ í›„ê¸° ë°ì´í„° ë¡œë“œ ì‹œë„ ${loadAttempts}/${maxLoadAttempts}`);
                
                // Firebase ì´ˆê¸°í™” ëŒ€ê¸°
                await waitForFirebase();
                
                // ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ ì‹œì‘
                subscribeToReviews();
                
                // ì´ˆê¸° ë°ì´í„° ë¡œë“œ
                const { collection, getDocs, query, where, orderBy } = window.firebaseFirestoreFunctions;
                const reviewsRef = collection(window.firebaseDb, 'reviews');
                
                let snapshot;
                try {
                    // ì¸ë±ìŠ¤ ì˜¤ë¥˜ ë°©ì§€ë¥¼ ìœ„í•´ ë‹¨ìˆœ ì¿¼ë¦¬ ì‚¬ìš©
                    const allSnapshot = await getDocs(reviewsRef);
                    snapshot = {
                        forEach: (callback) => {
                            allSnapshot.forEach(doc => {
                                const data = doc.data();
                                if (data.approved === true) {
                                    callback(doc);
                                }
                            });
                        }
                    };
                    console.log('âœ… Firebase ì¿¼ë¦¬ ì„±ê³µ (í´ë¼ì´ì–¸íŠ¸ í•„í„°ë§)');
                } catch (error) {
                    console.warn('âš ï¸ Firebase ì¿¼ë¦¬ ì˜¤ë¥˜:', error);
                    snapshot = { forEach: () => {} };
                }
                
                allReviews = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    // ë°ì´í„° ìœ íš¨ì„± ê²€ì‚¬
                    if (data && data.name && data.productName) {
                        // ë°ì´í„° êµ¬ì¡° í‘œì¤€í™” (ê¸°ë³¸ê°’ ì„¤ì •)
                        const standardizedData = {
                            id: doc.id,
                            ...data,
                            approved: data.approved || false,
                            featured: data.featured || false,
                            rating: data.rating || 5,
                            views: data.views || 0,
                            country: data.country || 'ëŒ€í•œë¯¼êµ­',
                            shipping: data.shipping || '3ì¼',
                            method: data.method || 'PriceHunter ê²€ì¦',
                            badge: data.badge || 'ì‹¤ì œ êµ¬ë§¤ì',
                            category: data.category || 'ì¼ë°˜',
                            savingsPercent: typeof data.savingsPercent === 'number' ? data.savingsPercent : 
                                          typeof data.savingsPercent === 'string' ? parseInt(data.savingsPercent) || 0 : 0
                        };
                        allReviews.push(standardizedData);
                    }
                });
                
                filteredReviews = [...allReviews];
                updateStatistics();
                displayReviews();
                
                console.log(`âœ… ${allReviews.length}ê°œ ìŠ¹ì¸ëœ í›„ê¸° ë¡œë“œ ì™„ë£Œ`);
                loadAttempts = 0; // ì„±ê³µ ì‹œ ë¦¬ì…‹
                
            } catch (error) {
                console.error('âŒ í›„ê¸° ë¡œë“œ ì‹¤íŒ¨:', error);
                
                // ì¬ì‹œë„ ë¡œì§
                if (loadAttempts < maxLoadAttempts) {
                    console.log(`â³ ${2000 * loadAttempts}ms í›„ ì¬ì‹œë„...`);
                    setTimeout(() => {
                        loadReviews();
                    }, 2000 * loadAttempts);
                    return;
                }
                
                // ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ ì´ˆê³¼ ì‹œ ê¸°ë³¸ ë°ì´í„° ì‚¬ìš©
                console.log('ğŸ”„ ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ ì´ˆê³¼, ê¸°ë³¸ ë°ì´í„° ì‚¬ìš©');
                loadDefaultReviews();
                loadAttempts = 0; // ë¦¬ì…‹
                
            } finally {
                loadingSpinner.classList.add('hidden');
            }
        }

        // í›„ê¸° ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ (ê°œì„ ëœ ë²„ì „)
        function subscribeToReviews() {
            if (reviewsUnsubscribe) {
                reviewsUnsubscribe();
                console.log('ğŸ”„ ê¸°ì¡´ í›„ê¸° ë¦¬ìŠ¤ë„ˆ ì •ë¦¬');
            }

            // Firebase ì´ˆê¸°í™” í™•ì¸
            if (!window.firebaseDb || !window.firebaseFirestoreFunctions) {
                console.warn('âš ï¸ Firebaseê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•„ ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆë¥¼ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            const { collection, onSnapshot, query, where, orderBy } = window.firebaseFirestoreFunctions;
            const reviewsRef = collection(window.firebaseDb, 'reviews');
            
            // ì¸ë±ìŠ¤ ì˜¤ë¥˜ ë°©ì§€ë¥¼ ìœ„í•´ ëª¨ë“  í›„ê¸°ë¥¼ ì‹¤ì‹œê°„ ê°ì‹œí•˜ê³  í´ë¼ì´ì–¸íŠ¸ì—ì„œ í•„í„°ë§
            reviewsUnsubscribe = onSnapshot(reviewsRef, (snapshot) => {
                console.log('ğŸ“‹ ë¦¬ë·°í˜ì´ì§€ í›„ê¸° ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸...');
                
                allReviews = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    if (data.approved === true && data && data.name && data.productName) {
                        // ë°ì´í„° êµ¬ì¡° í‘œì¤€í™” (ê¸°ë³¸ê°’ ì„¤ì •)
                        const standardizedData = {
                            id: doc.id,
                            ...data,
                            approved: data.approved || false,
                            featured: data.featured || false,
                            rating: data.rating || 5,
                            views: data.views || 0,
                            country: data.country || 'ëŒ€í•œë¯¼êµ­',
                            shipping: data.shipping || '3ì¼',
                            method: data.method || 'PriceHunter ê²€ì¦',
                            badge: data.badge || 'ì‹¤ì œ êµ¬ë§¤ì',
                            category: data.category || 'ì¼ë°˜',
                            savingsPercent: typeof data.savingsPercent === 'number' ? data.savingsPercent : 
                                          typeof data.savingsPercent === 'string' ? parseInt(data.savingsPercent) || 0 : 0
                        };
                        allReviews.push(standardizedData);
                    }
                });
                
                // í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì •ë ¬ (ìµœì‹ ìˆœ)
                allReviews.sort((a, b) => {
                    const dateA = a.createdAt?.toDate?.() || new Date(0);
                    const dateB = b.createdAt?.toDate?.() || new Date(0);
                    return dateB - dateA;
                });
                
                filteredReviews = [...allReviews];
                updateStatistics();
                displayReviews();
                
                console.log(`âœ… ë¦¬ë·°í˜ì´ì§€ í›„ê¸° ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì™„ë£Œ: ${allReviews.length}ê°œ`);
            }, (error) => {
                console.error('âŒ ë¦¬ë·°í˜ì´ì§€ í›„ê¸° ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ ì˜¤ë¥˜:', error);
                
                // ì˜¤ë¥˜ ë°œìƒ ì‹œ 5ì´ˆ í›„ ì¬ì—°ê²° ì‹œë„
                setTimeout(() => {
                    console.log('ğŸ”„ í›„ê¸° ë¦¬ìŠ¤ë„ˆ ì¬ì—°ê²° ì‹œë„...');
                    subscribeToReviews();
                }, 5000);
            });
            
            console.log('âœ… í›„ê¸° ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ ì‹œì‘ë¨');
        }

        // í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ ë¦¬ìŠ¤ë„ˆ ì •ë¦¬
        window.addEventListener('beforeunload', () => {
            if (reviewsUnsubscribe) {
                reviewsUnsubscribe();
                console.log('ğŸ§¹ ë¦¬ë·°í˜ì´ì§€ í›„ê¸° ë¦¬ìŠ¤ë„ˆ ì •ë¦¬ ì™„ë£Œ');
            }
        });

        // ê¸°ë³¸ í›„ê¸° ë°ì´í„° (Firebase ì—°ê²° ì‹¤íŒ¨ ì‹œ) - ì¸ë±ìŠ¤í˜ì´ì§€ ì‹¤ì œê³ ê°í›„ê¸° ë°ì´í„° ê¸°ì¤€
        function loadDefaultReviews() {
            allReviews = [
                {
                    id: '1',
                    name: 'í™ê¸¸ë™',
                    ageGroup: '20ëŒ€',
                    occupation: 'ê°œë°œì',
                    productName: 'ë…¸íŠ¸ë¶',
                    originalPrice: '1,200,000ì›',
                    finalPrice: '780,000ì›',
                    savings: '420,000ì›',
                    savingsPercent: 35,
                    rating: 5,
                    review: 'ìš”ì²­ê°€ 120ë§Œì› â†’ 78ë§Œì›ìœ¼ë¡œ êµ¬ë§¤! ì„±ëŠ¥ë„ í›Œë¥­í•˜ê³  ì •ë§ ë§Œì¡±í•©ë‹ˆë‹¤.',
                    country: 'ëŒ€í•œë¯¼êµ­',
                    shipping: '2ì¼',
                    method: 'ê³µì¥ ì§ì ‘êµ¬ë§¤',
                    badge: 'ì‹¤ì œ êµ¬ë§¤ì',
                    purchaseDate: '2024-07-01',
                    profileImage: 'https://images.unsplash.com/photo-1519125323398-675f0ddb6308?auto=format&fit=crop&w=600&q=80',
                    category: 'ì „ìì œí’ˆ',
                    photos: []
                },
                {
                    id: '2',
                    name: 'ê¹€ì˜í¬',
                    ageGroup: '30ëŒ€',
                    occupation: 'ë””ìì´ë„ˆ',
                    productName: 'ëª¨ë‹ˆí„°',
                    originalPrice: '450,000ì›',
                    finalPrice: '280,000ì›',
                    savings: '170,000ì›',
                    savingsPercent: 38,
                    rating: 4.5,
                    review: 'ìš”ì²­ê°€ 45ë§Œì› â†’ 28ë§Œì›ìœ¼ë¡œ ì ˆì•½! í™”ì§ˆë„ ì¢‹ê³  ê°€ê²©ë„ ë§Œì¡±!',
                    country: 'ëŒ€í•œë¯¼êµ­',
                    shipping: '3ì¼',
                    method: 'ë„ë§¤ì²˜ ì—°ë™',
                    badge: 'ì‹¤ì œ êµ¬ë§¤ì',
                    purchaseDate: '2024-07-02',
                    profileImage: 'https://images.unsplash.com/photo-1503602642458-232111445657?auto=format&fit=crop&w=600&q=80',
                    category: 'ì „ìì œí’ˆ',
                    photos: []
                },
                {
                    id: '3',
                    name: 'ì´ì² ìˆ˜',
                    ageGroup: '40ëŒ€',
                    occupation: 'ìì˜ì—…ì',
                    productName: 'ì‚¬ë¬´ìš©í’ˆ',
                    originalPrice: '890,000ì›',
                    finalPrice: '520,000ì›',
                    savings: '370,000ì›',
                    savingsPercent: 42,
                    rating: 5,
                    review: 'ìš”ì²­ê°€ 89ë§Œì› â†’ 52ë§Œì›ìœ¼ë¡œ ì ˆì•½! ë¹ ë¥¸ ë°°ì†¡, ì €ë ´í•œ ê°€ê²©!',
                    country: 'ëŒ€í•œë¯¼êµ­',
                    shipping: '2ì¼',
                    method: 'ê³µì¥ ì§ì ‘êµ¬ë§¤',
                    badge: 'ì‚¬ì—…ì ëŒ€ëŸ‰êµ¬ë§¤',
                    purchaseDate: '2024-07-03',
                    profileImage: 'https://images.unsplash.com/photo-1465101046530-73398c7f28ca?auto=format&fit=crop&w=600&q=80',
                    category: 'ì‚¬ë¬´ìš©í’ˆ',
                    photos: []
                },
                {
                    id: '4',
                    name: 'ë°•ë¯¼ìˆ˜',
                    ageGroup: '20ëŒ€',
                    occupation: 'ëŒ€í•™ìƒ',
                    productName: 'íƒœë¸”ë¦¿',
                    originalPrice: '320,000ì›',
                    finalPrice: '210,000ì›',
                    savings: '110,000ì›',
                    savingsPercent: 34,
                    rating: 4.8,
                    review: 'ìš”ì²­ê°€ 32ë§Œì› â†’ 21ë§Œì›ìœ¼ë¡œ êµ¬ë§¤! í•™ìƒ í• ì¸ê¹Œì§€ ë°›ì•„ì„œ êµ¿!',
                    country: 'ëŒ€í•œë¯¼êµ­',
                    shipping: '4ì¼',
                    method: 'ê³µì¥ ì§ì ‘êµ¬ë§¤',
                    badge: 'ì‹¤ì œ êµ¬ë§¤ì',
                    purchaseDate: '2024-07-04',
                    profileImage: 'https://images.unsplash.com/photo-1512499617640-c2f999098c01?auto=format&fit=crop&w=600&q=80',
                    category: 'ì „ìì œí’ˆ',
                    photos: []
                },
                {
                    id: '5',
                    name: 'ìµœì§€ì€',
                    ageGroup: '30ëŒ€',
                    occupation: 'ì£¼ë¶€',
                    productName: 'ê°€ì „ì œí’ˆ',
                    originalPrice: '680,000ì›',
                    finalPrice: '420,000ì›',
                    savings: '260,000ì›',
                    savingsPercent: 38,
                    rating: 5,
                    review: 'ìš”ì²­ê°€ 68ë§Œì› â†’ 42ë§Œì›ìœ¼ë¡œ ì ˆì•½! ë¯¿ê³  êµ¬ë§¤í–ˆì–´ìš”.',
                    country: 'ëŒ€í•œë¯¼êµ­',
                    shipping: '3ì¼',
                    method: 'ë„ë§¤ì²˜ ì—°ë™',
                    badge: 'ì‹¤ì œ êµ¬ë§¤ì',
                    purchaseDate: '2024-07-05',
                    profileImage: 'https://images.unsplash.com/photo-1515378791036-0648a3ef77b2?auto=format&fit=crop&w=600&q=80',
                    category: 'ê°€ì „ì œí’ˆ',
                    photos: []
                },
                {
                    id: '6',
                    name: 'ì •ìš°ì„±',
                    ageGroup: '40ëŒ€',
                    occupation: 'ì§ì¥ì¸',
                    productName: 'ìŠ¤ë§ˆíŠ¸ì›Œì¹˜',
                    originalPrice: '298,000ì›',
                    finalPrice: '156,000ì›',
                    savings: '142,000ì›',
                    savingsPercent: 48,
                    rating: 4.7,
                    review: 'ìš”ì²­ê°€ 29.8ë§Œì› â†’ 15.6ë§Œì›ìœ¼ë¡œ ì ˆì•½! ê¸°ëŠ¥ë„ ë§ê³  ì €ë ´!',
                    country: 'ëŒ€í•œë¯¼êµ­',
                    shipping: '2ì¼',
                    method: 'ê³µì¥ ì§ì ‘êµ¬ë§¤',
                    badge: 'ì‹¤ì œ êµ¬ë§¤ì',
                    purchaseDate: '2024-07-06',
                    profileImage: 'https://images.unsplash.com/photo-1519125323398-675f0ddb6308?auto=format&fit=crop&w=600&q=80',
                    category: 'ì „ìì œí’ˆ',
                    photos: []
                },
                {
                    id: '7',
                    name: 'í•œê°€ì˜',
                    ageGroup: '20ëŒ€',
                    occupation: 'ì‹ í˜¼ë¶€ë¶€',
                    productName: 'ì‹ í˜¼ê°€ì „',
                    originalPrice: '1,560,000ì›',
                    finalPrice: '890,000ì›',
                    savings: '670,000ì›',
                    savingsPercent: 43,
                    rating: 5,
                    review: 'ìš”ì²­ê°€ 156ë§Œì› â†’ 89ë§Œì›ìœ¼ë¡œ ì ˆì•½! ë°°ì†¡ë„ ë¹ ë¥´ê³  ë§Œì¡±!',
                    country: 'ëŒ€í•œë¯¼êµ­',
                    shipping: '3ì¼',
                    method: 'ë„ë§¤ì²˜ ì—°ë™',
                    badge: 'ì‹¤ì œ êµ¬ë§¤ì',
                    purchaseDate: '2024-07-07',
                    profileImage: 'https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=600&q=80',
                    category: 'ê°€ì „ì œí’ˆ',
                    photos: []
                },
                {
                    id: '8',
                    name: 'ì˜¤ì¤€í˜¸',
                    ageGroup: '30ëŒ€',
                    occupation: '1ì¸ê°€êµ¬',
                    productName: 'ìƒí™œìš©í’ˆ',
                    originalPrice: '234,000ì›',
                    finalPrice: '145,000ì›',
                    savings: '89,000ì›',
                    savingsPercent: 38,
                    rating: 4.6,
                    review: 'ìš”ì²­ê°€ 23.4ë§Œì› â†’ 14.5ë§Œì›ìœ¼ë¡œ ì ˆì•½! í˜¼ì ì‚¬ëŠ”ë° ë”±!',
                    country: 'ëŒ€í•œë¯¼êµ­',
                    shipping: '2ì¼',
                    method: 'ê³µì¥ ì§ì ‘êµ¬ë§¤',
                    badge: 'ì‹¤ì œ êµ¬ë§¤ì',
                    purchaseDate: '2024-07-08',
                    profileImage: 'https://images.unsplash.com/photo-1519125323398-675f0ddb6308?auto=format&fit=crop&w=600&q=80',
                    category: 'ìƒí™œìš©í’ˆ',
                    photos: []
                },
                {
                    id: '9',
                    name: 'ìœ ìˆ˜ì§„',
                    ageGroup: '60ëŒ€',
                    occupation: 'ë¶€ëª¨ë‹˜ ì„ ë¬¼',
                    productName: 'ì•ˆë§ˆê¸°',
                    originalPrice: '189,000ì›',
                    finalPrice: '67,000ì›',
                    savings: '122,000ì›',
                    savingsPercent: 65,
                    rating: 5,
                    review: 'ìš”ì²­ê°€ 18.9ë§Œì› â†’ 6.7ë§Œì›ìœ¼ë¡œ ì ˆì•½! ë¶€ëª¨ë‹˜ì´ ì¢‹ì•„í•˜ì…¨ì–´ìš”.',
                    country: 'ëŒ€í•œë¯¼êµ­',
                    shipping: '2ì¼',
                    method: 'ê³µì¥ ì§ì ‘êµ¬ë§¤',
                    badge: 'ì‹¤ì œ êµ¬ë§¤ì',
                    purchaseDate: '2024-07-09',
                    profileImage: 'https://images.unsplash.com/photo-1503602642458-232111445657?auto=format&fit=crop&w=600&q=80',
                    category: 'ìƒí™œìš©í’ˆ',
                    photos: []
                },
                {
                    id: '10',
                    name: 'ì¥ë™ê±´',
                    ageGroup: '10ëŒ€',
                    occupation: 'í•™ìƒ',
                    productName: 'í•™ìš©í’ˆ, ITê¸°ê¸°',
                    originalPrice: '890,000ì›',
                    finalPrice: '520,000ì›',
                    savings: '370,000ì›',
                    savingsPercent: 42,
                    rating: 4.9,
                    review: 'ìš”ì²­ê°€ 89ë§Œì› â†’ 52ë§Œì›ìœ¼ë¡œ ì ˆì•½! ë…¸íŠ¸ë¶, íƒœë¸”ë¦¿ ë‹¤ ì‹¸ê²Œ ìƒ€ì–´ìš”.',
                    country: 'ëŒ€í•œë¯¼êµ­',
                    shipping: '2ì¼',
                    method: 'ê³µì¥ ì§ì ‘êµ¬ë§¤',
                    badge: 'ì‹¤ì œ êµ¬ë§¤ì',
                    purchaseDate: '2024-07-10',
                    profileImage: 'https://images.unsplash.com/photo-1519125323398-675f0ddb6308?auto=format&fit=crop&w=600&q=80',
                    category: 'ì „ìì œí’ˆ',
                    photos: []
                },
                {
                    id: '11',
                    name: 'ì„œì§€í›ˆ',
                    ageGroup: '30ëŒ€',
                    occupation: 'ì·¨ë¯¸ëŸ¬',
                    productName: 'ì·¨ë¯¸ìš©í’ˆ',
                    originalPrice: '456,000ì›',
                    finalPrice: '234,000ì›',
                    savings: '222,000ì›',
                    savingsPercent: 49,
                    rating: 5,
                    review: 'ìš”ì²­ê°€ 45.6ë§Œì› â†’ 23.4ë§Œì›ìœ¼ë¡œ ì ˆì•½! ê¸°íƒ€, ìº í•‘ìš©í’ˆ, ìš´ë™ê¸°êµ¬ê¹Œì§€ ë§Œì¡±!',
                    country: 'ëŒ€í•œë¯¼êµ­',
                    shipping: '2ì¼',
                    method: 'ê³µì¥ ì§ì ‘êµ¬ë§¤',
                    badge: 'ì‹¤ì œ êµ¬ë§¤ì',
                    purchaseDate: '2024-07-11',
                    profileImage: 'https://images.unsplash.com/photo-1519125323398-675f0ddb6308?auto=format&fit=crop&w=600&q=80',
                    category: 'ìƒí™œìš©í’ˆ',
                    photos: []
                },
                {
                    id: '12',
                    name: 'ë¬¸ì§€í˜„',
                    ageGroup: '40ëŒ€',
                    occupation: 'ì§ì¥ì¸',
                    productName: 'íŒ¨ì…˜/ì¡í™”',
                    originalPrice: '345,000ì›',
                    finalPrice: '198,000ì›',
                    savings: '147,000ì›',
                    savingsPercent: 43,
                    rating: 4.6,
                    review: 'ìš”ì²­ê°€ 34.5ë§Œì› â†’ 19.8ë§Œì›ìœ¼ë¡œ ì ˆì•½! ê°€ë°©, ì‹ ë°œ, ì•¡ì„¸ì„œë¦¬ ë‹¤ ì‹¸ê²Œ ìƒ€ì–´ìš”.',
                    country: 'ëŒ€í•œë¯¼êµ­',
                    shipping: '2ì¼',
                    method: 'ê³µì¥ ì§ì ‘êµ¬ë§¤',
                    badge: 'ì‹¤ì œ êµ¬ë§¤ì',
                    purchaseDate: '2024-07-12',
                    profileImage: 'https://images.unsplash.com/photo-1519125323398-675f0ddb6308?auto=format&fit=crop&w=600&q=80',
                    category: 'ìƒí™œìš©í’ˆ',
                    photos: []
                },
                {
                    id: '13',
                    name: 'ì´í•˜ë‚˜',
                    ageGroup: '30ëŒ€',
                    occupation: 'í”„ë¦¬ëœì„œ',
                    productName: 'ì‚¬ë¬´ìš©í’ˆ',
                    originalPrice: '567,000ì›',
                    finalPrice: '345,000ì›',
                    savings: '222,000ì›',
                    savingsPercent: 39,
                    rating: 4.8,
                    review: 'ìš”ì²­ê°€ 56.7ë§Œì› â†’ 34.5ë§Œì›ìœ¼ë¡œ ì ˆì•½! í”„ë¦°í„°, ëª¨ë‹ˆí„°, ì˜ìê¹Œì§€ ë§Œì¡±!',
                    country: 'ëŒ€í•œë¯¼êµ­',
                    shipping: '2ì¼',
                    method: 'ê³µì¥ ì§ì ‘êµ¬ë§¤',
                    badge: 'ì‹¤ì œ êµ¬ë§¤ì',
                    purchaseDate: '2024-07-13',
                    profileImage: 'https://images.unsplash.com/photo-1519125323398-675f0ddb6308?auto=format&fit=crop&w=600&q=80',
                    category: 'ì‚¬ë¬´ìš©í’ˆ',
                    photos: []
                },
                {
                    id: '14',
                    name: 'ìµœìœ ë¦¬',
                    ageGroup: '20ëŒ€',
                    occupation: 'ëŒ€í•™ìƒ',
                    productName: 'ì „ìê¸°ê¸°',
                    originalPrice: '789,000ì›',
                    finalPrice: '456,000ì›',
                    savings: '333,000ì›',
                    savingsPercent: 42,
                    rating: 5,
                    review: 'ìš”ì²­ê°€ 78.9ë§Œì› â†’ 45.6ë§Œì›ìœ¼ë¡œ ì ˆì•½! ìŠ¤ë§ˆíŠ¸í°, ì´ì–´í°, ë…¸íŠ¸ë¶ ë‹¤ ì‹¸ê²Œ ìƒ€ì–´ìš”.',
                    country: 'ëŒ€í•œë¯¼êµ­',
                    shipping: '2ì¼',
                    method: 'ê³µì¥ ì§ì ‘êµ¬ë§¤',
                    badge: 'ì‹¤ì œ êµ¬ë§¤ì',
                    purchaseDate: '2024-07-14',
                    profileImage: 'https://images.unsplash.com/photo-1519125323398-675f0ddb6308?auto=format&fit=crop&w=600&q=80',
                    category: 'ì „ìì œí’ˆ',
                    photos: []
                },
                {
                    id: '15',
                    name: 'ë°•ìƒë¯¼',
                    ageGroup: '40ëŒ€',
                    occupation: 'ì‚¬ì—…ì',
                    productName: 'ì‚¬ë¬´ì‹¤ ë¹„í’ˆ',
                    originalPrice: '2,340,000ì›',
                    finalPrice: '1,450,000ì›',
                    savings: '890,000ì›',
                    savingsPercent: 38,
                    rating: 5,
                    review: 'ìš”ì²­ê°€ 234ë§Œì› â†’ 145ë§Œì›ìœ¼ë¡œ ì ˆì•½! í”„ë¦°í„°, ì˜ì, ì±…ìƒ ë“± ëŒ€ëŸ‰êµ¬ë§¤ë„ ë¹ ë¥´ê³  ì €ë ´!',
                    country: 'ëŒ€í•œë¯¼êµ­',
                    shipping: '3ì¼',
                    method: 'ë„ë§¤ì²˜ ì—°ë™',
                    badge: 'ì‚¬ì—…ì ëŒ€ëŸ‰êµ¬ë§¤',
                    purchaseDate: '2024-07-15',
                    profileImage: 'https://images.unsplash.com/photo-1515378791036-0648a3ef77b2?auto=format&fit=crop&w=600&q=80',
                    category: 'ì‚¬ë¬´ìš©í’ˆ',
                    photos: []
                }
            ];
            
            filteredReviews = [...allReviews];
            updateStatistics();
            displayReviews();
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStatistics() {
            const totalReviews = allReviews.length;
            
            if (totalReviews === 0) {
                document.getElementById('total-reviews').textContent = '0';
                document.getElementById('total-savings').textContent = '0ì›';
                document.getElementById('avg-rating').textContent = '0.0';
                document.getElementById('avg-savings').textContent = '0.0%';
                return;
            }
            
            const totalSavings = allReviews.reduce((sum, review) => {
                const savings = parseInt(review.savings?.replace(/[^0-9]/g, '') || '0');
                return sum + (isNaN(savings) ? 0 : savings);
            }, 0);
            
            const avgRating = allReviews.reduce((sum, review) => sum + (review.rating || 5), 0) / totalReviews;
            const avgSavings = allReviews.reduce((sum, review) => {
                const savingsPercent = typeof review.savingsPercent === 'number' ? review.savingsPercent : 
                                     typeof review.savingsPercent === 'string' ? parseInt(review.savingsPercent) || 0 : 0;
                return sum + savingsPercent;
            }, 0) / totalReviews;

            document.getElementById('total-reviews').textContent = totalReviews.toLocaleString();
            document.getElementById('total-savings').textContent = totalSavings.toLocaleString() + 'ì›';
            document.getElementById('avg-rating').textContent = avgRating.toFixed(1);
            document.getElementById('avg-savings').textContent = avgSavings.toFixed(1) + '%';
        }

        // í›„ê¸° í‘œì‹œ
        function displayReviews() {
            const startIndex = (currentPage - 1) * reviewsPerPage;
            const endIndex = startIndex + reviewsPerPage;
            const pageReviews = filteredReviews.slice(startIndex, endIndex);

            reviewsContainer.innerHTML = pageReviews.map((review, index) => `
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden card-hover animate-fade-in-up" style="animation-delay: ${index * 0.1}s">
                    <div class="p-6">
                        <!-- í”„ë¡œí•„ í—¤ë” -->
                        <div class="flex items-center mb-4">
                            <img src="${review.profileImage || 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=150&h=150&fit=crop&crop=face'}" 
                                 alt="${review.name}" class="w-12 h-12 rounded-full object-cover mr-4">
                            <div>
                                <h3 class="font-bold text-gray-800">${review.name}, ${review.ageGroup} ${review.occupation}</h3>
                                <div class="flex items-center">
                                    ${getStarsHtml(review.rating)}
                                    <span class="ml-2 text-sm text-gray-600">${formatDate(review.purchaseDate)}</span>
                                </div>
                            </div>
                        </div>

                        <!-- ì œí’ˆ ì •ë³´ -->
                        <div class="mb-4">
                            <h4 class="font-semibold text-lg text-gray-800 mb-2">${review.productName}</h4>
                            <div class="flex items-center justify-between bg-gray-50 rounded-lg p-3">
                                <div class="text-sm">
                                    <div class="text-gray-600">ìš”ì²­ê°€</div>
                                    <div class="font-semibold text-gray-800">${review.originalPrice}</div>
                                </div>
                                <div class="text-2xl text-gray-400">â†’</div>
                                <div class="text-sm">
                                    <div class="text-gray-600">ìµœì¢…ê°€</div>
                                    <div class="font-semibold text-green-600">${review.finalPrice}</div>
                                </div>
                            </div>
                        </div>

                        <!-- ì ˆì•½ ì •ë³´ -->
                        <div class="bg-gradient-to-r from-green-50 to-blue-50 rounded-lg p-4 mb-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="text-sm text-gray-600">ì ˆì•½ ê¸ˆì•¡</div>
                                    <div class="text-xl font-bold text-green-600">${review.savings}</div>
                                </div>
                                <div class="text-right">
                                    <div class="text-sm text-gray-600">ì ˆì•½ë¥ </div>
                                    <div class="text-xl font-bold text-blue-600">${review.savingsPercent}%</div>
                                </div>
                            </div>
                        </div>

                        <!-- í›„ê¸° ë‚´ìš© -->
                        <div class="mb-4">
                            <p class="text-gray-700 leading-relaxed">${review.review}</p>
                        </div>

                        <!-- í›„ê¸° ì‚¬ì§„ë“¤ -->
                        ${review.photos && review.photos.length > 0 ? `
                            <div class="mb-4">
                                <div class="grid grid-cols-2 gap-2">
                                    ${review.photos.slice(0, 4).map(photo => `
                                        <img src="${photo}" alt="í›„ê¸° ì‚¬ì§„" 
                                             class="w-full h-24 object-cover rounded-lg cursor-pointer hover:opacity-80 transition"
                                             onclick="openPhotoModal('${photo}')">
                                    `).join('')}
                                </div>
                                ${review.photos.length > 4 ? `
                                    <p class="text-sm text-gray-500 mt-2">+${review.photos.length - 4}ì¥ ë” ë³´ê¸°</p>
                                ` : ''}
                            </div>
                        ` : ''}

                        <!-- ë°°ì§€ ë° ì •ë³´ -->
                        <div class="flex items-center justify-between">
                            <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium">
                                ${review.badge}
                            </span>
                            <div class="text-sm text-gray-500">
                                ${review.shipping} ë°°ì†¡ â€¢ ${review.method}
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');

            reviewsContainer.classList.remove('hidden');
            renderPagination();
        }

        // ë³„ì  HTML ìƒì„±
        function getStarsHtml(rating) {
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 !== 0;
            let starsHtml = '';
            
            for (let i = 0; i < fullStars; i++) {
                starsHtml += '<span class="text-yellow-400">â­</span>';
            }
            if (hasHalfStar) {
                starsHtml += '<span class="text-yellow-400">â­</span>';
            }
            
            return starsHtml;
        }

        // ë‚ ì§œ í¬ë§·íŒ…
        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleDateString('ko-KR', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric' 
            });
        }

        // í˜ì´ì§€ë„¤ì´ì…˜ ë Œë”ë§
        function renderPagination() {
            const totalPages = Math.ceil(filteredReviews.length / reviewsPerPage);
            
            if (totalPages <= 1) {
                pagination.classList.add('hidden');
                return;
            }

            let paginationHtml = '';
            
            // ì´ì „ ë²„íŠ¼
            if (currentPage > 1) {
                paginationHtml += `
                    <button onclick="goToPage(${currentPage - 1})" 
                            class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition">
                        ì´ì „
                    </button>
                `;
            }

            // í˜ì´ì§€ ë²ˆí˜¸ë“¤
            for (let i = 1; i <= totalPages; i++) {
                if (i === currentPage) {
                    paginationHtml += `
                        <button class="px-4 py-2 bg-blue-600 text-white rounded-lg">
                            ${i}
                        </button>
                    `;
                } else {
                    paginationHtml += `
                        <button onclick="goToPage(${i})" 
                                class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition">
                            ${i}
                        </button>
                    `;
                }
            }

            // ë‹¤ìŒ ë²„íŠ¼
            if (currentPage < totalPages) {
                paginationHtml += `
                    <button onclick="goToPage(${currentPage + 1})" 
                            class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition">
                        ë‹¤ìŒ
                    </button>
                `;
            }

            pagination.innerHTML = paginationHtml;
            pagination.classList.remove('hidden');
        }

        // í˜ì´ì§€ ì´ë™
        function goToPage(page) {
            currentPage = page;
            displayReviews();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // í•„í„° ë° ê²€ìƒ‰ ì ìš©
        function applyFiltersAndSort() {
            let filtered = [...allReviews];

            // ì¹´í…Œê³ ë¦¬ í•„í„°
            const categoryFilter = document.getElementById('category-filter').value;
            if (categoryFilter) {
                filtered = filtered.filter(review => 
                    (review.category && review.category.toLowerCase().includes(categoryFilter.toLowerCase())) ||
                    review.productName.toLowerCase().includes(categoryFilter.toLowerCase())
                );
            }

            // í‰ì  í•„í„°
            const ratingFilter = document.getElementById('rating-filter').value;
            if (ratingFilter) {
                filtered = filtered.filter(review => review.rating >= parseInt(ratingFilter));
            }

            // ê²€ìƒ‰
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            if (searchTerm) {
                filtered = filtered.filter(review => 
                    review.productName.toLowerCase().includes(searchTerm) ||
                    review.review.toLowerCase().includes(searchTerm) ||
                    review.name.toLowerCase().includes(searchTerm)
                );
            }

            // ì •ë ¬
            const sortFilter = document.getElementById('sort-filter').value;
            switch (sortFilter) {
                case 'newest':
                    filtered.sort((a, b) => {
                        const dateA = new Date(a.purchaseDate || 0);
                        const dateB = new Date(b.purchaseDate || 0);
                        return dateB - dateA;
                    });
                    break;
                case 'oldest':
                    filtered.sort((a, b) => {
                        const dateA = new Date(a.purchaseDate || 0);
                        const dateB = new Date(b.purchaseDate || 0);
                        return dateA - dateB;
                    });
                    break;
                case 'rating':
                    filtered.sort((a, b) => (b.rating || 0) - (a.rating || 0));
                    break;
                case 'savings':
                    filtered.sort((a, b) => {
                        const aSavings = typeof a.savingsPercent === 'number' ? a.savingsPercent : 
                                        typeof a.savingsPercent === 'string' ? parseInt(a.savingsPercent) || 0 : 0;
                        const bSavings = typeof b.savingsPercent === 'number' ? b.savingsPercent : 
                                        typeof b.savingsPercent === 'string' ? parseInt(b.savingsPercent) || 0 : 0;
                        return bSavings - aSavings;
                    });
                    break;
            }

            filteredReviews = filtered;
            currentPage = 1;
            displayReviews();
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.getElementById('category-filter').addEventListener('change', applyFiltersAndSort);
        document.getElementById('rating-filter').addEventListener('change', applyFiltersAndSort);
        document.getElementById('sort-filter').addEventListener('change', applyFiltersAndSort);
        document.getElementById('search-input').addEventListener('input', applyFiltersAndSort);

        // ì‚¬ì§„ ëª¨ë‹¬ í•¨ìˆ˜ë“¤
        function openPhotoModal(photoUrl) {
            document.getElementById('modal-photo').src = photoUrl;
            document.getElementById('photo-modal').classList.remove('hidden');
        }

        function closePhotoModal() {
            document.getElementById('photo-modal').classList.add('hidden');
        }

        // ì „ì—­ í•¨ìˆ˜ë¡œ ë…¸ì¶œ
        window.goToPage = goToPage;
        window.openPhotoModal = openPhotoModal;
        window.closePhotoModal = closePhotoModal;

        // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ ë° ì ‘ê·¼ ì œì–´ (ê°œì„ ëœ ë²„ì „)
        function checkLoginStatus() {
            const loggedIn = localStorage.getItem('loggedIn');
            const currentUser = localStorage.getItem('currentUser');
            const user = localStorage.getItem('user');
            const loggedInEmail = localStorage.getItem('loggedInEmail');
            const userEmail = localStorage.getItem('userEmail');
            const userData = localStorage.getItem('userData');
            
            // ë” ê°•í™”ëœ ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ - JSON íŒŒì‹±ë„ í¬í•¨
            let isLoggedIn = false;
            
            try {
                // ë¬¸ìì—´ í˜•íƒœì˜ 'true' ì²´í¬
                if (loggedIn === 'true') {
                    isLoggedIn = true;
                }
                
                // ì‚¬ìš©ì ë°ì´í„°ê°€ ìˆëŠ”ì§€ ì²´í¬
                if (currentUser || user || loggedInEmail || userEmail) {
                    isLoggedIn = true;
                }
                
                // JSON í˜•íƒœì˜ ì‚¬ìš©ì ë°ì´í„° ì²´í¬
                if (userData) {
                    const parsedUserData = JSON.parse(userData);
                    if (parsedUserData && (parsedUserData.email || parsedUserData.name)) {
                        isLoggedIn = true;
                    }
                }
                
                // ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ë„ ì²´í¬
                if (sessionStorage.getItem('loggedIn') === 'true' || 
                    sessionStorage.getItem('currentUser') ||
                    sessionStorage.getItem('user')) {
                    isLoggedIn = true;
                }
                
            } catch (error) {
                console.warn('ë¡œê·¸ì¸ ìƒíƒœ íŒŒì‹± ì˜¤ë¥˜:', error);
                // íŒŒì‹± ì˜¤ë¥˜ ì‹œ ê¸°ë³¸ê°’ ì‚¬ìš©
                isLoggedIn = loggedIn === 'true' || currentUser || user || loggedInEmail || userEmail;
            }
            
            const loginOverlay = document.getElementById('login-required-overlay');
            const mainContent = document.getElementById('main-content');
            
            console.log('ğŸ” ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ (ê°œì„ ëœ ë²„ì „):', {
                loggedIn: loggedIn,
                currentUser: currentUser,
                user: user,
                loggedInEmail: loggedInEmail,
                userEmail: userEmail,
                userData: userData,
                sessionLoggedIn: sessionStorage.getItem('loggedIn'),
                sessionCurrentUser: sessionStorage.getItem('currentUser'),
                isLoggedIn: isLoggedIn,
                loginOverlay: !!loginOverlay,
                mainContent: !!mainContent
            });
            
            if (isLoggedIn) {
                // ë¡œê·¸ì¸ëœ ê²½ìš°
                console.log('âœ… ë¡œê·¸ì¸ë¨ - í›„ê¸° í˜ì´ì§€ ì ‘ê·¼ í—ˆìš©');
                if (loginOverlay) {
                    loginOverlay.style.display = 'none';
                    loginOverlay.classList.add('hidden');
                }
                if (mainContent) {
                    mainContent.classList.remove('hidden');
                    mainContent.style.display = 'block';
                }
                loadReviews();
            } else {
                // ë¡œê·¸ì¸ë˜ì§€ ì•Šì€ ê²½ìš°
                console.log('âŒ ë¡œê·¸ì¸ ì•ˆë¨ - í›„ê¸° í˜ì´ì§€ ì ‘ê·¼ ì°¨ë‹¨');
                if (loginOverlay) {
                    loginOverlay.style.display = 'flex';
                    loginOverlay.classList.remove('hidden');
                }
                if (mainContent) {
                    mainContent.classList.add('hidden');
                    mainContent.style.display = 'none';
                }
            }
        }

        // ë¡œê·¸ì¸ ìƒíƒœ ë³€ê²½ ê°ì§€
        function onLoginStatusChange() {
            checkLoginStatus();
        }

        // ë¡œê·¸ì¸ ìƒíƒœ ë³€ê²½ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        window.addEventListener('storage', function(e) {
            if (e.key === 'loggedIn' || e.key === 'currentUser') {
                console.log('ğŸ”„ ë¡œê·¸ì¸ ìƒíƒœ ë³€ê²½ ê°ì§€:', e.key, e.newValue);
                onLoginStatusChange();
            }
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
        document.addEventListener('DOMContentLoaded', checkLoginStatus);
     </script>
 </body>
 </html>