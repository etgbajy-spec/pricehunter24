<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ë¡œê·¸ì¸ - PriceHunter</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23ec4899'><path d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z'/></svg>">
    
    <!-- ìºì‹œ ì œì–´ -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    
    <!-- Content Security Policy - Firebase iframe í—ˆìš© -->
    <meta http-equiv="Content-Security-Policy" content="frame-src 'self' https://www.google.com https://recaptcha.google.com https://kauth.kakao.com https://pricehunter-99a1b.firebaseapp.com https://*.firebaseapp.com https://*.googleapis.com https://apis.google.com https://*.firebaseapp.com; connect-src 'self' https://firestore.googleapis.com https://identitytoolkit.googleapis.com https://securetoken.googleapis.com https://firebasestorage.googleapis.com https://content-firebaseappcheck.googleapis.com https://www.googleapis.com https://*.firebaseio.com wss://*.firebaseio.com https://developers.kakao.com https://kapi.kakao.com https://kauth.kakao.com https://*.firebaseapp.com https://*.cloudfunctions.net https://api.emailjs.com https://www.gstatic.com https://*.gstatic.com https://apis.google.com https://*.googleapis.com;" />
    
    <meta name="cache-buster" content="v1.0-20241220" />
    <script>
      // ê°•ì œ ìºì‹œ ë¬´íš¨í™” ë° ë””ë²„ê¹…
      console.log('ğŸš€ login.html v1.0 ë¡œë“œë¨');
      console.log('ğŸ“ í˜„ì¬ URL:', window.location.href);
      console.log('ğŸ• ë¡œë“œ ì‹œê°„:', new Date().toISOString());
      
      // ë” ê°•ë ¥í•œ ìºì‹œ ë²„ìŠ¤í„°
      if (window.location.search.indexOf('v=') === -1) {
        console.log('ğŸ”„ ê°•ë ¥í•œ ìºì‹œ ë²„ìŠ¤í„° ì¶”ê°€ ì¤‘...');
        const timestamp = Date.now();
        const random = Math.random().toString(36).substring(7);
        window.location.href = window.location.href + (window.location.search ? '&' : '?') + 'v=' + timestamp + '&r=' + random;
      }
      
      // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ í™•ì¸
      window.addEventListener('load', function() {
        console.log('âœ… í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ - v1.0');
      });
    </script>
  
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Firebase v9 SDK (ëª¨ë“ˆì‹) -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
    import { getAuth, signInWithCustomToken, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js';
    import { getFirestore, doc, setDoc, getDoc, collection, query, orderBy, onSnapshot, addDoc, serverTimestamp, getDocs, where, deleteDoc } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js';
    
    // Firebase ì„¤ì •
    const firebaseConfig = {
      apiKey: "AIzaSyDBZxKyMS7eeBTbPnbZkj0WWOZQHNldoL4",
      authDomain: "pricehunter-99a1b.firebaseapp.com",
      projectId: "pricehunter-99a1b",
      storageBucket: "pricehunter-99a1b.firebasestorage.app",
      messagingSenderId: "242265693919",
      appId: "1:242265693919:web:74234d942b82a51541136a",
      measurementId: "G-4BKLV4EVB9"
    };

    // Firebase ì´ˆê¸°í™”
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // ì „ì—­ ë³€ìˆ˜ë¡œ ë…¸ì¶œ
    window.firebaseApp = app;
    window.firebaseAuth = auth;
    window.firebaseDb = db;
    window.firebaseAuthFunctions = { 
      signInWithCustomToken, 
      onAuthStateChanged, 
      signOut 
    };
    window.firebaseFirestoreFunctions = { 
      collection, 
      addDoc, 
      serverTimestamp, 
      getDocs, 
      where, 
      query, 
      deleteDoc,
      getDoc,
      setDoc,
      doc
    };
    window.firebase = {
      firestore: () => db,
      auth: () => auth,
      apps: [app],
      app: () => app,
      firestore: {
        FieldValue: {
          serverTimestamp: serverTimestamp
        }
      }
    };

    console.log('âœ… Firebase v9 ì´ˆê¸°í™” ì™„ë£Œ (login.html)');
  </script>
  
  <style>
    body {
      -webkit-user-select: text;
      -moz-user-select: text;
      -ms-user-select: text;
      user-select: text;
    }
    
    body, div, p, h1, h2, h3, h4, h5, h6, span, label {
      caret-color: transparent;
    }
    
    input, textarea {
      caret-color: auto;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
      .fade-in-up {
      animation: fadeInUp 0.6s ease-out;
    }

      .loading {
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }
  </style>
</head>

  <body class="bg-gradient-to-br from-pink-50 to-blue-50 min-h-screen">
  <!-- í—¤ë” -->
    <header class="bg-white shadow-sm">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center py-4">
          <div class="flex items-center">
            <a href="index.html" class="text-2xl font-bold text-pink-600">PriceHunter</a>
          </div>
          <nav class="hidden md:flex space-x-8">
            <a href="index.html" class="text-gray-600 hover:text-pink-600">í™ˆ</a>
            <a href="about.html" class="text-gray-600 hover:text-pink-600">ì†Œê°œ</a>
            <a href="contact.html" class="text-gray-600 hover:text-pink-600">ë¬¸ì˜</a>
          </nav>
      </div>
    </div>
  </header>

  <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <main class="max-w-4xl mx-auto px-4 py-12 mx-4">
      <div class="text-center mb-12 fade-in-up">
        <h1 class="text-4xl font-bold text-gray-900 mb-4">ë¡œê·¸ì¸</h1>
        <p class="text-lg text-gray-600">PriceHunterì—<br class="sm:hidden">ë‹¤ì‹œ ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!</p>
    </div>

      <!-- ë¡œê·¸ì¸ í¼ -->
      <div class="max-w-xs sm:max-w-sm md:max-w-md mx-auto bg-white rounded-2xl shadow-lg p-4 sm:p-6 md:p-8 mx-4 fade-in-up">
        <div class="mb-6">
          <div class="w-16 h-16 bg-blue-500 rounded-full flex items-center justify-center mx-auto mb-4">
            <span class="text-2xl">ğŸ”</span>
        </div>
          <h3 class="text-xl font-semibold text-gray-900 mb-2 text-center">ë¡œê·¸ì¸</h3>
          <p class="text-gray-600 text-center">ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼<br class="sm:hidden">ì…ë ¥í•´ì£¼ì„¸ìš”</p>
      </div>

      <form id="login-form" class="space-y-6">
        <!-- ì´ë©”ì¼ -->
        <div>
            <label for="email" class="block text-sm font-medium text-gray-700 mb-2">ì´ë©”ì¼</label>
            <input type="email" id="email" name="email" required placeholder="example@email.com"
                   class="w-full px-3 py-2 sm:px-4 sm:py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent text-sm sm:text-base">
        </div>

        <!-- ë¹„ë°€ë²ˆí˜¸ -->
        <div>
            <label for="password" class="block text-sm font-medium text-gray-700 mb-2">ë¹„ë°€ë²ˆí˜¸</label>
            <input type="password" id="password" name="password" required
                   class="w-full px-3 py-2 sm:px-4 sm:py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent text-sm sm:text-base">
        </div>

        <!-- ë¡œê·¸ì¸ ë²„íŠ¼ -->
          <button type="submit" id="login-button"
                  class="w-full bg-pink-600 hover:bg-pink-700 text-white font-semibold py-2 sm:py-3 px-4 sm:px-6 rounded-lg transition duration-200 text-sm sm:text-base">
            ë¡œê·¸ì¸
        </button>
      </form>

      <!-- ì˜¤ë¥˜ ë©”ì‹œì§€ -->
      <div id="login-error" class="text-red-500 text-center mt-4 hidden">
        <span>ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.</span>
      </div>
      
      <!-- í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì ìƒì„± ë²„íŠ¼ (ê°œë°œìš©) -->
      <div class="mt-4 text-center">
        <button id="create-test-user" class="text-xs text-gray-500 hover:text-gray-700 underline">
          í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì ìƒì„±
        </button>
      </div>
    </div>

    <!-- íšŒì›ê°€ì… ë§í¬ -->
    <div class="max-w-xs sm:max-w-sm md:max-w-md mx-auto text-center mt-8 mx-4">
      <p class="text-gray-600 mb-4">ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”?</p>
      <a href="register.html" class="inline-block bg-blue-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-blue-700 transition">íšŒì›ê°€ì…í•˜ê¸°</a>
      
    </div>
  </main>

  <script>
      // Firebase ì´ˆê¸°í™” ëŒ€ê¸°
      function waitForFirebase() {
        return new Promise((resolve, reject) => {
          console.log('ğŸ” Firebase ìƒíƒœ í™•ì¸:', {
            firebaseDefined: typeof firebase !== 'undefined',
            firebaseApps: firebase ? firebase.apps.length : 0,
            windowFirebaseApp: !!window.firebaseApp,
            windowFirebaseDb: !!window.firebaseDb,
            windowFirebaseAuth: !!window.firebaseAuth,
            firebaseFirestoreFunctions: !!window.firebaseFirestoreFunctions
          });
          
          if (window.firebaseApp && window.firebaseDb && window.firebaseAuth && window.firebaseFirestoreFunctions) {
            console.log('âœ… Firebase v9 ì¤€ë¹„ë¨');
            resolve();
          } else {
            const checkInterval = setInterval(() => {
              if (window.firebaseApp && window.firebaseDb && window.firebaseAuth && window.firebaseFirestoreFunctions) {
                clearInterval(checkInterval);
                console.log('âœ… Firebase v9 ì¤€ë¹„ë¨');
                resolve();
              }
            }, 100);
            
            // 10ì´ˆ í›„ íƒ€ì„ì•„ì›ƒ
            setTimeout(() => {
              clearInterval(checkInterval);
              console.error('âŒ Firebase ì´ˆê¸°í™” íƒ€ì„ì•„ì›ƒ');
              reject(new Error('Firebase ì´ˆê¸°í™” ì‹¤íŒ¨'));
            }, 10000);
          }
        });
      }

      // ì‚¬ìš©ì ë°ì´í„°ë¥¼ Firebaseì—ì„œ ê²€ìƒ‰
      async function findUserByEmail(email) {
        try {
          console.log('ğŸ” Firebaseì—ì„œ ì‚¬ìš©ì ê²€ìƒ‰ ì¤‘:', email);
          await waitForFirebase();
          
          const db = window.firebaseDb;
          const { collection, query, where, getDocs } = window.firebaseFirestoreFunctions;
          const usersRef = collection(db, 'users');
          
          // ì´ë©”ì¼ë¡œ ì‚¬ìš©ì ê²€ìƒ‰
          const emailQuery = query(usersRef, where('email', '==', email));
          const emailSnapshot = await getDocs(emailQuery);
          
          if (!emailSnapshot.empty) {
            const userDoc = emailSnapshot.docs[0];
            const userData = userDoc.data();
            console.log('âœ… Firebaseì—ì„œ ì‚¬ìš©ì ì°¾ìŒ:', userData.email);
            return userData;
          }
          
          console.log('âŒ Firebaseì—ì„œ ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ:', email);
          return null;
        } catch (error) {
          console.error('âŒ Firebase ì‚¬ìš©ì ê²€ìƒ‰ ì‹¤íŒ¨:', error);
          return null;
        }
      }

      // ì‚¬ìš©ì ë°ì´í„° upsert í•¨ìˆ˜
      async function upsertUser(userData, extra = {}) {
        try {
          await waitForFirebase();
          
          const db = window.firebaseDb;
          const { collection, addDoc, setDoc, serverTimestamp } = window.firebaseFirestoreFunctions;
          const usersRef = collection(db, 'users');
          
          const userDocData = {
            uid: userData.uid,
            email: userData.email,
            displayName: userData.displayName || userData.name || userData.nickname || '',
            photoURL: userData.photoURL || userData.profileImage || '',
            loginMethod: userData.loginMethod || 'email',
            createdAt: userData.createdAt || new Date(),
            updatedAt: new Date(),
            isActive: true,
            ...extra
          };
          
          // ì‚¬ìš©ì ë¬¸ì„œ ID ìƒì„± (ì´ë©”ì¼ ê¸°ë°˜)
          const docId = `email_${userData.email.replace('@', '_').replace('.', '_')}`;
          const userDocRef = doc(usersRef, docId);
          
          // ë¬¸ì„œ ì„¤ì • (upsert)
          await setDoc(userDocRef, userDocData, { merge: true });
          console.log('âœ… ì‚¬ìš©ì ë°ì´í„° upsert ì™„ë£Œ:', docId);
          
          return userDocData;
        } catch (error) {
          console.error('âŒ ì‚¬ìš©ì ë°ì´í„° upsert ì‹¤íŒ¨:', error);
          throw error;
        }
      }

      // ì…ë ¥ê°’ ê²€ì¦
      function validateInput(value, type) {
        if (!value || value.trim() === '') return false;
        
        switch (type) {
          case 'email':
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(value.trim());
          case 'password':
            return value.length >= 6;
          default:
            return true;
        }
      }

      // ì…ë ¥ê°’ ì •ë¦¬
      function sanitizeInput(input) {
        return input.trim().replace(/[<>]/g, '');
      }

      // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ
      function showToast(message, type = 'info') {
        // ê°„ë‹¨í•œ í† ìŠ¤íŠ¸ êµ¬í˜„
        const toast = document.createElement('div');
        toast.className = `fixed top-4 right-4 px-6 py-3 rounded-lg text-white z-50 ${
          type === 'success' ? 'bg-green-500' : 
          type === 'error' ? 'bg-red-500' : 
          'bg-blue-500'
        }`;
        toast.textContent = message;
        document.body.appendChild(toast);
        
        setTimeout(() => {
          document.body.removeChild(toast);
        }, 3000);
      }

      // ë¡œê·¸ì¸ ì‹œë„ ì œí•œ
      let loginAttempts = 0;
      const maxLoginAttempts = 5;
      let lockoutTime = 0;
      
      function canAttemptLogin() {
        const now = Date.now();
        if (lockoutTime > now) {
          const remainingTime = Math.ceil((lockoutTime - now) / 1000 / 60);
          showToast(`ë¡œê·¸ì¸ ì‹œë„ê°€ ì œí•œë˜ì—ˆìŠµë‹ˆë‹¤. ${remainingTime}ë¶„ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.`, 'error');
          return false;
        }
        return true;
      }
      
      function recordLoginAttempt(success) {
        if (success) {
          loginAttempts = 0;
          lockoutTime = 0;
        } else {
          loginAttempts++;
          if (loginAttempts >= maxLoginAttempts) {
            lockoutTime = Date.now() + (15 * 60 * 1000); // 15ë¶„ ì œí•œ
            showToast('ë¡œê·¸ì¸ ì‹œë„ê°€ ë„ˆë¬´ ë§ìŠµë‹ˆë‹¤. 15ë¶„ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'error');
          }
        }
      }

      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
      document.addEventListener('DOMContentLoaded', function() {
        console.log('ğŸš€ login.html v1.0 ë¡œë“œë¨');
        
        // ë¡œê·¸ì¸ í¼ ì œì¶œ
        document.getElementById('login-form').addEventListener('submit', async function(e) {
          e.preventDefault();
          
          const loginStartTime = performance.now();
          console.log('ğŸš€ ë¡œê·¸ì¸ í”„ë¡œì„¸ìŠ¤ ì‹œì‘');
          
          const email = sanitizeInput(document.getElementById('email').value.trim());
          const password = document.getElementById('password').value;
          
          // ì…ë ¥ê°’ ê²€ì¦
          if (!validateInput(email, 'email')) {
            showToast('ì˜¬ë°”ë¥¸ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”', 'error');
            return;
          }
          
          if (!validateInput(password, 'password')) {
            showToast('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”', 'error');
            return;
          }
          
          // ë¡œê·¸ì¸ ì‹œë„ ì œí•œ í™•ì¸
          if (!canAttemptLogin()) {
            return;
          }
          
          // ë¡œê·¸ì¸ ë²„íŠ¼ ë¹„í™œì„±í™”
          const loginButton = document.getElementById('login-button');
          loginButton.disabled = true;
          loginButton.textContent = 'ë¡œê·¸ì¸ ì¤‘...';
          loginButton.classList.add('loading');
          
          try {
            // Firebaseì—ì„œ ì‚¬ìš©ì ê²€ìƒ‰
            console.log('ğŸ” ë¡œê·¸ì¸ ì‹œë„ - ê²€ìƒ‰í•  ì´ë©”ì¼:', email);
            const user = await findUserByEmail(email);
            
            // ë””ë²„ê¹…ì„ ìœ„í•œ ì‚¬ìš©ì ì •ë³´ ì¶œë ¥
            if (user) {
              console.log('ğŸ‘¤ ì°¾ì€ ì‚¬ìš©ì ì •ë³´:', {
                email: user.email,
                name: user.name,
                hasPassword: !!user.password,
                uid: user.uid
              });
            }
            
            if (!user) {
              console.log('âŒ ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
              document.getElementById('login-error').classList.remove('hidden');
              recordLoginAttempt(false);
              showToast('ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'error');
              return;
            }
            
            // ë¹„ë°€ë²ˆí˜¸ ê²€ì¦
            console.log('ğŸ” ë¹„ë°€ë²ˆí˜¸ ê²€ì¦:', {
              hasPassword: !!user.password,
              userPassword: user.password ? '***' : 'null',
              inputPassword: password ? '***' : 'null',
              passwordMatch: user.password === password
            });
            
            // ë¹„ë°€ë²ˆí˜¸ ê²€ì¦ (íšŒì›ê°€ì… ì‹œ ë¹„ë°€ë²ˆí˜¸ëŠ” í•„ìˆ˜ì´ë¯€ë¡œ ë°˜ë“œì‹œ ìˆì–´ì•¼ í•¨)
            if (user.password !== password) {
              console.log('âŒ ë¹„ë°€ë²ˆí˜¸ ë¶ˆì¼ì¹˜');
              document.getElementById('login-error').classList.remove('hidden');
              recordLoginAttempt(false);
              showToast('ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'error');
              return;
            }
            console.log('âœ… ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜');
            
            // ë¡œê·¸ì¸ ì„±ê³µ ì²˜ë¦¬
            const userData = {
              uid: user.uid || `email_${user.email.replace('@', '_').replace('.', '_')}`,
              email: user.email,
              displayName: user.name || user.displayName || '',
              photoURL: user.photoURL || '',
              loginMethod: 'email'
            };

            // Firestoreì— ì‚¬ìš©ì ë°ì´í„° upsert
            await upsertUser(userData, {
              lastLogin: new Date(),
              loginCount: (user.loginCount || 0) + 1
            });

            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ë¡œê·¸ì¸ ì •ë³´ ì €ì¥
            localStorage.setItem('loggedIn', 'true');
            localStorage.setItem('currentUser', JSON.stringify(userData));
            localStorage.setItem('user', JSON.stringify(userData)); // ë§ˆì´í˜ì´ì§€ í˜¸í™˜ì„±
            localStorage.setItem('loggedInEmail', userData.email);
            
            const totalLoginTime = performance.now() - loginStartTime;
            console.log(`ğŸ‰ ë¡œê·¸ì¸ ì„±ê³µ! ì´ ì†Œìš”ì‹œê°„: ${totalLoginTime.toFixed(2)}ms`);
            recordLoginAttempt(true);
            showToast(`ë¡œê·¸ì¸ ì„±ê³µ! (${totalLoginTime.toFixed(0)}ms)`, 'success');
            
            // ë©”ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
            setTimeout(() => {
              window.location.href = 'index.html';
            }, 1000);
            
          } catch (error) {
            console.error('âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨:', error);
            document.getElementById('login-error').classList.remove('hidden');
            recordLoginAttempt(false);
            showToast('ë¡œê·¸ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
          } finally {
            // ë¡œê·¸ì¸ ë²„íŠ¼ í™œì„±í™”
            loginButton.disabled = false;
            loginButton.textContent = 'ë¡œê·¸ì¸';
            loginButton.classList.remove('loading');
          }
        });
        
        // í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì ìƒì„± ë²„íŠ¼
        document.getElementById('create-test-user').addEventListener('click', async function() {
          const testEmail = 'test@example.com';
          const testPassword = '123456';
          
          try {
            await waitForFirebase();
            
            const db = window.firebaseDb;
            const { collection, addDoc, serverTimestamp } = window.firebaseFirestoreFunctions;
            const usersRef = collection(db, 'users');
            
            // í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì ë°ì´í„°
            const testUserData = {
              uid: `email_${testEmail.replace('@', '_').replace('.', '_')}`,
              email: testEmail,
              name: 'í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì',
              displayName: 'í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì',
              phone: '010-1234-5678',
              password: testPassword,
              emailVerification: testEmail,
              agreeTerms: true,
              agreePrivacy: true,
              agreeMarketing: false,
              loginMethod: 'email',
              isActive: true,
              createdAt: serverTimestamp(),
              updatedAt: serverTimestamp()
            };
            
            // ì¤‘ë³µ í™•ì¸
            const { query, where, getDocs } = window.firebaseFirestoreFunctions;
            const emailQuery = query(usersRef, where('email', '==', testEmail));
            const emailSnapshot = await getDocs(emailQuery);
            
            if (!emailSnapshot.empty) {
              showToast('í…ŒìŠ¤íŠ¸ ì‚¬ìš©ìê°€ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤.', 'info');
              return;
            }
            
            // í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì ìƒì„±
            await addDoc(usersRef, testUserData);
            
            showToast('í…ŒìŠ¤íŠ¸ ì‚¬ìš©ìê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!\nì´ë©”ì¼: test@example.com\në¹„ë°€ë²ˆí˜¸: 123456', 'success');
            
            // í¼ì— í…ŒìŠ¤íŠ¸ ë°ì´í„° ì…ë ¥
            document.getElementById('email').value = testEmail;
            document.getElementById('password').value = testPassword;
            
          } catch (error) {
            console.error('í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì ìƒì„± ì‹¤íŒ¨:', error);
            showToast('í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
          }
        });
      });
  </script>
</body>
</html>
