<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex, nofollow" />
  
  <!-- Content Security Policy - Firebase iframe í—ˆìš© -->
  <meta http-equiv="Content-Security-Policy" content="frame-src 'self' https://www.google.com https://recaptcha.google.com https://kauth.kakao.com https://pricehunter-99a1b.firebaseapp.com https://*.firebaseapp.com https://*.googleapis.com;" />
  
  <title>íšŒì› ëŒ€ì‹œë³´ë“œ - PriceHunter</title>
  
  <!-- Google Analytics ì œê±°ë¨ - CSP ì˜¤ë¥˜ ë°©ì§€ -->
  
  <!-- ê°œë°œìš©: cdn.tailwindcss.com, í”„ë¡œë•ì…˜ìš©: ë¡œì»¬ íŒŒì¼ë¡œ ë³€ê²½ ê¶Œì¥ -->
  <!-- 
    âš ï¸ ì½˜ì†” ê²½ê³  ë¬´ì‹œí•˜ì„¸ìš”! âš ï¸
    - ê°œë°œ ì¤‘: cdn.tailwindcss.com ì‚¬ìš© (ë¹ ë¥¸ ê°œë°œ)
    - ë°°í¬ ì‹œ: ë¡œì»¬ íŒŒì¼ë¡œ ë³€ê²½ (ì„±ëŠ¥ ìµœì í™”)
    - ì´ ê²½ê³ ëŠ” ê°œë°œ ì¤‘ì—ëŠ” ë¬´ì‹œí•´ë„ ë©ë‹ˆë‹¤!
  -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Firebase v9 SDK (ëª¨ë“ˆì‹) -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
    import { getAuth, onAuthStateChanged, GoogleAuthProvider, reauthenticateWithPopup, reauthenticateWithRedirect, deleteUser, signOut } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js';
    import { getFirestore, collection, addDoc, serverTimestamp, query, orderBy, onSnapshot, getDocs, where, doc, updateDoc, deleteDoc, arrayUnion, limit } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js';
    
    // Firebase ì„¤ì •
    const firebaseConfig = {
      apiKey: "AIzaSyDBZxKyMS7eeBTbPnbZkj0WWOZQHNldoL4",
      authDomain: "pricehunter-99a1b.firebaseapp.com",
      projectId: "pricehunter-99a1b",
      storageBucket: "pricehunter-99a1b.firebasestorage.app",
      messagingSenderId: "242265693919",
      appId: "1:242265693919:web:74234d942b82a51541136a",
      measurementId: "G-4BKLV4EVB9"
    };

    // Firebase ì´ˆê¸°í™”
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Google Auth Provider ì„¤ì •
    const googleProvider = new GoogleAuthProvider();
    googleProvider.setCustomParameters({ prompt: 'select_account' });
    
    // ì „ì—­ ë³€ìˆ˜ë¡œ ë…¸ì¶œ
    window.firebaseApp = app;
    window.firebaseAuth = auth;
    window.firebaseDb = db;
    window.firebaseGoogleProvider = googleProvider;
    window.firebaseAuthFunctions = {
      reauthenticateWithPopup,
      reauthenticateWithRedirect,
      deleteUser,
      signOut,
      onAuthStateChanged
    };
    window.firebaseFirestoreFunctions = { 
      collection, 
      addDoc, 
      serverTimestamp, 
      query, 
      orderBy, 
      onSnapshot, 
      getDocs, 
      where, 
      doc, 
      updateDoc, 
      deleteDoc,
      arrayUnion,
      limit
    };

    console.log('âœ… Firebase v9 ì´ˆê¸°í™” ì™„ë£Œ (member-dashboard.html)');
    console.log('ğŸ” Firebase í•¨ìˆ˜ë“¤ í™•ì¸:', Object.keys(window.firebaseFirestoreFunctions));
    console.log('ğŸ” Firebase í•¨ìˆ˜ë“¤ ìƒì„¸:', {
      collection: typeof collection,
      getDocs: typeof getDocs,
      where: typeof where,
      query: typeof query,
      orderBy: typeof orderBy,
      addDoc: typeof addDoc,
      serverTimestamp: typeof serverTimestamp,
      onSnapshot: typeof onSnapshot,
      doc: typeof doc,
      updateDoc: typeof updateDoc,
      deleteDoc: typeof deleteDoc
    });
  </script>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* í…ìŠ¤íŠ¸ ì„ íƒ ë° í¸ì§‘ ë°©ì§€ */
    body {
      font-family: 'Noto Sans KR', sans-serif;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
    
    /* ë²„íŠ¼ê³¼ ë§í¬, ì…ë ¥ í•„ë“œëŠ” í…ìŠ¤íŠ¸ ì„ íƒ í—ˆìš© */
    button, a, input, textarea, select {
      -webkit-user-select: text;
      -moz-user-select: text;
      -ms-user-select: text;
      user-select: text;
    }
    
    /* í¼ ë¼ë²¨ê³¼ ì„¤ëª… í…ìŠ¤íŠ¸ëŠ” ì„ íƒ ë°©ì§€ */
    label, .form-description {
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
    .fade-in { animation: fadeIn 0.7s; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .spinner {
      border: 4px solid #e5e7eb;
      border-top: 4px solid #38bdf8;
      border-radius: 50%;
      width: 2.5rem;
      height: 2.5rem;
      animation: spin 1s linear infinite;
      margin: 0 auto;
    }
    @keyframes spin { 100% { transform: rotate(360deg); } }
    
    /* ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ë§ */
    #result-summary img {
      max-width: 100%;
      height: auto;
      margin: 10px 0;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      display: block;
    }
    
    /* ë¦¬ì¹˜ í…ìŠ¤íŠ¸ ë‚´ìš© ìŠ¤íƒ€ì¼ë§ */
    #result-summary {
      line-height: 1.6;
      word-wrap: break-word;
    }
    
    #result-summary p {
      margin: 8px 0;
    }
    
    #result-summary strong {
      font-weight: bold;
    }
    
    #result-summary em {
      font-style: italic;
    }
    
    #result-summary u {
      text-decoration: underline;
    }
    
    /* íƒ­ ìŠ¤íƒ€ì¼ë§ */
    .tab-button {
      transition: all 0.3s ease;
    }
    
    .tab-button.active {
      background: linear-gradient(135deg, #3b82f6, #1d4ed8);
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }
    
    .tab-panel {
      display: none;
    }
    
    .tab-panel.active {
      display: block;
      animation: fadeIn 0.5s ease-in-out;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-emerald-50 to-pink-50 min-h-screen">
  <div class="max-w-4xl mx-auto px-4 py-8">
    <!-- í—¤ë” -->
    <div class="text-center mb-8">
      <div class="flex justify-between items-center mb-4">
        <a href="index.html" class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white font-semibold rounded-lg shadow hover:shadow-lg transition-all duration-200 flex items-center gap-2">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
          </svg>
          í™ˆìœ¼ë¡œ ê°€ê¸°
        </a>
        <button id="header-logout-btn" class="px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white font-semibold rounded-lg shadow hover:shadow-lg transition-all duration-200 flex items-center gap-2">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
          </svg>
          ë¡œê·¸ì•„ì›ƒ
        </button>
      </div>
      <h1 class="text-3xl md:text-4xl font-extrabold text-blue-600 mb-2">íšŒì›<br class="sm:hidden">ëŒ€ì‹œë³´ë“œ</h1>
      <p class="text-gray-600">ë‚´ ì •ë³´ ê´€ë¦¬ ë°<br class="sm:hidden">ì˜ë¢° ê²°ê³¼ ì¡°íšŒ</p>
    </div>

    <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
    <div class="flex justify-center mb-8">
      <div class="bg-white rounded-2xl shadow-lg p-2 flex gap-2">
        <button id="tab-info" class="tab-button px-6 py-3 rounded-xl font-semibold text-gray-700 hover:bg-blue-50 active" onclick="switchTab('panel-info')">
          ğŸ‘¤ ë‚´ ì •ë³´
        </button>
        <button id="tab-requests" class="tab-button px-6 py-3 rounded-xl font-semibold text-gray-700 hover:bg-blue-50" onclick="switchTab('panel-requests')">
          ğŸ“‹ ì˜ë¢° ë‚´ì—­
        </button>
        <button id="tab-inquiry" class="tab-button px-6 py-3 rounded-xl font-semibold text-gray-700 hover:bg-blue-50" onclick="switchTab('panel-inquiry')">
          ğŸ’¬ 1:1 ë¬¸ì˜
        </button>
      </div>
    </div>

    <!-- íƒ­ ì»¨í…ì¸  -->
    <div class="bg-white rounded-3xl shadow-2xl p-6 md:p-8">
      <!-- ë‚´ ì •ë³´ íƒ­ -->
      <div id="panel-info" class="tab-panel active">
        <div class="max-w-2xl mx-auto">
          <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">ë‚´ ì •ë³´<br class="sm:hidden">ê´€ë¦¬</h2>
          
          <!-- ë‚´ ì •ë³´ í‘œì‹œ -->
          <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6 p-4 bg-blue-50 rounded-xl">
            <div>
              <div class="font-bold text-lg text-gray-800" id="mypage-name">ì´ë¦„</div>
              <div class="text-gray-500 text-sm" id="mypage-email">ì´ë©”ì¼</div>
            </div>
            <div class="flex gap-2">
              <button id="edit-info-btn" class="px-4 py-2 min-h-[44px] min-w-[44px] bg-blue-500 text-white rounded-lg shadow hover:bg-blue-600 focus:ring-2 focus:ring-blue-400 focus:outline-none transition">
                ì •ë³´ ìˆ˜ì •
              </button>
              <button id="logout-btn" class="px-4 py-2 min-h-[44px] bg-gray-500 text-white rounded-lg shadow hover:bg-gray-600 focus:ring-2 focus:ring-gray-400 focus:outline-none transition">
                ë¡œê·¸ì•„ì›ƒ
              </button>
              <button id="withdraw-btn" class="px-4 py-2 min-h-[44px] bg-red-500 text-white rounded-lg shadow hover:bg-red-600 focus:ring-2 focus:ring-red-400 focus:outline-none transition">
                íšŒì›íƒˆí‡´
              </button>
            </div>
          </div>

          <!-- ì •ë³´ìˆ˜ì • í¼ -->
          <div id="info-form-container" class="hidden">
            <form id="info-form" class="flex flex-col gap-4">
              <div>
                <label class="block text-gray-700 font-semibold mb-2">ì´ë¦„</label>
                <input type="text" id="info-name" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-400 focus:outline-none bg-gray-100 cursor-not-allowed" required readonly />
              </div>
              <div>
                <label class="block text-gray-700 font-semibold mb-2">ì´ë©”ì¼</label>
                <input type="email" id="info-email" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-400 focus:outline-none bg-gray-100 cursor-not-allowed" required readonly />
              </div>
              <div>
                <label class="block text-gray-700 font-semibold mb-2">íœ´ëŒ€í°</label>
                <input type="tel" id="info-phone" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-400 focus:outline-none bg-gray-100 cursor-not-allowed" readonly />
              </div>
              <div>
                <label class="block text-gray-700 font-semibold mb-2">ì¹´ì¹´ì˜¤ID</label>
                <input type="text" id="info-kakao" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-400 focus:outline-none" />
              </div>
              <button type="submit" class="w-full py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white font-bold rounded-lg shadow hover:scale-105 transition-all duration-300 text-lg mt-4">
                ì •ë³´ ì €ì¥
              </button>
            </form>
          </div>
        </div>
      </div>

      <!-- ì˜ë¢° ë‚´ì—­ íƒ­ -->
      <div id="panel-requests" class="tab-panel">
        <div class="max-w-4xl mx-auto">
          <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">ì˜ë¢° ë‚´ì—­ ë° ê²°ê³¼ ì¡°íšŒ</h2>
          
          <!-- ê²€ìƒ‰ ì„¹ì…˜ -->
          <div class="mb-8 p-6 bg-blue-50 rounded-xl">
            <label class="block text-gray-700 font-semibold mb-2">
              ì˜ë¢°ë²ˆí˜¸ ë˜ëŠ” íœ´ëŒ€í° ë²ˆí˜¸ë¡œ ê²°ê³¼ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </label>
            <div class="flex flex-col md:flex-row gap-3">
              <input id="search-input" type="text" class="flex-1 px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-400 focus:outline-none transition text-lg" placeholder="#PH-000000 ë˜ëŠ” 010-1234-5678" />
              <button id="search-btn" class="px-6 py-3 bg-gradient-to-r from-blue-400 to-emerald-400 text-white font-bold rounded-lg shadow-lg hover:scale-105 transition-all duration-300">
                ì¡°íšŒí•˜ê¸°
              </button>
            </div>
          </div>

          <!-- ì˜ë¢° ë¦¬ìŠ¤íŠ¸ -->
          <div id="my-request-list-section" class="mb-8">
            <div class="font-bold text-blue-700 mb-4 text-lg">ğŸ“‹ ì˜ë¢° ë‚´ì—­ ëª©ë¡</div>
            <ul id="my-request-list" class="bg-blue-50 rounded-xl shadow-inner divide-y divide-blue-100 text-left"></ul>
          </div>

          <!-- Loading Animation -->
          <div id="loading" class="hidden my-8 text-center">
            <div class="spinner"></div>
            <div class="mt-2 text-blue-400 font-semibold">ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
          </div>

          <!-- Result Card -->
          <div id="result-card" class="hidden w-full fade-in">
            <div class="bg-white rounded-2xl shadow-lg p-6 mb-4 text-left border-2 border-blue-100">
              <!-- ì§„í–‰ìƒí™© ë°°ì§€ -->
              <div class="mb-4 flex justify-between items-center">
                <div id="status-badge" class="px-3 py-1 rounded-full text-sm font-bold text-white"></div>
              </div>
              
              <!-- ì˜ë¢° ê¸°ë³¸ ì •ë³´ -->
              <div class="bg-blue-50 rounded-lg p-4 mb-6 border-l-4 border-blue-500">
                <h4 class="font-bold text-blue-800 mb-3">ğŸ“ ì˜ë¢° ê¸°ë³¸ ì •ë³´</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                  <div><span class="font-semibold">ì˜ë¢°ë²ˆí˜¸:</span> <span id="request-number"></span></div>
                  <div><span class="font-semibold">ì˜ë¢°ì¼ì‹œ:</span> <span id="request-date"></span></div>
                  <div><span class="font-semibold">ì œí’ˆëª…:</span> <span id="product-name"></span></div>
                  <div><span class="font-semibold">ìš”ì²­ê°€:</span> <span id="original-price"></span></div>
                </div>
              </div>
              
              <!-- ê²°ê³¼ ì •ë³´ -->
              <div id="result-info" class="hidden">
                <!-- ê²€ì¦ ê²°ê³¼ ì œëª© -->
                <div class="bg-white rounded-lg p-4 mb-6 border-l-4 border-green-500">
                  <h4 class="font-bold text-green-800 mb-3">ğŸ’° ê²€ì¦ ê²°ê³¼</h4>
                  <!-- ì œëª© ìˆ¨ê¹€ ì²˜ë¦¬ -->
                  <div id="result-title" class="text-2xl font-bold text-gray-800 mb-3 hidden"></div>
                  <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <div class="bg-green-50 rounded-lg p-3">
                      <div class="text-sm text-green-600 font-semibold">ìµœì €ê°€ (ì‹¤êµ¬ë§¤ê°€)</div>
                      <div id="result-price" class="text-2xl font-bold text-green-800"></div>
                    </div>
                    <div class="bg-blue-50 rounded-lg p-3">
                      <div class="text-sm text-blue-600 font-semibold">ì ˆì•½ ê¸ˆì•¡</div>
                      <div id="result-savings" class="text-2xl font-bold text-blue-800"></div>
                    </div>
                    <div class="bg-purple-50 rounded-lg p-3">
                      <div class="text-sm text-purple-600 font-semibold">ì ˆì•½ë¥ </div>
                      <div id="result-savings-percent" class="text-2xl font-bold text-purple-800"></div>
                    </div>
                  </div>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div><span class="font-semibold">ì›ì‚°ì§€/ê³µê¸‰ì²˜:</span> <span id="result-origin"></span></div>
                    <div><span class="font-semibold">êµ¬ë§¤ ë°©ë²•:</span> <span id="result-purchase-method"></span></div>
                  </div>
                </div>

                <!-- ê²€ì¦ ì‹œì  ì •ë³´ -->
                <div class="bg-white rounded-lg p-4 mb-6 border-l-4 border-orange-500">
                  <h4 class="font-bold text-orange-800 mb-3">ğŸ• ê²€ì¦ ì‹œì </h4>
                  <div class="text-sm text-gray-700">
                    <span class="font-semibold">ê²€ì¦ ì™„ë£Œì¼:</span> <span id="verification-date"></span>
                  </div>
                  <div class="text-xs text-gray-500 mt-1">
                    ğŸ’¡ ê²€ì¦ ì‹œì ì˜ ê°€ê²© ì •ë³´ì…ë‹ˆë‹¤. í˜„ì¬ ê°€ê²©ê³¼ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                  </div>
                </div>

                <!-- ìƒì„¸ ê²€ì¦ ë‚´ìš© -->
                <div class="bg-white rounded-lg p-4 mb-6 border-l-4 border-purple-500">
                  <h4 class="font-bold text-purple-800 mb-3">ğŸ“‹ ìƒì„¸ ê²€ì¦ ë‚´ìš©</h4>
                  <div id="result-summary" class="text-gray-700 bg-gray-50 rounded-xl p-4 min-h-[60px] overflow-hidden"></div>
                </div>

                <!-- ì¦ê±° ìë£Œ (ì¡°ê±´ë¶€ í‘œì‹œ) -->
                <div id="evidence-section" class="bg-white rounded-lg p-4 mb-6 border-l-4 border-yellow-500 hidden">
                  <h4 class="font-bold text-yellow-800 mb-3">ğŸ“¸ ì¦ê±° ìë£Œ</h4>
                  <!-- ì´ë¯¸ì§€ í‘œì‹œ ì˜ì—­ -->
                  <div id="result-image-container" class="mb-4 hidden">
                    <img id="result-image-display" class="max-w-full h-auto rounded-lg shadow-lg mx-auto" style="max-height: 400px;" alt="ê²€ì¦ ê²°ê³¼ ì´ë¯¸ì§€">
                  </div>
                  
                  <!-- ë§í¬ ì´ë™ ë²„íŠ¼ -->
                  <div id="action-buttons" class="mt-6 space-y-3 hidden">
                    <div class="flex justify-center">
                      <button id="link-button" class="px-8 py-3 bg-blue-500 text-white font-bold rounded-lg hover:bg-blue-600 transition text-center">
                        ğŸ”— ë§í¬ë¡œ ì´ë™í•˜ê¸°
                      </button>
                    </div>
                    <div class="text-xs text-gray-500 text-center">
                      ğŸ’¡ ë§í¬ë¡œ ì´ë™í•˜ì—¬ ì§ì ‘ êµ¬ë§¤í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </div>
                  </div>
                </div>

                <!-- ì •ì±… ì¤€ìˆ˜ í™•ì¸ -->
                <div class="bg-gradient-to-r from-green-50 to-blue-50 border border-green-200 rounded-lg p-4 mb-6">
                  <h4 class="font-bold text-green-800 mb-3">âœ… ê²€ì¦ ì •ì±… ì¤€ìˆ˜ í™•ì¸</h4>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                    <div class="space-y-2">
                      <div class="flex items-center gap-2">
                        <span class="text-green-600">âœ“</span>
                        <span>ê²€ì¦ ì‹œì ì´ ì •í™•íˆ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤</span>
                      </div>
                      <div class="flex items-center gap-2">
                        <span id="evidence-check" class="text-gray-400">â—‹</span>
                        <span>ì¦ê±° ìë£Œê°€ ì œì‹œë˜ì—ˆìŠµë‹ˆë‹¤</span>
                      </div>
                      <div class="flex items-center gap-2">
                        <span class="text-green-600">âœ“</span>
                        <span>ë¸Œëœë“œ ë°°ì œ ì •ì±…ì„ ì¤€ìˆ˜í–ˆìŠµë‹ˆë‹¤</span>
                      </div>
                    </div>
                    <div class="space-y-2">
                      <div class="flex items-center gap-2">
                        <span class="text-green-600">âœ“</span>
                        <span>ê°€ê²© ì •ë³´ê°€ ì •í™•í•©ë‹ˆë‹¤</span>
                      </div>
                      <div class="flex items-center gap-2">
                        <span class="text-green-600">âœ“</span>
                        <span>ìƒì„¸ ë‚´ìš©ì´ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤</span>
                      </div>
                      <div class="flex items-center gap-2">
                        <span class="text-green-600">âœ“</span>
                        <span>êµ¬ë§¤ ë°©ë²•ì´ ì•ˆë‚´ë˜ì—ˆìŠµë‹ˆë‹¤</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- No Result -->
          <div id="no-result" class="hidden text-center py-12">
            <div class="text-gray-500 text-lg">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
          </div>
        </div>
      </div>

      <!-- 1:1 ë¬¸ì˜ íƒ­ (ê¸°ì¡´ contact.html ê¸°ëŠ¥ ê·¸ëŒ€ë¡œ êµ¬í˜„) -->
      <div id="panel-inquiry" class="tab-panel">
        <div class="max-w-4xl mx-auto">
          <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">1:1 ë¬¸ì˜</h2>
          
          <!-- ë¬¸ì˜ ì‘ì„± í¼ (ê¸°ì¡´ contact.html ê·¸ëŒ€ë¡œ) -->
          <div class="mb-8 p-6 bg-blue-50 rounded-xl">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">ìƒˆ ë¬¸ì˜ ì‘ì„±</h3>
            <form id="contact-form" class="space-y-4">
              <div>
                <label class="block text-gray-700 font-semibold mb-2" for="contact-subject">ë¬¸ì˜ ì œëª©</label>
                <input type="text" id="contact-subject" name="contact-subject" required maxlength="60" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-pink-400 focus:outline-none transition" placeholder="ì˜ˆ: ì˜ë¢° ì „ ê¶ê¸ˆí•œ ì , ê²€ì¦ ê³¼ì • ë¬¸ì˜, ê°€ê²© ë¹„êµ ë°©ë²• ë“±" />
              </div>
              <div>
                <label class="block text-gray-700 font-semibold mb-2" for="contact-message">ë¬¸ì˜ ë‚´ìš©</label>
                <textarea id="contact-message" name="contact-message" rows="5" required class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-pink-400 focus:outline-none transition" placeholder="ì˜ë¢°í•˜ì‹¤ ìƒí’ˆì´ë‚˜ ì„œë¹„ìŠ¤ì— ëŒ€í•´ ê¶ê¸ˆí•œ ì ì„ ìì„¸íˆ ì…ë ¥í•´ ì£¼ì„¸ìš”.&#10;&#10;ì˜ˆì‹œ:&#10;- íŠ¹ì • ìƒí’ˆì˜ ìµœì €ê°€ ê²€ì¦ì´ ê°€ëŠ¥í•œê°€ìš”?&#10;- ê²€ì¦ ê³¼ì •ì—ì„œ ì–´ë–¤ ì •ë³´ë¥¼ ì œê³µí•´ì£¼ì‹œë‚˜ìš”?&#10;- ì˜ë¢° í›„ ê²°ê³¼ëŠ” ì–¸ì œ ë°›ì„ ìˆ˜ ìˆë‚˜ìš”?&#10;- ê°€ê²© ë¹„êµëŠ” ì–´ë–¤ ê¸°ì¤€ìœ¼ë¡œ í•˜ë‚˜ìš”?"></textarea>
              </div>
              <div>
                <label class="block text-gray-700 font-semibold mb-2" for="contact-file">ì²¨ë¶€íŒŒì¼ (ì„ íƒ, ì´ë¯¸ì§€/ë¬¸ì„œ ë“±)</label>
                <input type="file" id="contact-file" name="contact-file" class="w-full" accept="image/*,.pdf,.doc,.docx,.xls,.xlsx,.txt" />
                <div id="filePreview" class="mt-2"></div>
              </div>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label class="block text-gray-700 font-semibold mb-2" for="contact-name">ì´ë¦„</label>
                  <input type="text" id="contact-name" name="contact-name" readonly class="w-full px-4 py-3 rounded-lg border border-gray-200 bg-gray-100 text-gray-500" />
                </div>
                <div>
                  <label class="block text-gray-700 font-semibold mb-2" for="contact-email">ì´ë©”ì¼</label>
                  <input type="email" id="contact-email" name="contact-email" readonly class="w-full px-4 py-3 rounded-lg border border-gray-200 bg-gray-100 text-gray-500" />
                </div>
              </div>
              <button type="submit" class="w-full py-3 bg-gradient-to-r from-pink-400 to-amber-400 text-white font-bold rounded-lg shadow-lg hover:scale-105 hover:from-amber-400 hover:to-pink-400 transition-all duration-300 text-lg">ë¬¸ì˜ ì œì¶œí•˜ê¸°</button>
            </form>
            <div id="contact-success" class="hidden mt-6 p-4 bg-emerald-50 border border-emerald-200 rounded-xl text-emerald-700 text-center font-bold">ë¬¸ì˜ê°€ ì •ìƒì ìœ¼ë¡œ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤!</div>
          </div>

          <!-- ë¬¸ì˜ ë‚´ì—­ (ê¸°ì¡´ contact.html ê·¸ëŒ€ë¡œ) -->
          <div class="mb-8">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">ì´ì „ ë¬¸ì˜ ë‚´ì—­</h3>
            <ul id="contact-history" class="space-y-3 text-left text-sm">
              <!-- ë¬¸ì˜ ë‚´ì—­ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ì˜ë¢°ë‚´ì—­ ìƒì„¸ë³´ê¸° ëª¨ë‹¬ -->
  <div id="request-detail-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
    <div class="flex items-center justify-center min-h-screen p-4">
      <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
        <!-- ëª¨ë‹¬ í—¤ë” -->
        <div class="sticky top-0 bg-white border-b border-gray-200 p-6 rounded-t-2xl">
          <div class="flex justify-between items-center">
            <h2 class="text-2xl font-bold text-gray-800">ì˜ë¢° ìƒì„¸ ì •ë³´</h2>
            <button id="close-request-modal" class="text-gray-500 hover:text-gray-700 text-3xl font-bold">&times;</button>
          </div>
        </div>
        
        <!-- ëª¨ë‹¬ ë‚´ìš© -->
        <div class="p-6">
          <!-- ì˜ë¢° ê¸°ë³¸ ì •ë³´ -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
              ğŸ“ ì˜ë¢° ê¸°ë³¸ ì •ë³´
            </h3>
            <div class="bg-blue-50 rounded-lg p-4 border-l-4 border-blue-500">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                <div><span class="font-semibold text-gray-700">ì˜ë¢°ë²ˆí˜¸:</span> <span id="modal-request-number" class="text-blue-600"></span></div>
                <div><span class="font-semibold text-gray-700">ì˜ë¢°ì¼ì‹œ:</span> <span id="modal-request-date" class="text-blue-600"></span></div>
                <div><span class="font-semibold text-gray-700">ì œí’ˆëª…:</span> <span id="modal-product-name" class="text-blue-600"></span></div>
                <div><span class="font-semibold text-gray-700">ìš”ì²­ê°€:</span> <span id="modal-original-price" class="text-blue-600"></span></div>
                <div><span class="font-semibold text-gray-700">ìƒíƒœ:</span> <span id="modal-status" class="px-2 py-1 rounded-full text-xs font-bold text-white"></span></div>
                <div><span class="font-semibold text-gray-700">ì§„í–‰ë¥ :</span> <span id="modal-progress" class="text-blue-600"></span></div>
              </div>
            </div>
          </div>

          <!-- ì œí’ˆ ìƒì„¸ ì •ë³´ -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
              ğŸ›ï¸ ì œí’ˆ ìƒì„¸ ì •ë³´
            </h3>
            <div class="bg-green-50 rounded-lg p-4 border-l-4 border-green-500">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                <div><span class="font-semibold text-gray-700">ë¸Œëœë“œ:</span> <span id="modal-brand" class="text-green-600"></span></div>
                <div><span class="font-semibold text-gray-700">ëª¨ë¸ëª…:</span> <span id="modal-model" class="text-green-600"></span></div>
                <div><span class="font-semibold text-gray-700">ì¹´í…Œê³ ë¦¬:</span> <span id="modal-category" class="text-green-600"></span></div>
                <div><span class="font-semibold text-gray-700">ìˆ˜ëŸ‰:</span> <span id="modal-quantity" class="text-green-600"></span></div>
                <div class="md:col-span-2"><span class="font-semibold text-gray-700">ì œí’ˆ ì„¤ëª…:</span> <span id="modal-description" class="text-green-600"></span></div>
              </div>
            </div>
          </div>

          <!-- ì²¨ë¶€ ì´ë¯¸ì§€ -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
              ğŸ“¸ ì²¨ë¶€ ì´ë¯¸ì§€
            </h3>
            <div id="modal-images" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
              <!-- ì´ë¯¸ì§€ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </div>
          </div>

          <!-- ì—°ë½ì²˜ ì •ë³´ -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
              ğŸ“ ì—°ë½ì²˜ ì •ë³´
            </h3>
            <div class="bg-yellow-50 rounded-lg p-4 border-l-4 border-yellow-500">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                <div><span class="font-semibold text-gray-700">ì´ë¦„:</span> <span id="modal-user-name" class="text-yellow-600"></span></div>
                <div><span class="font-semibold text-gray-700">ì´ë©”ì¼:</span> <span id="modal-user-email" class="text-yellow-600"></span></div>
                <div><span class="font-semibold text-gray-700">íœ´ëŒ€í°:</span> <span id="modal-user-phone" class="text-yellow-600"></span></div>
                <div><span class="font-semibold text-gray-700">ì¹´ì¹´ì˜¤ID:</span> <span id="modal-user-kakao" class="text-yellow-600"></span></div>
              </div>
            </div>
          </div>

          <!-- ì¶”ê°€ ìš”ì²­ì‚¬í•­ -->
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
              ğŸ’¬ ì¶”ê°€ ìš”ì²­ì‚¬í•­
            </h3>
            <div class="bg-purple-50 rounded-lg p-4 border-l-4 border-purple-500">
              <div class="text-sm">
                <span class="font-semibold text-gray-700">íŠ¹ë³„ ìš”ì²­:</span> <span id="modal-special-request" class="text-purple-600"></span>
              </div>
            </div>
          </div>

          <!-- ê´€ë¦¬ì ë‹µë³€ (ìˆëŠ” ê²½ìš°) -->
          <div id="modal-admin-response" class="mb-6 hidden">
            <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
              ğŸ’¼ ê´€ë¦¬ì ë‹µë³€
            </h3>
            <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-6 border-l-4 border-blue-500 shadow-lg">
              <div class="flex items-center mb-4">
                <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center mr-3">
                  <span class="text-white font-bold text-lg">P</span>
                </div>
                <div>
                  <div class="font-semibold text-gray-800">PriceHunter íŒ€</div>
                  <div class="text-sm text-gray-500">
                    <span class="font-medium">ë‹µë³€ì¼ì‹œ:</span> <span id="modal-response-date"></span>
                  </div>
                </div>
              </div>
              <div class="bg-white rounded-lg p-4 shadow-sm">
                <div id="modal-response-content"></div>
              </div>
              <div class="mt-4 flex items-center text-sm text-gray-500">
                <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                </svg>
                ë‹µë³€ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ì „ì—­ ë³€ìˆ˜
    // ê³µí†µ ê°€ê²© í¬ë§· í•¨ìˆ˜ (ì»´ë§ˆ í‘œì‹œ)
    function formatPrice(price) {
      if (!price && price !== 0) return 'ê°€ê²© ì •ë³´ ì—†ìŒ';
      
      // ìˆ«ìë¡œ ë³€í™˜
      let numPrice;
      if (typeof price === 'number') {
        numPrice = price;
      } else if (typeof price === 'string') {
        // ë¬¸ìì—´ì—ì„œ ìˆ«ìë§Œ ì¶”ì¶œ
        numPrice = parseInt(price.replace(/[^\d]/g, '')) || 0;
      } else {
        return 'ê°€ê²© ì •ë³´ ì—†ìŒ';
      }
      
      // ì»´ë§ˆ í¬ë§·íŒ…
      return numPrice.toLocaleString() + 'ì›';
    }
    
    let currentReqKey = null;
    let currentDisplayedReq = null;
    let fileData = '';

    // íƒ­ ì „í™˜ ê¸°ëŠ¥ - ì „ì—­ í•¨ìˆ˜ë¡œ ë§Œë“¤ì–´ì„œ HTMLì—ì„œ ì§ì ‘ í˜¸ì¶œ ê°€ëŠ¥
    window.switchTab = function(tabId) {
      console.log('=== switchTab ì‹œì‘ ===', tabId);
      
      // 1. ëª¨ë“  íƒ­ ë²„íŠ¼ ë¹„í™œì„±í™”
      const allButtons = document.querySelectorAll('.tab-button');
      console.log('ì°¾ì€ íƒ­ ë²„íŠ¼ ìˆ˜:', allButtons.length);
      allButtons.forEach(btn => {
        btn.classList.remove('active');
        console.log('ë²„íŠ¼ ë¹„í™œì„±í™”:', btn.id);
      });
      
      // 2. ëª¨ë“  íƒ­ íŒ¨ë„ ìˆ¨ê¹€
      const allPanels = document.querySelectorAll('.tab-panel');
      console.log('ì°¾ì€ íƒ­ íŒ¨ë„ ìˆ˜:', allPanels.length);
      allPanels.forEach(panel => {
        panel.classList.remove('active');
        console.log('íŒ¨ë„ ìˆ¨ê¹€:', panel.id);
      });
      
      // 3. ì„ íƒëœ íƒ­ íŒ¨ë„ í‘œì‹œ
      const targetPanel = document.getElementById(tabId);
      if (targetPanel) {
        targetPanel.classList.add('active');
        console.log('âœ… íŒ¨ë„ í™œì„±í™” ì„±ê³µ:', tabId);
      } else {
        console.error('âŒ íŒ¨ë„ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ:', tabId);
        return;
      }
      
      // 4. ì„ íƒëœ íƒ­ ë²„íŠ¼ í™œì„±í™”
      let buttonId = '';
      if (tabId === 'panel-info') {
        buttonId = 'tab-info';
      } else if (tabId === 'panel-requests') {
        buttonId = 'tab-requests';
      } else if (tabId === 'panel-inquiry') {
        buttonId = 'tab-inquiry';
      }
      
      if (buttonId) {
        const targetButton = document.getElementById(buttonId);
        if (targetButton) {
          targetButton.classList.add('active');
          console.log('âœ… ë²„íŠ¼ í™œì„±í™” ì„±ê³µ:', buttonId);
        } else {
          console.error('âŒ ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ:', buttonId);
        }
      }
      
      // íƒ­ë³„ ë°ì´í„° ìƒˆë¡œê³ ì¹¨
      if (tabId === 'panel-requests') {
        renderMyRequestList();
      } else if (tabId === 'panel-inquiry') {
        renderHistory();
      }
      
      console.log('=== switchTab ì™„ë£Œ ===');
    }

    // ë‚´ ì •ë³´ í‘œì‹œ (Firebaseì—ì„œ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°)
    async function renderMyInfo() {
      try {
        await waitForFirebase();
        const { collection, query, where, getDocs } = window.firebaseFirestoreFunctions;
        const db = window.firebaseDb;
        
        // í˜„ì¬ ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ì´ë©”ì¼ ê°€ì ¸ì˜¤ê¸°
        const loggedInEmail = getUserEmail();
        
        if (!loggedInEmail) {
          console.error('âŒ ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }
        
        // Firebaseì—ì„œ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ
        const usersRef = collection(db, 'users');
        const q = query(usersRef, where('email', '==', loggedInEmail));
        const querySnapshot = await getDocs(q);
        
        if (!querySnapshot.empty) {
          const userDoc = querySnapshot.docs[0];
          const userData = userDoc.data();
          
          document.getElementById('mypage-name').textContent = userData.name || 'ì´ë¦„ ì—†ìŒ';
          document.getElementById('mypage-email').textContent = userData.email || 'ì´ë©”ì¼ ì—†ìŒ';
          document.getElementById('info-name').value = userData.name || '';
          document.getElementById('info-email').value = userData.email || '';
          document.getElementById('info-phone').value = userData.phone || '';
          document.getElementById('info-kakao').value = userData.kakao || '';
          
          // ë¬¸ì˜ í¼ì—ë„ ì‚¬ìš©ì ì •ë³´ ìë™ ì…ë ¥
          document.getElementById('contact-name').value = userData.name || '';
          document.getElementById('contact-email').value = userData.email || '';
        } else {
          console.error('Firebaseì—ì„œ ì‚¬ìš©ì ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          document.getElementById('mypage-name').textContent = 'ì‚¬ìš©ì ì •ë³´ ì—†ìŒ';
          document.getElementById('mypage-email').textContent = 'ì´ë©”ì¼ ì—†ìŒ';
          document.getElementById('info-name').value = '';
          document.getElementById('info-email').value = '';
          document.getElementById('info-phone').value = '';
          document.getElementById('info-kakao').value = '';
          
          // ë¬¸ì˜ í¼ì—ë„ ë¹ˆ ê°’ìœ¼ë¡œ ì„¤ì •
          document.getElementById('contact-name').value = '';
          document.getElementById('contact-email').value = '';
        }
      } catch (error) {
        console.error('ì‚¬ìš©ì ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', error);
        if (error.message === 'Firebase ì´ˆê¸°í™” ì‹¤íŒ¨') {
          console.error('âŒ Firebaseê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
          alert('Firebase ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
        }
      }
    }

    // Firebaseì—ì„œ ì˜ë¢° ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    async function getRequestsFromFirebase() {
      try {
        await waitForFirebase();
        const { collection, query, where, orderBy, getDocs } = window.firebaseFirestoreFunctions;
        const db = window.firebaseDb;
        
        // í˜„ì¬ ì‚¬ìš©ì ì´ë©”ì¼ ê°€ì ¸ì˜¤ê¸°
        const userEmail = getUserEmail();
        console.log('ğŸ” ìµœì¢… ì‚¬ìš©ì ì´ë©”ì¼:', userEmail);
        
        if (!userEmail) {
          console.log('âŒ ì‚¬ìš©ì ì´ë©”ì¼ì„ ì°¾ì„ ìˆ˜ ì—†ì–´ì„œ Firebaseì—ì„œ ì˜ë¢° ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          console.log('ğŸ” localStorage ìƒíƒœ:', {
            loggedInEmail: localStorage.getItem('loggedInEmail'),
            currentUser: localStorage.getItem('currentUser'),
            user: localStorage.getItem('user'),
            loggedIn: localStorage.getItem('loggedIn')
          });
          return [];
        }
        
        // Firebaseì—ì„œ í•´ë‹¹ ì‚¬ìš©ìì˜ ì˜ë¢° ë°ì´í„° ì¡°íšŒ
        console.log('ğŸ” ì‚¬ìš©ì ì´ë©”ì¼ë¡œ ì˜ë¢° ë°ì´í„° ì¡°íšŒ:', userEmail);
        
        let querySnapshot;
        try {
          // ë¨¼ì € orderBy ì—†ì´ ì¡°íšŒí•´ë³´ê¸°
          const requestsQuery = query(
            collection(db, 'requests'),
            where('email', '==', userEmail)
          );
          
          querySnapshot = await getDocs(requestsQuery);
          console.log('ğŸ” ì¿¼ë¦¬ ê²°ê³¼:', querySnapshot.size, 'ê°œ ë¬¸ì„œ ë°œê²¬');
        } catch (queryError) {
          console.warn('âš ï¸ where ì¿¼ë¦¬ ì‹¤íŒ¨, ëª¨ë“  ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ì„œ í•„í„°ë§:', queryError);
          
          // ì¿¼ë¦¬ ì‹¤íŒ¨ì‹œ ìµœì‹  500ê°œë§Œ ê°€ì ¸ì™€ì„œ í´ë¼ì´ì–¸íŠ¸ì—ì„œ í•„í„°ë§ (ì¿¼ë¦¬ ìµœì í™”)
          const { limit } = window.firebaseFirestoreFunctions;
          const allRequestsQuery = query(collection(db, 'requests'), limit(500));
          querySnapshot = await getDocs(allRequestsQuery);
          console.log('ğŸ” ì „ì²´ ì˜ë¢° ë°ì´í„° (ìµœì‹  500ê°œ):', querySnapshot.size, 'ê°œ ë¬¸ì„œ ë°œê²¬');
        }
        
        const requests = [];
        
        querySnapshot.forEach((doc) => {
          const data = doc.data();
          console.log('ğŸ“„ ë¬¸ì„œ ë°ì´í„°:', doc.id, data.email, 'vs', userEmail);
          
          // ì´ë©”ì¼ì´ ì¼ì¹˜í•˜ëŠ” ê²½ìš°ë§Œ ì¶”ê°€
          if (data.email === userEmail) {
            requests.push({
              id: doc.id,
              ...data
            });
          }
        });
        
        // í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œì—ì„œ ì •ë ¬ (createdAt ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ)
        requests.sort((a, b) => {
          const aTime = a.createdAt ? a.createdAt.toDate ? a.createdAt.toDate() : new Date(a.createdAt) : new Date(0);
          const bTime = b.createdAt ? b.createdAt.toDate ? b.createdAt.toDate() : new Date(b.createdAt) : new Date(0);
          return bTime - aTime;
        });
        
        console.log(`âœ… Firebaseì—ì„œ ì˜ë¢° ë°ì´í„° ${requests.length}ê°œ ê°€ì ¸ì˜´`);
        console.log('ğŸ“Š ì˜ë¢° ë°ì´í„° ìƒì„¸:', requests);
        return requests;
      } catch (error) {
        console.error('âŒ Firebaseì—ì„œ ì˜ë¢° ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
        if (error.message === 'Firebase ì´ˆê¸°í™” ì‹¤íŒ¨') {
          console.error('âŒ Firebaseê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
          alert('Firebase ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
        }
        return [];
      }
    }
    
    // Firebaseì—ì„œ ë¬¸ì˜ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    async function getInquiriesFromFirebase() {
      try {
        await waitForFirebase();
        const { collection, query, where, orderBy, getDocs } = window.firebaseFirestoreFunctions;
        const db = window.firebaseDb;
        
        // í˜„ì¬ ì‚¬ìš©ì ì´ë©”ì¼ ê°€ì ¸ì˜¤ê¸°
        const userEmail = getUserEmail();
        
        if (!userEmail) {
          console.log('âŒ ì‚¬ìš©ì ì´ë©”ì¼ì„ ì°¾ì„ ìˆ˜ ì—†ì–´ì„œ Firebaseì—ì„œ ë¬¸ì˜ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          return [];
        }
        
        // Firebaseì—ì„œ í•´ë‹¹ ì‚¬ìš©ìì˜ ë¬¸ì˜ ë°ì´í„° ì¡°íšŒ
        console.log('ğŸ” ì‚¬ìš©ì ì´ë©”ì¼ë¡œ ë¬¸ì˜ ë°ì´í„° ì¡°íšŒ:', userEmail);
        
        let querySnapshot;
        try {
          // ë¨¼ì € orderBy ì—†ì´ ì¡°íšŒí•´ë³´ê¸°
          const inquiriesQuery = query(
            collection(db, 'inquiries'),
            where('email', '==', userEmail)
          );
          
          querySnapshot = await getDocs(inquiriesQuery);
          console.log('ğŸ” ë¬¸ì˜ ì¿¼ë¦¬ ê²°ê³¼:', querySnapshot.size, 'ê°œ ë¬¸ì„œ ë°œê²¬');
        } catch (queryError) {
          console.warn('âš ï¸ ë¬¸ì˜ where ì¿¼ë¦¬ ì‹¤íŒ¨, ëª¨ë“  ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ì„œ í•„í„°ë§:', queryError);
          
          // ì¿¼ë¦¬ ì‹¤íŒ¨ì‹œ ìµœì‹  500ê°œë§Œ ê°€ì ¸ì™€ì„œ í´ë¼ì´ì–¸íŠ¸ì—ì„œ í•„í„°ë§ (ì¿¼ë¦¬ ìµœì í™”)
          const { limit } = window.firebaseFirestoreFunctions;
          const allInquiriesQuery = query(collection(db, 'inquiries'), limit(500));
          querySnapshot = await getDocs(allInquiriesQuery);
          console.log('ğŸ” ì „ì²´ ë¬¸ì˜ ë°ì´í„° (ìµœì‹  500ê°œ):', querySnapshot.size, 'ê°œ ë¬¸ì„œ ë°œê²¬');
        }
        const inquiries = [];
        
        querySnapshot.forEach((doc) => {
          const data = doc.data();
          console.log('ğŸ“„ ë¬¸ì˜ ë¬¸ì„œ ë°ì´í„°:', doc.id, data.email, 'vs', userEmail);
          
          // ì´ë©”ì¼ì´ ì¼ì¹˜í•˜ëŠ” ê²½ìš°ë§Œ ì¶”ê°€
          if (data.email === userEmail) {
            inquiries.push({
              id: doc.id,
              ...data
            });
          }
        });
        
        // í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œì—ì„œ ì •ë ¬ (date ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ)
        inquiries.sort((a, b) => {
          const aTime = a.date ? new Date(a.date) : new Date(0);
          const bTime = b.date ? new Date(b.date) : new Date(0);
          return bTime - aTime;
        });
        
        console.log(`âœ… Firebaseì—ì„œ ë¬¸ì˜ ë°ì´í„° ${inquiries.length}ê°œ ê°€ì ¸ì˜´`);
        return inquiries;
      } catch (error) {
        console.error('âŒ Firebaseì—ì„œ ë¬¸ì˜ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
        if (error.message === 'Firebase ì´ˆê¸°í™” ì‹¤íŒ¨') {
          console.error('âŒ Firebaseê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
          alert('Firebase ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
        }
        return [];
      }
    }

    // ì˜ë¢° ë‚´ì—­ ëª©ë¡ ë Œë”ë§ (Firebase + ë¡œì»¬ìŠ¤í† ë¦¬ì§€ í†µí•©)
    async function renderMyRequestList() {
      const requestList = document.getElementById('my-request-list');
      let requests = [];
      
      try {
        // 1. Firebaseì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹œë„
        const firebaseRequests = await getRequestsFromFirebase();
        if (firebaseRequests.length > 0) {
          requests = firebaseRequests;
          console.log('Firebaseì—ì„œ ì˜ë¢° ë°ì´í„° ì‚¬ìš©');
        } else {
          // Firebaseì— ë°ì´í„°ê°€ ì—†ìŒ
          console.log('Firebaseì— ë°ì´í„° ì—†ìŒ');
          requests = [];
        }
      } catch (error) {
        console.error('Firebase ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
        requests = [];
      }
      
      // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ í•¨ìˆ˜ ì œê±°ë¨ - Firebase ì „ìš© ì‚¬ìš©
      
      // ë‚ ì§œìˆœìœ¼ë¡œ ì •ë ¬ (ìµœì‹ ìˆœ)
      requests.sort((a, b) => {
        const dateA = new Date(a.reqDate || a.createdAt || 0);
        const dateB = new Date(b.reqDate || b.createdAt || 0);
        return dateB - dateA;
      });
      
      if (requests.length === 0) {
        requestList.innerHTML = '<li class="p-4 text-gray-500 text-center">ì˜ë¢° ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</li>';
        return;
      }
      
      requestList.innerHTML = '';
      requests.forEach((request) => {
        // Firebase ë°ì´í„°ì™€ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ë°ì´í„° êµ¬ì¡° í†µí•© ì²˜ë¦¬
        const reqNum = request.reqNum || request.requestNumber || request.data?.reqNum;
        const userName = request.userName || request.name || request.data?.userName;
        const reqDate = request.reqDate || request.createdAt || request.data?.reqDate;
        const productName = request.productName || request.name || request.data?.productName;
        
        let formattedDate = 'ë‚ ì§œ ì—†ìŒ';
        if (reqDate) {
          try {
            let date;
            if (reqDate.toDate) {
              date = reqDate.toDate();
            } else if (reqDate.seconds) {
              date = new Date(reqDate.seconds * 1000);
            } else {
              date = new Date(reqDate);
            }
            formattedDate = isNaN(date.getTime()) ? 'ë‚ ì§œ ì—†ìŒ' : date.toLocaleDateString('ko-KR');
          } catch (e) {
            formattedDate = 'ë‚ ì§œ ì—†ìŒ';
          }
        }
        
        // Firebase ìƒíƒœ í™•ì¸
        const requestStatus = request.status || 'ì²˜ë¦¬ì¤‘';
        const hasAdminResponse = request.adminResponse && Object.keys(request.adminResponse).length > 0;
        
        const listItem = document.createElement('li');
        listItem.className = 'p-4 hover:bg-blue-100 cursor-pointer transition-colors';
        listItem.innerHTML = `
          <div class="flex justify-between items-start">
            <div class="flex-1">
              <div class="font-semibold text-gray-800">${reqNum}</div>
              <div class="text-sm text-gray-600">${userName} | ${formattedDate}</div>
              <div class="text-sm text-gray-500 mt-1">${productName}</div>
            </div>
            <div class="ml-4 text-right">
              ${requestStatus === 'ë‹µë³€ì™„ë£Œ' ? 
                '<span class="inline-block px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full">ë‹µë³€ì™„ë£Œ</span>' :
                requestStatus === 'ì²˜ë¦¬ì¤‘' ?
                '<span class="inline-block px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full">ì²˜ë¦¬ì¤‘</span>' :
                requestStatus === 'ëŒ€ê¸°' ?
                '<span class="inline-block px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded-full">ëŒ€ê¸°</span>' :
                '<span class="inline-block px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">' + requestStatus + '</span>'
              }
            </div>
          </div>
        `;
        
        listItem.onclick = () => {
          // ì˜ë¢° ìƒì„¸ë³´ê¸° ëª¨ë‹¬ í‘œì‹œ
          showRequestDetailModal(request);
        };
        
        requestList.appendChild(listItem);
      });
    }

    // ì˜ë¢° ì •ë³´ë§Œ í‘œì‹œ (ê²°ê³¼ ë°ì´í„°ê°€ ì—†ì„ ë•Œ)
    function displayRequestOnly(requestData, reqNum) {
      console.log('ì˜ë¢° ì •ë³´ë§Œ í‘œì‹œ:', reqNum, requestData);
      
      // ë¡œë”© ìˆ¨ê¸°ê¸°
      document.getElementById('loading').classList.add('hidden');
      
      // ì˜ë¢° ì •ë³´ í‘œì‹œ
      const resultInfo = document.getElementById('result-info');
      resultInfo.classList.remove('hidden');
      
      // ì œëª© ì„¤ì •
      const resultTitle = document.getElementById('result-title');
      if (resultTitle) {
        resultTitle.textContent = 'ì˜ë¢° ì ‘ìˆ˜ ì™„ë£Œ';
      }
      
      // ë‚´ìš© ì„¤ì • - ì˜ë¢° ì ‘ìˆ˜ ì™„ë£Œ ë©”ì‹œì§€
      const content = `
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
          <div class="flex items-center">
            <svg class="w-6 h-6 text-blue-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <h3 class="text-lg font-semibold text-blue-800">ì˜ë¢°ê°€ ì„±ê³µì ìœ¼ë¡œ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤</h3>
          </div>
          <p class="text-blue-700 mt-2">ì „ë¬¸ ê²€ì¦íŒ€ì´ ìµœì €ê°€ ê²€ì¦ì„ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤. ê²°ê³¼ëŠ” 1-2ì¼ ë‚´ì— ì—°ë½ë“œë¦¬ê² ìŠµë‹ˆë‹¤.</p>
        </div>
        <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
          <h4 class="font-semibold text-gray-800 mb-2">ì˜ë¢° ìƒì„¸ ì •ë³´</h4>
          <div class="space-y-2 text-sm text-gray-600">
            <p><span class="font-medium">ìƒí’ˆëª…:</span> ${requestData.name || 'ì •ë³´ ì—†ìŒ'}</p>
            <p><span class="font-medium">ìš”ì²­ê°€ê²©:</span> ${requestData.price ? formatPrice(requestData.price) : 'ì •ë³´ ì—†ìŒ'}</p>
            <p><span class="font-medium">ìƒí’ˆ ì„¤ëª…:</span> ${requestData.desc || 'ì •ë³´ ì—†ìŒ'}</p>
            ${requestData.urls && requestData.urls.length > 0 ? `<p><span class="font-medium">ì°¸ê³  ë§í¬:</span> <a href="${requestData.urls[0]}" target="_blank" class="text-blue-600 hover:underline">${requestData.urls[0]}</a></p>` : ''}
          </div>
        </div>
      `;
      document.getElementById('result-summary').innerHTML = content;
      
      // ì˜ë¢° ê¸°ë³¸ ì •ë³´ ì„¤ì •
      const requestNumber = document.getElementById('request-number');
      const requestDate = document.getElementById('request-date');
      const productName = document.getElementById('product-name');
      const originalPrice = document.getElementById('original-price');
      
      if (requestNumber) requestNumber.textContent = reqNum;
      if (requestDate) {
        const dateStr = requestData.date || requestData.createdAt || '';
        requestDate.textContent = formatDateTime(dateStr);
      }
      if (productName) {
        productName.textContent = requestData.name || requestData.productName || '';
      }
      if (originalPrice) {
        originalPrice.textContent = formatPrice(requestData.price);
      }
      
      // ì¦ê±°ìë£Œ ì„¹ì…˜ ìˆ¨ê¸°ê¸° (ê²°ê³¼ê°€ ì—†ìœ¼ë¯€ë¡œ)
      const evidenceSection = document.getElementById('evidence-section');
      if (evidenceSection) {
        evidenceSection.classList.add('hidden');
      }
      
      // ë§í¬ ì„¹ì…˜ ìˆ¨ê¸°ê¸° (ê²°ê³¼ê°€ ì—†ìœ¼ë¯€ë¡œ)
      const linkSection = document.getElementById('link-section');
      if (linkSection) {
        linkSection.classList.add('hidden');
      }
    }

    // ê´€ë¦¬ì ë‹µë³€ í‘œì‹œ (ê¸°ì¡´ í˜ì´ì§€ ê¸°ëŠ¥ ê·¸ëŒ€ë¡œ)
    function showAdminResponse(reqNum) {
      currentReqKey = 'request-' + reqNum;
      currentDisplayedReq = reqNum;
      
      // ë¡œë”© í‘œì‹œ
      document.getElementById('loading').classList.remove('hidden');
      document.getElementById('result-card').classList.add('hidden');
      document.getElementById('no-result').classList.add('hidden');
      
      // ì˜ë¢° ë°ì´í„° ì°¾ê¸°
      const requestKey = 'request-' + reqNum;
      let requestData = null;
      try {
        const data = localStorage.getItem(requestKey);
        if (data) {
          requestData = JSON.parse(data);
          console.log('ì˜ë¢° ë°ì´í„° ë¡œë“œ ì„±ê³µ:', requestKey, requestData);
        } else {
          console.log('ì˜ë¢° ë°ì´í„° ì—†ìŒ:', requestKey);
        }
      } catch (e) {
        console.log('ì˜ë¢° ë°ì´í„° íŒŒì‹± ì‹¤íŒ¨:', requestKey, e);
      }
      
      // ê²°ê³¼ ë°ì´í„° ì°¾ê¸°
      const possibleKeys = [
        'result-' + reqNum,
        'result-' + reqNum.replace('#', ''),
        'result-' + reqNum.replace('#PH-', ''),
        'result-' + reqNum.replace('PH-', ''),
        'result-' + reqNum.replace('#', '').replace('PH-', '')
      ];
      
      let resultData = null;
      for (const key of possibleKeys) {
        try {
          const data = localStorage.getItem(key);
          if (data) {
            resultData = JSON.parse(data);
            console.log('ê²°ê³¼ ë°ì´í„° ë¡œë“œ ì„±ê³µ:', key, resultData);
            break;
          }
        } catch (e) {
          console.log('ê²°ê³¼ ë°ì´í„° íŒŒì‹± ì‹¤íŒ¨:', key, e);
        }
      }
      
      if (!resultData) {
        console.log('ê²°ê³¼ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ. ê²€ìƒ‰í•œ í‚¤ë“¤:', possibleKeys);
      }
      
      // ê²°ê³¼ ë°ì´í„°ê°€ ì—†ì–´ë„ ì˜ë¢° ì •ë³´ëŠ” í‘œì‹œ
      if (!resultData) {
        console.log('ê²°ê³¼ ë°ì´í„° ì—†ìŒ - ì˜ë¢° ì •ë³´ë§Œ í‘œì‹œ');
        document.getElementById('loading').classList.add('hidden');
        
        // ì˜ë¢° ì •ë³´ë§Œ í‘œì‹œ
        if (requestData) {
          displayRequestOnly(requestData, reqNum);
        } else {
          document.getElementById('no-result').classList.remove('hidden');
        }
        return;
      }
      
      // DOM ìš”ì†Œ í‘œì‹œ
      const resultInfo = document.getElementById('result-info');
      resultInfo.classList.remove('hidden');
      
      // ì œëª© ì„¤ì • - "ìµœì €ê°€ê¸ˆì¦" ì˜¤íƒ€ ìˆ˜ì •
      const resultTitle = document.getElementById('result-title');
      if (resultTitle && resultData.title) {
        // "ìµœì €ê°€ê¸ˆì¦" ì˜¤íƒ€ë¥¼ "ìµœì €ê°€ ê²€ì¦"ìœ¼ë¡œ ìˆ˜ì •
        let title = resultData.title;
        if (title.includes('ìµœì €ê°€ê¸ˆì¦')) {
          title = title.replace('ìµœì €ê°€ê¸ˆì¦', 'ìµœì €ê°€ ê²€ì¦');
        }
        resultTitle.textContent = title;
      }
      
      // ë‚´ìš© ì„¤ì •
      const content = resultData.content || resultData.summary || 'ê²°ê³¼ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.';
      document.getElementById('result-summary').innerHTML = content;
      
      // ì˜ë¢° ê¸°ë³¸ ì •ë³´ ì„¤ì •
      const requestNumber = document.getElementById('request-number');
      const requestDate = document.getElementById('request-date');
      const productName = document.getElementById('product-name');
      const originalPrice = document.getElementById('original-price');
      
      if (requestNumber) requestNumber.textContent = reqNum;
      if (requestDate) {
        const dateStr = requestData ? (requestData.date || requestData.createdAt || '') : '';
        requestDate.textContent = formatDateTime(dateStr);
      }
      if (productName) {
        productName.textContent = requestData ? (requestData.name || requestData.productName || '') : '';
      }
      if (originalPrice) {
        const price = requestData ? requestData.price : '';
        if (typeof price === 'number') {
          originalPrice.textContent = price.toLocaleString() + 'ì›';
        } else if (typeof price === 'string') {
          originalPrice.textContent = price;
        } else {
          originalPrice.textContent = '';
        }
      }

      // ê²€ì¦ ê²°ê³¼ ì •ë³´ ì„¤ì •
      const resultPrice = document.getElementById('result-price');
      const resultSavings = document.getElementById('result-savings');
      const resultSavingsPercent = document.getElementById('result-savings-percent');
      const resultOrigin = document.getElementById('result-origin');
      const resultPurchaseMethod = document.getElementById('result-purchase-method');
      const verificationDate = document.getElementById('verification-date');
      
      // ìµœì €ê°€ ì„¤ì •
      if (resultPrice) {
        resultPrice.textContent = resultData.finalPrice || resultData.price || '';
      }
      
      // ì ˆì•½ ê¸ˆì•¡ ê³„ì‚° ë° ì„¤ì •
      if (resultSavings) {
        // ìˆ«ì íƒ€ì… ì²˜ë¦¬ í•¨ìˆ˜
        const extractNumber = (value) => {
          if (typeof value === 'number') return value;
          if (typeof value === 'string') {
            return parseInt(value.replace(/[^\d]/g, '')) || 0;
          }
          return 0;
        };
        
        const original = extractNumber(requestData.price);
        const final = extractNumber(resultData.finalPrice || resultData.price);
        const savings = original - final;
        if (savings > 0) {
          resultSavings.textContent = savings.toLocaleString() + 'ì›';
        } else {
          resultSavings.textContent = resultData.savings || '';
        }
      }
      
      // ì ˆì•½ë¥  ê³„ì‚° ë° ì„¤ì •
      if (resultSavingsPercent) {
        // ìˆ«ì íƒ€ì… ì²˜ë¦¬ í•¨ìˆ˜
        const extractNumber = (value) => {
          if (typeof value === 'number') return value;
          if (typeof value === 'string') {
            return parseInt(value.replace(/[^\d]/g, '')) || 0;
          }
          return 0;
        };
        
        const original = extractNumber(requestData.price);
        const final = extractNumber(resultData.finalPrice || resultData.price);
        if (original > 0) {
          const percent = Math.round((original - final) / original * 100);
          resultSavingsPercent.textContent = percent + '%';
        } else {
          resultSavingsPercent.textContent = resultData.savingsPercent || '';
        }
      }
      
      // ì›ì‚°ì§€ ì •ë³´ ì„¤ì •
      if (resultOrigin) {
        resultOrigin.textContent = resultData.origin || '';
      }
      
      // êµ¬ë§¤ ë°©ë²• ì„¤ì •
      if (resultPurchaseMethod) {
        resultPurchaseMethod.textContent = resultData.purchaseMethod || '';
      }
      
      // ê²€ì¦ ì‹œì  ì„¤ì •
      if (verificationDate) {
        if (resultData.verificationDate) {
          const date = new Date(resultData.verificationDate);
          verificationDate.textContent = date.toLocaleDateString('ko-KR') + ' ' + date.toLocaleTimeString('ko-KR');
        } else if (resultData.savedAt) {
          const date = new Date(resultData.savedAt);
          verificationDate.textContent = date.toLocaleDateString('ko-KR') + ' ' + date.toLocaleTimeString('ko-KR');
        } else {
          verificationDate.textContent = 'ê²€ì¦ ì™„ë£Œì¼';
        }
      }
      
      // ì´ë¯¸ì§€ ì²˜ë¦¬ (ê´€ë¦¬ìê°€ ì…ë ¥í•œ ì¦ê±°ìë£Œë§Œ)
      const resultImageContainer = document.getElementById('result-image-container');
      const resultImageDisplay = document.getElementById('result-image-display');
      
      let imageData = null;
      
      // 1. ê²°ê³¼ ë°ì´í„°ì— ì§ì ‘ ì €ì¥ëœ ì´ë¯¸ì§€ (ê´€ë¦¬ì ì…ë ¥)
      if (resultData.image && resultData.image.startsWith('data:image/')) {
        imageData = resultData.image;
      }
      
      // 2. ê²°ê³¼ ë°ì´í„°ì˜ imageKeyë¡œ ì €ì¥ëœ ì´ë¯¸ì§€ (ê´€ë¦¬ì ì…ë ¥)
      if (!imageData && resultData.imageKey) {
        try {
          const savedImage = localStorage.getItem(resultData.imageKey);
          if (savedImage && savedImage.startsWith('data:image/')) {
            imageData = savedImage;
          }
        } catch (e) {
          console.error('ë³„ë„ ì €ì¥ëœ ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨:', e);
        }
      }
      
      // 3. ê²°ê³¼ ë°ì´í„°ì˜ screenshot í•„ë“œ (ê´€ë¦¬ì ì…ë ¥)
      if (!imageData && resultData.screenshot) {
        imageData = resultData.screenshot;
      }
      
      // ì˜ë¢° ë°ì´í„°ì˜ ì´ë¯¸ì§€ëŠ” ì¦ê±°ìë£Œë¡œ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ (ê³ ê°ì´ ì˜¬ë¦° ì œí’ˆ ì´ë¯¸ì§€)
      console.log('ê´€ë¦¬ì ì…ë ¥ ì¦ê±°ìë£Œ ì´ë¯¸ì§€:', imageData ? 'ìˆìŒ' : 'ì—†ìŒ');
      if (imageData) {
        console.log('ì´ë¯¸ì§€ ë°ì´í„° íƒ€ì…:', typeof imageData);
        console.log('ì´ë¯¸ì§€ ë°ì´í„° ê¸¸ì´:', imageData.length);
        console.log('ì´ë¯¸ì§€ ë°ì´í„° ì‹œì‘ ë¶€ë¶„:', imageData.substring(0, 50));
      }
      
      // ì¦ê±°ìë£Œ ì„¹ì…˜ ì¡°ê±´ë¶€ í‘œì‹œ
      const evidenceSection = document.getElementById('evidence-section');
      let hasEvidence = false;
      
      // ì´ë¯¸ì§€ í‘œì‹œ
      if (imageData && resultImageContainer && resultImageDisplay) {
        if (imageData.startsWith('data:image/')) {
          resultImageDisplay.src = imageData;
          resultImageDisplay.onload = () => {
            resultImageContainer.classList.remove('hidden');
            hasEvidence = true;
            if (evidenceSection) evidenceSection.classList.remove('hidden');
          };
          resultImageDisplay.onerror = () => {
            resultImageContainer.classList.add('hidden');
          };
        } else {
          resultImageContainer.classList.add('hidden');
        }
      } else {
        if (resultImageContainer) {
          resultImageContainer.classList.add('hidden');
        }
      }
      
      // ë§í¬ ì´ë™ ë²„íŠ¼ ì²˜ë¦¬
      const actionButtons = document.getElementById('action-buttons');
      const linkButton = document.getElementById('link-button');
      
      if (resultData.link || resultData.url) {
        // ë§í¬ê°€ ìˆìœ¼ë©´ ë²„íŠ¼ í‘œì‹œ
        actionButtons.classList.remove('hidden');
        hasEvidence = true;
        const linkUrl = resultData.link || resultData.url;
        
        // ë§í¬ ì´ë™ ë²„íŠ¼ ì´ë²¤íŠ¸ (í™•ì¸ì°½ í¬í•¨)
        linkButton.onclick = function() {
          if (confirm('ì™¸ë¶€ ë§í¬ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ë™í•  ì‚¬ì´íŠ¸: ' + new URL(linkUrl).hostname)) {
            window.open(linkUrl, '_blank');
          }
        };
      } else {
        // ë§í¬ê°€ ì—†ìœ¼ë©´ ë²„íŠ¼ ìˆ¨ê¹€
        actionButtons.classList.add('hidden');
      }
      
      // ì¦ê±°ìë£Œê°€ ìˆìœ¼ë©´ ì„¹ì…˜ í‘œì‹œ, ì—†ìœ¼ë©´ ìˆ¨ê¹€
      if (evidenceSection) {
        if (hasEvidence) {
          evidenceSection.classList.remove('hidden');
        } else {
          evidenceSection.classList.add('hidden');
        }
      }
      
      // ì •ì±… ì¤€ìˆ˜ í™•ì¸ - ì¦ê±°ìë£Œ ì²´í¬ ì—…ë°ì´íŠ¸
      const evidenceCheck = document.getElementById('evidence-check');
      if (evidenceCheck) {
        if (hasEvidence) {
          evidenceCheck.innerHTML = '<span class="text-green-600">âœ“</span>';
        } else {
          evidenceCheck.innerHTML = '<span class="text-gray-400">â—‹</span>';
        }
      }
      
      // ìƒíƒœ ë°°ì§€ ì„¤ì •
      const statusBadge = document.getElementById('status-badge');
      if (statusBadge) {
        statusBadge.textContent = 'ê²€ì¦ ì™„ë£Œ';
        statusBadge.className = 'px-3 py-1 rounded-full text-sm font-bold text-white bg-green-500';
      }
       
       // ê²°ê³¼ ì¹´ë“œ í‘œì‹œ
       document.getElementById('result-card').classList.remove('hidden');
       
       // ë¡œë”© ìˆ¨ê¹€
       document.getElementById('loading').classList.add('hidden');
       document.getElementById('no-result').classList.add('hidden');
    }

         // ê²°ê³¼ ìˆ¨ê¸°ê¸°
     function hideResult() {
       currentReqKey = null;
       currentDisplayedReq = null;
       document.getElementById('result-card').classList.add('hidden');
       document.getElementById('no-result').classList.add('hidden');
       
       const resultInfo = document.getElementById('result-info');
       const resultSummary = document.getElementById('result-summary');
       const actionButtons = document.getElementById('action-buttons');
       const evidenceSection = document.getElementById('evidence-section');
       if (resultInfo) resultInfo.classList.add('hidden');
       if (resultSummary) resultSummary.classList.add('hidden');
       if (actionButtons) actionButtons.classList.add('hidden');
       if (evidenceSection) evidenceSection.classList.add('hidden');
     }

    // ì¦ê±°ìë£Œ ì—†ëŠ” ê²°ê³¼ ë°ì´í„° ì •ë¦¬ í•¨ìˆ˜
    function cleanupResultData() {
      console.log('ì¦ê±°ìë£Œ ì—†ëŠ” ê²°ê³¼ ë°ì´í„° ì •ë¦¬ ì‹œì‘...');
      
      // ëª¨ë“  result- í‚¤ ê²€ìƒ‰
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key && key.startsWith('result-')) {
          try {
            const resultData = JSON.parse(localStorage.getItem(key));
            if (resultData) {
              // ì¦ê±°ìë£Œê°€ ì—†ëŠ”ì§€ í™•ì¸ (ê´€ë¦¬ìê°€ ì…ë ¥í•œ ê²ƒë§Œ)
              const hasEvidence = !!(resultData.link || resultData.url || resultData.image || resultData.imageKey || resultData.screenshot);
              
              if (!hasEvidence) {
                console.log('ê´€ë¦¬ì ì…ë ¥ ì¦ê±°ìë£Œ ì—†ëŠ” ê²°ê³¼ ë°ì´í„° ë°œê²¬:', key, resultData);
                // ì—¬ê¸°ì„œ ì •ë¦¬ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
                // ì˜ˆ: localStorage.removeItem(key);
              }
            }
          } catch (e) {
            console.log('ê²°ê³¼ ë°ì´í„° íŒŒì‹± ì˜¤ë¥˜:', key, e);
          }
        }
      }
    }

    // ì´ë¯¸ì§€ ë°ì´í„° ì‚­ì œ í•¨ìˆ˜
    function removeImageDataFromResults() {
      console.log('ê²°ê³¼ ë°ì´í„°ì—ì„œ ì´ë¯¸ì§€ í•„ë“œ ì‚­ì œ ì‹œì‘...');
      
      // ëª¨ë“  result- í‚¤ ê²€ìƒ‰
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key && key.startsWith('result-')) {
          try {
            const resultData = JSON.parse(localStorage.getItem(key));
            if (resultData) {
              let modified = false;
              
              // ì´ë¯¸ì§€ ê´€ë ¨ í•„ë“œ ì‚­ì œ
              if (resultData.image) {
                console.log('ì´ë¯¸ì§€ í•„ë“œ ì‚­ì œ:', key);
                delete resultData.image;
                modified = true;
              }
              
              if (resultData.imageKey) {
                console.log('imageKey í•„ë“œ ì‚­ì œ:', key);
                delete resultData.imageKey;
                modified = true;
              }
              
              if (resultData.screenshot) {
                console.log('screenshot í•„ë“œ ì‚­ì œ:', key);
                delete resultData.screenshot;
                modified = true;
              }
              
              // ìˆ˜ì •ëœ ë°ì´í„° ì €ì¥
              if (modified) {
                localStorage.setItem(key, JSON.stringify(resultData));
                console.log('ìˆ˜ì •ëœ ê²°ê³¼ ë°ì´í„° ì €ì¥:', key);
              }
            }
          } catch (e) {
            console.log('ê²°ê³¼ ë°ì´í„° ì²˜ë¦¬ ì˜¤ë¥˜:', key, e);
          }
        }
      }
      
      console.log('ì´ë¯¸ì§€ ë°ì´í„° ì‚­ì œ ì™„ë£Œ!');
    }

    // ë¬¸ì˜/ë‹µë³€ ë‚´ìš© ì•ˆì „í•˜ê²Œ ë Œë”ë§ (ê¸°ì¡´ contact.html ê·¸ëŒ€ë¡œ)
    function escapeHtml(str) {
      if (!str) return '';
      return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/'/g, '&#39;');
    }

    // ëŒ“ê¸€ ë Œë”ë§ í•¨ìˆ˜ (ê¸°ì¡´ contact.html ê·¸ëŒ€ë¡œ)
    function renderComments(comments) {
      if (!comments || comments.length === 0) return '';
      return comments.map(comment => `
        <div class='p-2 bg-white rounded border mb-2'>
          <div class='font-bold text-blue-700 text-sm'>${escapeHtml(comment.author)}</div>
          <div class='text-gray-800 text-sm'>${escapeHtml(comment.text)}</div>
          <div class='text-gray-400 text-xs'>${(() => {
            try {
              let date;
              if (comment.date && comment.date.toDate) {
                date = comment.date.toDate();
              } else if (comment.date && comment.date.seconds) {
                date = new Date(comment.date.seconds * 1000);
              } else {
                date = new Date(comment.date);
              }
              return isNaN(date.getTime()) ? 'ë‚ ì§œ ì—†ìŒ' : date.toLocaleString('ko-KR');
            } catch (e) {
              return 'ë‚ ì§œ ì—†ìŒ';
            }
          })()}</div>
        </div>
      `).join('');
    }

    // ì‹¤ì‹œê°„ ëŒ“ê¸€ ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•œ í•¨ìˆ˜ (ê¸°ì¡´ contact.html ê·¸ëŒ€ë¡œ)
    function updateCommentsInRealTime() {
      const commentForms = document.querySelectorAll('.comment-form');
      commentForms.forEach(form => {
        const subject = form.getAttribute('data-subject');
        const date = form.getAttribute('data-date');
        
        // inquiry-ì—ì„œ ìµœì‹  ëŒ“ê¸€ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        let inquiryKey = null;
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          if (key.startsWith('inquiry-')) {
            const obj = JSON.parse(localStorage.getItem(key));
            if (obj && obj.subject === subject && obj.date === date) {
              inquiryKey = key;
              break;
            }
          }
        }
        
        if (inquiryKey) {
          const inquiry = JSON.parse(localStorage.getItem(inquiryKey));
          const commentsHtml = renderComments(inquiry.comments || []);
          const commentsContainer = form.previousElementSibling;
          if (commentsContainer && commentsContainer.classList.contains('comments-list')) {
            commentsContainer.innerHTML = commentsHtml;
          }
        }
      });
    }

    // ë¬¸ì˜ ì‚­ì œ í•¨ìˆ˜ (Firebase ì „ìš©)
    async function deleteInquiry(subject, date) {
      if (!confirm('ì •ë§ ì´ ë¬¸ì˜ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
      
      // Firebaseì—ì„œ ë¬¸ì˜ ì‚­ì œ
      try {
        await waitForFirebase();
        const { collection, query, where, getDocs, deleteDoc } = window.firebaseFirestoreFunctions;
        const db = window.firebaseDb;
        
        const inquiriesRef = collection(db, 'inquiries');
        const q = query(inquiriesRef, where('subject', '==', subject), where('date', '==', date));
        const querySnapshot = await getDocs(q);
        
        if (!querySnapshot.empty) {
          const doc = querySnapshot.docs[0];
          await deleteDoc(doc.ref);
          console.log('âœ… Firebaseì—ì„œ ë¬¸ì˜ ì‚­ì œ ì™„ë£Œ');
        }
      } catch (error) {
        console.error('âŒ Firebase ë¬¸ì˜ ì‚­ì œ ì‹¤íŒ¨:', error);
      }
      
      renderHistory();
    }

    // ë‚ ì§œ í¬ë§· í•¨ìˆ˜ (ê¸°ì¡´ contact.html ê·¸ëŒ€ë¡œ)
    function formatDateTime(dateStr) {
      if (!dateStr) return 'ë‚ ì§œ ì—†ìŒ';
      
      console.log('formatDateTime ì…ë ¥:', dateStr, 'íƒ€ì…:', typeof dateStr);
      
      let date;
      
      try {
        // Firestore Timestamp ê°ì²´ ì²˜ë¦¬
        if (dateStr && typeof dateStr === 'object' && dateStr.toDate) {
          date = dateStr.toDate();
        } else if (dateStr && typeof dateStr === 'object' && dateStr.seconds) {
          // Timestamp ê°ì²´ (seconds í•„ë“œ)
          date = new Date(dateStr.seconds * 1000);
        } else if (typeof dateStr === 'string') {
          // ì´ë¯¸ í•œêµ­ì–´ í˜•ì‹ì¸ ê²½ìš° (ì˜ˆ: "2025. 1. 30. ì˜¤ì „ 4:55:37")
          if (dateStr.includes('ì˜¤ì „') || dateStr.includes('ì˜¤í›„')) {
            // í•œêµ­ì–´ ë‚ ì§œ í˜•ì‹ì„ íŒŒì‹±
            const match = dateStr.match(/(\d{4})\.\s*(\d{1,2})\.\s*(\d{1,2})\.\s*(ì˜¤ì „|ì˜¤í›„)\s*(\d{1,2}):(\d{1,2}):(\d{1,2})/);
            if (match) {
              const [, year, month, day, ampm, hour, minute, second] = match;
              let hour24 = parseInt(hour);
              if (ampm === 'ì˜¤í›„' && hour24 !== 12) hour24 += 12;
              if (ampm === 'ì˜¤ì „' && hour24 === 12) hour24 = 0;
              
              date = new Date(parseInt(year), parseInt(month) - 1, parseInt(day), hour24, parseInt(minute), parseInt(second));
              console.log('í•œêµ­ì–´ ë‚ ì§œ íŒŒì‹± ê²°ê³¼:', date);
            } else {
              date = new Date(dateStr);
            }
          } else {
            // ì¼ë°˜ì ì¸ ë‚ ì§œ í˜•ì‹
            date = new Date(dateStr);
          }
        } else if (typeof dateStr === 'number') {
          // íƒ€ì„ìŠ¤íƒ¬í”„ì¸ ê²½ìš°
          date = new Date(dateStr);
        } else {
          // ê¸°íƒ€ ê²½ìš°
          date = new Date(dateStr);
        }
        
        // ìœ íš¨í•˜ì§€ ì•Šì€ ë‚ ì§œì¸ì§€ í™•ì¸
        if (isNaN(date.getTime())) {
          console.log('ìœ íš¨í•˜ì§€ ì•Šì€ ë‚ ì§œ:', dateStr);
          return 'ë‚ ì§œ í˜•ì‹ ì˜¤ë¥˜';
        }
        
        const y = date.getFullYear();
        const m = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        const h = String(date.getHours()).padStart(2, '0');
        const min = String(date.getMinutes()).padStart(2, '0');
        const result = `${y}-${m}-${day} ${h}:${min}`;
        
        console.log('formatDateTime ê²°ê³¼:', result);
        return result;
      } catch (error) {
        console.error('formatDateTime ì˜¤ë¥˜:', error, dateStr);
        return 'ë‚ ì§œ í˜•ì‹ ì˜¤ë¥˜';
      }
    }

    // ë¬¸ì˜ ë‚´ì—­ ë Œë”ë§ (Firebase + ë¡œì»¬ìŠ¤í† ë¦¬ì§€ í†µí•©)
    async function renderHistory() {
      let history = [];
      
      try {
        // 1. Firebaseì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹œë„
        const firebaseInquiries = await getInquiriesFromFirebase();
        if (firebaseInquiries.length > 0) {
          history = firebaseInquiries;
          console.log('Firebaseì—ì„œ ë¬¸ì˜ ë°ì´í„° ì‚¬ìš©');
          
          // ê° ë¬¸ì˜ì— ëŒ€í•œ ëŒ“ê¸€ ê°€ì ¸ì˜¤ê¸°
          await waitForFirebase();
          const { collection, query, where, getDocs, orderBy } = window.firebaseFirestoreFunctions;
          const commentsRef = collection(window.firebaseDb, 'inquiryComments');
          
          for (let inq of history) {
            try {
              const commentsQuery = query(
                commentsRef,
                where('inquiryId', '==', inq.id)
              );
              const commentsSnapshot = await getDocs(commentsQuery);
              const comments = [];
              commentsSnapshot.forEach(doc => {
                const data = doc.data();
                comments.push({
                  author: data.author,
                  text: data.text,
                  date: data.date || (data.createdAt?.seconds ? data.createdAt.seconds * 1000 : Date.now())
                });
              });
              // í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë‚ ì§œìˆœ ì •ë ¬
              comments.sort((a, b) => a.date - b.date);
              inq.comments = comments;
            } catch (error) {
              console.warn('ëŒ“ê¸€ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
              inq.comments = [];
            }
          }
        } else {
          // Firebaseì— ë°ì´í„°ê°€ ì—†ìŒ
          console.log('Firebaseì— ë°ì´í„° ì—†ìŒ');
          history = [];
        }
      } catch (error) {
        console.error('Firebase ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
        history = [];
      }
      
      const ul = document.getElementById('contact-history');
      ul.innerHTML = '';
      if (history.length === 0) {
        ul.innerHTML = '<li class="text-gray-400">ë¬¸ì˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</li>';
        return;
      }
      history.forEach(inq => {
        // ë‹µë³€ ë¶ˆëŸ¬ì˜¤ê¸° (Firebaseì—ì„œ adminResponse í™•ì¸)
        let answer = '';
        let answerHtml = '';
        
        // Firebaseì—ì„œ ê°€ì ¸ì˜¨ adminResponse í™•ì¸
        if (inq.adminResponse) {
          if (typeof inq.adminResponse === 'object' && inq.adminResponse !== null) {
            // êµ¬ì¡°í™”ëœ ë‹µë³€ ë°ì´í„°
            answerHtml = formatInquiryResponseForMember(inq.adminResponse);
            answer = 'êµ¬ì¡°í™”ëœ ë‹µë³€'; // ìƒíƒœ í™•ì¸ìš©
          } else {
            // ê¸°ì¡´ í…ìŠ¤íŠ¸ ë‹µë³€
            answer = inq.adminResponse;
          }
        } else if (inq.answer) {
          // ê¸°ì¡´ answer í•„ë“œ
          answer = inq.answer;
        }
        
        // ë‹µë³€ HTMLì´ ì—†ìœ¼ë©´ ê¸°ë³¸ í…ìŠ¤íŠ¸ë¡œ ìƒì„±
        if (!answerHtml) {
          answerHtml = answer ? escapeHtml(answer) : '<span class="text-gray-400">ë‹µë³€ ëŒ€ê¸°ì¤‘</span>';
        }
        let fileHtml = '';
        if (inq.file) {
          if (inq.file.startsWith('data:image/')) {
            fileHtml = `<div class='mb-2'><img src='${inq.file}' alt='ì²¨ë¶€ ì´ë¯¸ì§€' class='max-h-32 rounded-xl border shadow w-full object-contain' /></div>`;
          } else {
            const fileName = inq.fileName || 'ì²¨ë¶€íŒŒì¼';
            fileHtml = `<div class='mb-2 text-gray-600'>ì²¨ë¶€íŒŒì¼: <a href='${inq.file}' download='${fileName}' class='text-blue-600 underline'>${fileName}</a></div>`;
          }
        }
        // ë¬¸ì˜ ìƒíƒœ í™•ì¸
        const inquiryStatus = inq.status || (answer ? 'ë‹µë³€ì™„ë£Œ' : 'ëŒ€ê¸°ì¤‘');
        const statusBadge = inquiryStatus === 'ë‹µë³€ì™„ë£Œ' ? 
          '<span class="inline-block px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full ml-2">ë‹µë³€ì™„ë£Œ</span>' :
          '<span class="inline-block px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full ml-2">ëŒ€ê¸°ì¤‘</span>';

        ul.innerHTML += `
          <li class='p-4 bg-blue-50 rounded-xl shadow mb-2 min-w-0'>
            <div class='flex items-center justify-between mb-1'>
              <div class='font-bold text-blue-700'>${escapeHtml(inq.subject)}</div>
              ${statusBadge}
            </div>
            <div class='text-gray-700 mb-1 whitespace-pre-line'>${escapeHtml(inq.message || inq.content || '')}</div>
            ${fileHtml}
            <div class='text-xs text-gray-400 mb-2'>ë¬¸ì˜ì¼ì‹œ: ${formatDateTime(inq.date)}</div>
            <div class='mt-2 p-3 rounded bg-white border'>
              <span class='font-bold text-blue-700'>ë‹µë³€</span><br>
              <div class='text-gray-800 mt-1'>${answerHtml}</div>
            </div>
            <div class='mt-4'>
              <div class='font-bold text-blue-700 mb-2'>ì¶”ê°€ ëŒ“ê¸€</div>
              <div class='comments-list'>${renderComments((inq.comments||[]))}</div>
              <form class='comment-form' data-subject="${escapeHtml(inq.subject)}" data-date="${escapeHtml(inq.date)}">
                <div class='flex gap-2'>
                  <input type='text' name='comment' class='flex-1 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-400 focus:outline-none' placeholder='ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”' aria-label='ëŒ“ê¸€ ì…ë ¥' />
                  <button type='submit' class='px-4 py-2 bg-emerald-500 text-white rounded-lg font-bold hover:bg-emerald-600 transition' aria-label='ëŒ“ê¸€ ì¶”ê°€'>ë“±ë¡</button>
                </div>
              </form>
            </div>
            <!-- ì˜ë¢° ì‚­ì œ ê¸°ëŠ¥ ì œê±° - íì‡„ì„± ê°•í™” -->
          </li>
        `;
      });
    }

  // ê³µí†µ í•¨ìˆ˜: ì‚¬ìš©ì ì´ë©”ì¼ ê°€ì ¸ì˜¤ê¸° (ì—¬ëŸ¬ ë°©ë²•ìœ¼ë¡œ ì‹œë„)
  function getUserEmail() {
    let userEmail = localStorage.getItem('loggedInEmail');
    
    // loggedInEmailì´ ì—†ìœ¼ë©´ ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œ ì‹œë„
    if (!userEmail) {
      const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
      const user = JSON.parse(localStorage.getItem('user') || '{}');
      
      if (currentUser.email) {
        userEmail = currentUser.email;
        console.log('ğŸ” currentUserì—ì„œ ì´ë©”ì¼ ê°€ì ¸ì˜´:', userEmail);
      } else if (user.email) {
        userEmail = user.email;
        console.log('ğŸ” userì—ì„œ ì´ë©”ì¼ ê°€ì ¸ì˜´:', userEmail);
      }
    }
    
    return userEmail;
  }

  // ë””ë²„ê¹…ìš© í•¨ìˆ˜ - í˜„ì¬ ìƒíƒœ í™•ì¸
  async function debugCurrentState() {
    console.log('ğŸ” === ë””ë²„ê¹… ì •ë³´ ===');
    console.log('ğŸ” localStorage loggedInEmail:', localStorage.getItem('loggedInEmail'));
    console.log('ğŸ” localStorage user:', localStorage.getItem('user'));
    console.log('ğŸ” localStorage currentUser:', localStorage.getItem('currentUser'));
    console.log('ğŸ” localStorage loggedIn:', localStorage.getItem('loggedIn'));
    
    try {
      await waitForFirebase();
      const { collection, getDocs } = window.firebaseFirestoreFunctions;
      const db = window.firebaseDb;
      
      // ëª¨ë“  ì˜ë¢° ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
      const allRequestsQuery = query(collection(db, 'requests'));
      const allSnapshot = await getDocs(allRequestsQuery);
      console.log('ğŸ” Firebase ì „ì²´ ì˜ë¢° ë°ì´í„°:', allSnapshot.size, 'ê°œ');
      
      allSnapshot.forEach((doc) => {
        const data = doc.data();
        console.log('ğŸ“„ ì˜ë¢° ë°ì´í„°:', {
          id: doc.id,
          email: data.email,
          name: data.name,
          reqNum: data.reqNum || data.requestNumber
        });
      });
    } catch (error) {
      console.error('ğŸ” ë””ë²„ê¹… ì¤‘ ì˜¤ë¥˜:', error);
    }
    console.log('ğŸ” === ë””ë²„ê¹… ì™„ë£Œ ===');
  }

  // Firebase ì´ˆê¸°í™” ëŒ€ê¸° í•¨ìˆ˜
  async function waitForFirebase() {
    return new Promise((resolve, reject) => {
      console.log('ğŸ”„ Firebase ì´ˆê¸°í™” ìƒíƒœ í™•ì¸:', {
        firebaseApp: !!window.firebaseApp,
        firebaseDb: !!window.firebaseDb,
        firebaseFirestoreFunctions: !!window.firebaseFirestoreFunctions,
        firebaseFirestoreFunctionsKeys: window.firebaseFirestoreFunctions ? Object.keys(window.firebaseFirestoreFunctions) : 'undefined'
      });
      
      if (window.firebaseApp && window.firebaseDb && window.firebaseFirestoreFunctions) {
        console.log('âœ… Firebase ì´ˆê¸°í™” ì™„ë£Œ');
        console.log('ğŸ” ì‚¬ìš© ê°€ëŠ¥í•œ Firebase í•¨ìˆ˜ë“¤:', Object.keys(window.firebaseFirestoreFunctions));
        resolve();
      } else {
        // Firebase ì´ˆê¸°í™” ëŒ€ê¸°
        const checkInterval = setInterval(() => {
          if (window.firebaseApp && window.firebaseDb && window.firebaseFirestoreFunctions) {
            clearInterval(checkInterval);
            console.log('âœ… Firebase ì´ˆê¸°í™” ì™„ë£Œ (ëŒ€ê¸° í›„)');
            console.log('ğŸ” ì‚¬ìš© ê°€ëŠ¥í•œ Firebase í•¨ìˆ˜ë“¤:', Object.keys(window.firebaseFirestoreFunctions));
            resolve();
          }
        }, 100);
        
        // 10ì´ˆ í›„ íƒ€ì„ì•„ì›ƒ
        setTimeout(() => {
          clearInterval(checkInterval);
          console.error('âŒ Firebase ì´ˆê¸°í™” íƒ€ì„ì•„ì›ƒ - Firebase í•¨ìˆ˜ë“¤ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          console.error('ğŸ” ìµœì¢… ìƒíƒœ:', {
            firebaseApp: !!window.firebaseApp,
            firebaseDb: !!window.firebaseDb,
            firebaseFirestoreFunctions: !!window.firebaseFirestoreFunctions
          });
          reject(new Error('Firebase ì´ˆê¸°í™” ì‹¤íŒ¨'));
        }, 10000);
      }
    });
  }
    
    // Firebase ì—°ê²° ìƒíƒœ í™•ì¸
    function checkFirebaseConnection() {
      if (!window.firebaseApp || !window.firebaseDb) {
        console.warn('âš ï¸ Firebase ì—°ê²° ì‹¤íŒ¨ - ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ëª¨ë“œ ì‚¬ìš©');
        return false;
      }
      return true;
    }

    // Firebase ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ í•¨ìˆ˜
    async function migrateDataToFirebase() {
      try {
        console.log('ğŸ”„ Firebase ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œì‘...');
        
        // Firebase ì´ˆê¸°í™” ëŒ€ê¸°
        await waitForFirebase();
        
        // 1. ì˜ë¢° ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜
        await migrateRequestData();
        
        // 2. ë¬¸ì˜ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜
        await migrateInquiryData();
        
        console.log('âœ… Firebase ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ');
        
        // ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ í›„ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì •ë¦¬ (ì„ íƒì‚¬í•­)
        // cleanupLocalStorageAfterMigration();
      } catch (error) {
        console.error('âŒ Firebase ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤íŒ¨:', error);
      }
    }
    
    // ë§ˆì´ê·¸ë ˆì´ì…˜ í›„ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì •ë¦¬ (ì„ íƒì‚¬í•­)
    function cleanupLocalStorageAfterMigration() {
      try {
        console.log('ğŸ§¹ ë§ˆì´ê·¸ë ˆì´ì…˜ í›„ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì •ë¦¬ ì‹œì‘...');
        
        // ì˜ë¢° ë°ì´í„° ì •ë¦¬
        const requestKeys = [];
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          if (key && key.startsWith('request-')) {
            requestKeys.push(key);
          }
        }
        
        // ë¬¸ì˜ ë°ì´í„° ì •ë¦¬
        const hasInquiries = localStorage.getItem('contact-history');
        
        if (confirm(`ë§ˆì´ê·¸ë ˆì´ì…˜ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\n\në¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œ ë‹¤ìŒ ë°ì´í„°ë¥¼ ì •ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n- ì˜ë¢° ë°ì´í„°: ${requestKeys.length}ê°œ\n- ë¬¸ì˜ ë°ì´í„°: ${hasInquiries ? 'ìˆìŒ' : 'ì—†ìŒ'}\n\n(ì •ë¦¬í•´ë„ Firebaseì— ì•ˆì „í•˜ê²Œ ì €ì¥ë˜ì–´ ìˆìŠµë‹ˆë‹¤)`)) {
          // ì˜ë¢° ë°ì´í„° ì •ë¦¬
          requestKeys.forEach(key => {
            localStorage.removeItem(key);
          });
          
          // ë¬¸ì˜ ë°ì´í„° ì •ë¦¬
          if (hasInquiries) {
            localStorage.removeItem('contact-history');
          }
          
          console.log('âœ… ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì •ë¦¬ ì™„ë£Œ');
          alert('ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì •ë¦¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
      } catch (error) {
        console.error('âŒ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì •ë¦¬ ì‹¤íŒ¨:', error);
      }
    }
    
    // ì˜ë¢° ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜
    async function migrateRequestData() {
      try {
        const { collection, addDoc, serverTimestamp, getDocs, query, where } = window.firebaseFirestoreFunctions;
        const db = window.firebaseDb;
        
        // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œ ì˜ë¢° ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        const requests = [];
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          if (key && key.startsWith('request-')) {
            try {
              const data = JSON.parse(localStorage.getItem(key));
              if (data && data.email) {
                requests.push({ key, data });
              }
            } catch (e) {
              console.log('ì˜ë¢° ë°ì´í„° íŒŒì‹± ì‹¤íŒ¨:', key);
            }
          }
        }
        
        console.log(`ğŸ“‹ ë§ˆì´ê·¸ë ˆì´ì…˜í•  ì˜ë¢° ë°ì´í„°: ${requests.length}ê°œ`);
        
        for (const { key, data } of requests) {
          try {
            // Firebaseì— ì´ë¯¸ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
            const existingQuery = query(
              collection(db, 'requests'),
              where('requestNumber', '==', data.requestNumber || key.replace('request-', ''))
            );
            const existingDocs = await getDocs(existingQuery);
            
            if (existingDocs.empty) {
              // Firebaseì— ì €ì¥
              const requestData = {
                ...data,
                requestNumber: data.requestNumber || key.replace('request-', ''),
                migratedAt: serverTimestamp(),
                source: 'localStorage_migration'
              };
              
              await addDoc(collection(db, 'requests'), requestData);
              console.log(`âœ… ì˜ë¢° ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ: ${key}`);
            } else {
              console.log(`â­ï¸ ì˜ë¢° ë°ì´í„° ì´ë¯¸ ì¡´ì¬: ${key}`);
            }
          } catch (error) {
            console.error(`âŒ ì˜ë¢° ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤íŒ¨: ${key}`, error);
          }
        }
      } catch (error) {
        console.error('âŒ ì˜ë¢° ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤íŒ¨:', error);
      }
    }
    
    // ë¬¸ì˜ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜
    async function migrateInquiryData() {
      try {
        const { collection, addDoc, serverTimestamp, getDocs, query, where } = window.firebaseFirestoreFunctions;
        const db = window.firebaseDb;
        
        // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œ ë¬¸ì˜ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        const inquiries = JSON.parse(localStorage.getItem('contact-history') || '[]');
        
        console.log(`ğŸ“‹ ë§ˆì´ê·¸ë ˆì´ì…˜í•  ë¬¸ì˜ ë°ì´í„°: ${inquiries.length}ê°œ`);
        
        for (const inquiry of inquiries) {
          try {
            // Firebaseì— ì´ë¯¸ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
            const existingQuery = query(
              collection(db, 'inquiries'),
              where('subject', '==', inquiry.subject),
              where('date', '==', inquiry.date)
            );
            const existingDocs = await getDocs(existingQuery);
            
            if (existingDocs.empty) {
              // Firebaseì— ì €ì¥
              const inquiryData = {
                ...inquiry,
                migratedAt: serverTimestamp(),
                source: 'localStorage_migration'
              };
              
              await addDoc(collection(db, 'inquiries'), inquiryData);
              console.log(`âœ… ë¬¸ì˜ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ: ${inquiry.subject}`);
            } else {
              console.log(`â­ï¸ ë¬¸ì˜ ë°ì´í„° ì´ë¯¸ ì¡´ì¬: ${inquiry.subject}`);
            }
          } catch (error) {
            console.error(`âŒ ë¬¸ì˜ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤íŒ¨: ${inquiry.subject}`, error);
          }
        }
      } catch (error) {
        console.error('âŒ ë¬¸ì˜ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤íŒ¨:', error);
      }
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', function() {
      console.log('í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ - ì´ˆê¸°í™” ì‹œì‘');
      
      // ì´ˆê¸° íƒ­ ìƒíƒœ í™•ì¸
      console.log('ì´ˆê¸° íƒ­ ìƒíƒœ:');
      console.log('- tab-info active:', document.getElementById('tab-info').classList.contains('active'));
      console.log('- panel-info active:', document.getElementById('panel-info').classList.contains('active'));
      
      // ë””ë²„ê¹… ì •ë³´ ì¶œë ¥
      debugCurrentState();
      
      // Firebase ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
      migrateDataToFirebase();
      
      // ë‚´ ì •ë³´ í‘œì‹œ
      renderMyInfo();
      
      // ì˜ë¢° ë‚´ì—­ ëª©ë¡ í‘œì‹œ
      renderMyRequestList();
      
      // ë¬¸ì˜ ë‚´ì—­ í‘œì‹œ
      renderHistory();
      
      // ì¦ê±°ìë£Œ ì—†ëŠ” ê²°ê³¼ ë°ì´í„° í™•ì¸ (ë””ë²„ê¹…ìš©)
      cleanupResultData();
      
      // ì´ë¯¸ì§€ ë°ì´í„° ì‚­ì œ (í•œ ë²ˆë§Œ ì‹¤í–‰)
      if (!localStorage.getItem('imageDataCleaned')) {
        removeImageDataFromResults();
        localStorage.setItem('imageDataCleaned', 'true');
      }
      
      // íƒ­ ì „í™˜ ì´ë²¤íŠ¸ëŠ” HTML onclickìœ¼ë¡œ ì²˜ë¦¬ë¨
      
      // ì •ë³´ìˆ˜ì • í¼ í† ê¸€
      document.getElementById('edit-info-btn').addEventListener('click', function() {
        const formContainer = document.getElementById('info-form-container');
        formContainer.classList.toggle('hidden');
        if (!formContainer.classList.contains('hidden')) {
          document.getElementById('info-email').focus();
        }
      });

      // ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜ (ê³µí†µ)
      async function handleLogout() {
        if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          try {
            await waitForFirebase();
            const { signOut } = window.firebaseAuthFunctions;
            await signOut(window.firebaseAuth);
            
            // localStorageì—ì„œ ì‚¬ìš©ì ì •ë³´ ì‚­ì œ
            localStorage.removeItem('user');
            localStorage.removeItem('currentUser');
            localStorage.removeItem('loggedIn');
            localStorage.removeItem('loggedInEmail');
            
            alert('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.');
            window.location.href = 'index.html';
          } catch (error) {
            console.error('ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨:', error);
            alert('ë¡œê·¸ì•„ì›ƒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
          }
        }
      }

      // ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (ë‚´ ì •ë³´ íƒ­)
      const logoutBtn = document.getElementById('logout-btn');
      if (logoutBtn) {
        logoutBtn.addEventListener('click', handleLogout);
      }

      // í—¤ë” ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      const headerLogoutBtn = document.getElementById('header-logout-btn');
      if (headerLogoutBtn) {
        headerLogoutBtn.addEventListener('click', handleLogout);
      }
      
      // íšŒì›íƒˆí‡´ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      document.getElementById('withdraw-btn').addEventListener('click', function() {
        openWithdrawModal();
      });
      
      // íšŒì›íƒˆí‡´ í™•ì¸ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      document.getElementById('withdraw-confirm').addEventListener('change', function() {
        const confirmBtn = document.getElementById('withdraw-confirm-btn');
        confirmBtn.disabled = !this.checked;
      });
      
      // ì •ë³´ìˆ˜ì • í¼ ì €ì¥
      document.getElementById('info-form').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        try {
          // ê¸°ì¡´ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
          const originalUser = JSON.parse(localStorage.getItem('user') || '{}');
          const loggedInEmail = getUserEmail();
          
          if (!loggedInEmail) {
            alert('ë¡œê·¸ì¸ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            return;
          }
          
          const updatedUser = {
            ...originalUser,
            kakao: document.getElementById('info-kakao').value.trim() // ì¹´ì¹´ì˜¤IDë§Œ ìˆ˜ì • ê°€ëŠ¥
          };
          
          // localStorage ì—…ë°ì´íŠ¸
          localStorage.setItem('user', JSON.stringify(updatedUser));
          localStorage.setItem('currentUser', JSON.stringify(updatedUser));
          
          // Firebase ì—…ë°ì´íŠ¸
          await waitForFirebase();
          const { collection, query, where, getDocs, updateDoc, doc } = window.firebaseFirestoreFunctions;
          const db = window.firebaseDb;
          
          const usersRef = collection(db, 'users');
          const q = query(usersRef, where('email', '==', loggedInEmail));
          const querySnapshot = await getDocs(q);
          
          if (!querySnapshot.empty) {
            const userDoc = querySnapshot.docs[0];
            await updateDoc(doc(db, 'users', userDoc.id), {
              kakao: updatedUser.kakao,
              updatedAt: new Date()
            });
            console.log('âœ… Firebase ì‚¬ìš©ì ì •ë³´ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
          }
          
          // UI ì—…ë°ì´íŠ¸
          renderMyInfo();
          document.getElementById('info-form-container').classList.add('hidden');
          alert('ì¹´ì¹´ì˜¤IDê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
          
        } catch (error) {
          console.error('ì •ë³´ ì €ì¥ ì‹¤íŒ¨:', error);
          alert('ì •ë³´ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
        }
      });
      
      // ê²€ìƒ‰ ê¸°ëŠ¥
      document.getElementById('search-btn').addEventListener('click', function() {
        const searchInput = document.getElementById('search-input').value.trim();
        if (searchInput) {
          // ì˜ë¢° ë²ˆí˜¸ë¡œ ê²€ìƒ‰
          if (searchInput.startsWith('#') || searchInput.startsWith('PH-')) {
            showAdminResponse(searchInput);
          } else {
            // íœ´ëŒ€í° ë²ˆí˜¸ë¡œ ê²€ìƒ‰
            searchByPhone(searchInput);
          }
        } else {
          alert('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        }
      });
      
      // íœ´ëŒ€í° ë²ˆí˜¸ë¡œ ê²€ìƒ‰ ê¸°ëŠ¥
      function searchByPhone(phoneNumber) {
        const requests = [];
        
        // localStorageì—ì„œ ëª¨ë“  ì˜ë¢° ë°ì´í„° ìˆ˜ì§‘
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          if (key && key.startsWith('request-')) {
            try {
              const requestData = JSON.parse(localStorage.getItem(key));
              if (requestData) {
                const reqPhone = requestData.phone || requestData.userPhone || requestData.contact || '';
                if (reqPhone.includes(phoneNumber) || phoneNumber.includes(reqPhone)) {
                  const reqNum = requestData.reqNum || requestData.key || key.replace('request-', '');
                  if (reqNum) {
                    requests.push(reqNum);
                  }
                }
              }
            } catch (e) {
              console.log('ì˜ë¢° ë°ì´í„° íŒŒì‹± ì˜¤ë¥˜:', key, e);
            }
          }
        }
        
        if (requests.length > 0) {
          // ì²« ë²ˆì§¸ ê²°ê³¼ í‘œì‹œ
          showAdminResponse(requests[0]);
          
          if (requests.length > 1) {
            alert(`${requests.length}ê°œì˜ ì˜ë¢°ë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤. ì²« ë²ˆì§¸ ê²°ê³¼ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.`);
          }
        } else {
          document.getElementById('loading').classList.add('hidden');
          document.getElementById('no-result').classList.remove('hidden');
          document.getElementById('result-card').classList.add('hidden');
        }
      }
      
      // ì—”í„°í‚¤ ê²€ìƒ‰
      document.getElementById('search-input').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          document.getElementById('search-btn').click();
        }
      });

      // íŒŒì¼ ë¯¸ë¦¬ë³´ê¸° (ê¸°ì¡´ contact.html ê·¸ëŒ€ë¡œ)
      const fileInput = document.getElementById('contact-file');
      const filePreview = document.getElementById('filePreview');
      if (fileInput) {
        fileInput.addEventListener('change', function(event) {
          filePreview.innerHTML = '';
          const file = event.target.files[0];
          if (file) {
            if (file.type.startsWith('image/')) {
              const reader = new FileReader();
              reader.onload = function(e) {
                filePreview.innerHTML = `<img src="${e.target.result}" alt="ì²¨ë¶€ ì´ë¯¸ì§€" class="max-h-32 rounded-xl shadow-md border border-gray-200" />`;
                fileData = e.target.result;
              };
              reader.readAsDataURL(file);
            } else {
              filePreview.innerHTML = `<span class='text-gray-600'>${file.name}</span>`;
              fileData = '';
            }
          }
        });
      }

      // Firebase ì´ˆê¸°í™” ëŒ€ê¸° í•¨ìˆ˜ (ì „ì—­ìœ¼ë¡œ ì´ë™)

      // ìŠ¤ë§ˆíŠ¸ ì´ë¯¸ì§€ ì••ì¶• í•¨ìˆ˜ (ìë™ìœ¼ë¡œ í¬ê¸°ì— ë§ê²Œ ì••ì¶•)
      function compressImage(file, targetSizeKB = 500) {
        return new Promise((resolve, reject) => {
          const canvas = document.createElement('canvas');
          const ctx = canvas.getContext('2d');
          const img = new Image();
          
          img.onload = function() {
            let { width, height } = img;
            let quality = 0.8;
            let maxWidth = 1200;
            
            // ì´ˆê¸° ì••ì¶•
            if (width > maxWidth) {
              height = (height * maxWidth) / width;
              width = maxWidth;
            }
            
            canvas.width = width;
            canvas.height = height;
            ctx.drawImage(img, 0, 0, width, height);
            
            // í¬ê¸° ì²´í¬ ë° ì¬ì••ì¶•
            const checkSize = (q) => {
              const dataUrl = canvas.toDataURL('image/jpeg', q);
              const sizeKB = (dataUrl.length * 0.75) / 1024; // base64 to KB
              
              if (sizeKB > targetSizeKB && q > 0.1) {
                return checkSize(q - 0.1);
              }
              return dataUrl;
            };
            
            const compressedDataUrl = checkSize(quality);
            resolve(compressedDataUrl);
          };
          
          img.onerror = () => reject(new Error('ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨'));
          img.src = URL.createObjectURL(file);
        });
      }

      // Base64 ì´ë¯¸ì§€ ì§ì ‘ ì••ì¶• í•¨ìˆ˜ (CSP ë¬¸ì œ í•´ê²°)
      function compressBase64Image(base64DataUrl, targetSizeKB = 500) {
        return new Promise((resolve, reject) => {
          const canvas = document.createElement('canvas');
          const ctx = canvas.getContext('2d');
          const img = new Image();
          
          img.onload = function() {
            let { width, height } = img;
            let quality = 0.8;
            let maxWidth = 1200;
            
            // ì´ˆê¸° ì••ì¶•
            if (width > maxWidth) {
              height = (height * maxWidth) / width;
              width = maxWidth;
            }
            
            canvas.width = width;
            canvas.height = height;
            ctx.drawImage(img, 0, 0, width, height);
            
            // í¬ê¸° ì²´í¬ ë° ì¬ì••ì¶•
            const checkSize = (q) => {
              const dataUrl = canvas.toDataURL('image/jpeg', q);
              const sizeKB = (dataUrl.length * 0.75) / 1024; // base64 to KB
              
              if (sizeKB > targetSizeKB && q > 0.1) {
                return checkSize(q - 0.1);
              }
              return dataUrl;
            };
            
            const compressedDataUrl = checkSize(quality);
            resolve(compressedDataUrl);
          };
          
          img.onerror = () => reject(new Error('ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨'));
          img.src = base64DataUrl; // Base64 ë°ì´í„°ë¥¼ ì§ì ‘ ì‚¬ìš©
        });
      }

      // Firebaseì— ë¬¸ì˜ ë°ì´í„° ì €ì¥
      async function saveInquiryToFirebase(inquiryData) {
        try {
          await waitForFirebase();
          
          const { collection, addDoc, serverTimestamp } = window.firebaseFirestoreFunctions;
          const db = window.firebaseDb;
          
          const firebaseData = {
            ...inquiryData,
            createdAt: serverTimestamp(),
            status: 'pending',
            source: 'web_form'
          };
          
          const docRef = await addDoc(collection(db, 'inquiries'), firebaseData);
          console.log('âœ… Firebaseì— ë¬¸ì˜ ë°ì´í„° ì €ì¥ ì™„ë£Œ:', docRef.id);
          
          return docRef.id;
        } catch (error) {
          console.error('âŒ Firebase ë¬¸ì˜ ì €ì¥ ì‹¤íŒ¨:', error);
          throw error;
        }
      }

      // ë¬¸ì˜ ì œì¶œ (Firebase + localStorage)
      document.getElementById('contact-form').addEventListener('submit', async function(e) {
        e.preventDefault();
        const subject = document.getElementById('contact-subject').value.trim();
        const message = document.getElementById('contact-message').value.trim();
        const name = document.getElementById('contact-name').value;
        const email = document.getElementById('contact-email').value;
        const file = fileData;
        
        if (!subject || !message) {
          alert('ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
          return;
        }
        
        // ë¬¸ì˜ ë°ì´í„° ì¤€ë¹„
        let inquiry = { 
          subject, 
          message, 
          name, 
          email, 
          file, 
          date: new Date().toLocaleString(),
          timestamp: Date.now()
        };
        
        try {
        // íŒŒì¼ì´ ìˆê³  ì´ë¯¸ì§€ì¸ ê²½ìš° ì••ì¶• ì ìš©
        if (file && file.startsWith('data:image/')) {
          console.log('ğŸ“· ì´ë¯¸ì§€ íŒŒì¼ ê°ì§€ - ì••ì¶• ì‹œì‘...');
          
          // ì••ì¶• ì§„í–‰ ìƒí™© í‘œì‹œ
          const submitBtn = document.querySelector('#contact-form button[type="submit"]');
          if (submitBtn) {
            submitBtn.disabled = true;
            submitBtn.textContent = 'ì´ë¯¸ì§€ ì••ì¶• ì¤‘...';
          }
          
          try {
            // Base64 ë°ì´í„°ë¥¼ ì§ì ‘ ì••ì¶• (fetch ì‚¬ìš©í•˜ì§€ ì•ŠìŒ)
            const compressedDataUrl = await compressBase64Image(file, 500);
            inquiry.file = compressedDataUrl;
            console.log('âœ… ì´ë¯¸ì§€ ì••ì¶• ì™„ë£Œ');
          } catch (compressError) {
            console.warn('âš ï¸ ì²« ë²ˆì§¸ ì••ì¶• ì‹¤íŒ¨, ë” ê°•í•œ ì••ì¶• ì‹œë„...');
            try {
              // 200KB ì´í•˜ë¡œ ê°•í•œ ì••ì¶• ì‹œë„
              const compressedDataUrl = await compressBase64Image(file, 200);
              inquiry.file = compressedDataUrl;
              console.log('âœ… ê°•í•œ ì••ì¶• ì™„ë£Œ');
            } catch (strongCompressError) {
              console.error('âŒ ì••ì¶• ì‹¤íŒ¨, ì›ë³¸ ì‚¬ìš© (Firebase ì €ì¥ ì‹¤íŒ¨ ê°€ëŠ¥ì„± ìˆìŒ)');
              // ì••ì¶• ì‹¤íŒ¨ ì‹œ ì›ë³¸ ì‚¬ìš© (Firebase ì €ì¥ ì‹¤íŒ¨ ê°€ëŠ¥ì„± ìˆìŒ)
            }
          }
          
          if (submitBtn) {
            submitBtn.textContent = 'ë¬¸ì˜ ì œì¶œ ì¤‘...';
          }
        }
          
          // Firebaseì— ì €ì¥ ì‹œë„
          console.log('ğŸ”¥ Firebaseì— ë¬¸ì˜ ì €ì¥ ì‹œì‘...');
          const firebaseResult = await saveInquiryToFirebase(inquiry);
          
          // Firebaseì—ë§Œ ì €ì¥ (ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ë°±ì—… ì œê±°)
          
          // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
          alert('ë¬¸ì˜ê°€ ì„±ê³µì ìœ¼ë¡œ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤!\n\në¹ ë¥¸ ì‹œì¼ ë‚´ì— ë‹µë³€ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.\nê°ì‚¬í•©ë‹ˆë‹¤.');
          
          document.getElementById('contact-success').classList.remove('hidden');
          this.reset();
          filePreview.innerHTML = '';
          fileData = '';
          renderHistory();
          
        } catch (error) {
          console.error('ë¬¸ì˜ ì œì¶œ ì‹¤íŒ¨:', error);
          alert('ë¬¸ì˜ ì œì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
        } finally {
          // ë²„íŠ¼ ìƒíƒœ ë³µì›
          const submitBtn = document.querySelector('#contact-form button[type="submit"]');
          if (submitBtn) {
            submitBtn.disabled = false;
            submitBtn.textContent = 'ë¬¸ì˜ ì œì¶œ';
          }
        }
      });

      // ëŒ“ê¸€ ì œì¶œ ì´ë²¤íŠ¸ (Firebase ì „ìš©)
      document.addEventListener('submit', async function(e) {
        if (e.target.classList.contains('comment-form')) {
          e.preventDefault();
          const subject = e.target.getAttribute('data-subject');
          const date = e.target.getAttribute('data-date');
          const input = e.target.querySelector('input[name="comment"]');
          const text = input.value.trim();
          if (!text) return false;
          
          try {
            await waitForFirebase();
            
            // Firebaseì—ì„œ í•´ë‹¹ ë¬¸ì˜ ì°¾ê¸°
            const inquiries = await getInquiriesFromFirebase();
            const inquiry = inquiries.find(inq => {
              // ì œëª©ìœ¼ë¡œ ë¨¼ì € ë§¤ì¹­
              if (inq.subject !== subject) return false;
              
              // ë‚ ì§œ ë§¤ì¹­ (ì—¬ëŸ¬ í˜•ì‹ ì§€ì›)
              if (inq.date === date) return true;
              
              // createdAt íƒ€ì„ìŠ¤íƒ¬í”„ë¡œ ë§¤ì¹­
              if (inq.createdAt) {
                const createdAtDate = inq.createdAt.toDate ? inq.createdAt.toDate() : new Date(inq.createdAt.seconds * 1000);
                const targetDate = new Date(date);
                // ë‚ ì§œë§Œ ë¹„êµ (ì‹œê°„ ì œì™¸)
                if (createdAtDate.toDateString() === targetDate.toDateString()) return true;
                // ë˜ëŠ” ë¡œì¼€ì¼ ë¬¸ìì—´ë¡œ ë¹„êµ
                if (createdAtDate.toLocaleString() === date) return true;
              }
              
              return false;
            });
            
            if (!inquiry || !inquiry.id) {
              console.error('ë¬¸ì˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', { subject, date, inquiries: inquiries.map(i => ({ id: i.id, subject: i.subject, date: i.date })) });
              alert('ë¬¸ì˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
              return false;
            }
            
            const author = (JSON.parse(localStorage.getItem('user')||'{}').name) || 'íšŒì›';
            const userEmail = getUserEmail();
            
            console.log('ğŸ“ ëŒ“ê¸€ ì €ì¥ ì‹œë„:', {
              inquiryId: inquiry.id,
              author: author,
              email: userEmail,
              text: text
            });
            
            // ëŒ“ê¸€ì„ ë³„ë„ ì»¬ë ‰ì…˜ì— ì €ì¥ (ê¶Œí•œ ë¬¸ì œ í•´ê²°)
            const { collection, addDoc, serverTimestamp } = window.firebaseFirestoreFunctions;
            const commentsRef = collection(window.firebaseDb, 'inquiryComments');
            
            console.log('ğŸ“ inquiryComments ì»¬ë ‰ì…˜ì— ì €ì¥ ì‹œë„...');
            
            await addDoc(commentsRef, {
              inquiryId: inquiry.id,
              author: author,
              email: userEmail,
              text: text,
              date: Date.now(),
              createdAt: serverTimestamp()
            });
            
            console.log('âœ… Firebaseì— ëŒ“ê¸€ ì €ì¥ ì™„ë£Œ');
            
            // ì¦‰ì‹œ ë Œë”ë§ ê°±ì‹ 
            renderHistory();
            
            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            input.value = '';
            
          } catch (error) {
            console.error('âŒ ëŒ“ê¸€ ì €ì¥ ì‹¤íŒ¨:', error);
            console.error('âŒ ì—ëŸ¬ ìƒì„¸:', {
              code: error.code,
              message: error.message,
              stack: error.stack
            });
            
            let errorMessage = 'ëŒ“ê¸€ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
            if (error.code === 'permission-denied') {
              errorMessage = 'ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.\n\nFirestore ê·œì¹™ì´ ë°°í¬ë˜ì—ˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.\n\nFirebase ì½˜ì†”ì—ì„œ Rules íƒ­ì„ í™•ì¸í•˜ê³  "Publish" ë²„íŠ¼ì„ í´ë¦­í–ˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.';
            } else if (error.message) {
              errorMessage = `ëŒ“ê¸€ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${error.message}`;
            }
            
            alert(errorMessage);
          }
          
          return false;
        }
      });

      // ì‹¤ì‹œê°„ ëŒ“ê¸€ ì—…ë°ì´íŠ¸ íƒ€ì´ë¨¸ (3ì´ˆë§ˆë‹¤)
      setInterval(updateCommentsInRealTime, 3000);
    });

    // íšŒì›íƒˆí‡´ ëª¨ë‹¬ ì—´ê¸°/ë‹«ê¸°
    function openWithdrawModal() {
      document.getElementById('withdraw-modal').classList.remove('hidden');
      document.body.style.overflow = 'hidden';
      // ì²´í¬ë°•ìŠ¤ ì´ˆê¸°í™”
      document.getElementById('withdraw-confirm').checked = false;
      document.getElementById('withdraw-confirm-btn').disabled = true;
    }

    function closeWithdrawModal() {
      document.getElementById('withdraw-modal').classList.add('hidden');
      document.body.style.overflow = 'auto';
    }
    
    // í˜„ì¬ ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ê°€ì ¸ì˜¤ê¸° (Auth ìƒíƒœ ëŒ€ê¸°)
    async function getCurrentUser() {
      return new Promise((resolve, reject) => {
        if (!window.firebaseAuth) {
          reject(new Error('Firebase Authê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.'));
          return;
        }
        
        // ì´ë¯¸ currentUserê°€ ìˆìœ¼ë©´ ë°”ë¡œ ë°˜í™˜
        const currentUser = window.firebaseAuth.currentUser;
        if (currentUser) {
          console.log('âœ… í˜„ì¬ ì‚¬ìš©ì í™•ì¸ë¨:', currentUser.email);
          resolve(currentUser);
          return;
        }
        
        // Auth ìƒíƒœ ë³€ê²½ì„ ê¸°ë‹¤ë¦¼
        console.log('ğŸ”„ Auth ìƒíƒœ í™•ì¸ ì¤‘...');
        const onAuthStateChanged = window.firebaseAuthFunctions?.onAuthStateChanged;
        
        if (!onAuthStateChanged) {
          // ë™ì  import ì‹œë„
          import('https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js').then(({ onAuthStateChanged }) => {
            const unsubscribe = onAuthStateChanged(window.firebaseAuth, (user) => {
              unsubscribe(); // í•œ ë²ˆë§Œ ì‹¤í–‰
              if (user) {
                console.log('âœ… Auth ìƒíƒœ í™•ì¸ ì™„ë£Œ:', user.email);
                resolve(user);
              } else {
                console.error('âŒ ë¡œê·¸ì¸ëœ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤.');
                reject(new Error('ë¡œê·¸ì¸ëœ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤.'));
              }
            });
            
            // 5ì´ˆ íƒ€ì„ì•„ì›ƒ
            setTimeout(() => {
              unsubscribe();
              reject(new Error('Auth ìƒíƒœ í™•ì¸ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.'));
            }, 5000);
          }).catch((error) => {
            console.error('âŒ onAuthStateChanged import ì‹¤íŒ¨:', error);
            reject(new Error('ì¸ì¦ ìƒíƒœ í™•ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'));
          });
          return;
        }
        
        const unsubscribe = onAuthStateChanged(window.firebaseAuth, (user) => {
          unsubscribe(); // í•œ ë²ˆë§Œ ì‹¤í–‰
          if (user) {
            console.log('âœ… Auth ìƒíƒœ í™•ì¸ ì™„ë£Œ:', user.email);
            resolve(user);
          } else {
            console.error('âŒ ë¡œê·¸ì¸ëœ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤.');
            reject(new Error('ë¡œê·¸ì¸ëœ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤.'));
          }
        });
        
        // 5ì´ˆ íƒ€ì„ì•„ì›ƒ
        setTimeout(() => {
          unsubscribe();
          reject(new Error('Auth ìƒíƒœ í™•ì¸ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.'));
        }, 5000);
      });
    }

    // íšŒì›íƒˆí‡´ í™•ì¸ í•¨ìˆ˜ (ì¬ì¸ì¦ í›„ ì™„ì „ ì‚­ì œ)
    async function confirmWithdraw() {
      if (!document.getElementById('withdraw-confirm').checked) {
        alert('íšŒì›íƒˆí‡´ì— ë™ì˜í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      try {
        await waitForFirebase();
        
        // í˜„ì¬ ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸° (Auth ìƒíƒœ ëŒ€ê¸°)
        let currentUser;
        try {
          currentUser = await getCurrentUser();
        } catch (error) {
          console.error('âŒ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
          alert('ë¡œê·¸ì¸ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n\në‹¤ì‹œ ë¡œê·¸ì¸í•œ í›„ ì‹œë„í•´ì£¼ì„¸ìš”.');
          return;
        }
        
        if (!currentUser) {
          alert('ë¡œê·¸ì¸ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n\në‹¤ì‹œ ë¡œê·¸ì¸í•œ í›„ ì‹œë„í•´ì£¼ì„¸ìš”.');
          return;
        }
        
        // ì¬ì¸ì¦ í™•ì¸
        const confirmReauth = confirm('íšŒì›íƒˆí‡´ë¥¼ ìœ„í•´ ì¬ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.\n\nê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
        if (!confirmReauth) {
          return;
        }
        
        // ì‚¬ìš©ìì˜ ë¡œê·¸ì¸ ë°©ë²• í™•ì¸
        const providerId = currentUser.providerData?.[0]?.providerId;
        const providerDataLength = currentUser.providerData?.length || 0;
        
        // ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ ê³„ì • íŒë‹¨:
        // 1. providerIdê°€ 'password'ì¸ ê²½ìš°
        // 2. providerDataê°€ ë¹„ì–´ìˆê³  emailì´ ìˆê³  ìµëª… ê³„ì •ì´ ì•„ë‹Œ ê²½ìš°
        const isEmailAccount = (providerId === 'password') || 
                               (providerDataLength === 0 && currentUser.email && !currentUser.isAnonymous);
        
        console.log('ğŸ” ì‚¬ìš©ì ë¡œê·¸ì¸ ë°©ë²•:', providerId || 'ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ (providerData ì—†ìŒ)');
        console.log('ğŸ” providerData ê¸¸ì´:', providerDataLength);
        console.log('ğŸ” ì´ë©”ì¼ ê³„ì • ì—¬ë¶€:', isEmailAccount);
        console.log('ğŸ” ì‚¬ìš©ì ì •ë³´:', {
          email: currentUser.email,
          isAnonymous: currentUser.isAnonymous,
          providerId: providerId
        });
        
        // ì¬ì¸ì¦ ìˆ˜í–‰
        let reauthResult;
        try {
          if (providerId === 'google.com') {
            // Google ê³„ì • ì¬ì¸ì¦
            console.log('ğŸ”„ Google ê³„ì • ì¬ì¸ì¦ ì‹œì‘...');
            const { reauthenticateWithPopup } = window.firebaseAuthFunctions;
            reauthResult = await reauthenticateWithPopup(currentUser, window.firebaseGoogleProvider);
            console.log('âœ… Google ì¬ì¸ì¦ ì„±ê³µ');
          } else if (isEmailAccount) {
            // ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ ê³„ì • - ë¹„ë°€ë²ˆí˜¸ ì¬ì…ë ¥ í•„ìš”
            console.log('ğŸ”„ ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ ê³„ì • ì¬ì¸ì¦ ì‹œì‘...');
            const password = prompt('íšŒì›íƒˆí‡´ë¥¼ ìœ„í•´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”:');
            if (!password) {
              alert('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì§€ ì•Šì•„ íšŒì›íƒˆí‡´ê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
              return;
            }
            
            try {
              // ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ ì¬ì¸ì¦ì€ EmailAuthProvider í•„ìš”
              const { EmailAuthProvider, reauthenticateWithCredential } = await import('https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js');
              const emailCredential = EmailAuthProvider.credential(currentUser.email, password);
              reauthResult = await reauthenticateWithCredential(currentUser, emailCredential);
              console.log('âœ… ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ ì¬ì¸ì¦ ì„±ê³µ');
            } catch (emailReauthError) {
              console.error('âŒ ì´ë©”ì¼ ì¬ì¸ì¦ ì‹¤íŒ¨:', emailReauthError);
              if (emailReauthError.code === 'auth/wrong-password') {
                alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                return;
              } else if (emailReauthError.code === 'auth/invalid-credential') {
                alert('ì¸ì¦ ì •ë³´ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                return;
              } else if (emailReauthError.code === 'auth/too-many-requests') {
                alert('ë„ˆë¬´ ë§ì€ ì‹œë„ê°€ ìˆì—ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                return;
              }
              throw emailReauthError;
            }
          } else if (providerId === 'amazon.com') {
            // ì•„ë§ˆì¡´ ê³„ì • - ì¬ì¸ì¦ ì—†ì´ ë°”ë¡œ ì‚­ì œ ì‹œë„
            console.log('ğŸ”„ ì•„ë§ˆì¡´ ê³„ì • - ì¬ì¸ì¦ ì—†ì´ ì‚­ì œ ì§„í–‰...');
            reauthResult = currentUser;
          } else {
            // ê¸°íƒ€ ë¡œê·¸ì¸ ë°©ë²• - ì¬ì¸ì¦ ì—†ì´ ì‹œë„
            console.log('ğŸ”„ ê¸°íƒ€ ë¡œê·¸ì¸ ë°©ë²• - ì¬ì¸ì¦ ì—†ì´ ì‚­ì œ ì§„í–‰...');
            reauthResult = currentUser;
          }
        } catch (reauthError) {
          console.error('âŒ ì¬ì¸ì¦ ì‹¤íŒ¨:', reauthError);
          if (reauthError.code === 'auth/popup-closed-by-user' || reauthError.code === 'auth/cancelled-popup-request') {
            alert('ì¬ì¸ì¦ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
            return;
          }
          // ì¬ì¸ì¦ ì‹¤íŒ¨ ì‹œ ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
          alert('ì¬ì¸ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + (reauthError.message || reauthError.code || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜') + '\n\níšŒì›íƒˆí‡´ë¥¼ ê³„ì† ì§„í–‰í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }
        
        // ì¬ì¸ì¦ ì„±ê³µ í›„ Firestoreì—ì„œ ì‚¬ìš©ì ë°ì´í„° ë¨¼ì € ì‚­ì œ (Auth ì‚­ì œ ì „)
        const { doc, deleteDoc, collection, query, where, getDocs } = window.firebaseFirestoreFunctions;
        const db = window.firebaseDb;
        
        // ì‚¬ìš©ì ë¬¸ì„œ ID ì°¾ê¸° (uid ë˜ëŠ” emailë¡œ ê²€ìƒ‰)
        let userDocId = currentUser.uid;
        const usersRef = collection(db, 'users');
        const q = query(usersRef, where('email', '==', currentUser.email));
        const querySnapshot = await getDocs(q);
        
        // uidë¡œë„ ì‹œë„
        let userDocRef = doc(db, 'users', currentUser.uid);
        if (!querySnapshot.empty) {
          userDocId = querySnapshot.docs[0].id;
          userDocRef = doc(db, 'users', userDocId);
        }
        
        // Firestoreì—ì„œ ì‚¬ìš©ì ë°ì´í„° ì‚­ì œ (ì¬ì¸ì¦ í›„ì´ë¯€ë¡œ ê¶Œí•œ ìˆìŒ)
        try {
          await deleteDoc(userDocRef);
          console.log('âœ… Firestoreì—ì„œ ì‚¬ìš©ì ë°ì´í„° ì‚­ì œ ì™„ë£Œ:', userDocId);
        } catch (firestoreError) {
          console.warn('âš ï¸ Firestore ì‚­ì œ ì‹¤íŒ¨ (ê³„ì† ì§„í–‰):', firestoreError);
          // Firestore ì‚­ì œê°€ ì‹¤íŒ¨í•´ë„ Auth ì‚­ì œëŠ” ê³„ì† ì§„í–‰
        }
        
        // Firebase Authì—ì„œ ì‚¬ìš©ì ì‚­ì œ
        console.log('ğŸ—‘ï¸ Firebase Authì—ì„œ ì‚¬ìš©ì ì‚­ì œ ì‹œì‘...');
        const { deleteUser } = window.firebaseAuthFunctions;
        try {
          await deleteUser(currentUser);
          console.log('âœ… Firebase Authì—ì„œ ì‚¬ìš©ì ì‚­ì œ ì™„ë£Œ');
        } catch (deleteError) {
          console.error('âŒ Firebase Auth ì‚­ì œ ì‹¤íŒ¨:', deleteError);
          // requires-recent-login ì˜¤ë¥˜ì¸ ê²½ìš° íŠ¹ë³„ ì²˜ë¦¬
          if (deleteError.code === 'auth/requires-recent-login') {
            // ì•„ë§ˆì¡´ ë¡œê·¸ì¸ ë“± ì¬ì¸ì¦ì´ ì–´ë ¤ìš´ ê²½ìš°, Firestore ì‚­ì œë§Œìœ¼ë¡œ ì²˜ë¦¬
            console.warn('âš ï¸ ìµœê·¼ ë¡œê·¸ì¸ì´ í•„ìš”í•˜ì§€ë§Œ, Firestore ì‚­ì œëŠ” ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
            alert('íšŒì›íƒˆí‡´ê°€ ë¶€ë¶„ì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\n\nFirestore ë°ì´í„°ëŠ” ì‚­ì œë˜ì—ˆì§€ë§Œ, Firebase Auth ê³„ì • ì‚­ì œë¥¼ ìœ„í•´ì„œëŠ” ë‹¤ì‹œ ë¡œê·¸ì¸í•œ í›„ ì‹œë„í•´ì£¼ì„¸ìš”.\n\në˜ëŠ” ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.');
            // ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
            const { signOut } = window.firebaseAuthFunctions;
            await signOut(window.firebaseAuth);
            window.location.href = 'index.html';
            return;
          }
          throw deleteError;
        }
        
        // localStorageì—ì„œ ì‚¬ìš©ì ì •ë³´ ì‚­ì œ
        localStorage.removeItem('user');
        localStorage.removeItem('currentUser');
        localStorage.removeItem('loggedIn');
        localStorage.removeItem('loggedInEmail');
        
        // íšŒì›íƒˆí‡´ ì™„ë£Œ ë©”ì‹œì§€
        alert('íšŒì›íƒˆí‡´ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\n\nê³„ì •ì´ ì™„ì „íˆ ì‚­ì œë˜ì—ˆìœ¼ë©°, ê°™ì€ êµ¬ê¸€ ê³„ì •ìœ¼ë¡œ ë‹¤ì‹œ ê°€ì…í•˜ì…”ë„ ìƒˆ ê³„ì •ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤.\n\nê·¸ë™ì•ˆ ì´ìš©í•´ì£¼ì…”ì„œ ê°ì‚¬í–ˆìŠµë‹ˆë‹¤.');
        
        // ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™
        window.location.href = 'index.html';
      } catch (error) {
        console.error('íšŒì›íƒˆí‡´ ì‹¤íŒ¨:', error);
        let errorMessage = 'íšŒì›íƒˆí‡´ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\në‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
        
        if (error.code === 'auth/requires-recent-login') {
          errorMessage = 'ë³´ì•ˆì„ ìœ„í•´ ìµœê·¼ì— ë¡œê·¸ì¸í•œ ìƒíƒœì—¬ì•¼ í•©ë‹ˆë‹¤.\n\në‹¤ì‹œ ë¡œê·¸ì¸í•œ í›„ íšŒì›íƒˆí‡´ë¥¼ ì‹œë„í•´ì£¼ì„¸ìš”.';
        } else if (error.message) {
          errorMessage += '\n\nì˜¤ë¥˜: ' + error.message;
        }
        
        alert(errorMessage);
      }
    }
  </script>

  <!-- íšŒì›íƒˆí‡´ í™•ì¸ ëª¨ë‹¬ -->
  <div id="withdraw-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl p-4 sm:p-6 md:p-8 max-w-xs sm:max-w-sm md:max-w-md mx-4 text-center">
      <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
        <svg class="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
        </svg>
      </div>
      <h3 class="text-xl font-bold text-gray-800 mb-4">íšŒì›íƒˆí‡´ í™•ì¸</h3>
      <p class="text-gray-600 mb-6">ì •ë§ë¡œ íšŒì›íƒˆí‡´ë¥¼ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?<br><span class="text-red-600 font-semibold">ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</span></p>
      
      <div class="space-y-4 mb-6">
        <div class="flex items-center gap-3">
          <input type="checkbox" id="withdraw-confirm" class="w-4 h-4 text-red-600 border-gray-300 rounded focus:ring-red-500" required />
          <label for="withdraw-confirm" class="text-gray-700">íšŒì›íƒˆí‡´ì— ë™ì˜í•©ë‹ˆë‹¤</label>
        </div>
      </div>
      
      <div class="flex gap-3">
        <button onclick="closeWithdrawModal()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-800 py-3 px-6 rounded-lg font-semibold transition">ì·¨ì†Œ</button>
        <button onclick="confirmWithdraw()" id="withdraw-confirm-btn" disabled class="flex-1 bg-red-600 hover:bg-red-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white py-3 px-6 rounded-lg font-semibold transition whitespace-nowrap">íšŒì›íƒˆí‡´</button>
      </div>
    </div>
  </div>

  <!-- ì˜ë¢° ìƒì„¸ë³´ê¸° ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜ë“¤ -->
  <script>
    // ì˜ë¢° ìƒì„¸ë³´ê¸° ëª¨ë‹¬ í‘œì‹œ
    function showRequestDetailModal(request) {
      console.log('ì˜ë¢° ìƒì„¸ë³´ê¸° ëª¨ë‹¬ í‘œì‹œ:', request);
      
      // ëª¨ë‹¬ ë°ì´í„° ì±„ìš°ê¸°
      fillRequestDetailModal(request);
      
      // ëª¨ë‹¬ í‘œì‹œ
      document.getElementById('request-detail-modal').classList.remove('hidden');
      document.body.style.overflow = 'hidden';
    }

    // ë‚ ì§œë¥¼ ì•ˆì „í•˜ê²Œ í¬ë§·íŒ…í•˜ëŠ” í•¨ìˆ˜
    function formatDateForDisplay(dateValue) {
      if (!dateValue) return 'N/A';
      
      try {
        let date;
        if (dateValue.toDate) {
          // Firestore Timestamp ê°ì²´
          date = dateValue.toDate();
        } else if (dateValue.seconds) {
          // Timestamp ê°ì²´ (seconds í•„ë“œ)
          date = new Date(dateValue.seconds * 1000);
        } else if (typeof dateValue === 'string' || typeof dateValue === 'number') {
          // ë¬¸ìì—´ì´ë‚˜ ìˆ«ì
          date = new Date(dateValue);
        } else {
          return 'N/A';
        }
        
        if (isNaN(date.getTime())) {
          return 'N/A';
        }
        
        return date.toLocaleString('ko-KR');
      } catch (error) {
        console.error('ë‚ ì§œ í¬ë§·íŒ… ì˜¤ë¥˜:', error, dateValue);
        return 'N/A';
      }
    }

    // ëª¨ë‹¬ ë°ì´í„° ì±„ìš°ê¸°
    function fillRequestDetailModal(request) {
      // ì˜ë¢° ê¸°ë³¸ ì •ë³´
      document.getElementById('modal-request-number').textContent = request.reqNum || request.requestNumber || 'N/A';
      document.getElementById('modal-request-date').textContent = formatDateForDisplay(request.reqDate || request.createdAt);
      document.getElementById('modal-product-name').textContent = request.productName || request.name || 'N/A';
      document.getElementById('modal-original-price').textContent = formatPrice(request.originalPrice || request.price);
      
      // ìƒíƒœ ë° ì§„í–‰ë¥ 
      const status = request.status || 'ì²˜ë¦¬ì¤‘';
      const statusElement = document.getElementById('modal-status');
      statusElement.textContent = status;
      statusElement.className = 'px-2 py-1 rounded-full text-xs font-bold text-white ' + getStatusClass(status);
      
      document.getElementById('modal-progress').textContent = request.progress || '0%';

      // ì œí’ˆ ìƒì„¸ ì •ë³´
      document.getElementById('modal-brand').textContent = request.brand || 'N/A';
      document.getElementById('modal-model').textContent = request.model || 'N/A';
      document.getElementById('modal-category').textContent = request.category || 'N/A';
      document.getElementById('modal-quantity').textContent = request.quantity || '1';
      document.getElementById('modal-description').textContent = request.description || request.productDescription || 'N/A';

      // ì²¨ë¶€ ì´ë¯¸ì§€
      displayModalImages(request.images || request.attachedImages || []);

      // ì—°ë½ì²˜ ì •ë³´
      document.getElementById('modal-user-name').textContent = request.userName || request.name || 'N/A';
      document.getElementById('modal-user-email').textContent = request.email || 'N/A';
      document.getElementById('modal-user-phone').textContent = request.userPhone || request.phone || 'N/A';
      document.getElementById('modal-user-kakao').textContent = request.userKakao || request.kakao || 'N/A';

      // ì¶”ê°€ ìš”ì²­ì‚¬í•­
      document.getElementById('modal-special-request').textContent = request.specialRequest || request.additionalRequest || 'N/A';

      // ê´€ë¦¬ì ë‹µë³€ (ìˆëŠ” ê²½ìš°)
      if (request.adminResponse || request.response) {
        document.getElementById('modal-admin-response').classList.remove('hidden');
        document.getElementById('modal-response-date').textContent = formatDateForDisplay(request.responseDate || request.answeredAt);
        
        // ë‹µë³€ì´ êµ¬ì¡°í™”ëœ ë°ì´í„°ì¸ì§€ í™•ì¸
        if (typeof request.adminResponse === 'object' && request.adminResponse !== null) {
          // êµ¬ì¡°í™”ëœ ë‹µë³€ ë°ì´í„° í‘œì‹œ
          document.getElementById('modal-response-content').innerHTML = formatMemberResponseDisplay(request.adminResponse, request);
        } else {
          // ê¸°ì¡´ í…ìŠ¤íŠ¸ ë‹µë³€ í‘œì‹œ
          document.getElementById('modal-response-content').innerHTML = `<div class="whitespace-pre-wrap text-gray-700">${request.adminResponse || request.response || 'N/A'}</div>`;
        }
      } else {
        document.getElementById('modal-admin-response').classList.add('hidden');
      }
    }

    // ë¬¸ì˜ ë‹µë³€ì„ íšŒì›ìš©ìœ¼ë¡œ í¬ë§·íŒ…
    function formatInquiryResponseForMember(responseData) {
      let html = '<div class="space-y-3">';
      
      if (responseData.answer) {
        html += `
          <div class="p-3 bg-blue-50 rounded-lg border-l-4 border-blue-500">
            <div class="font-semibold text-blue-800 mb-2">ğŸ’¬ ë‹µë³€</div>
            <div class="text-blue-600 whitespace-pre-wrap">${escapeHtml(responseData.answer)}</div>
          </div>
        `;
      }
      
      if (responseData.additionalInfo) {
        html += `
          <div class="p-3 bg-gray-50 rounded-lg border-l-4 border-gray-500">
            <div class="font-semibold text-gray-800 mb-2">ğŸ“ ì¶”ê°€ ì •ë³´</div>
            <div class="text-gray-600 whitespace-pre-wrap">${escapeHtml(responseData.additionalInfo)}</div>
          </div>
        `;
      }
      
      html += '</div>';
      return html;
    }

    // íšŒì›ìš© ë‹µë³€ í‘œì‹œ í¬ë§·íŒ… (ì˜ë¢°ê±´ê³¼ ë¹„êµ)
    function formatMemberResponseDisplay(responseData, originalRequest) {
      let html = '<div class="space-y-4">';
      
      // ê°€ê²© ë¹„êµ ì„¹ì…˜
      if (responseData.lowestPrice || originalRequest.originalPrice) {
        html += `
          <div class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg p-4 border-l-4 border-green-500">
            <h4 class="font-semibold text-green-800 mb-3 flex items-center">
              <span class="text-xl mr-2">ğŸ’°</span>
              ê°€ê²© ë¹„êµ ê²°ê³¼
            </h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="bg-white rounded-lg p-3 shadow-sm">
                <div class="text-sm text-gray-600 mb-1">ì˜ë¢°í•˜ì‹  ê°€ê²©</div>
                <div class="text-lg font-bold text-gray-800">${originalRequest.originalPrice || originalRequest.price || 'N/A'}</div>
              </div>
              <div class="bg-white rounded-lg p-3 shadow-sm">
                <div class="text-sm text-gray-600 mb-1">ì°¾ì€ ìµœì €ê°€</div>
                <div class="text-lg font-bold text-green-600">${responseData.lowestPrice || 'N/A'}</div>
              </div>
            </div>
          </div>
        `;
      }
      
      // íŒë§¤ì—…ì²´ ì •ë³´
      if (responseData.seller) {
        html += `
          <div class="flex items-center p-3 bg-blue-50 rounded-lg border-l-4 border-blue-500">
            <span class="text-2xl mr-3">ğŸª</span>
            <div>
              <div class="font-semibold text-blue-800">ì¶”ì²œ íŒë§¤ì—…ì²´</div>
              <div class="text-blue-600">${responseData.seller}</div>
            </div>
          </div>
        `;
      }
      
      // íŒë§¤ ë§í¬
      if (responseData.sellerLink) {
        html += `
          <div class="flex items-center p-3 bg-purple-50 rounded-lg border-l-4 border-purple-500">
            <span class="text-2xl mr-3">ğŸ”—</span>
            <div>
              <div class="font-semibold text-purple-800">êµ¬ë§¤ ë§í¬</div>
              <a href="${responseData.sellerLink}" target="_blank" class="text-purple-600 hover:underline break-all">${responseData.sellerLink}</a>
            </div>
          </div>
        `;
      }
      
      // ë°°ì†¡ ì •ë³´
      if (responseData.shippingCost || responseData.shippingTime) {
        html += `
          <div class="flex items-center p-3 bg-yellow-50 rounded-lg border-l-4 border-yellow-500">
            <span class="text-2xl mr-3">ğŸšš</span>
            <div>
              <div class="font-semibold text-yellow-800">ë°°ì†¡ ì •ë³´</div>
              <div class="text-yellow-600">
                ${responseData.shippingCost ? `ë°°ì†¡ë¹„: ${responseData.shippingCost}` : ''}
                ${responseData.shippingCost && responseData.shippingTime ? '<br>' : ''}
                ${responseData.shippingTime ? `ë°°ì†¡ê¸°ê°„: ${responseData.shippingTime}` : ''}
              </div>
            </div>
          </div>
        `;
      }
      
      // ì´ ë¹„ìš©
      if (responseData.totalCost) {
        html += `
          <div class="flex items-center p-3 bg-red-50 rounded-lg border-l-4 border-red-500">
            <span class="text-2xl mr-3">ğŸ’³</span>
            <div>
              <div class="font-semibold text-red-800">ì´ êµ¬ë§¤ë¹„ìš©</div>
              <div class="text-red-600 text-lg font-bold">${responseData.totalCost}</div>
            </div>
          </div>
        `;
      }
      
      // ì¶”ê°€ ì •ë³´
      if (responseData.additionalInfo) {
        html += `
          <div class="p-3 bg-gray-50 rounded-lg border-l-4 border-gray-500">
            <div class="font-semibold text-gray-800 mb-2">ğŸ“ ì¶”ê°€ ì •ë³´ ë° ì¶”ì²œì‚¬ìœ </div>
            <div class="text-gray-600 whitespace-pre-wrap">${responseData.additionalInfo}</div>
          </div>
        `;
      }
      
      html += '</div>';
      return html;
    }

    // ìƒíƒœì— ë”°ë¥¸ CSS í´ë˜ìŠ¤ ë°˜í™˜
    function getStatusClass(status) {
      switch(status) {
        case 'ë‹µë³€ì™„ë£Œ': return 'bg-green-500';
        case 'ì™„ë£Œ': return 'bg-green-500';
        case 'ì²˜ë¦¬ì¤‘': return 'bg-yellow-500';
        case 'ëŒ€ê¸°': return 'bg-gray-500';
        case 'ì·¨ì†Œ': return 'bg-red-500';
        default: return 'bg-blue-500';
      }
    }

    // ëª¨ë‹¬ì— ì´ë¯¸ì§€ í‘œì‹œ
    function displayModalImages(images) {
      const imagesContainer = document.getElementById('modal-images');
      imagesContainer.innerHTML = '';

      if (!images || images.length === 0) {
        imagesContainer.innerHTML = '<div class="col-span-full text-center text-gray-500 py-8">ì²¨ë¶€ëœ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
      }

      images.forEach((image, index) => {
        const imageElement = document.createElement('div');
        imageElement.className = 'relative group';
        
        if (typeof image === 'string') {
          // Base64 ì´ë¯¸ì§€ ë˜ëŠ” URL
          imageElement.innerHTML = `
            <img src="${image}" alt="ì²¨ë¶€ ì´ë¯¸ì§€ ${index + 1}" class="w-full h-48 object-cover rounded-lg shadow-md hover:shadow-lg transition-shadow cursor-pointer" onclick="openImageModal('${image}')">
            <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all duration-200 rounded-lg flex items-center justify-center">
              <span class="text-white opacity-0 group-hover:opacity-100 transition-opacity text-sm font-semibold">í´ë¦­í•˜ì—¬ í™•ëŒ€</span>
            </div>
          `;
        } else if (image.url) {
          // ì´ë¯¸ì§€ ê°ì²´
          imageElement.innerHTML = `
            <img src="${image.url}" alt="${image.name || 'ì²¨ë¶€ ì´ë¯¸ì§€ ' + (index + 1)}" class="w-full h-48 object-cover rounded-lg shadow-md hover:shadow-lg transition-shadow cursor-pointer" onclick="openImageModal('${image.url}')">
            <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all duration-200 rounded-lg flex items-center justify-center">
              <span class="text-white opacity-0 group-hover:opacity-100 transition-opacity text-sm font-semibold">í´ë¦­í•˜ì—¬ í™•ëŒ€</span>
            </div>
          `;
        }
        
        imagesContainer.appendChild(imageElement);
      });
    }

    // ì´ë¯¸ì§€ í™•ëŒ€ ëª¨ë‹¬ (ê°„ë‹¨í•œ ë²„ì „)
    function openImageModal(imageSrc) {
      const modal = document.createElement('div');
      modal.className = 'fixed inset-0 bg-black bg-opacity-75 z-60 flex items-center justify-center';
      modal.innerHTML = `
        <div class="relative max-w-4xl max-h-full p-4">
          <img src="${imageSrc}" alt="í™•ëŒ€ëœ ì´ë¯¸ì§€" class="max-w-full max-h-full object-contain rounded-lg">
          <button onclick="this.parentElement.parentElement.remove()" class="absolute top-2 right-2 text-white text-3xl font-bold hover:text-gray-300">&times;</button>
        </div>
      `;
      document.body.appendChild(modal);
    }

    // ëª¨ë‹¬ ë‹«ê¸°
    function closeRequestDetailModal() {
      document.getElementById('request-detail-modal').classList.add('hidden');
      document.body.style.overflow = 'auto';
    }

    // ëª¨ë‹¬ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
    document.addEventListener('DOMContentLoaded', function() {
      // ëª¨ë‹¬ ë‹«ê¸° ë²„íŠ¼
      document.getElementById('close-request-modal').addEventListener('click', closeRequestDetailModal);
      
      // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
      document.getElementById('request-detail-modal').addEventListener('click', function(e) {
        if (e.target === this) {
          closeRequestDetailModal();
        }
      });
      
      // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && !document.getElementById('request-detail-modal').classList.contains('hidden')) {
          closeRequestDetailModal();
        }
      });

      // í˜ì´ì§€ ì–¸ë§ˆìš´íŠ¸ ì‹œ ì •ë¦¬ ì‘ì—… (ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€)
      window.addEventListener('beforeunload', function() {
        console.log('ğŸ”„ í˜ì´ì§€ ì–¸ë§ˆìš´íŠ¸ - ì •ë¦¬ ì‘ì—…');
        // í•„ìš”í•œ ê²½ìš° ì—¬ê¸°ì— ì¶”ê°€ ì •ë¦¬ ì‘ì—… ì¶”ê°€
      });
    });
  </script>
</body>
</html>
