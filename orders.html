<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="noindex, nofollow" />
    <title>ë‚´ ì£¼ë¬¸ ëª©ë¡ | PriceHunter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
      body { font-family: 'Noto Sans KR', sans-serif; }
      .status-ordered { color: #3b82f6; }
      .status-paid { color: #8b5cf6; }
      .status-preparing { color: #f97316; }
      .status-shipping { color: #6366f1; }
      .status-delivered { color: #10b981; }
      .status-none { color: #6b7280; }
    </style>
  </head>
  <body class="bg-gradient-to-br from-gray-50 via-blue-50 to-emerald-50 min-h-screen">
    <main class="container mx-auto px-4 py-8 max-w-4xl">
      <div class="bg-white/90 rounded-3xl shadow-2xl p-8 backdrop-blur-md">
        <div class="text-center mb-8">
          <h1 class="text-3xl font-extrabold text-pink-600 mb-2">ğŸ“¦ ë‚´ ì£¼ë¬¸ ëª©ë¡</h1>
          <p class="text-gray-600">êµ¬ë§¤í•œ ìƒí’ˆë“¤ì˜ ì§„í–‰ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”</p>
        </div>

        <!-- ì‚¬ìš©ì ì •ë³´ -->
        <div class="bg-pink-50 rounded-xl p-4 mb-6">
          <div class="flex items-center justify-between">
            <div>
              <span class="font-bold text-pink-700" id="user-name">ì‚¬ìš©ì</span>
              <span class="text-gray-600 ml-2" id="user-email">ì´ë©”ì¼</span>
            </div>
            <a href="index.html" class="px-4 py-2 bg-pink-500 text-white rounded-lg font-bold hover:bg-pink-600 transition">
              í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°
            </a>
          </div>
        </div>

        <!-- ì£¼ë¬¸ ëª©ë¡ -->
        <div class="mb-6">
          <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold text-gray-800">ì£¼ë¬¸ ë‚´ì—­</h2>
            <div class="text-sm text-gray-600">
              ì´ <span id="order-count">0</span>ê°œì˜ ì£¼ë¬¸
            </div>
          </div>
          
          <div class="bg-gray-50 rounded-xl overflow-hidden">
            <div class="grid grid-cols-12 gap-4 p-4 bg-gray-100 font-bold text-sm text-gray-700">
              <div class="col-span-2">ì£¼ë¬¸ë²ˆí˜¸</div>
              <div class="col-span-3">ìƒí’ˆëª…</div>
              <div class="col-span-2">êµ¬ë§¤ë°©ì‹</div>
              <div class="col-span-2">êµ¬ë§¤ìƒíƒœ</div>
              <div class="col-span-2">ì£¼ë¬¸ì¼</div>
              <div class="col-span-1">ìƒì„¸</div>
            </div>
            
            <div id="orders-list" class="divide-y divide-gray-200">
              <!-- ì£¼ë¬¸ ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>
          </div>
        </div>

        <!-- ì£¼ë¬¸ ìƒì„¸ ì •ë³´ -->
        <div id="order-detail" class="hidden bg-blue-50 rounded-xl p-6">
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-bold text-blue-700">ğŸ“‹ ì£¼ë¬¸ ìƒì„¸ ì •ë³´</h3>
            <button onclick="closeOrderDetail()" class="text-gray-500 hover:text-gray-700">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>
          
          <div id="order-detail-content" class="space-y-4">
            <!-- ì£¼ë¬¸ ìƒì„¸ ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
          </div>
        </div>

        <!-- ì§„í–‰ìƒíƒœ ì•ˆë‚´ -->
        <div class="bg-yellow-50 rounded-xl p-4">
          <h3 class="font-bold text-yellow-800 mb-2">ğŸ“Š êµ¬ë§¤ ì§„í–‰ìƒíƒœ ì•ˆë‚´</h3>
          <div class="grid grid-cols-2 md:grid-cols-5 gap-2 text-sm">
            <div class="flex items-center">
              <div class="w-3 h-3 bg-blue-500 rounded-full mr-2"></div>
              <span class="status-ordered">ì£¼ë¬¸ì ‘ìˆ˜</span>
            </div>
            <div class="flex items-center">
              <div class="w-3 h-3 bg-purple-500 rounded-full mr-2"></div>
              <span class="status-paid">ê²°ì œì™„ë£Œ</span>
            </div>
            <div class="flex items-center">
              <div class="w-3 h-3 bg-orange-500 rounded-full mr-2"></div>
              <span class="status-preparing">ë°°ì†¡ì¤€ë¹„</span>
            </div>
            <div class="flex items-center">
              <div class="w-3 h-3 bg-indigo-500 rounded-full mr-2"></div>
              <span class="status-shipping">ë°°ì†¡ì¤‘</span>
            </div>
            <div class="flex items-center">
              <div class="w-3 h-3 bg-green-500 rounded-full mr-2"></div>
              <span class="status-delivered">ë°°ì†¡ì™„ë£Œ</span>
            </div>
          </div>
        </div>
      </div>
    </main>

    <script>
      let currentUser = null;
      let allOrders = [];

      // ì‚¬ìš©ì ì •ë³´ ë¡œë“œ
      function loadUserInfo() {
        const userData = localStorage.getItem('user');
        if (userData) {
          currentUser = JSON.parse(userData);
          document.getElementById('user-name').textContent = currentUser.name;
          document.getElementById('user-email').textContent = currentUser.email;
        } else {
          // ë¡œê·¸ì¸ë˜ì§€ ì•Šì€ ê²½ìš° í™ˆìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
          window.location.href = 'index.html';
        }
      }

      // ì£¼ë¬¸ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
      function getOrders() {
        const orders = [];
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          if (key.startsWith('order-') && !key.includes('PH-')) {
            const orderData = localStorage.getItem(key);
            if (orderData) {
              const order = JSON.parse(orderData);
              // í˜„ì¬ ì‚¬ìš©ìì˜ ì˜ë¢°ì™€ ì—°ê²°ëœ ì£¼ë¬¸ë§Œ í•„í„°ë§
              const requestKey = 'request-' + key.replace('order-', '');
              const requestData = localStorage.getItem(requestKey);
              if (requestData) {
                const request = JSON.parse(requestData);
                if (request.email === currentUser.email) {
                  orders.push({
                    key: key,
                    reqKey: key.replace('order-', ''),
                    ...order
                  });
                }
              }
            }
          }
        }
        return orders.sort((a, b) => new Date(b.orderDate || 0) - new Date(a.orderDate || 0));
      }

      // êµ¬ë§¤ ìƒíƒœ í…ìŠ¤íŠ¸ ë³€í™˜
      function getPurchaseStatusText(status) {
        const statusMap = {
          'none': 'êµ¬ë§¤í•˜ì§€ ì•ŠìŒ',
          'ordered': 'ì£¼ë¬¸ì ‘ìˆ˜',
          'paid': 'ê²°ì œì™„ë£Œ',
          'preparing': 'ë°°ì†¡ì¤€ë¹„',
          'shipping': 'ë°°ì†¡ì¤‘',
          'delivered': 'ë°°ì†¡ì™„ë£Œ'
        };
        return statusMap[status] || 'êµ¬ë§¤í•˜ì§€ ì•ŠìŒ';
      }

      // êµ¬ë§¤ ë°©ì‹ í…ìŠ¤íŠ¸ ë³€í™˜
      function getPurchaseMethodText(method) {
        const methodMap = {
          'direct': 'PriceHunter ì§ì ‘êµ¬ë§¤ (ì„œë¹„ìŠ¤ ì¤‘ë‹¨)',
          'external': 'ìµœì €ê°€ ì‡¼í•‘ëª°',
          'none': 'êµ¬ë§¤í•˜ì§€ ì•ŠìŒ'
        };
        return methodMap[method] || 'êµ¬ë§¤í•˜ì§€ ì•ŠìŒ';
      }

      // ì£¼ë¬¸ ëª©ë¡ ë Œë”ë§
      function renderOrders() {
        allOrders = getOrders();
        const ordersList = document.getElementById('orders-list');
        const orderCount = document.getElementById('order-count');
        
        orderCount.textContent = allOrders.length;
        
        if (allOrders.length === 0) {
          ordersList.innerHTML = `
            <div class="p-8 text-center text-gray-500">
              <div class="text-4xl mb-4">ğŸ“¦</div>
              <div class="text-lg font-semibold mb-2">ì•„ì§ ì£¼ë¬¸í•œ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤</div>
              <div class="text-sm">ì˜ë¢° ê²°ê³¼ì—ì„œ êµ¬ë§¤ë¥¼ ì§„í–‰í•´ë³´ì„¸ìš”!</div>
            </div>
          `;
          return;
        }

        ordersList.innerHTML = '';
        
        allOrders.forEach(order => {
          const orderItem = document.createElement('div');
          orderItem.className = 'grid grid-cols-12 gap-4 p-4 hover:bg-gray-50 transition';
          
          const orderDate = order.orderDate ? new Date(order.orderDate).toLocaleDateString() : '-';
          const statusText = getPurchaseStatusText(order.status);
          const methodText = getPurchaseMethodText(order.method);
          
          orderItem.innerHTML = `
            <div class="col-span-2 text-sm font-semibold text-gray-700">${order.reqKey}</div>
            <div class="col-span-3 text-sm text-gray-800">${order.productName || '-'}</div>
            <div class="col-span-2 text-sm text-gray-600">${methodText}</div>
            <div class="col-span-2">
              <span class="px-2 py-1 rounded text-xs font-bold status-${order.status}">${statusText}</span>
            </div>
            <div class="col-span-2 text-sm text-gray-500">${orderDate}</div>
            <div class="col-span-1">
              <button onclick="showOrderDetail('${order.key}')" class="text-blue-600 hover:text-blue-800 text-sm font-semibold">
                ìƒì„¸ë³´ê¸°
              </button>
            </div>
          `;
          
          ordersList.appendChild(orderItem);
        });
      }

      // ì£¼ë¬¸ ìƒì„¸ ì •ë³´ í‘œì‹œ
      function showOrderDetail(orderKey) {
        const order = allOrders.find(o => o.key === orderKey);
        if (!order) return;

        const detailContent = document.getElementById('order-detail-content');
        const detailSection = document.getElementById('order-detail');
        
        let detailHtml = `
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <h4 class="font-bold text-gray-800 mb-3">ğŸ“¦ ì£¼ë¬¸ ì •ë³´</h4>
              <div class="space-y-2 text-sm">
                <div><span class="font-semibold">ì£¼ë¬¸ë²ˆí˜¸:</span> ${order.reqKey}</div>
                <div><span class="font-semibold">ìƒí’ˆëª…:</span> ${order.productName || '-'}</div>
                <div><span class="font-semibold">êµ¬ë§¤ë°©ì‹:</span> ${getPurchaseMethodText(order.method)}</div>
                <div><span class="font-semibold">êµ¬ë§¤ìƒíƒœ:</span> 
                  <span class="px-2 py-1 rounded text-xs font-bold status-${order.status}">${getPurchaseStatusText(order.status)}</span>
                </div>
                <div><span class="font-semibold">ì£¼ë¬¸ì¼:</span> ${order.orderDate ? new Date(order.orderDate).toLocaleString() : '-'}</div>
              </div>
            </div>
        `;

        if (order.method === 'direct') {
          detailHtml += `
            <div>
              <h4 class="font-bold text-gray-800 mb-3">ğŸ’³ ê²°ì œ ì •ë³´</h4>
              <div class="space-y-2 text-sm">
                <div><span class="font-semibold">ê²°ì œë°©ë²•:</span> ${order.paymentMethod || '-'}</div>
                <div><span class="font-semibold">ê²°ì œê¸ˆì•¡:</span> ${order.price || '-'}</div>
              </div>
            </div>
          `;
        } else if (order.method === 'external') {
          detailHtml += `
            <div>
              <h4 class="font-bold text-gray-800 mb-3">ğŸ”— ì™¸ë¶€ ë§í¬</h4>
              <div class="space-y-2 text-sm">
                <div><span class="font-semibold">êµ¬ë§¤ ë§í¬:</span></div>
                <a href="${order.externalLink}" target="_blank" class="text-blue-600 underline break-all">${order.externalLink}</a>
              </div>
            </div>
          `;
        }

        if (order.recipient) {
          detailHtml += `
            <div>
              <h4 class="font-bold text-gray-800 mb-3">ğŸ“® ë°°ì†¡ ì •ë³´</h4>
              <div class="space-y-2 text-sm">
                <div><span class="font-semibold">ìˆ˜ë ¹ì¸:</span> ${order.recipient.name || '-'}</div>
                <div><span class="font-semibold">ì—°ë½ì²˜:</span> ${order.recipient.phone || '-'}</div>
                <div><span class="font-semibold">ë°°ì†¡ì§€:</span> ${order.recipient.address || '-'}</div>
              </div>
            </div>
          `;
        }

        if (order.memo) {
          detailHtml += `
            <div class="md:col-span-2">
              <h4 class="font-bold text-gray-800 mb-3">ğŸ“ ê´€ë¦¬ì ë©”ëª¨</h4>
              <div class="bg-white rounded-lg p-3 text-sm">
                ${order.memo}
              </div>
            </div>
          `;
        }

        detailHtml += '</div>';
        
        detailContent.innerHTML = detailHtml;
        detailSection.classList.remove('hidden');
      }

      // ì£¼ë¬¸ ìƒì„¸ ì •ë³´ ë‹«ê¸°
      function closeOrderDetail() {
        document.getElementById('order-detail').classList.add('hidden');
      }

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
      window.addEventListener('DOMContentLoaded', function() {
        loadUserInfo();
        renderOrders();
      });
    </script>
  </body>
</html> 