<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firestore ë°ì´í„° í™•ì¸ - PriceHunter</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background: #e8f5e8; border-color: #4caf50; }
        .error { background: #ffebee; border-color: #f44336; }
        .info { background: #e3f2fd; border-color: #2196f3; }
        button { background: #2196f3; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #1976d2; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 5px; overflow-x: auto; font-size: 12px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 8px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background-color: #f2f2f2; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” Firestore ë°ì´í„° í™•ì¸ ë„êµ¬</h1>
        
        <div id="results"></div>
        
        <div style="text-align: center; margin-top: 30px;">
            <button onclick="checkFirestoreData()">Firestore ë°ì´í„° í™•ì¸</button>
            <button onclick="testKakaoLogin()">ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸</button>
            <button onclick="clearResults()">ê²°ê³¼ ì§€ìš°ê¸°</button>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="firebase-config.js"></script>

    <script>
        function addResult(title, content, type = 'info') {
            const resultsDiv = document.getElementById('results');
            const sectionDiv = document.createElement('div');
            sectionDiv.className = `section ${type}`;
            sectionDiv.innerHTML = `
                <h3>${title}</h3>
                <div>${content}</div>
            `;
            resultsDiv.appendChild(sectionDiv);
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        async function checkFirestoreData() {
            addResult('ğŸ” Firestore ë°ì´í„° í™•ì¸ ì‹œì‘...', 'ë°ì´í„°ë¥¼ í™•ì¸í•˜ëŠ” ì¤‘...', 'info');
            
            try {
                // Firebase ì´ˆê¸°í™” í™•ì¸
                if (typeof firebase === 'undefined') {
                    addResult('âŒ Firebase SDK ì˜¤ë¥˜', 'Firebase SDKê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', 'error');
                    return;
                }

                if (typeof initializeFirebase === 'undefined') {
                    addResult('âŒ Firebase ì´ˆê¸°í™” ì˜¤ë¥˜', 'initializeFirebase í•¨ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
                    return;
                }

                // Firebase ì´ˆê¸°í™”
                const initResult = initializeFirebase();
                if (!initResult) {
                    addResult('âŒ Firebase ì´ˆê¸°í™” ì‹¤íŒ¨', 'Firebase ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                    return;
                }

                addResult('âœ… Firebase ì´ˆê¸°í™” ì„±ê³µ', 'Firebaseê°€ ì •ìƒì ìœ¼ë¡œ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');

                // Firestore ì—°ê²° í…ŒìŠ¤íŠ¸
                if (!window.firestore) {
                    addResult('âŒ Firestore ì—°ê²° ì˜¤ë¥˜', 'Firestoreê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', 'error');
                    return;
                }

                addResult('âœ… Firestore ì—°ê²° ì„±ê³µ', 'Firestoreê°€ ì •ìƒì ìœ¼ë¡œ ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');

                // members ì»¬ë ‰ì…˜ ë°ì´í„° í™•ì¸
                const membersSnapshot = await window.firestore.collection('members').get();
                const members = [];
                membersSnapshot.forEach(doc => {
                    members.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });

                addResult(`ğŸ‘¥ Members ì»¬ë ‰ì…˜ (${members.length}ê°œ)`, `
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>ì´ë©”ì¼</th>
                                <th>ì´ë¦„</th>
                                <th>Provider</th>
                                <th>ê°€ì…ì¼</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${members.map(member => `
                                <tr>
                                    <td>${member.id}</td>
                                    <td>${member.email || '-'}</td>
                                    <td>${member.name || '-'}</td>
                                    <td>${member.provider || '-'}</td>
                                    <td>${member.createdAt ? new Date(member.createdAt.seconds * 1000).toLocaleString() : '-'}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `, members.length > 0 ? 'success' : 'error');

                // requests ì»¬ë ‰ì…˜ ë°ì´í„° í™•ì¸
                const requestsSnapshot = await window.firestore.collection('requests').get();
                const requests = [];
                requestsSnapshot.forEach(doc => {
                    requests.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });

                addResult(`ğŸ“‹ Requests ì»¬ë ‰ì…˜ (${requests.length}ê°œ)`, `
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>ì œëª©</th>
                                <th>ì´ë©”ì¼</th>
                                <th>ìƒíƒœ</th>
                                <th>ìƒì„±ì¼</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${requests.map(request => `
                                <tr>
                                    <td>${request.id}</td>
                                    <td>${request.title || '-'}</td>
                                    <td>${request.email || '-'}</td>
                                    <td>${request.status || '-'}</td>
                                    <td>${request.createdAt ? new Date(request.createdAt.seconds * 1000).toLocaleString() : '-'}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `, requests.length > 0 ? 'success' : 'error');

                // inquiries ì»¬ë ‰ì…˜ ë°ì´í„° í™•ì¸
                const inquiriesSnapshot = await window.firestore.collection('inquiries').get();
                const inquiries = [];
                inquiriesSnapshot.forEach(doc => {
                    inquiries.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });

                addResult(`ğŸ’¬ Inquiries ì»¬ë ‰ì…˜ (${inquiries.length}ê°œ)`, `
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>ì œëª©</th>
                                <th>ì´ë©”ì¼</th>
                                <th>ìƒíƒœ</th>
                                <th>ìƒì„±ì¼</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${inquiries.map(inquiry => `
                                <tr>
                                    <td>${inquiry.id}</td>
                                    <td>${inquiry.title || '-'}</td>
                                    <td>${inquiry.email || '-'}</td>
                                    <td>${inquiry.status || '-'}</td>
                                    <td>${inquiry.createdAt ? new Date(inquiry.createdAt.seconds * 1000).toLocaleString() : '-'}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `, inquiries.length > 0 ? 'success' : 'error');

                // ì „ì²´ ìš”ì•½
                const totalData = members.length + requests.length + inquiries.length;
                addResult('ğŸ“Š ì „ì²´ ë°ì´í„° ìš”ì•½', `
                    <p><strong>ì´ ë°ì´í„° ê°œìˆ˜:</strong> ${totalData}ê°œ</p>
                    <p><strong>íšŒì›:</strong> ${members.length}ëª…</p>
                    <p><strong>ì˜ë¢°:</strong> ${requests.length}ê°œ</p>
                    <p><strong>ë¬¸ì˜:</strong> ${inquiries.length}ê°œ</p>
                `, totalData > 0 ? 'success' : 'error');

            } catch (error) {
                addResult('âŒ ì˜¤ë¥˜ ë°œìƒ', `
                    <p><strong>ì˜¤ë¥˜ ë©”ì‹œì§€:</strong> ${error.message}</p>
                    <p><strong>ì˜¤ë¥˜ ì½”ë“œ:</strong> ${error.code || 'N/A'}</p>
                    <pre>${error.stack}</pre>
                `, 'error');
            }
        }

        async function testKakaoLogin() {
            addResult('ğŸ” ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.', 'info');
            
            try {
                // ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ URL ìƒì„±
                const clientId = '6917a034b74fafd0ac80ab855af5ed6d';
                const redirectUri = window.location.origin + '/register.html';
                const authUrl = `https://kauth.kakao.com/oauth/authorize?client_id=${clientId}&redirect_uri=${encodeURIComponent(redirectUri)}&response_type=code&scope=profile_nickname,account_email`;
                
                addResult('ğŸ”— ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ URL', `
                    <p><strong>í´ë¼ì´ì–¸íŠ¸ ID:</strong> ${clientId}</p>
                    <p><strong>ë¦¬ë‹¤ì´ë ‰íŠ¸ URI:</strong> ${redirectUri}</p>
                    <p><strong>ì¸ì¦ URL:</strong></p>
                    <pre>${authUrl}</pre>
                    <button onclick="window.open('${authUrl}', '_blank')">ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸</button>
                `, 'info');

                // Netlify Function í…ŒìŠ¤íŠ¸
                const testResponse = await fetch('/.netlify/functions/kakao-exchange', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        accessToken: 'test-token'
                    })
                });

                addResult('ğŸ”§ Netlify Function í…ŒìŠ¤íŠ¸', `
                    <p><strong>ì‘ë‹µ ìƒíƒœ:</strong> ${testResponse.status}</p>
                    <p><strong>ì‘ë‹µ í—¤ë”:</strong></p>
                    <pre>${JSON.stringify(Object.fromEntries(testResponse.headers.entries()), null, 2)}</pre>
                `, testResponse.ok ? 'success' : 'error');

            } catch (error) {
                addResult('âŒ ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜', `
                    <p><strong>ì˜¤ë¥˜ ë©”ì‹œì§€:</strong> ${error.message}</p>
                    <pre>${error.stack}</pre>
                `, 'error');
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ í™•ì¸
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(checkFirestoreData, 1000);
        });
    </script>
</body>
</html>
