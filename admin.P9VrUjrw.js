import{o as e,a as t,s as n,f as o,q as s,h as l,i as r,j as a,b as c}from"./firebase.D0v-ztDH.js";const d=["q886654@naver.com","admin@pricehunter.com"];let i,g,u,y,p;async function m(e){if(console.log("🔄 인증 상태 변경:",e?e.email:"로그아웃"),e){const o=await async function(e){try{const t=await e.getIdTokenResult();return"admin"===t.claims.role?(console.log("✅ Custom Claims에서 관리자 권한 확인"),!0):d.includes(e.email)?(console.log("✅ 이메일 화이트리스트에서 관리자 권한 확인"),!0):(console.log("❌ 관리자 권한 없음"),!1)}catch(t){return console.error("❌ 관리자 권한 확인 실패:",t),!1}}(e);o?(console.log("✅ 관리자 권한 확인됨"),function(){i&&(i.style.display="none");g&&(g.style.display="block");const e=document.getElementById("loginError");e&&(e.style.display="none")}(),console.log("🔄 실시간 리스너 설정 시작..."),function(){console.log("👥 회원 데이터 리스너 설정...");const e=s(r(c,"members"),l("createdAt","desc"));a(e,e=>{console.log("📊 회원 데이터 수신:",e.size,"개 문서"),function(e){if(!u)return;const t=u.querySelector("tbody");t&&(t.innerHTML="",e.forEach(e=>{const n=e.data(),o=document.createElement("tr");var s,l;o.className="border-b border-gray-200 hover:bg-gray-50",o.innerHTML=`\n      <td class="px-4 py-3">${n.email||"N/A"}</td>\n      <td class="px-4 py-3">${n.name||"N/A"}</td>\n      <td class="px-4 py-3">\n        <span class="px-2 py-1 text-xs rounded-full ${l=n.provider,{kakao:"bg-yellow-100 text-yellow-800",google:"bg-blue-100 text-blue-800",email:"bg-gray-100 text-gray-800"}[l]||"bg-gray-100 text-gray-800"}">\n          ${n.provider||"N/A"}\n        </span>\n      </td>\n      <td class="px-4 py-3">\n        <span class="px-2 py-1 text-xs rounded-full ${s=n.role,{admin:"bg-red-100 text-red-800",viewer:"bg-green-100 text-green-800",user:"bg-blue-100 text-blue-800"}[s]||"bg-gray-100 text-gray-800"}">\n          ${n.role||"viewer"}\n        </span>\n      </td>\n      <td class="px-4 py-3">${$(n.createdAt)}</td>\n      <td class="px-4 py-3">${$(n.updatedAt)}</td>\n    `,t.appendChild(o)}),console.log("✅ 회원 테이블 업데이트 완료:",e.size,"개 행"))}(e)},e=>{console.error("❌ 회원 데이터 리스너 오류:",e)})}(),function(){console.log("📋 의뢰 데이터 리스너 설정...");const e=s(r(c,"requests"),l("createdAt","desc"));a(e,e=>{console.log("📊 의뢰 데이터 수신:",e.size,"개 문서"),function(e){if(!y)return;const t=y.querySelector("tbody");t&&(t.innerHTML="",e.forEach(e=>{const n=e.data(),o=document.createElement("tr");o.className="border-b border-gray-200 hover:bg-gray-50",o.innerHTML=`\n      <td class="px-4 py-3">${n.productName||"N/A"}</td>\n      <td class="px-4 py-3">${n.createdByEmail||"N/A"}</td>\n      <td class="px-4 py-3">${$(n.createdAt)}</td>\n      <td class="px-4 py-3">\n        <span class="px-2 py-1 text-xs rounded-full ${E(n.status)}">\n          ${n.status||"pending"}\n        </span>\n      </td>\n    `,t.appendChild(o)}),console.log("✅ 의뢰 테이블 업데이트 완료:",e.size,"개 행"))}(e)},e=>{console.error("❌ 의뢰 데이터 리스너 오류:",e)})}(),function(){console.log("💬 문의 데이터 리스너 설정...");const e=s(r(c,"inquiries"),l("createdAt","desc"));a(e,e=>{console.log("📊 문의 데이터 수신:",e.size,"개 문서"),function(e){if(!p)return;const t=p.querySelector("tbody");t&&(t.innerHTML="",e.forEach(e=>{const n=e.data(),o=document.createElement("tr");o.className="border-b border-gray-200 hover:bg-gray-50",o.innerHTML=`\n      <td class="px-4 py-3">${n.subject||"N/A"}</td>\n      <td class="px-4 py-3">${n.createdByEmail||"N/A"}</td>\n      <td class="px-4 py-3">${$(n.createdAt)}</td>\n      <td class="px-4 py-3">\n        <span class="px-2 py-1 text-xs rounded-full ${E(n.status)}">\n          ${n.status||"pending"}\n        </span>\n      </td>\n    `,t.appendChild(o)}),console.log("✅ 문의 테이블 업데이트 완료:",e.size,"개 행"))}(e)},e=>{console.error("❌ 문의 데이터 리스너 오류:",e)})}()):(console.log("❌ 관리자 권한 없음"),f("관리자 권한이 없습니다."),await n(t))}else f()}async function b(e){e.preventDefault();const n=document.getElementById("email").value,s=document.getElementById("password").value;try{console.log("🔄 관리자 로그인 시도:",n),await o(t,n,s),console.log("✅ 관리자 로그인 성공")}catch(l){console.error("❌ 관리자 로그인 실패:",l),f("로그인에 실패했습니다: "+l.message)}}async function x(){try{await n(t),console.log("✅ 로그아웃 완료")}catch(e){console.error("❌ 로그아웃 실패:",e)}}function f(e=""){if(i&&(i.style.display="block"),g&&(g.style.display="none"),e){const t=document.getElementById("loginError");t&&(t.textContent=e,t.style.display="block")}}function E(e){return{pending:"bg-yellow-100 text-yellow-800",processing:"bg-blue-100 text-blue-800",completed:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800"}[e]||"bg-gray-100 text-gray-800"}function $(e){if(!e)return"N/A";return(e.toDate?e.toDate():new Date(e)).toLocaleString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}document.addEventListener("DOMContentLoaded",function(){console.log("🚀 관리자 대시보드 초기화 시작..."),i=document.getElementById("loginForm"),g=document.getElementById("dashboard"),u=document.getElementById("membersTable"),y=document.getElementById("requestsTable"),p=document.getElementById("inquiriesTable"),function(){i&&i.addEventListener("submit",b);const e=document.getElementById("logoutBtn");e&&e.addEventListener("click",x)}(),e(t,m)});
