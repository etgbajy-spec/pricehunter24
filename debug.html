<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow" />
    <title>Firebase ë””ë²„ê¹… - PriceHunter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    
    <!-- Firebase ì„¤ì • -->
    <script src="firebase-config.js"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-8">Firebase ë””ë²„ê¹… í˜ì´ì§€</h1>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Firebase ìƒíƒœ -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-4">Firebase ìƒíƒœ</h2>
                <div id="firebase-status" class="space-y-2">
                    <div>Firebase: <span id="firebase-loaded" class="text-red-500">ë¡œë”© ì¤‘...</span></div>
                    <div>Auth: <span id="auth-loaded" class="text-red-500">ë¡œë”© ì¤‘...</span></div>
                    <div>Firestore: <span id="firestore-loaded" class="text-red-500">ë¡œë”© ì¤‘...</span></div>
                </div>
            </div>
            
            <!-- í˜„ì¬ ì‚¬ìš©ì -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-4">í˜„ì¬ ì‚¬ìš©ì</h2>
                <div id="current-user" class="text-gray-500">ë¡œê·¸ì¸ë˜ì§€ ì•ŠìŒ</div>
            </div>
            
            <!-- íšŒì› ë°ì´í„° -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-4">íšŒì› ë°ì´í„°</h2>
                <div id="members-count" class="text-gray-500">ë¡œë”© ì¤‘...</div>
                <div id="members-list" class="mt-4 max-h-64 overflow-y-auto"></div>
            </div>
            
            <!-- ì˜ë¢° ë°ì´í„° -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-4">ì˜ë¢° ë°ì´í„°</h2>
                <div id="requests-count" class="text-gray-500">ë¡œë”© ì¤‘...</div>
                <div id="requests-list" class="mt-4 max-h-64 overflow-y-auto"></div>
            </div>
        </div>
        
        <!-- í…ŒìŠ¤íŠ¸ ë²„íŠ¼ -->
        <div class="mt-8 bg-white p-6 rounded-lg shadow">
            <h2 class="text-xl font-semibold mb-4">í…ŒìŠ¤íŠ¸ ë²„íŠ¼</h2>
            <div class="space-x-4">
                <button onclick="testFirestoreWrite()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                    Firestore ì“°ê¸° í…ŒìŠ¤íŠ¸
                </button>
                <button onclick="refreshData()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                    ë°ì´í„° ìƒˆë¡œê³ ì¹¨
                </button>
            </div>
        </div>
    </div>

    <script>
        // Firebase ì´ˆê¸°í™” í™•ì¸
        function checkFirebaseStatus() {
            const firebaseLoaded = document.getElementById('firebase-loaded');
            const authLoaded = document.getElementById('auth-loaded');
            const firestoreLoaded = document.getElementById('firestore-loaded');
            
            firebaseLoaded.textContent = window.firebase ? 'âœ… ë¡œë“œë¨' : 'âŒ ë¡œë“œ ì•ˆë¨';
            firebaseLoaded.className = window.firebase ? 'text-green-500' : 'text-red-500';
            
            authLoaded.textContent = window.auth ? 'âœ… ë¡œë“œë¨' : 'âŒ ë¡œë“œ ì•ˆë¨';
            authLoaded.className = window.auth ? 'text-green-500' : 'text-red-500';
            
            firestoreLoaded.textContent = window.firestore ? 'âœ… ë¡œë“œë¨' : 'âŒ ë¡œë“œ ì•ˆë¨';
            firestoreLoaded.className = window.firestore ? 'text-green-500' : 'text-red-500';
        }
        
        // í˜„ì¬ ì‚¬ìš©ì í™•ì¸
        function checkCurrentUser() {
            const currentUserDiv = document.getElementById('current-user');
            
            if (window.auth && window.auth.currentUser) {
                const user = window.auth.currentUser;
                currentUserDiv.innerHTML = `
                    <div class="text-sm">
                        <div><strong>UID:</strong> ${user.uid}</div>
                        <div><strong>Email:</strong> ${user.email}</div>
                        <div><strong>Name:</strong> ${user.displayName || 'ì—†ìŒ'}</div>
                    </div>
                `;
            } else {
                currentUserDiv.textContent = 'ë¡œê·¸ì¸ë˜ì§€ ì•ŠìŒ';
            }
        }
        
        // íšŒì› ë°ì´í„° ë¡œë“œ
        function loadMembers() {
            if (!window.firestore) {
                document.getElementById('members-count').textContent = 'Firestore ë¡œë“œ ì•ˆë¨';
                return;
            }
            
            window.firestore.collection('members')
                .orderBy('createdAt', 'desc')
                .limit(10)
                .get()
                .then((snapshot) => {
                    const count = snapshot.size;
                    document.getElementById('members-count').textContent = `ì´ ${count}ëª…`;
                    
                    const listDiv = document.getElementById('members-list');
                    if (count === 0) {
                        listDiv.innerHTML = '<div class="text-gray-500">íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                        return;
                    }
                    
                    listDiv.innerHTML = snapshot.docs.map(doc => {
                        const data = doc.data();
                        return `
                            <div class="border-b pb-2 mb-2">
                                <div class="font-semibold">${data.name || 'ì´ë¦„ ì—†ìŒ'}</div>
                                <div class="text-sm text-gray-500">${data.email}</div>
                                <div class="text-xs text-gray-400">${data.provider} | ${doc.id}</div>
                            </div>
                        `;
                    }).join('');
                })
                .catch((error) => {
                    console.error('íšŒì› ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                    document.getElementById('members-count').textContent = `ì˜¤ë¥˜: ${error.message}`;
                });
        }
        
        // ì˜ë¢° ë°ì´í„° ë¡œë“œ
        function loadRequests() {
            if (!window.firestore) {
                document.getElementById('requests-count').textContent = 'Firestore ë¡œë“œ ì•ˆë¨';
                return;
            }
            
            window.firestore.collection('requests')
                .orderBy('createdAt', 'desc')
                .limit(10)
                .get()
                .then((snapshot) => {
                    const count = snapshot.size;
                    document.getElementById('requests-count').textContent = `ì´ ${count}ê±´`;
                    
                    const listDiv = document.getElementById('requests-list');
                    if (count === 0) {
                        listDiv.innerHTML = '<div class="text-gray-500">ì˜ë¢°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                        return;
                    }
                    
                    listDiv.innerHTML = snapshot.docs.map(doc => {
                        const data = doc.data();
                        return `
                            <div class="border-b pb-2 mb-2">
                                <div class="font-semibold">${data.title || 'ì œëª© ì—†ìŒ'}</div>
                                <div class="text-sm text-gray-500">${data.status} | ${data.createdByEmail}</div>
                                <div class="text-xs text-gray-400">${doc.id}</div>
                            </div>
                        `;
                    }).join('');
                })
                .catch((error) => {
                    console.error('ì˜ë¢° ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                    document.getElementById('requests-count').textContent = `ì˜¤ë¥˜: ${error.message}`;
                });
        }
        
        // Firestore ì“°ê¸° í…ŒìŠ¤íŠ¸
        function testFirestoreWrite() {
            if (!window.firestore) {
                alert('Firestoreê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const testData = {
                name: 'í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì',
                email: 'test@example.com',
                provider: 'test',
                role: 'viewer',
                status: 'active',
                createdAt: new Date(),
                updatedAt: new Date()
            };
            
            window.firestore.collection('members').add(testData)
                .then((docRef) => {
                    console.log('í…ŒìŠ¤íŠ¸ ë°ì´í„° ì €ì¥ ì„±ê³µ:', docRef.id);
                    alert('í…ŒìŠ¤íŠ¸ ë°ì´í„° ì €ì¥ ì„±ê³µ!');
                    refreshData();
                })
                .catch((error) => {
                    console.error('í…ŒìŠ¤íŠ¸ ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:', error);
                    alert('í…ŒìŠ¤íŠ¸ ë°ì´í„° ì €ì¥ ì‹¤íŒ¨: ' + error.message);
                });
        }
        
        // ë°ì´í„° ìƒˆë¡œê³ ì¹¨
        function refreshData() {
            checkFirebaseStatus();
            checkCurrentUser();
            loadMembers();
            loadRequests();
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            // Firebase ì´ˆê¸°í™” ëŒ€ê¸°
            setTimeout(() => {
                if (typeof initializeFirebase === 'function') {
                    initializeFirebase();
                    
                    // Firebase í”„ë¡œì íŠ¸ í™•ì¸
                    setTimeout(() => {
                        if (window.firebase && window.firebase.apps.length > 0) {
                            const projectId = window.firebase.app().options.projectId;
                            console.log('ğŸ” debug.html Firebase í”„ë¡œì íŠ¸ ID:', projectId);
                        }
                    }, 500);
                }
                refreshData();
            }, 1000);
        });
    </script>
</body>
</html>
