<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ì˜ë¢° ê²°ê³¼ ì…ë ¥/ê´€ë¦¬ | PriceHunter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
      body { font-family: 'Noto Sans KR', 'Inter', sans-serif; }
      .tab-btn.active {
        background-color: #ec4899;
        color: white;
      }
      .filter-btn.active {
        background-color: #6b7280;
        color: white;
      }
    </style>
  </head>
  <body class="bg-gradient-to-br from-gray-50 via-blue-50 to-emerald-50 min-h-screen flex items-center justify-center px-2">
    <main class="w-full max-w-6xl bg-white/90 rounded-3xl shadow-2xl p-8 md:p-12 flex flex-col items-center text-center backdrop-blur-md mt-8 mb-8">
      <h1 class="text-2xl md:text-3xl font-extrabold text-pink-600 mb-4">ì˜ë¢° ê²°ê³¼ ì…ë ¥/ê´€ë¦¬ (ê´€ë¦¬ì ì „ìš©)</h1>
      <div class="text-sm text-gray-500 mb-6">ì´ í˜ì´ì§€ëŠ” ê´€ë¦¬ì(ê°œë°œì)ë§Œ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤.</div>
      
      <!-- ì•Œë¦¼ ì„¤ì • ì„¹ì…˜ -->
      <div class="w-full mb-6 p-4 bg-blue-50 rounded-xl">
        <div class="font-bold text-blue-700 mb-3">ğŸ“± ì•Œë¦¼ ë°œì†¡ ì„¤ì •</div>
        <div class="flex flex-wrap gap-4 items-center justify-center">
          <select id="notify-method" class="px-3 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-pink-400 focus:outline-none">
            <option value="both">ì¹´ì¹´ì˜¤í†¡ + ë¬¸ì</option>
            <option value="kakao">ì¹´ì¹´ì˜¤í†¡ë§Œ</option>
            <option value="sms">ë¬¸ìë§Œ</option>
          </select>
        </div>
        <div class="text-xs text-gray-500 mt-2 text-center">
          ê²°ê³¼ ì €ì¥ í›„ "ê³ ê°ì—ê²Œ ì•Œë¦¼ ë°œì†¡" ë²„íŠ¼ì„ ëˆŒëŸ¬ ê³ ê°ì—ê²Œ ì•Œë¦¼ì„ ë°œì†¡í•©ë‹ˆë‹¤.
        </div>
      </div>
      
      <!-- íšŒì›ë³„ íƒ­ ì‹œìŠ¤í…œ -->
      <div class="w-full mb-6">
        <div class="flex flex-wrap gap-2 justify-center mb-4">
          <button id="tab-all" class="tab-btn active px-4 py-2 bg-pink-500 text-white rounded-lg font-bold hover:bg-pink-600 transition" onclick="switchTab('all')">
            ì „ì²´ <span id="count-all" class="ml-1 bg-white text-pink-500 px-2 py-1 rounded text-xs">0</span>
          </button>
          <!-- íšŒì›ë³„ íƒ­ì€ ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
        </div>
        
        <!-- ì§„í–‰ìƒí™© í•„í„° -->
        <div class="flex flex-wrap gap-2 justify-center mb-4">
          <button id="filter-all" class="filter-btn active px-3 py-1 bg-gray-500 text-white rounded font-bold hover:bg-gray-600 transition text-sm" onclick="switchFilter('all')">ì „ì²´</button>
          <button id="filter-new" class="filter-btn px-3 py-1 bg-red-500 text-white rounded font-bold hover:bg-red-600 transition text-sm" onclick="switchFilter('new')">ì‹ ê·œì˜ë¢°</button>
          <button id="filter-progress" class="filter-btn px-3 py-1 bg-orange-500 text-white rounded font-bold hover:bg-orange-600 transition text-sm" onclick="switchFilter('progress')">ì§„í–‰ì¤‘</button>
          <button id="filter-complete" class="filter-btn px-3 py-1 bg-green-500 text-white rounded font-bold hover:bg-green-600 transition text-sm" onclick="switchFilter('complete')">ì™„ë£Œ</button>
        </div>
      </div>
      
      <!-- ì¼ê´„ ì‚­ì œ ë° ì•Œë¦¼ ë°œì†¡ ë²„íŠ¼ -->
      <div class="w-full mb-4 flex justify-between items-center">
        <div class="flex items-center gap-4">
          <label class="flex items-center gap-2 cursor-pointer">
            <input type="checkbox" id="select-all" class="w-4 h-4 text-pink-600 bg-gray-100 border-gray-300 rounded focus:ring-pink-500 focus:ring-2" onchange="toggleSelectAll()">
            <span class="text-sm font-semibold text-gray-700">ì „ì²´ ì„ íƒ</span>
          </label>
          <span id="selected-count" class="text-sm text-gray-600">ì„ íƒë¨: 0ê°œ</span>
        </div>
        <div class="flex gap-2">
          <button id="bulk-notify-btn" class="px-4 py-2 bg-blue-500 text-white rounded-lg font-bold hover:bg-blue-600 transition text-sm hidden" onclick="bulkSendNotification()">
            ì„ íƒ ì•Œë¦¼ ë°œì†¡ (<span id="notify-count">0</span>ê°œ)
          </button>
          <button id="bulk-delete-btn" class="px-4 py-2 bg-red-500 text-white rounded-lg font-bold hover:bg-red-600 transition text-sm hidden" onclick="bulkDelete()">
            ì„ íƒ ì‚­ì œ (<span id="delete-count">0</span>ê°œ)
          </button>
        </div>
      </div>
      
      <!-- ì˜ë¢° ëª©ë¡ -->
      <div class="w-full mb-8">
        <div class="font-bold text-gray-700 mb-2 text-left">ì ‘ìˆ˜ëœ ì˜ë¢° ëª©ë¡</div>
        <div class="flex justify-between items-center px-4 py-2 bg-pink-100 rounded-t-xl text-sm font-bold text-pink-700 flex-wrap">
          <span class="w-8">ì„ íƒ</span>
          <span class="flex-1">ì˜ë¢°ë²ˆí˜¸/íšŒì›ëª…</span>
          <span class="w-1/6 text-center">ì˜ë¢°ì¼ì‹œ</span>
          <span class="w-1/6 text-center">ì§„í–‰ìƒí™©</span>
          <span class="w-1/6 text-center">êµ¬ë§¤ë°©ì‹</span>
          <span class="w-1/6 text-center">êµ¬ë§¤ìƒíƒœ</span>
          <span class="w-1/6 text-center">ì•Œë¦¼ìƒíƒœ</span>
          <span class="w-1/4 text-right">ì œí’ˆëª…</span>
        </div>
        <ul id="request-list" class="bg-pink-50 rounded-b-xl shadow-inner divide-y divide-pink-100 text-left"></ul>
      </div>
      
      <!-- ì˜ë¢° ìƒì„¸ ë° ë‹µë³€ ì…ë ¥ -->
      <div id="detail-section" class="w-full hidden">
        <div class="bg-white rounded-2xl shadow-lg p-6 mb-4 text-left">
          <div class="mb-2 text-gray-700 font-bold">ì˜ë¢° ìƒì„¸</div>
          <div class="mb-2 text-gray-600"><span class="font-semibold">ì˜ë¢°ë²ˆí˜¸:</span> <span id="detail-num"></span></div>
          <div class="mb-2 text-gray-600"><span class="font-semibold">ì œí’ˆëª…:</span> <span id="detail-name"></span></div>
          <div class="mb-2 text-gray-600"><span class="font-semibold">ì œí’ˆì„¤ëª…:</span> <span id="detail-desc"></span></div>
          <div class="mb-2 text-gray-600"><span class="font-semibold">ì°¸ê³ ì‚¬ì´íŠ¸:</span> <span id="detail-url"></span></div>
          <div class="mb-2 text-gray-600"><span class="font-semibold">ê°€ê²©:</span> <span id="detail-price"></span></div>
          <div class="mb-2 text-gray-600"><span class="font-semibold">ì´ë¦„:</span> <span id="detail-username"></span></div>
          <div class="mb-2 text-gray-600"><span class="font-semibold">ì´ë©”ì¼:</span> <span id="detail-email"></span></div>
          <div class="mb-2 text-gray-600"><span class="font-semibold">íœ´ëŒ€í°:</span> <span id="detail-phone"></span></div>
          <div class="mb-2 text-gray-600"><span class="font-semibold">í†µê´€ë²ˆí˜¸:</span> <span id="detail-customs"></span></div>
          <div class="mb-2 text-gray-600"><span class="font-semibold">ì—…ë¡œë“œ ì´ë¯¸ì§€:</span> <span id="detail-img"></span></div>
        </div>
        <form id="result-form" class="w-full bg-gray-50 rounded-2xl shadow-inner p-6 mb-4 text-left">
          <div class="mb-3">
            <label class="block text-gray-700 font-semibold mb-1" for="admin-price">ìµœì €ê°€</label>
            <input type="text" id="admin-price" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-pink-400 focus:outline-none" />
          </div>
          <div class="mb-3">
            <label class="block text-gray-700 font-semibold mb-1" for="admin-origin">ì›ì‚°ì§€/ê³µê¸‰ì²˜</label>
            <input type="text" id="admin-origin" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-pink-400 focus:outline-none" />
          </div>
          <div class="mb-3">
            <label class="block text-gray-700 font-semibold mb-1" for="admin-summary">ì¢…í•©ì„¤ëª…</label>
            
            <!-- ë¦¬ì¹˜ í…ìŠ¤íŠ¸ ì—ë””í„° íˆ´ë°” -->
            <div class="bg-white border border-gray-300 rounded-t-lg p-2 flex flex-wrap gap-1 items-center">
              <!-- ê¸€ê¼´ í¬ê¸° -->
              <select id="font-size" class="px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-pink-400 focus:outline-none">
                <option value="12">12px</option>
                <option value="14">14px</option>
                <option value="16" selected>16px</option>
                <option value="18">18px</option>
                <option value="20">20px</option>
                <option value="24">24px</option>
              </select>
              
              <!-- êµµê²Œ -->
              <button type="button" id="bold-btn" class="px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded border" title="êµµê²Œ">
                <strong>B</strong>
              </button>
              
              <!-- ê¸°ìš¸ì„ -->
              <button type="button" id="italic-btn" class="px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded border" title="ê¸°ìš¸ì„">
                <em>I</em>
              </button>
              
              <!-- ë°‘ì¤„ -->
              <button type="button" id="underline-btn" class="px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded border" title="ë°‘ì¤„">
                <u>U</u>
              </button>
              
              <!-- êµ¬ë¶„ì„  -->
              <div class="w-px h-6 bg-gray-300 mx-1"></div>
              
              <!-- ìƒ‰ìƒ -->
              <input type="color" id="text-color" class="w-8 h-8 border border-gray-300 rounded cursor-pointer" title="í…ìŠ¤íŠ¸ ìƒ‰ìƒ">
              
              <!-- ë°°ê²½ìƒ‰ -->
              <input type="color" id="bg-color" class="w-8 h-8 border border-gray-300 rounded cursor-pointer" title="ë°°ê²½ìƒ‰">
              
              <!-- êµ¬ë¶„ì„  -->
              <div class="w-px h-6 bg-gray-300 mx-1"></div>
              
              <!-- ë§í¬ -->
              <button type="button" id="link-btn" class="px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded border" title="ë§í¬ ì¶”ê°€">
                ğŸ”—
              </button>
              
              <!-- ì´ë¯¸ì§€ -->
              <button type="button" id="image-btn" class="px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded border" title="ì´ë¯¸ì§€ íŒŒì¼ ì—…ë¡œë“œ (í´ë¦½ë³´ë“œ ë¶™ì—¬ë„£ê¸°: Ctrl+V, ë“œë˜ê·¸ì•¤ë“œë¡­ ì§€ì›)">
                ğŸ–¼ï¸
              </button>
              
              <!-- êµ¬ë¶„ì„  -->
              <div class="w-px h-6 bg-gray-300 mx-1"></div>
              
              <!-- ì •ë ¬ -->
              <button type="button" id="align-left" class="px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded border" title="ì™¼ìª½ ì •ë ¬">
                â¬…ï¸
              </button>
              <button type="button" id="align-center" class="px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded border" title="ê°€ìš´ë° ì •ë ¬">
                â†”ï¸
              </button>
              <button type="button" id="align-right" class="px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded border" title="ì˜¤ë¥¸ìª½ ì •ë ¬">
                â¡ï¸
              </button>
              
              <!-- êµ¬ë¶„ì„  -->
              <div class="w-px h-6 bg-gray-300 mx-1"></div>
              
              <!-- ëª©ë¡ -->
              <button type="button" id="ul-btn" class="px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded border" title="ê¸€ë¨¸ë¦¬ ê¸°í˜¸ ëª©ë¡">
                â€¢ ëª©ë¡
              </button>
              <button type="button" id="ol-btn" class="px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded border" title="ë²ˆí˜¸ ë§¤ê¸°ê¸° ëª©ë¡">
                1. ëª©ë¡
              </button>
            </div>
            
            <!-- ë¦¬ì¹˜ í…ìŠ¤íŠ¸ ì—ë””í„° -->
            <div id="rich-editor" class="w-full min-h-[200px] px-4 py-3 border border-gray-300 rounded-b-lg focus-within:ring-2 focus-within:ring-pink-400 focus-within:outline-none bg-white" contenteditable="true" placeholder="ê°€ê²©, ì›ì‚°ì§€, ìƒí’ˆíŠ¹ì§• ë“± ì „ì²´ì ì¸ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”."></div>
            
            <!-- ì´ë¯¸ì§€ ì‚½ì… ì•ˆë‚´ -->
            <div class="text-xs text-gray-500 mt-2 flex items-center gap-4">
              <span>ğŸ’¡ ì´ë¯¸ì§€ ì‚½ì…: ğŸ–¼ï¸ ë²„íŠ¼ í´ë¦­ ë˜ëŠ” Ctrl+V (í´ë¦½ë³´ë“œ) ë˜ëŠ” ë“œë˜ê·¸ì•¤ë“œë¡­</span>
            </div>
            
            <!-- ìˆ¨ê²¨ì§„ textarea (ë°ì´í„° ì €ì¥ìš©) -->
            <textarea id="admin-summary" class="hidden"></textarea>
          </div>
          <div class="mb-3">
            <label class="block text-gray-700 font-semibold mb-1" for="admin-link">ìµœì €ê°€ ë§í¬</label>
            <input type="url" id="admin-link" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-pink-400 focus:outline-none" placeholder="https://example.com" />
          </div>
          <div class="flex gap-2 mt-6">
            <button type="submit" class="flex-1 py-3 bg-pink-500 text-white font-bold rounded-lg shadow hover:bg-pink-600 transition text-lg">ì €ì¥</button>
            <button type="button" id="admin-delete" class="flex-1 py-3 bg-gray-200 text-gray-600 font-bold rounded-lg shadow hover:bg-gray-300 transition text-lg">ì‚­ì œ</button>
          </div>
        </form>
        <div id="admin-msg" class="text-center text-gray-400 text-sm mt-4"></div>
        
        <!-- êµ¬ë§¤ ìƒíƒœ ê´€ë¦¬ ì„¹ì…˜ -->
        <div id="purchase-management" class="w-full bg-blue-50 rounded-2xl shadow-inner p-6 mb-4 text-left hidden">
          <div class="mb-4">
            <h3 class="text-lg font-bold text-blue-700 mb-3">ğŸ›’ êµ¬ë§¤ ìƒíƒœ ê´€ë¦¬</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-gray-700 font-semibold mb-2">êµ¬ë§¤ ë°©ì‹</label>
                <div class="text-sm text-gray-600 mb-2">
                  <span id="purchase-method-display">-</span>
                </div>
              </div>
              <div>
                <label class="block text-gray-700 font-semibold mb-2">êµ¬ë§¤ ì§„í–‰ìƒíƒœ</label>
                <select id="purchase-status" class="w-full px-3 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-400 focus:outline-none text-sm">
                  <option value="none">êµ¬ë§¤í•˜ì§€ ì•ŠìŒ</option>
                  <option value="ordered">ì£¼ë¬¸ì ‘ìˆ˜</option>
                  <option value="paid">ê²°ì œì™„ë£Œ</option>
                  <option value="preparing">ë°°ì†¡ì¤€ë¹„</option>
                  <option value="shipping">ë°°ì†¡ì¤‘</option>
                  <option value="delivered">ë°°ì†¡ì™„ë£Œ</option>
                </select>
              </div>
            </div>
            <div class="mt-4">
              <label class="block text-gray-700 font-semibold mb-2">ê´€ë¦¬ì ë©”ëª¨</label>
              <textarea id="purchase-memo" rows="3" class="w-full px-3 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-400 focus:outline-none text-sm" placeholder="êµ¬ë§¤ ê´€ë ¨ íŠ¹ì´ì‚¬í•­ì´ë‚˜ ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”."></textarea>
            </div>
            <div class="flex gap-2 mt-4">
              <button type="button" id="update-purchase-status" class="px-4 py-2 bg-blue-500 text-white font-bold rounded-lg hover:bg-blue-600 transition text-sm">êµ¬ë§¤ìƒíƒœ ì—…ë°ì´íŠ¸</button>
              <button type="button" id="view-order-details" class="px-4 py-2 bg-green-500 text-white font-bold rounded-lg hover:bg-green-600 transition text-sm">ì£¼ë¬¸ìƒì„¸ë³´ê¸°</button>
            </div>
          </div>
        </div>
      </div>
    </main>
    <script>
      // ì „ì—­ ë³€ìˆ˜
      let currentTab = 'all';
      let currentFilter = 'all';
      let allRequests = [];
      let currentReqKey = '';
      let selectedRequests = new Set();
      let currentRequest = null; // í˜„ì¬ ì„ íƒëœ ì˜ë¢° ì •ë³´
      
      // ì˜ë¢° ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
      function getRequestList() {
        const list = [];
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          if (key.startsWith('request-')) {
            const req = JSON.parse(localStorage.getItem(key));
            list.push({ key, ...req });
          }
        }
        // ìµœì‹ ìˆœ ì •ë ¬(ê°€ì¥ ìµœê·¼ì´ ìœ„ë¡œ)
        return list.sort((a, b) => (b.date || 0) - (a.date || 0));
      }
      
      // ì§„í–‰ìƒí™© íŒë‹¨ í•¨ìˆ˜
      function getRequestStatus(req) {
        const reqNum = req.key.replace('request-', '');
        const hasResult = !!localStorage.getItem('result-' + reqNum);
        
        if (!hasResult) {
          return { status: 'new', text: 'ì‹ ê·œì˜ë¢°', color: 'bg-red-500', textColor: 'text-red-500' };
        }
        
        const result = JSON.parse(localStorage.getItem('result-' + reqNum) || '{}');
        if (result.price && result.origin && result.summary && result.link) {
          return { status: 'complete', text: 'ì™„ë£Œ', color: 'bg-green-500', textColor: 'text-green-500' };
        }
        
        return { status: 'progress', text: 'ì§„í–‰ì¤‘', color: 'bg-orange-500', textColor: 'text-orange-500' };
      }
      
      // íšŒì›ë³„ íƒ­ ìƒì„±
      function createUserTabs() {
        const users = {};
        allRequests.forEach(req => {
          const userName = req.userName || 'ìµëª…';
          if (!users[userName]) {
            users[userName] = { name: userName, count: 0 };
          }
          users[userName].count++;
        });
        
        const tabContainer = document.querySelector('.flex.flex-wrap.gap-2.justify-center');
        const allTab = tabContainer.querySelector('#tab-all');
        tabContainer.innerHTML = '';
        tabContainer.appendChild(allTab);
        
        Object.values(users).forEach(user => {
          const tab = document.createElement('button');
          tab.className = 'tab-btn px-4 py-2 bg-gray-300 text-gray-700 rounded-lg font-bold hover:bg-gray-400 transition';
          tab.onclick = () => switchTab(user.name);
          tab.innerHTML = `${user.name} <span class="ml-1 bg-white text-gray-700 px-2 py-1 rounded text-xs">${user.count}</span>`;
          tabContainer.appendChild(tab);
        });
      }
      
      // íƒ­ ì „í™˜
      function switchTab(userName) {
        currentTab = userName;
        
        // íƒ­ ë²„íŠ¼ í™œì„±í™”
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        
        renderRequestList();
      }
      
      // í•„í„° ì „í™˜
      function switchFilter(status) {
        currentFilter = status;
        
        // í•„í„° ë²„íŠ¼ í™œì„±í™”
        document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        
        renderRequestList();
      }
      
      // ì „ì²´ ì„ íƒ/í•´ì œ
      function toggleSelectAll() {
        const selectAllCheckbox = document.getElementById('select-all');
        const checkboxes = document.querySelectorAll('.request-checkbox');
        
        checkboxes.forEach(checkbox => {
          checkbox.checked = selectAllCheckbox.checked;
          if (selectAllCheckbox.checked) {
            selectedRequests.add(checkbox.value);
          } else {
            selectedRequests.delete(checkbox.value);
          }
        });
        
        updateSelectionUI();
      }
      
      // ê°œë³„ ì„ íƒ ì²˜ë¦¬
      function toggleSelection(reqKey) {
        if (selectedRequests.has(reqKey)) {
          selectedRequests.delete(reqKey);
        } else {
          selectedRequests.add(reqKey);
        }
        
        updateSelectionUI();
      }
      
      // ì„ íƒ UI ì—…ë°ì´íŠ¸
      function updateSelectionUI() {
        const selectedCount = selectedRequests.size;
        const deleteCount = selectedCount;
        
        document.getElementById('selected-count').textContent = `ì„ íƒë¨: ${selectedCount}ê°œ`;
        document.getElementById('delete-count').textContent = deleteCount;
        document.getElementById('notify-count').textContent = selectedCount;
        
        const bulkDeleteBtn = document.getElementById('bulk-delete-btn');
        const bulkNotifyBtn = document.getElementById('bulk-notify-btn');
        
        if (selectedCount > 0) {
          bulkDeleteBtn.classList.remove('hidden');
          bulkNotifyBtn.classList.remove('hidden');
        } else {
          bulkDeleteBtn.classList.add('hidden');
          bulkNotifyBtn.classList.add('hidden');
        }
        
        // ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸
        const selectAllCheckbox = document.getElementById('select-all');
        const checkboxes = document.querySelectorAll('.request-checkbox');
        const allChecked = checkboxes.length > 0 && Array.from(checkboxes).every(cb => cb.checked);
        selectAllCheckbox.checked = allChecked;
      }
      
      // ì¼ê´„ ì‚­ì œ
      function bulkDelete() {
        if (selectedRequests.size === 0) return;
        
        const confirmMessage = `ì„ íƒëœ ${selectedRequests.size}ê°œì˜ ì˜ë¢°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`;
        if (!confirm(confirmMessage)) return;
        
        selectedRequests.forEach(reqKey => {
          // ì˜ë¢° ì‚­ì œ
          localStorage.removeItem(reqKey);
          
          // ê²°ê³¼ë„ ì‚­ì œ
          const reqNum = reqKey.replace('request-', '');
          localStorage.removeItem('result-' + reqNum);
        });
        
        // ì„ íƒ ì´ˆê¸°í™”
        selectedRequests.clear();
        document.getElementById('select-all').checked = false;
        
        // ë¦¬ìŠ¤íŠ¸ ìƒˆë¡œê³ ì¹¨
        renderRequestList();
        
        alert(`${selectedRequests.size}ê°œì˜ ì˜ë¢°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
      }
      
      // ì¼ê´„ ì•Œë¦¼ ë°œì†¡
      function bulkSendNotification() {
        if (selectedRequests.size === 0) return;
        
        const notifyMethod = document.getElementById('notify-method').value;
        const confirmMessage = `ì„ íƒëœ ${selectedRequests.size}ê°œì˜ ì˜ë¢°ì— ëŒ€í•´ ê³ ê°ì—ê²Œ ì•Œë¦¼ì„ ë°œì†¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì•Œë¦¼ ë°©ë²•: ${notifyMethod}`;
        
        if (!confirm(confirmMessage)) return;
        
        let successCount = 0;
        let failCount = 0;
        
        selectedRequests.forEach(reqKey => {
          const reqNum = reqKey.replace('request-', '');
          const resultData = localStorage.getItem('result-' + reqNum);
          
          if (resultData) {
            const request = JSON.parse(localStorage.getItem(reqKey));
            const result = JSON.parse(resultData);
            
            // ì‹¤ì œ ì•Œë¦¼ ë°œì†¡
            console.log(`=== ì¼ê´„ ì•Œë¦¼ ë°œì†¡: ${reqNum} ===`);
            console.log('ìˆ˜ì‹ ì:', request.userName, request.phone);
            console.log('ì•Œë¦¼ ë°©ë²•:', notifyMethod);
            
            // ì¹´ì¹´ì˜¤í†¡ ì•Œë¦¼ (ì‹¤ì œ API ì—°ë™)
            if (notifyMethod === 'both' || notifyMethod === 'kakao') {
              sendKakaoNotification(request.phone, request.userName, result);
            }
            
            // SMS ì•Œë¦¼ (ì‹¤ì œ API ì—°ë™)
            if (notifyMethod === 'both' || notifyMethod === 'sms') {
              sendSMSNotification(request.phone, request.userName, result);
            }
            
            // ì•Œë¦¼ ë°œì†¡ ìƒíƒœ ì €ì¥
            localStorage.setItem('notify-' + reqNum, JSON.stringify({
              sent: true,
              sentAt: Date.now(),
              method: notifyMethod,
              recipient: request.userName
            }));
            
            successCount++;
          } else {
            failCount++;
          }
        });
        
        // ì„ íƒ ì´ˆê¸°í™”
        selectedRequests.clear();
        document.getElementById('select-all').checked = false;
        
        // ë¦¬ìŠ¤íŠ¸ ìƒˆë¡œê³ ì¹¨
        renderRequestList();
        
        alert(`ì•Œë¦¼ ë°œì†¡ ì™„ë£Œ!\n\nì„±ê³µ: ${successCount}ê°œ\nì‹¤íŒ¨: ${failCount}ê°œ (ê²°ê³¼ê°€ ì—†ëŠ” ì˜ë¢°)`);
      }
      
      // êµ¬ë§¤ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
      function getPurchaseInfo(reqKey) {
        const reqNum = reqKey.replace('request-', '');
        const orderData = localStorage.getItem('order-' + reqNum);
        return orderData ? JSON.parse(orderData) : null;
      }
      
      // êµ¬ë§¤ ìƒíƒœ í…ìŠ¤íŠ¸ ë³€í™˜
      function getPurchaseStatusText(status) {
        const statusMap = {
          'none': 'êµ¬ë§¤í•˜ì§€ ì•ŠìŒ',
          'ordered': 'ì£¼ë¬¸ì ‘ìˆ˜',
          'paid': 'ê²°ì œì™„ë£Œ', 
          'preparing': 'ë°°ì†¡ì¤€ë¹„',
          'shipping': 'ë°°ì†¡ì¤‘',
          'delivered': 'ë°°ì†¡ì™„ë£Œ'
        };
        return statusMap[status] || 'êµ¬ë§¤í•˜ì§€ ì•ŠìŒ';
      }
      
      // êµ¬ë§¤ ìƒíƒœ ìƒ‰ìƒ ë³€í™˜
      function getPurchaseStatusColor(status) {
        const colorMap = {
          'none': 'text-gray-500',
          'ordered': 'text-blue-600',
          'paid': 'text-purple-600',
          'preparing': 'text-orange-600',
          'shipping': 'text-indigo-600',
          'delivered': 'text-green-600'
        };
        return colorMap[status] || 'text-gray-500';
      }
      
      // êµ¬ë§¤ ë°©ì‹ í…ìŠ¤íŠ¸ ë³€í™˜
      function getPurchaseMethodText(method) {
        const methodMap = {
          'direct': 'PriceHunter ì§ì ‘êµ¬ë§¤ (ì„œë¹„ìŠ¤ ì¤‘ë‹¨)',
          'external': 'ìµœì €ê°€ ì‡¼í•‘ëª°',
          'none': 'êµ¬ë§¤í•˜ì§€ ì•ŠìŒ'
        };
        return methodMap[method] || 'êµ¬ë§¤í•˜ì§€ ì•ŠìŒ';
      }
      
      // ìë™ ì•Œë¦¼ ë°œì†¡ í•¨ìˆ˜
      function sendAutoNotification(request, result) {
        const autoNotify = document.getElementById('auto-notify').checked;
        const notifyMethod = document.getElementById('notify-method').value;
        
        if (!autoNotify) return;
        
        // ì•Œë¦¼ ë©”ì‹œì§€ ìƒì„±
        const message = `[PriceHunter] ì˜ë¢° ê²°ê³¼ ì™„ë£Œ\n\nì˜ë¢°ë²ˆí˜¸: ${request.key.replace('request-', '')}\nì œí’ˆëª…: ${request.name}\nìµœì €ê°€: ${result.price}\n\nê²°ê³¼ ì¡°íšŒ: https://pricehunter.kr/result-search.html`;
        
        // ì‹¤ì œ ì•Œë¦¼ ë°œì†¡ (ì‹œë®¬ë ˆì´ì…˜)
        console.log('=== ìë™ ì•Œë¦¼ ë°œì†¡ ===');
        console.log('ìˆ˜ì‹ ì:', request.userName, request.phone, request.email);
        console.log('ì•Œë¦¼ ë°©ë²•:', notifyMethod);
        console.log('ë©”ì‹œì§€:', message);
        
        // ì¹´ì¹´ì˜¤í†¡ ì•Œë¦¼ (ì‹œë®¬ë ˆì´ì…˜)
        if (notifyMethod === 'both' || notifyMethod === 'kakao') {
          console.log('ğŸ“± ì¹´ì¹´ì˜¤í†¡ ì•Œë¦¼ ë°œì†¡:', request.phone);
          // ì‹¤ì œ êµ¬í˜„ ì‹œ: ì¹´ì¹´ì˜¤í†¡ API ì—°ë™
        }
        
        // SMS ì•Œë¦¼ (ì‹œë®¬ë ˆì´ì…˜)
        if (notifyMethod === 'both' || notifyMethod === 'sms') {
          console.log('ğŸ“ SMS ì•Œë¦¼ ë°œì†¡:', request.phone);
          // ì‹¤ì œ êµ¬í˜„ ì‹œ: SMS API ì—°ë™
        }
        
        // ì´ë©”ì¼ ì•Œë¦¼ (ì¶”ê°€ ì˜µì…˜)
        if (request.email) {
          console.log('ğŸ“§ ì´ë©”ì¼ ì•Œë¦¼ ë°œì†¡:', request.email);
          // ì‹¤ì œ êµ¬í˜„ ì‹œ: ì´ë©”ì¼ API ì—°ë™
        }
        
        alert(`âœ… ìë™ ì•Œë¦¼ì´ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nìˆ˜ì‹ ì: ${request.userName}\nì—°ë½ì²˜: ${request.phone}\nì•Œë¦¼ ë°©ë²•: ${notifyMethod}`);
      }
      
      // ìˆ˜ë™ ì•Œë¦¼ ë°œì†¡ í•¨ìˆ˜
      function sendManualNotification() {
        if (!currentRequest) {
          alert('ì˜ë¢° ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }
        
        const reqNum = currentReqKey.replace('request-', '');
        const resultData = localStorage.getItem('result-' + reqNum);
        
        if (!resultData) {
          alert('ì €ì¥ëœ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ê²°ê³¼ë¥¼ ì €ì¥í•´ì£¼ì„¸ìš”.');
          return;
        }
        
        const result = JSON.parse(resultData);
        const notifyMethod = document.getElementById('notify-method').value;
        
        // ì•Œë¦¼ ë©”ì‹œì§€ ìƒì„±
        const message = `[PriceHunter] ì˜ë¢° ê²°ê³¼ ì™„ë£Œ\n\nì˜ë¢°ë²ˆí˜¸: ${reqNum}\nì œí’ˆëª…: ${currentRequest.name}\nìµœì €ê°€: ${result.price}\n\nê²°ê³¼ ì¡°íšŒ: https://pricehunter.kr/result-search.html`;
        
        // í™•ì¸ ëŒ€í™”ìƒì
        const confirmMessage = `ê³ ê°ì—ê²Œ ì•Œë¦¼ì„ ë°œì†¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nìˆ˜ì‹ ì: ${currentRequest.userName}\nì—°ë½ì²˜: ${currentRequest.phone}\nì•Œë¦¼ ë°©ë²•: ${notifyMethod}\n\në©”ì‹œì§€:\n${message}`;
        
        if (!confirm(confirmMessage)) return;
        
        // ì‹¤ì œ ì•Œë¦¼ ë°œì†¡ (ì‹œë®¬ë ˆì´ì…˜)
        console.log('=== ìˆ˜ë™ ì•Œë¦¼ ë°œì†¡ ===');
        console.log('ìˆ˜ì‹ ì:', currentRequest.userName, currentRequest.phone, currentRequest.email);
        console.log('ì•Œë¦¼ ë°©ë²•:', notifyMethod);
        console.log('ë©”ì‹œì§€:', message);
        
        // ì¹´ì¹´ì˜¤í†¡ ì•Œë¦¼ (ì‹œë®¬ë ˆì´ì…˜)
        if (notifyMethod === 'both' || notifyMethod === 'kakao') {
          console.log('ğŸ“± ì¹´ì¹´ì˜¤í†¡ ì•Œë¦¼ ë°œì†¡:', currentRequest.phone);
          // ì‹¤ì œ êµ¬í˜„ ì‹œ: ì¹´ì¹´ì˜¤í†¡ API ì—°ë™
        }
        
        // SMS ì•Œë¦¼ (ì‹œë®¬ë ˆì´ì…˜)
        if (notifyMethod === 'both' || notifyMethod === 'sms') {
          console.log('ğŸ“ SMS ì•Œë¦¼ ë°œì†¡:', currentRequest.phone);
          // ì‹¤ì œ êµ¬í˜„ ì‹œ: SMS API ì—°ë™
        }
        
        // ì´ë©”ì¼ ì•Œë¦¼ (ì¶”ê°€ ì˜µì…˜)
        if (currentRequest.email) {
          console.log('ğŸ“§ ì´ë©”ì¼ ì•Œë¦¼ ë°œì†¡:', currentRequest.email);
          // ì‹¤ì œ êµ¬í˜„ ì‹œ: ì´ë©”ì¼ API ì—°ë™
        }
        
        // ì•Œë¦¼ ë°œì†¡ ìƒíƒœ ì €ì¥
        localStorage.setItem('notify-' + reqNum, JSON.stringify({
          sent: true,
          sentAt: Date.now(),
          method: notifyMethod,
          recipient: currentRequest.userName
        }));
        
        // ë°œì†¡ ì™„ë£Œ í‘œì‹œ
        document.getElementById('admin-msg').innerHTML = `
          <div class="text-green-600 font-bold">âœ… ì•Œë¦¼ ë°œì†¡ ì™„ë£Œ!</div>
          <div class="text-sm text-gray-600 mt-1">
            ìˆ˜ì‹ ì: ${currentRequest.userName} | 
            ì—°ë½ì²˜: ${currentRequest.phone} | 
            ë°©ë²•: ${notifyMethod}
          </div>
        `;
        
        // ë°œì†¡ ë²„íŠ¼ ë¹„í™œì„±í™”
        const notifyBtn = document.getElementById('send-notify-btn');
        if (notifyBtn) {
          notifyBtn.disabled = true;
          notifyBtn.textContent = 'ë°œì†¡ ì™„ë£Œ';
          notifyBtn.className = 'px-4 py-2 bg-gray-400 text-white rounded-lg font-bold cursor-not-allowed';
        }
        
        // ë¦¬ìŠ¤íŠ¸ ìƒˆë¡œê³ ì¹¨
        setTimeout(() => {
          renderRequestList();
        }, 500);
      }
      
      function renderRequestList() {
        allRequests = getRequestList();
        
        // íƒ­ë³„ í•„í„°ë§
        let filteredRequests = allRequests;
        if (currentTab !== 'all') {
          filteredRequests = allRequests.filter(req => req.userName === currentTab);
        }
        
        // ì§„í–‰ìƒí™©ë³„ í•„í„°ë§
        if (currentFilter !== 'all') {
          filteredRequests = filteredRequests.filter(req => {
            const status = getRequestStatus(req);
            return status.status === currentFilter;
          });
        }
        
        // ìš°ì„ ìˆœìœ„ ì •ë ¬ (ì‹ ê·œì˜ë¢° â†’ ì§„í–‰ì¤‘ â†’ ì™„ë£Œ)
        filteredRequests.sort((a, b) => {
          const statusA = getRequestStatus(a);
          const statusB = getRequestStatus(b);
          const priority = { new: 3, progress: 2, complete: 1 };
          return priority[statusB.status] - priority[statusA.status];
        });
        
        const ul = document.getElementById('request-list');
        ul.innerHTML = '';
        
        if (filteredRequests.length === 0) {
          ul.innerHTML = '<li class="py-4 text-center text-gray-400">í•´ë‹¹í•˜ëŠ” ì˜ë¢°ê°€ ì—†ìŠµë‹ˆë‹¤.</li>';
          return;
        }
        
        filteredRequests.forEach(req => {
          const li = document.createElement('li');
          // í˜„ì¬ ì„ íƒëœ ì˜ë¢°ì¸ì§€ í™•ì¸í•˜ì—¬ ìŠ¤íƒ€ì¼ ì ìš©
          const isSelected = currentReqKey === req.key;
          li.className = `py-3 px-4 hover:bg-pink-100 cursor-pointer flex items-center gap-2 flex-wrap ${isSelected ? 'bg-pink-200 border-l-4 border-pink-500' : ''}`;
          
          const reqNum = req.key.replace('request-', '');
          const status = getRequestStatus(req);
          const statusBadge = `<span class="px-2 py-1 rounded text-xs font-bold text-white ${status.color}">${status.text}</span>`;
          
          // êµ¬ë§¤ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
          const purchaseInfo = getPurchaseInfo(req.key);
          const purchaseMethod = purchaseInfo ? purchaseInfo.method : 'none';
          const purchaseStatus = purchaseInfo ? purchaseInfo.status : 'none';
          
          const purchaseMethodText = getPurchaseMethodText(purchaseMethod);
          const purchaseStatusText = getPurchaseStatusText(purchaseStatus);
          const purchaseStatusColor = getPurchaseStatusColor(purchaseStatus);
          
          // ì•Œë¦¼ ìƒíƒœ í™•ì¸
          const notifyData = localStorage.getItem('notify-' + reqNum);
          let notifyBadge = '';
          if (notifyData) {
            const notify = JSON.parse(notifyData);
            if (notify.sent) {
              const sentDate = new Date(notify.sentAt).toLocaleDateString();
              notifyBadge = `<span class="px-2 py-1 rounded text-xs font-bold text-white bg-green-500" title="ë°œì†¡ì¼: ${sentDate}">ë°œì†¡ì™„ë£Œ</span>`;
            }
          } else if (status.status === 'complete') {
            notifyBadge = `<span class="px-2 py-1 rounded text-xs font-bold text-white bg-red-500">ë¯¸ë°œì†¡</span>`;
          }
          
          // ì²´í¬ë°•ìŠ¤
          const checkbox = `<input type="checkbox" class="request-checkbox w-4 h-4 text-pink-600 bg-gray-100 border-gray-300 rounded focus:ring-pink-500 focus:ring-2" value="${req.key}" ${selectedRequests.has(req.key) ? 'checked' : ''} onclick="event.stopPropagation(); toggleSelection('${req.key}')">`;
          
          li.innerHTML = `
            <div class="w-8 flex justify-center">${checkbox}</div>
            <div class="flex-1 truncate flex items-center" style="min-width: 0;">
              <span class="font-semibold text-pink-600">${reqNum}</span> | 
              <span class="text-gray-700">${req.userName || 'ìµëª…'}</span>
              <span class="ml-2 text-gray-400 text-xs">${isSelected ? 'â–¼' : 'â–¶'}</span>
            </div>
            <div class="w-1/6 text-center text-xs text-gray-400">${req.date ? new Date(req.date).toLocaleString() : ''}</div>
            <div class="w-1/6 text-center">${statusBadge}</div>
            <div class="w-1/6 text-center text-xs">
              <span class="text-gray-600">${purchaseMethodText}</span>
            </div>
            <div class="w-1/6 text-center">
              <span class="px-2 py-1 rounded text-xs font-bold ${purchaseStatusColor}">${purchaseStatusText}</span>
            </div>
            <div class="w-1/6 text-center">${notifyBadge}</div>
            <div class="w-1/4 text-right text-sm text-gray-600 truncate">${req.name || ''}</div>
          `;
          
          li.onclick = function() { showDetail(req); };
          ul.appendChild(li);
        });
        
        // ì „ì²´ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
        updateCounts();
        updateSelectionUI();
      }
      
      // ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
      function updateCounts() {
        const counts = { all: 0, new: 0, progress: 0, complete: 0 };
        
        allRequests.forEach(req => {
          counts.all++;
          const status = getRequestStatus(req);
          counts[status.status]++;
        });
        
        document.getElementById('count-all').textContent = counts.all;
      }
      
      function showDetail(req) {
        const detailSection = document.getElementById('detail-section');
        
        // ê°™ì€ ì˜ë¢°ë¥¼ ë‹¤ì‹œ í´ë¦­í•œ ê²½ìš° í† ê¸€ (ë‹«ê¸°)
        if (currentReqKey === req.key && !detailSection.classList.contains('hidden')) {
          detailSection.classList.add('hidden');
          currentReqKey = '';
          currentRequest = null;
          return;
        }
        
        // ë‹¤ë¥¸ ì˜ë¢°ë¥¼ í´ë¦­í•˜ê±°ë‚˜ ì²˜ìŒ ì—´ë¦¬ëŠ” ê²½ìš°
        currentReqKey = req.key;
        currentRequest = req; // í˜„ì¬ ì˜ë¢° ì •ë³´ ì €ì¥
        detailSection.classList.remove('hidden');
        document.getElementById('detail-num').textContent = req.key.replace('request-','');
        document.getElementById('detail-name').textContent = req.name || '';
        document.getElementById('detail-desc').textContent = req.desc || '';
        // ì°¸ê³ ì‚¬ì´íŠ¸ ì—¬ëŸ¬ ê°œ
        const urlEl = document.getElementById('detail-url');
        if (req.urls && Array.isArray(req.urls)) {
          urlEl.innerHTML = req.urls.map(u => {
            if (/^https?:\/\//.test(u)) {
              return `<a href="${u}" target="_blank" class="text-blue-600 underline break-all mr-2">${u}</a>`;
            } else {
              return `<span class="text-gray-700 bg-gray-100 rounded px-2 py-1 mr-2">${u}</span>`;
            }
          }).join('');
        } else if (req.url) {
          urlEl.innerHTML = `<a href="${req.url}" target="_blank" class="text-blue-600 underline break-all">${req.url}</a>`;
        } else {
          urlEl.innerHTML = '';
        }
        document.getElementById('detail-price').textContent = req.price || '';
        document.getElementById('detail-username').textContent = req.userName || '';
        document.getElementById('detail-email').textContent = req.email || '';
        document.getElementById('detail-phone').textContent = req.phone || '';
        document.getElementById('detail-customs').textContent = req.customs || '';
        // ì´ë¯¸ì§€ ì—¬ëŸ¬ ì¥
        const imgEl = document.getElementById('detail-img');
        if (req.images && Array.isArray(req.images)) {
          imgEl.innerHTML = req.images.map(img => `<img src="${img}" class="h-16 rounded-lg border inline-block mr-2 mb-2" />`).join('');
        } else if (req.img) {
          imgEl.innerHTML = `<img src="${req.img}" class="h-16 rounded-lg border inline-block" />`;
        } else {
          imgEl.innerHTML = '';
        }
        // ê²°ê³¼ê°€ ìˆìœ¼ë©´ ë¶ˆëŸ¬ì˜¤ê¸°
        const resultKey = 'result-' + req.key.replace('request-','');
        const data = JSON.parse(localStorage.getItem(resultKey) || 'null');
        document.getElementById('admin-price').value = data && data.price ? data.price : '';
        document.getElementById('admin-origin').value = data && data.origin ? data.origin : '';
        
        // ë¦¬ì¹˜ ì—ë””í„°ì— ë‚´ìš© ë¡œë“œ
        const richEditor = document.getElementById('rich-editor');
        const summaryTextarea = document.getElementById('admin-summary');
        if (data && data.summary) {
          richEditor.innerHTML = data.summary;
          summaryTextarea.value = data.summary;
        } else {
          richEditor.innerHTML = '';
          summaryTextarea.value = '';
        }
        document.getElementById('admin-link').value = data && data.link ? data.link : '';
        document.getElementById('admin-msg').textContent = '';
        
        // êµ¬ë§¤ ìƒíƒœ ê´€ë¦¬ ì„¹ì…˜ í‘œì‹œ
        const purchaseManagement = document.getElementById('purchase-management');
        purchaseManagement.classList.remove('hidden');
        
        // êµ¬ë§¤ ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸°
        const purchaseInfo = getPurchaseInfo(req.key);
        if (purchaseInfo) {
          document.getElementById('purchase-method-display').textContent = getPurchaseMethodText(purchaseInfo.method);
          document.getElementById('purchase-status').value = purchaseInfo.status || 'none';
          document.getElementById('purchase-memo').value = purchaseInfo.memo || '';
        } else {
          document.getElementById('purchase-method-display').textContent = 'êµ¬ë§¤í•˜ì§€ ì•ŠìŒ';
          document.getElementById('purchase-status').value = 'none';
          document.getElementById('purchase-memo').value = '';
        }
      }
      
      // ë‹µë³€ ì €ì¥/ì‚­ì œ ì‹œ summary í•„ë“œë„ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°
      document.getElementById('result-form').onsubmit = function(e) {
        e.preventDefault();
        if (!currentReqKey || !currentRequest) return;
        const reqNum = currentReqKey.replace('request-','');
        
        // ë¦¬ì¹˜ ì—ë””í„°ì˜ ì‹¤ì œ ë‚´ìš©ì„ ê°€ì ¸ì˜¤ê¸° (ìµœì¢… ë™ê¸°í™”)
        const richEditor = document.getElementById('rich-editor');
        let summaryContent = '';
        
        if (richEditor) {
          // ì €ì¥ ì „ ìµœì¢… ë™ê¸°í™”
          summaryContent = richEditor.innerHTML;
          // textareaì—ë„ ë™ê¸°í™”
          const textarea = document.getElementById('admin-summary');
          if (textarea) {
            textarea.value = summaryContent;
          }
        }
        
        const data = {
          price: document.getElementById('admin-price').value,
          origin: document.getElementById('admin-origin').value,
          summary: summaryContent,
          link: document.getElementById('admin-link').value
        };
        localStorage.setItem('result-' + reqNum, JSON.stringify(data));
        
        // ì•Œë¦¼ ë°œì†¡ ë²„íŠ¼ í‘œì‹œ
        const hasImages = summaryContent.includes('<img');
        const imageInfo = hasImages ? ' (ì´ë¯¸ì§€ í¬í•¨)' : '';
        
        document.getElementById('admin-msg').innerHTML = `
          <div class="text-green-600 font-bold mb-2">âœ… ê²°ê³¼ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!${imageInfo}</div>
          <button id="send-notify-btn" onclick="sendManualNotification()" class="px-4 py-2 bg-blue-500 text-white rounded-lg font-bold hover:bg-blue-600 transition">
            ê³ ê°ì—ê²Œ ì•Œë¦¼ ë°œì†¡
          </button>
        `;
        
        // ë¦¬ìŠ¤íŠ¸ ìƒˆë¡œê³ ì¹¨
        setTimeout(() => {
          renderRequestList();
        }, 500);
      };
      
      document.getElementById('admin-delete').onclick = function() {
        if (!currentReqKey) return;
        const reqNum = currentReqKey.replace('request-','');
        localStorage.removeItem('result-' + reqNum);
        document.getElementById('admin-msg').textContent = 'ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!';
        
        // ë¦¬ìŠ¤íŠ¸ ìƒˆë¡œê³ ì¹¨
        setTimeout(() => {
          renderRequestList();
        }, 500);
      };
      
      // êµ¬ë§¤ ìƒíƒœ ì—…ë°ì´íŠ¸
      document.getElementById('update-purchase-status').onclick = function() {
        if (!currentReqKey || !currentRequest) {
          alert('ì˜ë¢°ë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.');
          return;
        }
        
        const reqNum = currentReqKey.replace('request-', '');
        const status = document.getElementById('purchase-status').value;
        const memo = document.getElementById('purchase-memo').value;
        
        // ê¸°ì¡´ êµ¬ë§¤ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        const existingPurchase = getPurchaseInfo(currentReqKey) || {};
        
        // êµ¬ë§¤ ì •ë³´ ì—…ë°ì´íŠ¸
        const purchaseInfo = {
          ...existingPurchase,
          status: status,
          memo: memo,
          updatedAt: Date.now(),
          updatedBy: 'admin'
        };
        
        localStorage.setItem('order-' + reqNum, JSON.stringify(purchaseInfo));
        
        alert('êµ¬ë§¤ ìƒíƒœê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
        
        // ë¦¬ìŠ¤íŠ¸ ìƒˆë¡œê³ ì¹¨
        renderRequestList();
      };
      
      // ì£¼ë¬¸ ìƒì„¸ë³´ê¸°
      document.getElementById('view-order-details').onclick = function() {
        if (!currentReqKey || !currentRequest) {
          alert('ì˜ë¢°ë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.');
          return;
        }
        
        const reqNum = currentReqKey.replace('request-', '');
        const purchaseInfo = getPurchaseInfo(currentReqKey);
        const orderData = localStorage.getItem('order-' + reqNum);
        
        if (!purchaseInfo || purchaseInfo.method === 'none') {
          alert('êµ¬ë§¤ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }
        
        // ì£¼ë¬¸ ìƒì„¸ ì •ë³´ í‘œì‹œ
        let orderDetails = `=== ì£¼ë¬¸ ìƒì„¸ ì •ë³´ ===\n\n`;
        orderDetails += `ì˜ë¢°ë²ˆí˜¸: ${reqNum}\n`;
        orderDetails += `ì œí’ˆëª…: ${currentRequest.name}\n`;
        orderDetails += `êµ¬ë§¤ì: ${currentRequest.userName}\n`;
        orderDetails += `ì—°ë½ì²˜: ${currentRequest.phone}\n`;
        orderDetails += `êµ¬ë§¤ë°©ì‹: ${getPurchaseMethodText(purchaseInfo.method)}\n`;
        orderDetails += `êµ¬ë§¤ìƒíƒœ: ${getPurchaseStatusText(purchaseInfo.status)}\n`;
        
        if (purchaseInfo.orderNumber) {
          orderDetails += `ì£¼ë¬¸ë²ˆí˜¸: ${purchaseInfo.orderNumber}\n`;
        }
        
        if (purchaseInfo.orderDate) {
          orderDetails += `ì£¼ë¬¸ì¼: ${new Date(purchaseInfo.orderDate).toLocaleString()}\n`;
        }
        
        if (purchaseInfo.memo) {
          orderDetails += `ê´€ë¦¬ì ë©”ëª¨: ${purchaseInfo.memo}\n`;
        }
        
        if (purchaseInfo.updatedAt) {
          orderDetails += `ìµœì¢… ì—…ë°ì´íŠ¸: ${new Date(purchaseInfo.updatedAt).toLocaleString()}\n`;
        }
        
        alert(orderDetails);
      };
      
      // ë¦¬ì¹˜ í…ìŠ¤íŠ¸ ì—ë””í„° ê¸°ëŠ¥
      function initRichEditor() {
        const editor = document.getElementById('rich-editor');
        const textarea = document.getElementById('admin-summary');
        
        if (!editor) return;
        
        // ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ ì ìš© í•¨ìˆ˜
        function applyImageStyle(img) {
          img.style.maxWidth = '100%';
          img.style.height = 'auto';
          img.style.margin = '10px 0';
          img.style.borderRadius = '8px';
          img.style.boxShadow = '0 2px 8px rgba(0,0,0,0.1)';
          img.style.cursor = 'pointer';
          img.title = 'í´ë¦­í•˜ì—¬ í¬ê¸° ì¡°ì ˆ';
        }
        
        // ì´ë¯¸ì§€ ì‚½ì… í•¨ìˆ˜
        function insertImage(src) {
          const img = document.createElement('img');
          img.src = src;
          applyImageStyle(img);
          
          // ì—ë””í„°ì— ì´ë¯¸ì§€ ì‚½ì…
          const selection = window.getSelection();
          if (selection.rangeCount > 0) {
            const range = selection.getRangeAt(0);
            range.deleteContents();
            range.insertNode(img);
          } else {
            editor.appendChild(img);
          }
          
          // ì»¤ì„œë¥¼ ì´ë¯¸ì§€ ë’¤ë¡œ ì´ë™
          const newRange = document.createRange();
          newRange.setStartAfter(img);
          newRange.collapse(true);
          selection.removeAllRanges();
          selection.addRange(newRange);
          
          syncContent();
          editor.focus();
        }
        
        // ì—ë””í„° ë‚´ìš©ì„ textareaì— ë™ê¸°í™”
        function syncContent() {
          if (textarea && editor) {
            textarea.value = editor.innerHTML;
          }
        }
        
        // ì €ì¥ ì „ ìµœì¢… ë™ê¸°í™”
        function finalSync() {
          if (editor) {
            return editor.innerHTML;
          }
          return '';
        }
        
        // ì—ë””í„° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        editor.addEventListener('input', syncContent);
        editor.addEventListener('paste', function(e) {
          e.preventDefault();
          
          // í´ë¦½ë³´ë“œì—ì„œ ì´ë¯¸ì§€ í™•ì¸
          const items = e.clipboardData.items;
          let hasImage = false;
          
          for (let i = 0; i < items.length; i++) {
            if (items[i].type.indexOf('image') !== -1) {
              hasImage = true;
              const file = items[i].getAsFile();
              const reader = new FileReader();
              
              reader.onload = function(e) {
                insertImage(e.target.result);
              };
              
              reader.readAsDataURL(file);
              break;
            }
          }
          
          // ì´ë¯¸ì§€ê°€ ì—†ìœ¼ë©´ í…ìŠ¤íŠ¸ë¡œ ì²˜ë¦¬
          if (!hasImage) {
            const text = e.clipboardData.getData('text/plain');
            document.execCommand('insertText', false, text);
          }
        });
        
        // ê¸€ê¼´ í¬ê¸° ë³€ê²½
        document.getElementById('font-size').addEventListener('change', function() {
          document.execCommand('fontSize', false, this.value);
          editor.focus();
        });
        
        // êµµê²Œ
        document.getElementById('bold-btn').addEventListener('click', function() {
          document.execCommand('bold', false, null);
          editor.focus();
        });
        
        // ê¸°ìš¸ì„
        document.getElementById('italic-btn').addEventListener('click', function() {
          document.execCommand('italic', false, null);
          editor.focus();
        });
        
        // ë°‘ì¤„
        document.getElementById('underline-btn').addEventListener('click', function() {
          document.execCommand('underline', false, null);
          editor.focus();
        });
        
        // í…ìŠ¤íŠ¸ ìƒ‰ìƒ
        document.getElementById('text-color').addEventListener('change', function() {
          document.execCommand('foreColor', false, this.value);
          editor.focus();
        });
        
        // ë°°ê²½ìƒ‰
        document.getElementById('bg-color').addEventListener('change', function() {
          document.execCommand('hiliteColor', false, this.value);
          editor.focus();
        });
        
        // ë§í¬ ì¶”ê°€
        document.getElementById('link-btn').addEventListener('click', function() {
          const url = prompt('ë§í¬ URLì„ ì…ë ¥í•˜ì„¸ìš”:');
          if (url) {
            document.execCommand('createLink', false, url);
          }
          editor.focus();
        });
        
        // ì´ë¯¸ì§€ ì¶”ê°€
        document.getElementById('image-btn').addEventListener('click', function() {
          // ì´ë¯¸ì§€ ì—…ë¡œë“œ input ìƒì„±
          const fileInput = document.createElement('input');
          fileInput.type = 'file';
          fileInput.accept = 'image/*';
          fileInput.style.display = 'none';
          
          fileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
              const reader = new FileReader();
              reader.onload = function(e) {
                insertImage(e.target.result);
              };
              reader.readAsDataURL(file);
            }
            document.body.removeChild(fileInput);
          });
          
          document.body.appendChild(fileInput);
          fileInput.click();
        });
        
        // ì •ë ¬
        document.getElementById('align-left').addEventListener('click', function() {
          document.execCommand('justifyLeft', false, null);
          editor.focus();
        });
        
        document.getElementById('align-center').addEventListener('click', function() {
          document.execCommand('justifyCenter', false, null);
          editor.focus();
        });
        
        document.getElementById('align-right').addEventListener('click', function() {
          document.execCommand('justifyRight', false, null);
          editor.focus();
        });
        
        // ëª©ë¡
        document.getElementById('ul-btn').addEventListener('click', function() {
          document.execCommand('insertUnorderedList', false, null);
          editor.focus();
        });
        
        document.getElementById('ol-btn').addEventListener('click', function() {
          document.execCommand('insertOrderedList', false, null);
          editor.focus();
        });
        
        // ì—ë””í„° ë‚´ìš©ì„ textareaì— ë¡œë“œ
        function loadContent() {
          if (textarea && textarea.value && editor) {
            editor.innerHTML = textarea.value;
            // ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ ì¬ì ìš©
            const images = editor.querySelectorAll('img');
            images.forEach(img => {
              applyImageStyle(img);
            });
          }
        }
        
        // ì´ë¯¸ì§€ í¬ê¸° ì¡°ì ˆ ê¸°ëŠ¥
        editor.addEventListener('click', function(e) {
          if (e.target.tagName === 'IMG') {
            const img = e.target;
            const currentWidth = img.offsetWidth;
            const newWidth = prompt('ì´ë¯¸ì§€ ë„ˆë¹„ë¥¼ í”½ì…€ë¡œ ì…ë ¥í•˜ì„¸ìš” (í˜„ì¬: ' + currentWidth + 'px):', currentWidth);
            
            if (newWidth && !isNaN(newWidth)) {
              img.style.width = newWidth + 'px';
              img.style.height = 'auto';
              syncContent();
            }
          }
        });
        
        // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ê¸°ëŠ¥
        editor.addEventListener('dragover', function(e) {
          e.preventDefault();
          editor.style.backgroundColor = '#f0f9ff';
          editor.style.borderColor = '#3b82f6';
        });
        
        editor.addEventListener('dragleave', function(e) {
          e.preventDefault();
          editor.style.backgroundColor = '';
          editor.style.borderColor = '';
        });
        
        editor.addEventListener('drop', function(e) {
          e.preventDefault();
          editor.style.backgroundColor = '';
          editor.style.borderColor = '';
          
          const files = e.dataTransfer.files;
          if (files.length > 0) {
            const file = files[0];
            if (file.type.startsWith('image/')) {
              const reader = new FileReader();
              reader.onload = function(e) {
                insertImage(e.target.result);
              };
              reader.readAsDataURL(file);
            }
          }
        });
        
        // ì´ˆê¸° ë‚´ìš© ë¡œë“œ
        loadContent();
      }
      
              // SMS ì•Œë¦¼ ë°œì†¡ í•¨ìˆ˜
        async function sendSMSNotification(phone, userName, result) {
          try {
            // ë„¤ì´ë²„ í´ë¼ìš°ë“œ SMS API ì„¤ì •
            const serviceId = 'ncp:sms:kr:123456789012:pricehunter'; // ì‹¤ì œ ì„œë¹„ìŠ¤ IDë¡œ ë³€ê²½ í•„ìš”
            const accessKey = 'YOUR_ACCESS_KEY'; // ì‹¤ì œ ì•¡ì„¸ìŠ¤ í‚¤ë¡œ ë³€ê²½ í•„ìš”
            const secretKey = 'YOUR_SECRET_KEY'; // ì‹¤ì œ ì‹œí¬ë¦¿ í‚¤ë¡œ ë³€ê²½ í•„ìš”
            
            // SMS ë‚´ìš© êµ¬ì„±
            const message = `[PriceHunter] ${userName}ë‹˜, ì˜ë¢°í•˜ì‹  ìƒí’ˆì˜ ìµœì €ê°€ ì •ë³´ê°€ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤. 
            
ìƒí’ˆëª…: ${result.productName}
ìµœì €ê°€: ${result.lowestPrice}
ì‡¼í•‘ëª°: ${result.shopName}

ìì„¸í•œ ë‚´ìš©ì€ PriceHunterì—ì„œ í™•ì¸í•´ì£¼ì„¸ìš”.
https://pricehunt24.com/result-search.html?req=${result.requestKey}`;

            // ì‹¤ì œ SMS API í˜¸ì¶œ (CORS ì´ìŠˆë¡œ ì¸í•´ ì„œë²„ ì‚¬ì´ë“œì—ì„œ ì²˜ë¦¬ í•„ìš”)
            console.log('ğŸ“ SMS ë°œì†¡ ì‹œë„:', {
              phone: phone,
              message: message,
              serviceId: serviceId
            });

            // ì„œë²„ ì‚¬ì´ë“œ API í˜¸ì¶œ ì‹œë®¬ë ˆì´ì…˜
            const response = await fetch('/api/send-sms', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                phone: phone,
                message: message,
                serviceId: serviceId,
                accessKey: accessKey,
                secretKey: secretKey
              })
            });

            if (response.ok) {
              console.log('âœ… SMS ë°œì†¡ ì„±ê³µ:', phone);
              return true;
            } else {
              console.error('âŒ SMS ë°œì†¡ ì‹¤íŒ¨:', phone);
              return false;
            }
          } catch (error) {
            console.error('âŒ SMS ë°œì†¡ ì˜¤ë¥˜:', error);
            return false;
          }
        }

        // ì¹´ì¹´ì˜¤í†¡ ì•Œë¦¼ ë°œì†¡ í•¨ìˆ˜
        async function sendKakaoNotification(phone, userName, result) {
          try {
            // ì¹´ì¹´ì˜¤í†¡ ì•Œë¦¼í†¡ API ì„¤ì •
            const apiKey = 'YOUR_KAKAO_API_KEY'; // ì‹¤ì œ API í‚¤ë¡œ ë³€ê²½ í•„ìš”
            const templateId = 'pricehunter_notification'; // ì‹¤ì œ í…œí”Œë¦¿ IDë¡œ ë³€ê²½ í•„ìš”
            
            // ì•Œë¦¼í†¡ ë‚´ìš© êµ¬ì„±
            const message = {
              phone: phone,
              templateId: templateId,
              variables: {
                userName: userName,
                productName: result.productName,
                lowestPrice: result.lowestPrice,
                shopName: result.shopName,
                requestKey: result.requestKey
              }
            };

            console.log('ğŸ“± ì¹´ì¹´ì˜¤í†¡ ì•Œë¦¼í†¡ ë°œì†¡ ì‹œë„:', {
              phone: phone,
              templateId: templateId
            });

            // ì„œë²„ ì‚¬ì´ë“œ API í˜¸ì¶œ ì‹œë®¬ë ˆì´ì…˜
            const response = await fetch('/api/send-kakao', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify(message)
            });

            if (response.ok) {
              console.log('âœ… ì¹´ì¹´ì˜¤í†¡ ì•Œë¦¼í†¡ ë°œì†¡ ì„±ê³µ:', phone);
              return true;
            } else {
              console.error('âŒ ì¹´ì¹´ì˜¤í†¡ ì•Œë¦¼í†¡ ë°œì†¡ ì‹¤íŒ¨:', phone);
              return false;
            }
          } catch (error) {
            console.error('âŒ ì¹´ì¹´ì˜¤í†¡ ì•Œë¦¼í†¡ ë°œì†¡ ì˜¤ë¥˜:', error);
            return false;
          }
        }

        // ì´ˆê¸°í™”
        window.addEventListener('DOMContentLoaded', function() {
          renderRequestList();
          createUserTabs();
          initRichEditor();
        });
    </script>
  </body>
</html> 