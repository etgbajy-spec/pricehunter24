<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ì˜ë¢° ê²°ê³¼ ì…ë ¥/ê´€ë¦¬ | PriceHunter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- í”„ë¡œë•ì…˜ì—ì„œëŠ” Tailwind CSSë¥¼ ë¹Œë“œí•˜ì—¬ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
      body { font-family: 'Noto Sans KR', 'Inter', sans-serif; }
      .tab-btn.active {
        background-color: #ec4899;
        color: white;
      }
      .filter-btn.active {
        background-color: #6b7280;
        color: white;
      }
      #rich-editor {
        min-height: 200px;
        border: 1px solid #d1d5db;
        border-radius: 0.5rem;
        padding: 1rem;
        background: white;
      }
      #rich-editor:focus {
        outline: none;
        border-color: #ec4899;
        box-shadow: 0 0 0 3px rgba(236, 72, 153, 0.1);
      }
      .editor-toolbar {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-bottom: 1rem;
        padding: 0.5rem;
        background: #f9fafb;
        border-radius: 0.5rem;
      }
      .editor-btn {
        padding: 0.5rem;
        border: 1px solid #d1d5db;
        border-radius: 0.25rem;
        background: white;
        cursor: pointer;
        font-size: 0.875rem;
      }
      .editor-btn:hover {
        background: #f3f4f6;
      }
      .editor-btn.active {
        background: #ec4899;
        color: white;
        border-color: #ec4899;
      }
    </style>
  </head>
  <body class="bg-gradient-to-br from-gray-50 via-blue-50 to-emerald-50 min-h-screen flex items-center justify-center px-2">
    <main class="w-full max-w-6xl bg-white/90 rounded-3xl shadow-2xl p-4 md:p-8 lg:p-12 flex flex-col items-center text-center backdrop-blur-md mt-4 md:mt-8 mb-4 md:mb-8">
      <h1 class="text-xl sm:text-2xl md:text-3xl font-extrabold text-pink-600 mb-3 md:mb-4">ì˜ë¢° ê²°ê³¼ ì…ë ¥/ê´€ë¦¬ (ê´€ë¦¬ì ì „ìš©)</h1>
      <div class="text-sm text-gray-500 mb-6">ì´ í˜ì´ì§€ëŠ” ê´€ë¦¬ì(ê°œë°œì)ë§Œ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤.</div>
      
      <!-- ì•Œë¦¼ ì„¤ì • ì„¹ì…˜ -->
      <div class="w-full mb-6 p-4 bg-blue-50 rounded-xl">
        <div class="font-bold text-blue-700 mb-3">ğŸ“± ì•Œë¦¼ ë°œì†¡ ì„¤ì •</div>
        <div class="flex flex-wrap gap-4 items-center justify-center">
          <select id="notify-method" class="px-3 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-pink-400 focus:outline-none">
            <option value="both">ì¹´ì¹´ì˜¤í†¡ + ë¬¸ì</option>
            <option value="kakao">ì¹´ì¹´ì˜¤í†¡ë§Œ</option>
            <option value="sms">ë¬¸ìë§Œ</option>
          </select>
        </div>
        <div class="text-xs text-gray-500 mt-2 text-center">
          ê²°ê³¼ ì €ì¥ í›„ "ê³ ê°ì—ê²Œ ì•Œë¦¼ ë°œì†¡" ë²„íŠ¼ì„ ëˆŒëŸ¬ ê³ ê°ì—ê²Œ ì•Œë¦¼ì„ ë°œì†¡í•©ë‹ˆë‹¤.
        </div>
      </div>
      
      <!-- íšŒì›ë³„ íƒ­ ì‹œìŠ¤í…œ -->
      <div class="w-full mb-6">
        <div class="flex flex-wrap gap-2 justify-center mb-4">
          <button id="tab-all" class="tab-btn active px-4 py-2 bg-pink-500 text-white rounded-lg font-bold hover:bg-pink-600 transition" onclick="switchTab('all')">
            ì „ì²´ <span id="count-all" class="ml-1 bg-white text-pink-500 px-2 py-1 rounded text-xs">0</span>
          </button>
          <!-- íšŒì›ë³„ íƒ­ì€ ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
        </div>
        
        <!-- ì§„í–‰ìƒí™© í•„í„° -->
        <div class="flex flex-wrap gap-2 justify-center mb-4">
          <button id="filter-all" class="filter-btn active px-3 py-1 bg-gray-500 text-white rounded font-bold hover:bg-gray-600 transition text-sm" onclick="switchFilter('all')">ì „ì²´</button>
          <button id="filter-new" class="filter-btn px-3 py-1 bg-red-500 text-white rounded font-bold hover:bg-red-600 transition text-sm" onclick="switchFilter('new')">ì‹ ê·œì˜ë¢°</button>
          <button id="filter-progress" class="filter-btn px-3 py-1 bg-orange-500 text-white rounded font-bold hover:bg-orange-600 transition text-sm" onclick="switchFilter('progress')">ì§„í–‰ì¤‘</button>
          <button id="filter-complete" class="filter-btn px-3 py-1 bg-green-500 text-white rounded font-bold hover:bg-green-600 transition text-sm" onclick="switchFilter('complete')">ì™„ë£Œ</button>
        </div>
      </div>
      
      <!-- ì¼ê´„ ì‚­ì œ ë° ì•Œë¦¼ ë°œì†¡ ë²„íŠ¼ -->
      <div class="w-full mb-4 flex justify-between items-center">
        <div class="flex items-center gap-4">
          <label class="flex items-center gap-2 cursor-pointer">
            <input type="checkbox" id="select-all" class="w-4 h-4 text-pink-600 bg-gray-100 border-gray-300 rounded focus:ring-pink-500 focus:ring-2" onchange="toggleSelectAll()">
            <span class="text-sm font-semibold text-gray-700">ì „ì²´ ì„ íƒ</span>
          </label>
          <span id="selected-count" class="text-sm text-gray-600">ì„ íƒë¨: 0ê°œ</span>
        </div>
        <div class="flex gap-2">
          <button id="bulk-notify-btn" class="px-4 py-2 bg-blue-500 text-white rounded-lg font-bold hover:bg-blue-600 transition text-sm hidden" onclick="bulkSendNotification()">
            ì„ íƒ ì•Œë¦¼ ë°œì†¡ (<span id="notify-count">0</span>ê°œ)
          </button>
          <button id="bulk-delete-btn" class="px-4 py-2 bg-red-500 text-white rounded-lg font-bold hover:bg-red-600 transition text-sm hidden" onclick="bulkDelete()">
            ì„ íƒ ì‚­ì œ (<span id="delete-count">0</span>ê°œ)
          </button>
        </div>
      </div>
      
      <!-- ì˜ë¢° ëª©ë¡ -->
      <div class="w-full mb-8">
        <div class="font-bold text-gray-700 mb-2 text-left">ì ‘ìˆ˜ëœ ì˜ë¢° ëª©ë¡</div>
        <div class="flex justify-between items-center px-4 py-2 bg-pink-100 rounded-t-xl text-sm font-bold text-pink-700 flex-wrap">
          <span class="w-8">ì„ íƒ</span>
          <span class="flex-1">ì˜ë¢°ë²ˆí˜¸/íšŒì›ëª…</span>
          <span class="w-1/6 text-center">ì˜ë¢°ì¼ì‹œ</span>
          <span class="w-1/6 text-center">ì§„í–‰ìƒí™©</span>
          <span class="w-1/6 text-center">êµ¬ë§¤ë°©ì‹</span>
          <span class="w-1/6 text-center">êµ¬ë§¤ìƒíƒœ</span>
          <span class="w-1/6 text-center">ì•Œë¦¼ìƒíƒœ</span>
          <span class="w-1/4 text-right">ì œí’ˆëª…</span>
        </div>
        <ul id="request-list" class="bg-pink-50 rounded-b-xl shadow-inner divide-y divide-pink-100 text-left"></ul>
      </div>
      
      <!-- ì˜ë¢° ìƒì„¸ ë° ë‹µë³€ ì…ë ¥ -->
      <div id="detail-section" class="w-full hidden">
        <div class="bg-white rounded-2xl shadow-lg p-6 mb-4 text-left">
          <div class="mb-2 text-gray-700 font-bold">ì˜ë¢° ìƒì„¸</div>
          <div class="mb-2 text-gray-600"><span class="font-semibold">ì˜ë¢°ë²ˆí˜¸:</span> <span id="detail-num"></span></div>
          <div class="mb-2 text-gray-600"><span class="font-semibold">íšŒì›ëª…:</span> <span id="detail-name"></span></div>
          <div class="mb-2 text-gray-600"><span class="font-semibold">ì œí’ˆëª…:</span> <span id="detail-product"></span></div>
          <div class="mb-2 text-gray-600"><span class="font-semibold">í¬ë§ê°€ê²©:</span> <span id="detail-price"></span></div>
          <div class="mb-2 text-gray-600"><span class="font-semibold">ì œí’ˆì„¤ëª…:</span> <span id="detail-description"></span></div>
          <div class="mb-2 text-gray-600"><span class="font-semibold">ì°¸ê³ ì‚¬ì´íŠ¸:</span> <span id="detail-reference"></span></div>
          <div class="mb-2 text-gray-600"><span class="font-semibold">ì˜ë¢°ì¼ì‹œ:</span> <span id="detail-date"></span></div>
        </div>
        
        <!-- ë‹µë³€ ì…ë ¥ í¼ -->
        <div class="bg-white rounded-2xl shadow-lg p-6 text-left">
          <div class="mb-4 text-gray-700 font-bold">ë‹µë³€ ì…ë ¥</div>
          
          <form id="result-form" class="space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">ìµœì €ê°€</label>
                <input type="text" id="admin-price" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-400 focus:outline-none" placeholder="ì˜ˆ: 45,000ì›">
              </div>
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">ì›ì‚°ì§€/ê³µê¸‰ì²˜</label>
                <input type="text" id="admin-origin" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-400 focus:outline-none" placeholder="ì˜ˆ: ğŸ‡°ğŸ‡· ëŒ€í•œë¯¼êµ­">
              </div>
            </div>
            
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">êµ¬ë§¤ ë§í¬</label>
              <input type="url" id="admin-link" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-400 focus:outline-none" placeholder="https://example.com">
            </div>
            
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">ì¢…í•©ì„¤ëª…</label>
              <div class="editor-toolbar">
                <button type="button" class="editor-btn" onclick="execCommand('bold')">êµµê²Œ</button>
                <button type="button" class="editor-btn" onclick="execCommand('italic')">ê¸°ìš¸ì„</button>
                <button type="button" class="editor-btn" onclick="execCommand('underline')">ë°‘ì¤„</button>
                <button type="button" class="editor-btn" onclick="execCommand('insertUnorderedList')">ëª©ë¡</button>
                <button type="button" class="editor-btn" onclick="execCommand('insertOrderedList')">ë²ˆí˜¸ëª©ë¡</button>
                <button type="button" class="editor-btn" onclick="setFontSize()">ê¸€ìí¬ê¸°</button>
                <button type="button" class="editor-btn" onclick="insertImage()">ì´ë¯¸ì§€</button>
                <input type="file" id="image-upload" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
              </div>
              <div id="rich-editor" contenteditable="true" class="w-full"></div>
              <textarea id="admin-summary" style="display: none;"></textarea>
            </div>
            
            <div class="flex gap-2">
              <button type="submit" class="px-6 py-2 bg-pink-500 text-white rounded-lg font-bold hover:bg-pink-600 transition">
                ê²°ê³¼ ì €ì¥
              </button>
              <button type="button" id="admin-delete" class="px-6 py-2 bg-red-500 text-white rounded-lg font-bold hover:bg-red-600 transition">
                ê²°ê³¼ ì‚­ì œ
              </button>
            </div>
          </form>
          
          <div id="admin-msg" class="mt-4"></div>
        </div>
      </div>
    </main>

    <script>
      // ì „ì—­ ë³€ìˆ˜
      let currentTab = 'all';
      let currentFilter = 'all';
      let currentReqKey = null;
      let currentRequest = null;
      let selectedRequests = new Set();

      // ê´€ë¦¬ì ê¶Œí•œ í™•ì¸
      function isAdmin() {
        // localStorageì—ì„œ ì§ì ‘ isAdmin í‚¤ í™•ì¸
        const isAdminValue = localStorage.getItem('isAdmin');
        const adminModeValue = localStorage.getItem('adminMode');
        
        // ë‘˜ ì¤‘ í•˜ë‚˜ë¼ë„ trueì´ë©´ ê´€ë¦¬ìë¡œ ì¸ì‹
        return isAdminValue === 'true' || adminModeValue === 'true';
      }

      // íƒ­ ì „í™˜
      function switchTab(tab) {
        currentTab = tab;
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        document.getElementById('tab-' + tab).classList.add('active');
        renderRequestList();
      }

      // í•„í„° ì „í™˜
      function switchFilter(filter) {
        currentFilter = filter;
        document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
        document.getElementById('filter-' + filter).classList.add('active');
        renderRequestList();
      }

      // ì „ì²´ ì„ íƒ/í•´ì œ
      function toggleSelectAll() {
        const selectAll = document.getElementById('select-all');
        const checkboxes = document.querySelectorAll('.request-checkbox');
        
        checkboxes.forEach(checkbox => {
          checkbox.checked = selectAll.checked;
          if (selectAll.checked) {
            selectedRequests.add(checkbox.value);
          } else {
            selectedRequests.delete(checkbox.value);
          }
        });
        
        updateSelectedCount();
        updateBulkButtons();
      }

      // ì„ íƒëœ ê°œìˆ˜ ì—…ë°ì´íŠ¸
      function updateSelectedCount() {
        const count = selectedRequests.size;
        document.getElementById('selected-count').textContent = `ì„ íƒë¨: ${count}ê°œ`;
        document.getElementById('notify-count').textContent = count;
        document.getElementById('delete-count').textContent = count;
      }

      // ì¼ê´„ ë²„íŠ¼ ì—…ë°ì´íŠ¸
      function updateBulkButtons() {
        const count = selectedRequests.size;
        const notifyBtn = document.getElementById('bulk-notify-btn');
        const deleteBtn = document.getElementById('bulk-delete-btn');
        
        if (count > 0) {
          notifyBtn.classList.remove('hidden');
          deleteBtn.classList.remove('hidden');
        } else {
          notifyBtn.classList.add('hidden');
          deleteBtn.classList.add('hidden');
        }
      }

      // ì˜ë¢° ëª©ë¡ ë Œë”ë§
      function renderRequestList() {
        console.log('=== ì˜ë¢° ëª©ë¡ ë Œë”ë§ ===');
        
        const allKeys = Object.keys(localStorage);
        const requestKeys = allKeys.filter(key => key.startsWith('request-'));
        
        console.log('ì „ì²´ ì˜ë¢° ìˆ˜:', requestKeys.length);
        console.log('ì˜ë¢° ëª©ë¡:', requestKeys);
        
        let requests = [];
        
        requestKeys.forEach(key => {
          try {
            const request = JSON.parse(localStorage.getItem(key));
            if (request) {
              request.key = key;
              requests.push(request);
            }
          } catch (e) {
            console.error('ì˜ë¢° ë°ì´í„° íŒŒì‹± ì˜¤ë¥˜:', key, e);
          }
        });
        
        // í•„í„°ë§
        let filteredRequests = requests;
        
        if (currentTab !== 'all') {
          filteredRequests = requests.filter(req => req.userName === currentTab);
        }
        
        if (currentFilter !== 'all') {
          filteredRequests = filteredRequests.filter(req => {
            const result = localStorage.getItem('result-' + req.key.replace('request-', ''));
            if (currentFilter === 'new') return !result;
            if (currentFilter === 'progress') return result && !JSON.parse(result).summary;
            if (currentFilter === 'complete') return result && JSON.parse(result).summary;
            return true;
          });
        }
        
        console.log('í•„í„°ë§ëœ ì˜ë¢° ìˆ˜:', filteredRequests.length);
        console.log('í˜„ì¬ íƒ­:', currentTab);
        console.log('í˜„ì¬ í•„í„°:', currentFilter);
        
        // ëª©ë¡ ë Œë”ë§
        const list = document.getElementById('request-list');
        list.innerHTML = '';
        
        filteredRequests.forEach(request => {
          const reqNum = request.key.replace('request-', '');
          const result = localStorage.getItem('result-' + reqNum);
          const resultData = result ? JSON.parse(result) : null;
          
          const li = document.createElement('li');
          li.className = 'flex items-center px-4 py-3 hover:bg-pink-100 transition cursor-pointer';
          li.onclick = () => showDetail(request.key);
          
          const status = resultData ? (resultData.summary ? 'ì™„ë£Œ' : 'ì§„í–‰ì¤‘') : 'ì‹ ê·œì˜ë¢°';
          const statusColor = resultData ? (resultData.summary ? 'text-green-600' : 'text-orange-600') : 'text-red-600';
          
          li.innerHTML = `
            <div class="w-8">
              <input type="checkbox" class="request-checkbox w-4 h-4 text-pink-600 bg-gray-100 border-gray-300 rounded focus:ring-pink-500 focus:ring-2" 
                     value="${request.key}" 
                     ${selectedRequests.has(request.key) ? 'checked' : ''}
                     onclick="event.stopPropagation(); toggleRequestSelection('${request.key}')">
            </div>
            <div class="flex-1">
              <div class="font-semibold text-gray-800">${reqNum}</div>
              <div class="text-sm text-gray-600">${request.userName || 'ì•Œ ìˆ˜ ì—†ìŒ'}</div>
            </div>
            <div class="w-1/6 text-center text-sm text-gray-600">${new Date(request.date).toLocaleDateString()}</div>
            <div class="w-1/6 text-center">
              <span class="px-2 py-1 rounded text-xs font-semibold ${statusColor}">${status}</span>
            </div>
            <div class="w-1/6 text-center text-sm text-gray-600">-</div>
            <div class="w-1/6 text-center text-sm text-gray-600">-</div>
            <div class="w-1/6 text-center text-sm text-gray-600">-</div>
            <div class="w-1/4 text-right">
              <div class="font-semibold text-gray-800">${request.name || request.productName || request.product || 'ì œí’ˆëª… ì—†ìŒ'}</div>
              <div class="text-sm text-gray-600">${request.price || request.hopePrice || 'ê°€ê²© ì—†ìŒ'}ì›</div>
            </div>
          `;
          
          list.appendChild(li);
        });
        
        // ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
        document.getElementById('count-all').textContent = requests.length;
        
        console.log('ì˜ë¢° ëª©ë¡ ë Œë”ë§ ì™„ë£Œ');
      }

      // ì˜ë¢° ì„ íƒ í† ê¸€
      function toggleRequestSelection(key) {
        const checkbox = document.querySelector(`input[value="${key}"]`);
        if (checkbox.checked) {
          selectedRequests.add(key);
        } else {
          selectedRequests.delete(key);
        }
        updateSelectedCount();
        updateBulkButtons();
      }

      // ì‚¬ìš©ì íƒ­ ìƒì„±
      function createUserTabs() {
        const allKeys = Object.keys(localStorage);
        const requestKeys = allKeys.filter(key => key.startsWith('request-'));
        
        const users = new Set();
        requestKeys.forEach(key => {
          try {
            const request = JSON.parse(localStorage.getItem(key));
            if (request && request.userName) {
              users.add(request.userName);
            }
          } catch (e) {
            console.error('ì‚¬ìš©ì ë°ì´í„° íŒŒì‹± ì˜¤ë¥˜:', key, e);
          }
        });
        
        const tabContainer = document.querySelector('.flex.flex-wrap.gap-2.justify-center.mb-4');
        
        users.forEach(userName => {
          const button = document.createElement('button');
          button.id = 'tab-' + userName;
          button.className = 'tab-btn px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-bold hover:bg-gray-300 transition';
          button.onclick = () => switchTab(userName);
          button.innerHTML = `${userName} <span id="count-${userName}" class="ml-1 bg-white text-gray-700 px-2 py-1 rounded text-xs">0</span>`;
          tabContainer.appendChild(button);
        });
        
        console.log('ì‚¬ìš©ì íƒ­ ìƒì„± ì™„ë£Œ');
      }

      // ìƒì„¸ ì •ë³´ í‘œì‹œ
      function showDetail(reqKey) {
        currentReqKey = reqKey;
        currentRequest = JSON.parse(localStorage.getItem(reqKey));
        
        if (!currentRequest) {
          alert('ì˜ë¢° ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }
        
        // ìƒì„¸ ì •ë³´ ì±„ìš°ê¸°
        document.getElementById('detail-num').textContent = reqKey.replace('request-', '');
        document.getElementById('detail-name').textContent = currentRequest.userName || 'ì•Œ ìˆ˜ ì—†ìŒ';
        document.getElementById('detail-product').textContent = currentRequest.name || currentRequest.productName || currentRequest.product || 'ì œí’ˆëª… ì—†ìŒ';
        document.getElementById('detail-price').textContent = (currentRequest.price || currentRequest.hopePrice) ? (currentRequest.price || currentRequest.hopePrice) + 'ì›' : 'í¬ë§ê°€ê²© ì—†ìŒ';
        document.getElementById('detail-description').textContent = currentRequest.desc || currentRequest.description || 'ì„¤ëª… ì—†ìŒ';
        document.getElementById('detail-reference').textContent = (currentRequest.urls && currentRequest.urls.length > 0) ? currentRequest.urls[0] : (currentRequest.reference || 'ì°¸ê³ ì‚¬ì´íŠ¸ ì—†ìŒ');
        document.getElementById('detail-date').textContent = new Date(currentRequest.date).toLocaleString();
        
        // ê¸°ì¡´ ê²°ê³¼ ë¡œë“œ
        const reqNum = reqKey.replace('request-', '');
        const result = localStorage.getItem('result-' + reqNum);
        if (result) {
          const resultData = JSON.parse(result);
          document.getElementById('admin-price').value = resultData.price || '';
          document.getElementById('admin-origin').value = resultData.origin || '';
          document.getElementById('admin-link').value = resultData.link || '';
          
          const richEditor = document.getElementById('rich-editor');
          if (richEditor && resultData.summary) {
            richEditor.innerHTML = resultData.summary;
          }
        } else {
          // ì´ˆê¸°í™”
          document.getElementById('admin-price').value = '';
          document.getElementById('admin-origin').value = '';
          document.getElementById('admin-link').value = '';
          document.getElementById('rich-editor').innerHTML = '';
        }
        
        // ìƒì„¸ ì„¹ì…˜ í‘œì‹œ
        document.getElementById('detail-section').classList.remove('hidden');
      }

      // ë¦¬ì¹˜ í…ìŠ¤íŠ¸ ì—ë””í„° ì´ˆê¸°í™”
      function initRichEditor() {
        console.log('ë¦¬ì¹˜ ì—ë””í„° ì´ˆê¸°í™” ì‹œì‘');
        
        const editor = document.getElementById('rich-editor');
        const textarea = document.getElementById('admin-summary');
        
        if (!editor) {
          console.error('rich-editor ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }
        
        // ì—ë””í„° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        editor.addEventListener('input', function() {
          if (textarea) {
            textarea.value = editor.innerHTML;
          }
        });
        
        // ì´ë¯¸ì§€ ë¶™ì—¬ë„£ê¸° ì²˜ë¦¬
        editor.addEventListener('paste', function(e) {
          const items = e.clipboardData.items;
          for (let item of items) {
            if (item.type.indexOf('image') !== -1) {
              const file = item.getAsFile();
              const reader = new FileReader();
              reader.onload = function(e) {
                const img = document.createElement('img');
                img.src = e.target.result;
                img.style.maxWidth = '100%';
                img.style.height = 'auto';
                img.style.margin = '10px 0';
                editor.appendChild(img);
              };
              reader.readAsDataURL(file);
              e.preventDefault();
              break;
            }
          }
        });
        
        // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì´ë¯¸ì§€ ì²˜ë¦¬
        editor.addEventListener('dragover', function(e) {
          e.preventDefault();
        });
        
        editor.addEventListener('drop', function(e) {
          e.preventDefault();
          const files = e.dataTransfer.files;
          for (let file of files) {
            if (file.type.startsWith('image/')) {
              const reader = new FileReader();
              reader.onload = function(e) {
                const img = document.createElement('img');
                img.src = e.target.result;
                img.style.maxWidth = '100%';
                img.style.height = 'auto';
                img.style.margin = '10px 0';
                editor.appendChild(img);
              };
              reader.readAsDataURL(file);
            }
          }
        });
        
        // ì—ë””í„° í¬ì»¤ìŠ¤
        editor.addEventListener('click', function() {
          editor.focus();
        });
        
        console.log('ë¦¬ì¹˜ ì—ë””í„° ì´ˆê¸°í™” ì™„ë£Œ');
      }

      // ì—ë””í„° ëª…ë ¹ì–´ ì‹¤í–‰
      function execCommand(command) {
        document.execCommand(command, false, null);
        document.getElementById('rich-editor').focus();
      }

      // ê¸€ì í¬ê¸° ì„¤ì •
      function setFontSize() {
        const size = prompt('ê¸€ì í¬ê¸°ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 16px, 1.2em):', '16px');
        if (size) {
          const selection = window.getSelection();
          if (selection.rangeCount > 0) {
            const range = selection.getRangeAt(0);
            const span = document.createElement('span');
            span.style.fontSize = size;
            range.surroundContents(span);
          } else {
            // ì„ íƒëœ í…ìŠ¤íŠ¸ê°€ ì—†ìœ¼ë©´ í˜„ì¬ ì»¤ì„œ ìœ„ì¹˜ì— ì ìš©
            const editor = document.getElementById('rich-editor');
            const span = document.createElement('span');
            span.style.fontSize = size;
            span.textContent = 'ìƒˆ í…ìŠ¤íŠ¸';
            editor.appendChild(span);
          }
        }
        document.getElementById('rich-editor').focus();
      }

      // ì´ë¯¸ì§€ ì‚½ì…
      function insertImage() {
        document.getElementById('image-upload').click();
      }

      // ì´ë¯¸ì§€ ì—…ë¡œë“œ ì²˜ë¦¬
      function handleImageUpload(event) {
        const file = event.target.files[0];
        if (file && file.type.startsWith('image/')) {
          const reader = new FileReader();
          reader.onload = function(e) {
            const img = document.createElement('img');
            img.src = e.target.result;
            img.style.maxWidth = '100%';
            img.style.height = 'auto';
            img.style.margin = '10px 0';
            
            const editor = document.getElementById('rich-editor');
            editor.appendChild(img);
            editor.focus();
          };
          reader.readAsDataURL(file);
        }
        event.target.value = ''; // íŒŒì¼ ì…ë ¥ ì´ˆê¸°í™”
      }

      // ì˜ë¢° ë‹¨ì¼ ì‚­ì œ í•¨ìˆ˜
      function deleteSingleRequest(reqKey) {
        const reqNum = reqKey.replace('request-', '');
        const confirmMessage = `ì˜ë¢°ë²ˆí˜¸ ${reqNum}ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâš ï¸ ì‚­ì œë˜ëŠ” ë°ì´í„°:\nâ€¢ ì˜ë¢° ì •ë³´\nâ€¢ ì˜ë¢° ê²°ê³¼\nâ€¢ ì£¼ë¬¸ ì •ë³´\nâ€¢ ì•Œë¦¼ ë°œì†¡ ê¸°ë¡\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`;
        
        if (confirm(confirmMessage)) {
          // ëª¨ë“  ê´€ë ¨ ë°ì´í„° ì‚­ì œ
          localStorage.removeItem(reqKey); // ì˜ë¢° ì •ë³´
          localStorage.removeItem('result-' + reqNum); // ì˜ë¢° ê²°ê³¼
          localStorage.removeItem('order-' + reqNum); // ì£¼ë¬¸ ì •ë³´
          localStorage.removeItem('notify-' + reqNum); // ì•Œë¦¼ ë°œì†¡ ê¸°ë¡
          
          // í˜„ì¬ ì„ íƒëœ ì˜ë¢°ê°€ ì‚­ì œëœ ê²½ìš° ìƒì„¸ ì„¹ì…˜ ìˆ¨ê¸°ê¸°
          if (currentReqKey === reqKey) {
            currentReqKey = null;
            document.getElementById('detail-section').classList.add('hidden');
          }
          
          alert(`ì˜ë¢°ë²ˆí˜¸ ${reqNum}ì™€ ê´€ë ¨ ë°ì´í„°ê°€ ì™„ì „íˆ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
          renderRequestList();
        }
      }

      // ì¼ê´„ ì‚­ì œ
      function bulkDelete() {
        if (selectedRequests.size === 0) {
          alert('ì‚­ì œí•  ì˜ë¢°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
          return;
        }
        
        const confirmMessage = `ì„ íƒëœ ${selectedRequests.size}ê°œì˜ ì˜ë¢°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâš ï¸ ì‚­ì œë˜ëŠ” ë°ì´í„°:\nâ€¢ ì˜ë¢° ì •ë³´\nâ€¢ ì˜ë¢° ê²°ê³¼\nâ€¢ ì£¼ë¬¸ ì •ë³´\nâ€¢ ì•Œë¦¼ ë°œì†¡ ê¸°ë¡\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`;
        
        if (confirm(confirmMessage)) {
          let deletedCount = 0;
          
          selectedRequests.forEach(reqKey => {
            const reqNum = reqKey.replace('request-', '');
            localStorage.removeItem(reqKey);
            localStorage.removeItem('result-' + reqNum);
            localStorage.removeItem('order-' + reqNum);
            localStorage.removeItem('notify-' + reqNum);
            deletedCount++;
          });
          
          selectedRequests.clear();
          document.getElementById('select-all').checked = false;
          updateSelectedCount();
          updateBulkButtons();
          
          alert(`${deletedCount}ê°œì˜ ì˜ë¢°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
          renderRequestList();
        }
      }

      // ìˆ˜ë™ ì•Œë¦¼ ë°œì†¡
      function sendManualNotification() {
        if (!currentReqKey || !currentRequest) {
          alert('ì˜ë¢° ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }
        
        const reqNum = currentReqKey.replace('request-', '');
        const result = localStorage.getItem('result-' + reqNum);
        
        if (!result) {
          alert('ì €ì¥ëœ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }
        
        const resultData = JSON.parse(result);
        
        // ì•Œë¦¼ ë°œì†¡ ì‹œë®¬ë ˆì´ì…˜
        console.log('ğŸ“± ì•Œë¦¼ ë°œì†¡:', {
          userName: currentRequest.userName,
          phone: currentRequest.phone,
          productName: currentRequest.productName,
          result: resultData
        });
        
        alert('ì•Œë¦¼ì´ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤! (ì‹œë®¬ë ˆì´ì…˜)');
        
        // ì•Œë¦¼ ë°œì†¡ ê¸°ë¡ ì €ì¥
        localStorage.setItem('notify-' + reqNum, JSON.stringify({
          date: new Date().toISOString(),
          method: document.getElementById('notify-method').value,
          status: 'sent'
        }));
      }

      // ì¼ê´„ ì•Œë¦¼ ë°œì†¡
      function bulkSendNotification() {
        if (selectedRequests.size === 0) {
          alert('ì•Œë¦¼ì„ ë°œì†¡í•  ì˜ë¢°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
          return;
        }
        
        let sentCount = 0;
        
        selectedRequests.forEach(reqKey => {
          const reqNum = reqKey.replace('request-', '');
          const request = JSON.parse(localStorage.getItem(reqKey));
          const result = localStorage.getItem('result-' + reqNum);
          
          if (request && result) {
            console.log('ğŸ“± ì¼ê´„ ì•Œë¦¼ ë°œì†¡:', reqNum);
            sentCount++;
            
            // ì•Œë¦¼ ë°œì†¡ ê¸°ë¡ ì €ì¥
            localStorage.setItem('notify-' + reqNum, JSON.stringify({
              date: new Date().toISOString(),
              method: document.getElementById('notify-method').value,
              status: 'sent'
            }));
          }
        });
        
        alert(`${sentCount}ê°œì˜ ì•Œë¦¼ì´ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤! (ì‹œë®¬ë ˆì´ì…˜)`);
      }

      // ì´ˆê¸°í™”
      window.addEventListener('DOMContentLoaded', function() {
        console.log('=== ê´€ë¦¬ì í˜ì´ì§€ ì´ˆê¸°í™” ì‹œì‘ ===');
        
        // ê´€ë¦¬ì ê¶Œí•œ í™•ì¸
        if (!isAdmin()) {
          alert('ê´€ë¦¬ì ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.');
          window.location.href = 'index.html';
          return;
        }
        
        console.log('ê´€ë¦¬ì ê¶Œí•œ í™•ì¸ ì™„ë£Œ');
        
        // íƒ­ ë° í•„í„° ì´ˆê¸°í™”
        currentTab = 'all';
        currentFilter = 'all';
        
        console.log('íƒ­/í•„í„° ì´ˆê¸°í™” ì™„ë£Œ');
        
        // ì˜ë¢° ëª©ë¡ ë Œë”ë§
        renderRequestList();
        
        console.log('ì˜ë¢° ëª©ë¡ ë Œë”ë§ ì™„ë£Œ');
        
        // íƒ­ ìƒì„±
        createUserTabs();
        
        console.log('ì‚¬ìš©ì íƒ­ ìƒì„± ì™„ë£Œ');
        
        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        const selectAllElement = document.getElementById('select-all');
        if (selectAllElement) {
          selectAllElement.addEventListener('change', toggleSelectAll);
          console.log('select-all ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ì™„ë£Œ');
        }
        
        // í¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        const resultForm = document.getElementById('result-form');
        if (resultForm) {
          resultForm.onsubmit = function(e) {
            e.preventDefault();
            if (!currentReqKey || !currentRequest) return;
            const reqNum = currentReqKey.replace('request-','');
            
            // ë¦¬ì¹˜ ì—ë””í„°ì˜ ì‹¤ì œ ë‚´ìš©ì„ ê°€ì ¸ì˜¤ê¸°
            const richEditor = document.getElementById('rich-editor');
            let summaryContent = '';
            
            if (richEditor) {
              summaryContent = richEditor.innerHTML;
              const textarea = document.getElementById('admin-summary');
              if (textarea) {
                textarea.value = summaryContent;
              }
            }
            
            // ì…ë ¥ í•„ë“œë“¤ ê°€ì ¸ì˜¤ê¸°
            const adminPrice = document.getElementById('admin-price');
            const adminOrigin = document.getElementById('admin-origin');
            const adminLink = document.getElementById('admin-link');
            
            const data = {
              price: adminPrice ? adminPrice.value : '',
              origin: adminOrigin ? adminOrigin.value : '',
              summary: summaryContent,
              link: adminLink ? adminLink.value : ''
            };
            
            console.log('ì €ì¥í•  ë°ì´í„°:', data);
            
            // ì—¬ëŸ¬ í˜•ì‹ìœ¼ë¡œ ì €ì¥í•˜ì—¬ í˜¸í™˜ì„± ë³´ì¥
            localStorage.setItem('result-' + reqNum, JSON.stringify(data));
            localStorage.setItem('result-PH-' + reqNum, JSON.stringify(data));
            
            console.log('ê²°ê³¼ ì €ì¥ ì™„ë£Œ:', {
              key: 'result-' + reqNum,
              data: data
            });
            
            // ì•Œë¦¼ ë°œì†¡ ë²„íŠ¼ í‘œì‹œ
            const hasImages = summaryContent.includes('<img');
            const imageInfo = hasImages ? ' (ì´ë¯¸ì§€ í¬í•¨)' : '';
            
            const adminMsg = document.getElementById('admin-msg');
            if (adminMsg) {
              adminMsg.innerHTML = `
                <div class="text-green-600 font-bold mb-2">âœ… ê²°ê³¼ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!${imageInfo}</div>
                <button id="send-notify-btn" onclick="sendManualNotification()" class="px-4 py-2 bg-blue-500 text-white rounded-lg font-bold hover:bg-blue-600 transition">
                  ê³ ê°ì—ê²Œ ì•Œë¦¼ ë°œì†¡
                </button>
              `;
            }
            
            // ë¦¬ìŠ¤íŠ¸ ìƒˆë¡œê³ ì¹¨
            setTimeout(() => {
              renderRequestList();
            }, 500);
          };
          console.log('result-form ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ì™„ë£Œ');
        }
        
        // ì‚­ì œ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        const adminDeleteBtn = document.getElementById('admin-delete');
        if (adminDeleteBtn) {
          adminDeleteBtn.onclick = function() {
            if (!currentReqKey) return;
            const reqNum = currentReqKey.replace('request-','');
            localStorage.removeItem('result-' + reqNum);
            localStorage.removeItem('result-PH-' + reqNum);
            
            const adminMsg = document.getElementById('admin-msg');
            if (adminMsg) {
              adminMsg.textContent = 'ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!';
            }
            
            // ë¦¬ìŠ¤íŠ¸ ìƒˆë¡œê³ ì¹¨
            setTimeout(() => {
              renderRequestList();
            }, 500);
          };
          console.log('admin-delete ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ì™„ë£Œ');
        }
        
        // ë¦¬ì¹˜ í…ìŠ¤íŠ¸ ì—ë””í„° ì´ˆê¸°í™”
        initRichEditor();
        
        console.log('ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ì™„ë£Œ');
        console.log('=== ê´€ë¦¬ì í˜ì´ì§€ ì´ˆê¸°í™” ì™„ë£Œ ===');
      });
    </script>
  </body>
</html>
