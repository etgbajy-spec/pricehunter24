<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ì˜ë¢° ê²°ê³¼ ì…ë ¥/ê´€ë¦¬ | PriceHunter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script type="module">
      import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
      import { getFirestore, collection, addDoc, serverTimestamp, doc, getDoc, query, where, getDocs } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js';
      
      // Firebase ì„¤ì •
      const firebaseConfig = {
        apiKey: "AIzaSyDBZxKyMS7eeBTbPnbZkj0WWOZQHNldoL4",
        authDomain: "pricehunter-99a1b.firebaseapp.com",
        projectId: "pricehunter-99a1b",
        storageBucket: "pricehunter-99a1b.firebasestorage.app",
        messagingSenderId: "242265693919",
        appId: "1:242265693919:web:74234d942b82a51541136a",
        measurementId: "G-4BKLV4EVB9"
      };

      // Firebase ì´ˆê¸°í™”
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      
      // ì „ì—­ìœ¼ë¡œ ë…¸ì¶œ
      window.firebaseDb = db;
      window.firebaseFirestoreFunctions = { collection, addDoc, serverTimestamp, doc, getDoc, query, where, getDocs };
      
      console.log('âœ… Firebase ì´ˆê¸°í™” ì™„ë£Œ (result-admin.html)');
    </script>
    <style>
      body { font-family: 'Noto Sans KR', 'Inter', sans-serif; }
      .tab-btn.active {
        background-color: #ec4899;
        color: white;
      }
      .filter-btn.active {
        background-color: #6b7280;
        color: white;
      }
    </style>
  </head>
  <body class="bg-gradient-to-br from-gray-50 via-blue-50 to-emerald-50 min-h-screen flex items-center justify-center px-2">
    <main class="w-full max-w-6xl bg-white/90 rounded-3xl shadow-2xl p-4 md:p-8 lg:p-12 flex flex-col items-center text-center backdrop-blur-md mt-4 md:mt-8 mb-4 md:mb-8">
      <h1 class="text-xl sm:text-2xl md:text-3xl font-extrabold text-pink-600 mb-3 md:mb-4">ì˜ë¢° ê²°ê³¼ ì…ë ¥/ê´€ë¦¬ (ê´€ë¦¬ì ì „ìš©)</h1>
      <div class="text-sm text-gray-500 mb-6">ì´ í˜ì´ì§€ëŠ” ê´€ë¦¬ì(ê°œë°œì)ë§Œ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤.</div>
      
      <!-- ì•Œë¦¼ ì„¤ì • ì„¹ì…˜ -->
      <div class="w-full mb-6 p-4 bg-blue-50 rounded-xl">
        <div class="font-bold text-blue-700 mb-3">ğŸ“± ì•Œë¦¼ ë°œì†¡ ì„¤ì •</div>
        <div class="flex flex-wrap gap-4 items-center justify-center">
          <select id="notify-method" class="px-3 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-pink-400 focus:outline-none">
            <option value="both">ì¹´ì¹´ì˜¤í†¡ + ë¬¸ì</option>
            <option value="kakao">ì¹´ì¹´ì˜¤í†¡ë§Œ</option>
            <option value="sms">ë¬¸ìë§Œ</option>
          </select>
        </div>
        <div class="text-xs text-gray-500 mt-2 text-center">
          ê²°ê³¼ ì €ì¥ í›„ "ê³ ê°ì—ê²Œ ì•Œë¦¼ ë°œì†¡" ë²„íŠ¼ì„ ëˆŒëŸ¬ ê³ ê°ì—ê²Œ ì•Œë¦¼ì„ ë°œì†¡í•©ë‹ˆë‹¤.
        </div>
      </div>
      
      <!-- íšŒì›ë³„ íƒ­ ì‹œìŠ¤í…œ -->
      <div class="w-full mb-6">
        <div class="flex flex-wrap gap-2 justify-center mb-4">
          <button id="tab-all" class="tab-btn active px-4 py-2 bg-pink-500 text-white rounded-lg font-bold hover:bg-pink-600 transition" onclick="switchTab('all')">
            ì „ì²´ <span id="count-all" class="ml-1 bg-white text-pink-500 px-2 py-1 rounded text-xs">0</span>
          </button>
          <!-- íšŒì›ë³„ íƒ­ì€ ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
        </div>
        
        <!-- ê²€ìƒ‰ ë° í•„í„° -->
        <div class="flex flex-wrap gap-4 justify-center mb-4">
          <!-- ê²€ìƒ‰ ì…ë ¥ í•„ë“œ -->
          <div class="flex items-center gap-2">
            <input type="text" id="search-input" placeholder="ì˜ë¢°ë²ˆí˜¸, íšŒì›ëª…, ì œí’ˆëª…ìœ¼ë¡œ ê²€ìƒ‰" class="px-3 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-pink-400 focus:outline-none w-64">
            <button onclick="clearSearch()" class="px-2 py-1 bg-gray-500 text-white rounded text-xs hover:bg-gray-600 transition">ì´ˆê¸°í™”</button>
          </div>
          
          <!-- ì§„í–‰ìƒí™© í•„í„° -->
          <div class="flex flex-wrap gap-2">
            <button id="filter-all" class="filter-btn active px-3 py-1 bg-gray-500 text-white rounded font-bold hover:bg-gray-600 transition text-sm" onclick="switchFilter('all')">ì „ì²´</button>
            <button id="filter-new" class="filter-btn px-3 py-1 bg-red-500 text-white rounded font-bold hover:bg-red-600 transition text-sm" onclick="switchFilter('new')">ì‹ ê·œì˜ë¢°</button>
            <button id="filter-progress" class="filter-btn px-3 py-1 bg-orange-500 text-white rounded font-bold hover:bg-orange-600 transition text-sm" onclick="switchFilter('progress')">ì§„í–‰ì¤‘</button>
            <button id="filter-complete" class="filter-btn px-3 py-1 bg-green-500 text-white rounded font-bold hover:bg-green-600 transition text-sm" onclick="switchFilter('complete')">ì™„ë£Œ</button>
          </div>
        </div>
      </div>
      
      <!-- ì¼ê´„ ì‚­ì œ ë° ì•Œë¦¼ ë°œì†¡ ë²„íŠ¼ -->
      <div class="w-full mb-4 flex justify-between items-center">
        <div class="flex items-center gap-4">
          <label class="flex items-center gap-2 cursor-pointer">
            <input type="checkbox" id="select-all" class="w-4 h-4 text-pink-600 bg-gray-100 border-gray-300 rounded focus:ring-pink-500 focus:ring-2" onchange="toggleSelectAll()">
            <span class="text-sm font-semibold text-gray-700">ì „ì²´ ì„ íƒ</span>
          </label>
          <span id="selected-count" class="text-sm text-gray-600">ì„ íƒë¨: 0ê°œ</span>
        </div>
        <div class="flex gap-2">
          <button id="bulk-notify-btn" class="px-4 py-2 bg-blue-500 text-white rounded-lg font-bold hover:bg-blue-600 transition text-sm hidden" onclick="bulkSendNotification()">
            ì„ íƒ ì•Œë¦¼ ë°œì†¡ (<span id="notify-count">0</span>ê°œ)
          </button>
          <button id="bulk-delete-btn" class="px-4 py-2 bg-red-500 text-white rounded-lg font-bold hover:bg-red-600 transition text-sm hidden" onclick="bulkDelete()">
            ì„ íƒ ì‚­ì œ (<span id="delete-count">0</span>ê°œ)
          </button>
          <button id="export-data-btn" class="px-4 py-2 bg-green-500 text-white rounded-lg font-bold hover:bg-green-600 transition text-sm" onclick="exportAllData()">
            ğŸ“¥ ë°ì´í„° ë‚´ë³´ë‚´ê¸°
          </button>
          <button id="import-data-btn" class="px-4 py-2 bg-blue-500 text-white rounded-lg font-bold hover:bg-blue-600 transition text-sm" onclick="document.getElementById('import-file').click()">
            ğŸ“¤ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
          </button>
          <input type="file" id="import-file" accept=".json" style="display: none;" onchange="importData(this.files[0])">
        </div>
      </div>
      
      <!-- ì˜ë¢° ëª©ë¡ -->
      <div class="w-full mb-8">
        <div class="font-bold text-gray-700 mb-2 text-left">ì ‘ìˆ˜ëœ ì˜ë¢° ëª©ë¡</div>
        <div class="flex justify-between items-center px-4 py-2 bg-pink-100 rounded-t-xl text-sm font-bold text-pink-700 flex-wrap">
          <span class="w-8">ì„ íƒ</span>
          <span class="flex-1">ì˜ë¢°ë²ˆí˜¸/íšŒì›ëª…</span>
          <span class="w-1/6 text-center">ì˜ë¢°ì¼ì‹œ</span>
          <span class="w-1/6 text-center">ì§„í–‰ìƒí™©</span>
          <span class="w-1/6 text-center">êµ¬ë§¤ë°©ì‹</span>
          <span class="w-1/6 text-center">êµ¬ë§¤ìƒíƒœ</span>
          <span class="w-1/6 text-center">ì•Œë¦¼ìƒíƒœ</span>
          <span class="w-1/6 text-right">ì œí’ˆëª…</span>
        </div>
        <ul id="request-list" class="bg-pink-50 rounded-b-xl shadow-inner divide-y divide-pink-100 text-left"></ul>
      </div>
      
      <!-- ì˜ë¢° ìƒì„¸ ë° ë‹µë³€ ì…ë ¥ -->
      <div id="detail-section" class="w-full hidden">
        <div class="bg-white rounded-2xl shadow-lg p-6 mb-4 text-left">
          <div class="mb-2 text-gray-700 font-bold">ì˜ë¢° ìƒì„¸</div>
          <div class="mb-2 text-gray-600"><span class="font-semibold">ì˜ë¢°ë²ˆí˜¸:</span> <span id="detail-num"></span></div>
          <div class="mb-2 text-gray-600"><span class="font-semibold">ì œí’ˆëª…:</span> <span id="detail-name"></span></div>
          <div class="mb-2 text-gray-600"><span class="font-semibold">ì œí’ˆì„¤ëª…:</span> <span id="detail-desc"></span></div>
          <div class="mb-2 text-gray-600"><span class="font-semibold">ì°¸ê³ ì‚¬ì´íŠ¸:</span> <span id="detail-url"></span></div>
          <div class="mb-2 text-gray-600"><span class="font-semibold">ê°€ê²©:</span> <span id="detail-price"></span></div>
          <div class="mb-2 text-gray-600"><span class="font-semibold">ì´ë¦„:</span> <span id="detail-username"></span></div>
          <div class="mb-2 text-gray-600"><span class="font-semibold">ì´ë©”ì¼:</span> <span id="detail-email"></span></div>
          <div class="mb-2 text-gray-600"><span class="font-semibold">íœ´ëŒ€í°:</span> <span id="detail-phone"></span></div>
          <div class="mb-2 text-gray-600"><span class="font-semibold">í†µê´€ë²ˆí˜¸:</span> <span id="detail-customs"></span></div>
          <div class="mb-2 text-gray-600"><span class="font-semibold">ì—…ë¡œë“œ ì´ë¯¸ì§€:</span> <span id="detail-img"></span></div>
        </div>
        
        <form id="result-form" class="w-full bg-gray-50 rounded-2xl shadow-inner p-6 mb-4 text-left">
          <div class="mb-3">
            <label class="block text-gray-700 font-semibold mb-1" for="admin-price">ìµœì €ê°€</label>
            <input type="text" id="admin-price" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-pink-400 focus:outline-none" />
          </div>
          <div class="mb-3">
            <label class="block text-gray-700 font-semibold mb-1" for="admin-origin">ì›ì‚°ì§€/ê³µê¸‰ì²˜</label>
            <input type="text" id="admin-origin" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-pink-400 focus:outline-none" />
          </div>
          <div class="mb-3">
            <label class="block text-gray-700 font-semibold mb-1" for="admin-summary">ì¢…í•©ì„¤ëª…</label>
            <textarea id="admin-summary" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-pink-400 focus:outline-none" rows="6" placeholder="ì œí’ˆì— ëŒ€í•œ ìƒì„¸í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
          </div>
          <div class="mb-3">
            <label class="block text-gray-700 font-semibold mb-1" for="admin-link">êµ¬ë§¤ë§í¬</label>
            <input type="url" id="admin-link" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-pink-400 focus:outline-none" placeholder="https://..." />
          </div>
          <div class="flex gap-2 flex-wrap">
            <button type="submit" class="px-6 py-2 bg-pink-500 text-white font-bold rounded-lg hover:bg-pink-600 transition">ê²°ê³¼ ì €ì¥</button>
            <button type="button" id="admin-delete" class="px-6 py-2 bg-red-500 text-white font-bold rounded-lg hover:bg-red-600 transition">ê²°ê³¼ ì‚­ì œ</button>
            <button type="button" id="post-to-review-board" class="px-6 py-2 bg-blue-500 text-white font-bold rounded-lg hover:bg-blue-600 transition">í›„ê¸°ê²Œì‹œíŒì— ì˜¬ë¦¬ê¸°</button>
          </div>
          <div id="admin-msg" class="mt-3"></div>
        </form>
      </div>
    </main>

    <script>
      // ê´€ë¦¬ì ê¶Œí•œ í™•ì¸
      function isAdmin() {
        const adminMode = localStorage.getItem('adminMode') === 'true';
        const isAdmin = localStorage.getItem('isAdmin') === 'true';
        const result = adminMode || isAdmin;
        
        console.log('ê´€ë¦¬ì ê¶Œí•œ í™•ì¸:', {
          adminMode: adminMode,
          isAdmin: isAdmin,
          result: result
        });
        
        return result;
      }
      
      // ì „ì—­ ë³€ìˆ˜
      let currentTab = 'all';
      let currentFilter = 'all';
      let allRequests = [];
      let currentReqKey = '';
      let selectedRequests = new Set();
      let currentRequest = null;
      
      // ì˜ë¢° ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
      function getRequestList() {
        const list = [];
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          if (key && key.startsWith('request-') && !key.includes('TEST') && !key.startsWith('requestCount-')) {
            try {
              const req = JSON.parse(localStorage.getItem(key));
              if (!req.userName) {
                let userName = '';
                if (req.email) {
                  const user = JSON.parse(localStorage.getItem('user') || '{}');
                  const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
                  
                  if (user.email === req.email) {
                    userName = user.name || '';
                  } else if (currentUser.email === req.email) {
                    userName = currentUser.name || '';
                  }
                }
                req.userName = userName;
                localStorage.setItem(key, JSON.stringify(req));
              }
              list.push({ key, ...req });
            } catch (e) {
              console.log(`JSON íŒŒì‹± ì‹¤íŒ¨: ${key}`, e);
            }
          }
        }
        return list.sort((a, b) => (b.date || 0) - (a.date || 0));
      }
      
      // ì§„í–‰ìƒí™© íŒë‹¨ í•¨ìˆ˜
      function getRequestStatus(req) {
        const reqNum = req.key.replace('request-', '');
        const hasResult = !!localStorage.getItem('result-' + reqNum);
        
        if (!hasResult) {
          return { status: 'new', text: 'ì‹ ê·œì˜ë¢°', color: 'bg-red-500' };
        }
        
        const result = JSON.parse(localStorage.getItem('result-' + reqNum) || '{}');
        if (result.price && result.origin && result.summary && result.link) {
          return { status: 'complete', text: 'ì™„ë£Œ', color: 'bg-green-500' };
        }
        
        return { status: 'progress', text: 'ì§„í–‰ì¤‘', color: 'bg-orange-500' };
      }
      
      // êµ¬ë§¤ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
      function getPurchaseInfo(reqKey) {
        const reqNum = reqKey.replace('request-', '');
        const orderData = localStorage.getItem('order-' + reqNum);
        return orderData ? JSON.parse(orderData) : null;
      }
      
      // êµ¬ë§¤ ë°©ì‹ í…ìŠ¤íŠ¸
      function getPurchaseMethodText(method) {
        const methods = {
          'lowest': 'ìµœì €ê°€ ì‡¼í•‘ëª°',
          'direct': 'ì§ì ‘ êµ¬ë§¤',
          'none': 'êµ¬ë§¤í•˜ì§€ ì•ŠìŒ'
        };
        return methods[method] || 'êµ¬ë§¤í•˜ì§€ ì•ŠìŒ';
      }
      
      // êµ¬ë§¤ ìƒíƒœ í…ìŠ¤íŠ¸
      function getPurchaseStatusText(status) {
        const statuses = {
          'pending': 'ì£¼ë¬¸ì ‘ìˆ˜',
          'processing': 'ì²˜ë¦¬ì¤‘',
          'shipped': 'ë°°ì†¡ì¤‘',
          'delivered': 'ë°°ì†¡ì™„ë£Œ',
          'cancelled': 'ì·¨ì†Œë¨',
          'none': 'êµ¬ë§¤í•˜ì§€ ì•ŠìŒ'
        };
        return statuses[status] || 'êµ¬ë§¤í•˜ì§€ ì•ŠìŒ';
      }
      
      // êµ¬ë§¤ ìƒíƒœ ìƒ‰ìƒ
      function getPurchaseStatusColor(status) {
        const colors = {
          'pending': 'bg-yellow-500',
          'processing': 'bg-blue-500',
          'shipped': 'bg-purple-500',
          'delivered': 'bg-green-500',
          'cancelled': 'bg-red-500',
          'none': 'bg-gray-500'
        };
        return colors[status] || 'bg-gray-500';
      }
      
      // íšŒì›ë³„ íƒ­ ìƒì„±
      function createUserTabs() {
        const users = {};
        allRequests.forEach(req => {
          const userName = req.userName || 'ìµëª…';
          if (!users[userName]) {
            users[userName] = { name: userName, count: 0 };
          }
          users[userName].count++;
        });
        
        const tabContainer = document.querySelector('.flex.flex-wrap.gap-2.justify-center.mb-4');
        const allTab = document.getElementById('tab-all');
        
        // ê¸°ì¡´ íšŒì›ë³„ íƒ­ ì œê±°
        const existingTabs = tabContainer.querySelectorAll('.tab-btn:not(#tab-all)');
        existingTabs.forEach(tab => tab.remove());
        
        // ìƒˆë¡œìš´ íšŒì›ë³„ íƒ­ ì¶”ê°€
        Object.values(users).forEach(user => {
          const tab = document.createElement('button');
          tab.className = 'tab-btn px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-bold hover:bg-gray-300 transition';
          tab.onclick = () => switchTab(user.name);
          tab.innerHTML = `${user.name} <span class="ml-1 bg-white text-gray-700 px-2 py-1 rounded text-xs">${user.count}</span>`;
          tabContainer.appendChild(tab);
        });
        
        // ì „ì²´ íƒ­ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
        const allCount = allRequests.length;
        document.getElementById('count-all').textContent = allCount;
      }
      
      // íƒ­ ì „í™˜
      function switchTab(tabName) {
        currentTab = tabName;
        
        // íƒ­ ë²„íŠ¼ í™œì„±í™”
        document.querySelectorAll('.tab-btn').forEach(btn => {
          btn.classList.remove('active');
        });
        
        const activeTab = tabName === 'all' ? 
          document.getElementById('tab-all') : 
          document.querySelector(`[onclick="switchTab('${tabName}')"]`);
        
        if (activeTab) {
          activeTab.classList.add('active');
        }
        
        renderRequestList();
      }
      
      // í•„í„° ì „í™˜
      function switchFilter(filterName) {
        currentFilter = filterName;
        
        // í•„í„° ë²„íŠ¼ í™œì„±í™”
        document.querySelectorAll('.filter-btn').forEach(btn => {
          btn.classList.remove('active');
        });
        
        document.getElementById('filter-' + filterName).classList.add('active');
        
        renderRequestList();
      }
      
      // ì˜ë¢° ëª©ë¡ ë Œë”ë§
      function renderRequestList() {
        allRequests = getRequestList();
        
        console.log('=== ì˜ë¢° ëª©ë¡ ë Œë”ë§ ===');
        console.log('ì „ì²´ ì˜ë¢° ìˆ˜:', allRequests.length);
        
        // íƒ­ë³„ í•„í„°ë§
        let filteredRequests = allRequests;
        if (currentTab !== 'all') {
          filteredRequests = allRequests.filter(req => req.userName === currentTab);
        }
        
        // ì§„í–‰ìƒí™©ë³„ í•„í„°ë§
        if (currentFilter !== 'all') {
          filteredRequests = filteredRequests.filter(req => {
            const status = getRequestStatus(req);
            return status.status === currentFilter;
          });
        }
        
        // ê²€ìƒ‰ í•„í„°ë§
        const searchInput = document.getElementById('search-input');
        if (searchInput && searchInput.value.trim()) {
          const searchTerm = searchInput.value.toLowerCase();
          filteredRequests = filteredRequests.filter(req => {
            const reqNum = req.key.replace('request-', '');
            const userName = req.userName || '';
            const name = req.name || '';
            return reqNum.includes(searchTerm) || 
                   userName.toLowerCase().includes(searchTerm) || 
                   name.toLowerCase().includes(searchTerm);
          });
        }
        
        console.log('í•„í„°ë§ëœ ì˜ë¢° ìˆ˜:', filteredRequests.length);
        
        // ìš°ì„ ìˆœìœ„ ì •ë ¬ (ì‹ ê·œì˜ë¢° â†’ ì§„í–‰ì¤‘ â†’ ì™„ë£Œ)
        filteredRequests.sort((a, b) => {
          const statusA = getRequestStatus(a);
          const statusB = getRequestStatus(b);
          const priority = { new: 3, progress: 2, complete: 1 };
          return priority[statusB.status] - priority[statusA.status];
        });
        
        const ul = document.getElementById('request-list');
        ul.innerHTML = '';
        
        if (filteredRequests.length === 0) {
          ul.innerHTML = '<li class="py-4 text-center text-gray-400">í•´ë‹¹í•˜ëŠ” ì˜ë¢°ê°€ ì—†ìŠµë‹ˆë‹¤.</li>';
          return;
        }
        
        filteredRequests.forEach(req => {
          const li = document.createElement('li');
          const isSelected = currentReqKey === req.key;
          li.className = `py-3 px-4 hover:bg-pink-100 cursor-pointer flex items-center gap-2 flex-wrap ${isSelected ? 'bg-pink-200 border-l-4 border-pink-500' : ''}`;
          
          const reqNum = req.key.replace('request-', '');
          const status = getRequestStatus(req);
          const statusBadge = `<span class="px-2 py-1 rounded text-xs font-bold text-white ${status.color}">${status.text}</span>`;
          
          // êµ¬ë§¤ ì •ë³´
          const purchaseInfo = getPurchaseInfo(req.key);
          const purchaseMethod = purchaseInfo ? purchaseInfo.method : 'none';
          const purchaseStatus = purchaseInfo ? purchaseInfo.status : 'none';
          
          const purchaseMethodText = getPurchaseMethodText(purchaseMethod);
          const purchaseStatusText = getPurchaseStatusText(purchaseStatus);
          const purchaseStatusColor = getPurchaseStatusColor(purchaseStatus);
          
          // ì•Œë¦¼ ìƒíƒœ
          const notifyData = localStorage.getItem('notify-' + reqNum);
          let notifyBadge = '';
          if (notifyData) {
            const notify = JSON.parse(notifyData);
            if (notify.sent) {
              const sentDate = new Date(notify.sentAt).toLocaleDateString();
              notifyBadge = `<span class="px-2 py-1 rounded text-xs font-bold text-white bg-green-500" title="ë°œì†¡ì¼: ${sentDate}">ë°œì†¡ì™„ë£Œ</span>`;
            }
          } else if (status.status === 'complete') {
            notifyBadge = `<span class="px-2 py-1 rounded text-xs font-bold text-white bg-red-500">ë¯¸ë°œì†¡</span>`;
          }
          
          // ì²´í¬ë°•ìŠ¤
          const checkbox = `<input type="checkbox" class="request-checkbox w-4 h-4 text-pink-600 bg-gray-100 border-gray-300 rounded focus:ring-pink-500 focus:ring-2" value="${req.key}" ${selectedRequests.has(req.key) ? 'checked' : ''} onclick="event.stopPropagation(); toggleSelection('${req.key}')">`;
          
          li.innerHTML = `
            <div class="w-8 flex justify-center">${checkbox}</div>
            <div class="flex-1 truncate flex items-center" style="min-width: 0;">
              <span class="font-semibold text-pink-600">${reqNum}</span> | 
              <span class="text-gray-700">${req.userName || 'ìµëª…'}</span>
              <span class="ml-2 text-gray-400 text-xs">${isSelected ? 'â–¼' : 'â–¶'}</span>
            </div>
            <div class="w-1/6 text-center text-xs text-gray-400">${req.date ? new Date(req.date).toLocaleString() : ''}</div>
            <div class="w-1/6 text-center">${statusBadge}</div>
            <div class="w-1/6 text-center text-xs">
              <span class="text-gray-600">${purchaseMethodText}</span>
            </div>
            <div class="w-1/6 text-center">
              <span class="px-2 py-1 rounded text-xs font-bold ${purchaseStatusColor}">${purchaseStatusText}</span>
            </div>
            <div class="w-1/6 text-center">${notifyBadge}</div>
            <div class="w-1/6 text-right text-sm text-gray-600 truncate flex items-center justify-between">
              <span class="truncate">${req.name || ''}</span>
              <button onclick="event.stopPropagation(); deleteSingleRequest('${req.key}')" class="ml-2 px-2 py-1 bg-red-500 text-white rounded text-xs hover:bg-red-600 transition" title="ì˜ë¢° ì‚­ì œ">
                ğŸ—‘ï¸
              </button>
            </div>
          `;
          
          li.onclick = () => showRequestDetail(req.key);
          ul.appendChild(li);
        });
      }
      
      // ì˜ë¢° ìƒì„¸ ë³´ê¸°
      function showRequestDetail(reqKey) {
        const req = allRequests.find(r => r.key === reqKey);
        if (!req) return;
        
        currentReqKey = reqKey;
        currentRequest = req;
        
        // ìƒì„¸ ì •ë³´ í‘œì‹œ
        document.getElementById('detail-num').textContent = reqKey.replace('request-', '');
        document.getElementById('detail-name').textContent = req.name || '';
        document.getElementById('detail-desc').textContent = req.description || '';
        document.getElementById('detail-url').textContent = req.url || '';
        document.getElementById('detail-price').textContent = req.price || '';
        document.getElementById('detail-username').textContent = req.userName || '';
        document.getElementById('detail-email').textContent = req.email || '';
        document.getElementById('detail-phone').textContent = req.phone || '';
        document.getElementById('detail-customs').textContent = req.customs || '';
        document.getElementById('detail-img').textContent = req.images ? req.images.length + 'ê°œ' : '0ê°œ';
        
        // ê¸°ì¡´ ê²°ê³¼ ë°ì´í„° ë¡œë“œ
        const reqNum = reqKey.replace('request-', '');
        const resultData = localStorage.getItem('result-' + reqNum);
        if (resultData) {
          const result = JSON.parse(resultData);
          document.getElementById('admin-price').value = result.price || '';
          document.getElementById('admin-origin').value = result.origin || '';
          document.getElementById('admin-summary').value = result.summary || '';
          document.getElementById('admin-link').value = result.link || '';
        } else {
          document.getElementById('admin-price').value = '';
          document.getElementById('admin-origin').value = '';
          document.getElementById('admin-summary').value = '';
          document.getElementById('admin-link').value = '';
        }
        
        // ìƒì„¸ ì„¹ì…˜ í‘œì‹œ
        document.getElementById('detail-section').classList.remove('hidden');
        
        // ë¦¬ìŠ¤íŠ¸ ìƒˆë¡œê³ ì¹¨ (ì„ íƒ ìƒíƒœ ì—…ë°ì´íŠ¸)
        renderRequestList();
      }
      
      // ì „ì²´ ì„ íƒ ì²˜ë¦¬
      function toggleSelectAll() {
        const selectAllCheckbox = document.getElementById('select-all');
        const checkboxes = document.querySelectorAll('.request-checkbox');
        
        checkboxes.forEach(checkbox => {
          checkbox.checked = selectAllCheckbox.checked;
          if (selectAllCheckbox.checked) {
            selectedRequests.add(checkbox.value);
          } else {
            selectedRequests.delete(checkbox.value);
          }
        });
        
        updateSelectionUI();
      }
      
      // ê°œë³„ ì„ íƒ ì²˜ë¦¬
      function toggleSelection(reqKey) {
        if (selectedRequests.has(reqKey)) {
          selectedRequests.delete(reqKey);
        } else {
          selectedRequests.add(reqKey);
        }
        
        updateSelectionUI();
      }
      
      // ì„ íƒ UI ì—…ë°ì´íŠ¸
      function updateSelectionUI() {
        const selectedCount = selectedRequests.size;
        
        document.getElementById('selected-count').textContent = `ì„ íƒë¨: ${selectedCount}ê°œ`;
        document.getElementById('delete-count').textContent = selectedCount;
        document.getElementById('notify-count').textContent = selectedCount;
        
        const bulkDeleteBtn = document.getElementById('bulk-delete-btn');
        const bulkNotifyBtn = document.getElementById('bulk-notify-btn');
        
        if (selectedCount > 0) {
          bulkDeleteBtn.classList.remove('hidden');
          bulkNotifyBtn.classList.remove('hidden');
        } else {
          bulkDeleteBtn.classList.add('hidden');
          bulkNotifyBtn.classList.add('hidden');
        }
        
        // ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸
        const selectAllCheckbox = document.getElementById('select-all');
        const checkboxes = document.querySelectorAll('.request-checkbox');
        const allChecked = checkboxes.length > 0 && Array.from(checkboxes).every(cb => cb.checked);
        selectAllCheckbox.checked = allChecked;
      }
      
      // ì¼ê´„ ì‚­ì œ
      function bulkDelete() {
        if (selectedRequests.size === 0) return;
        
        const confirmMessage = `ì„ íƒëœ ${selectedRequests.size}ê°œì˜ ì˜ë¢°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâš ï¸ ì‚­ì œë˜ëŠ” ë°ì´í„°:\nâ€¢ ì˜ë¢° ì •ë³´\nâ€¢ ì˜ë¢° ê²°ê³¼\nâ€¢ ì£¼ë¬¸ ì •ë³´\nâ€¢ ì•Œë¦¼ ë°œì†¡ ê¸°ë¡\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`;
        if (!confirm(confirmMessage)) return;
        
        let deletedCount = 0;
        selectedRequests.forEach(reqKey => {
          const reqNum = reqKey.replace('request-', '');
          
          localStorage.removeItem(reqKey);
          localStorage.removeItem('result-' + reqNum);
          localStorage.removeItem('order-' + reqNum);
          localStorage.removeItem('notify-' + reqNum);
          
          deletedCount++;
        });
        
        selectedRequests.clear();
        document.getElementById('select-all').checked = false;
        
        renderRequestList();
        alert(`${deletedCount}ê°œì˜ ì˜ë¢°ì™€ ê´€ë ¨ ë°ì´í„°ê°€ ì™„ì „íˆ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
      }
      
      // ì¼ê´„ ì•Œë¦¼ ë°œì†¡
      function bulkSendNotification() {
        if (selectedRequests.size === 0) return;
        
        const notifyMethod = document.getElementById('notify-method').value;
        const confirmMessage = `ì„ íƒëœ ${selectedRequests.size}ê°œì˜ ì˜ë¢°ì— ëŒ€í•´ ê³ ê°ì—ê²Œ ì•Œë¦¼ì„ ë°œì†¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì•Œë¦¼ ë°©ë²•: ${notifyMethod}`;
        
        if (!confirm(confirmMessage)) return;
        
        alert('ì¼ê´„ ì•Œë¦¼ ë°œì†¡ ê¸°ëŠ¥ì€ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.');
      }
      
      // ì˜ë¢° ë‹¨ì¼ ì‚­ì œ
      function deleteSingleRequest(reqKey) {
        const reqNum = reqKey.replace('request-', '');
        const confirmMessage = `ì˜ë¢°ë²ˆí˜¸ ${reqNum}ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâš ï¸ ì‚­ì œë˜ëŠ” ë°ì´í„°:\nâ€¢ ì˜ë¢° ì •ë³´\nâ€¢ ì˜ë¢° ê²°ê³¼\nâ€¢ ì£¼ë¬¸ ì •ë³´\nâ€¢ ì•Œë¦¼ ë°œì†¡ ê¸°ë¡\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`;
        
        if (confirm(confirmMessage)) {
          localStorage.removeItem(reqKey);
          localStorage.removeItem('result-' + reqNum);
          localStorage.removeItem('order-' + reqNum);
          localStorage.removeItem('notify-' + reqNum);
          
          if (currentReqKey === reqKey) {
            currentReqKey = '';
            document.getElementById('detail-section').classList.add('hidden');
          }
          
          alert(`ì˜ë¢°ë²ˆí˜¸ ${reqNum}ì™€ ê´€ë ¨ ë°ì´í„°ê°€ ì™„ì „íˆ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
          renderRequestList();
        }
      }
      
      // ê²€ìƒ‰ ì´ˆê¸°í™”
      function clearSearch() {
        const searchInput = document.getElementById('search-input');
        if (searchInput) {
          searchInput.value = '';
          renderRequestList();
        }
      }
      
      // ì´ˆê¸°í™”
      window.addEventListener('DOMContentLoaded', function() {
        console.log('=== ê´€ë¦¬ì í˜ì´ì§€ ì´ˆê¸°í™” ì‹œì‘ ===');
        
        // ê´€ë¦¬ì ê¶Œí•œ í™•ì¸
        if (!isAdmin()) {
          alert('ê´€ë¦¬ì ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.');
          window.location.href = 'index.html';
          return;
        }
        
        console.log('ê´€ë¦¬ì ê¶Œí•œ í™•ì¸ ì™„ë£Œ');
        
        // íƒ­ ë° í•„í„° ì´ˆê¸°í™”
        currentTab = 'all';
        currentFilter = 'all';
        
        console.log('íƒ­/í•„í„° ì´ˆê¸°í™” ì™„ë£Œ');
        
        // ì˜ë¢° ëª©ë¡ ë Œë”ë§
        renderRequestList();
        
        console.log('ì˜ë¢° ëª©ë¡ ë Œë”ë§ ì™„ë£Œ');
        
        // íƒ­ ìƒì„±
        createUserTabs();
        
        console.log('ì‚¬ìš©ì íƒ­ ìƒì„± ì™„ë£Œ');
        
        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        const selectAllElement = document.getElementById('select-all');
        if (selectAllElement) {
          selectAllElement.addEventListener('change', toggleSelectAll);
          console.log('select-all ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ì™„ë£Œ');
        }
        
        const searchInputElement = document.getElementById('search-input');
        if (searchInputElement) {
          searchInputElement.addEventListener('input', function() {
            setTimeout(renderRequestList, 300);
          });
          console.log('search-input ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ì™„ë£Œ');
        }
        
        const resultForm = document.getElementById('result-form');
        if (resultForm) {
          resultForm.onsubmit = function(e) {
            e.preventDefault();
            if (!currentReqKey || !currentRequest) return;
            
            const reqNum = currentReqKey.replace('request-','');
            
            const adminPrice = document.getElementById('admin-price');
            const adminOrigin = document.getElementById('admin-origin');
            const adminSummary = document.getElementById('admin-summary');
            const adminLink = document.getElementById('admin-link');
            
            const data = {
              price: adminPrice ? adminPrice.value : '',
              origin: adminOrigin ? adminOrigin.value : '',
              summary: adminSummary ? adminSummary.value : '',
              link: adminLink ? adminLink.value : ''
            };
            
            console.log('ì €ì¥í•  ë°ì´í„°:', data);
            
            localStorage.setItem('result-' + reqNum, JSON.stringify(data));
            localStorage.setItem('result-PH-' + reqNum, JSON.stringify(data));
            
            console.log('ê²°ê³¼ ì €ì¥ ì™„ë£Œ:', {
              key: 'result-' + reqNum,
              data: data
            });
            
            const adminMsg = document.getElementById('admin-msg');
            if (adminMsg) {
              adminMsg.innerHTML = `
                <div class="text-green-600 font-bold mb-2">âœ… ê²°ê³¼ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!</div>
                <button onclick="sendManualNotification()" class="px-4 py-2 bg-blue-500 text-white rounded-lg font-bold hover:bg-blue-600 transition">
                  ê³ ê°ì—ê²Œ ì•Œë¦¼ ë°œì†¡
                </button>
              `;
            }
            
            setTimeout(() => {
              renderRequestList();
            }, 500);
          };
          console.log('result-form ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ì™„ë£Œ');
        }
        
        const adminDeleteBtn = document.getElementById('admin-delete');
        if (adminDeleteBtn) {
          adminDeleteBtn.onclick = function() {
            if (!currentReqKey) return;
            const reqNum = currentReqKey.replace('request-','');
            localStorage.removeItem('result-' + reqNum);
            localStorage.removeItem('result-PH-' + reqNum);
            
            const adminMsg = document.getElementById('admin-msg');
            if (adminMsg) {
              adminMsg.textContent = 'ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!';
            }
            
            setTimeout(() => {
              renderRequestList();
            }, 500);
          };
          console.log('admin-delete ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ì™„ë£Œ');
        }
        
        // í›„ê¸°ê²Œì‹œíŒì— ì˜¬ë¦¬ê¸° ë²„íŠ¼
        const postToReviewBoardBtn = document.getElementById('post-to-review-board');
        if (postToReviewBoardBtn) {
          postToReviewBoardBtn.onclick = async function() {
            if (!currentReqKey || !currentRequest) {
              alert('ì˜ë¢°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
              return;
            }
            
            // ê²°ê³¼ ë°ì´í„° í™•ì¸
            const reqNum = currentReqKey.replace('request-','');
            const resultData = localStorage.getItem('result-' + reqNum);
            if (!resultData) {
              alert('ë¨¼ì € ê²°ê³¼ë¥¼ ì €ì¥í•´ì£¼ì„¸ìš”.');
              return;
            }
            
            const result = JSON.parse(resultData);
            if (!result.price || !result.origin || !result.summary) {
              alert('ìµœì €ê°€, ì›ì‚°ì§€/ê³µê¸‰ì²˜, ì¢…í•©ì„¤ëª…ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
              return;
            }
            
            // í›„ê¸°ê²Œì‹œíŒ ë™ì˜ í™•ì¸ (Firebaseì—ì„œ í™•ì¸)
            try {
              // Firebaseì—ì„œ ì˜ë¢° ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
              const { collection, query, where, getDocs } = window.firebaseFirestoreFunctions || {};
              if (!window.firebaseDb || !collection) {
                // localStorage ê¸°ë°˜ìœ¼ë¡œ ë™ì˜ í™•ì¸
                const reviewBoardAgree = currentRequest.reviewBoardAgree;
                if (reviewBoardAgree !== true) {
                  if (!confirm('ì´ ì˜ë¢°ëŠ” í›„ê¸°ê²Œì‹œíŒ ìë™ë“±ë¡ì— ë™ì˜í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\nê·¸ë˜ë„ í›„ê¸°ê²Œì‹œíŒì— ì˜¬ë¦¬ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    return;
                  }
                }
              } else {
                // Firebaseì—ì„œ ì˜ë¢° ë°ì´í„° í™•ì¸
                const requestsRef = collection(window.firebaseDb, 'requests');
                const q = query(requestsRef, where('requestNumber', '==', reqNum));
                const querySnapshot = await getDocs(q);
                
                if (!querySnapshot.empty) {
                  const requestData = querySnapshot.docs[0].data();
                  if (requestData.reviewBoardAgree !== true) {
                    if (!confirm('ì´ ì˜ë¢°ëŠ” í›„ê¸°ê²Œì‹œíŒ ìë™ë“±ë¡ì— ë™ì˜í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\nê·¸ë˜ë„ í›„ê¸°ê²Œì‹œíŒì— ì˜¬ë¦¬ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                      return;
                    }
                  }
                }
              }
              
              // í›„ê¸° ë°ì´í„° ìƒì„±
              await postToReviewBoard(currentRequest, result, reqNum);
              
            } catch (error) {
              console.error('í›„ê¸°ê²Œì‹œíŒ ë“±ë¡ ì‹¤íŒ¨:', error);
              alert('í›„ê¸°ê²Œì‹œíŒ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
          };
          console.log('post-to-review-board ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ì™„ë£Œ');
        }
        
        console.log('ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ì™„ë£Œ');
        console.log('=== ê´€ë¦¬ì í˜ì´ì§€ ì´ˆê¸°í™” ì™„ë£Œ ===');
      });
      
      // ìˆ˜ë™ ì•Œë¦¼ ë°œì†¡ (ì„ì‹œ)
      function sendManualNotification() {
        alert('ì•Œë¦¼ ë°œì†¡ ê¸°ëŠ¥ì€ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.');
      }
      
      // ë°ì´í„° ë‚´ë³´ë‚´ê¸°
      function exportAllData() {
        const allData = {};
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          if (key) {
            allData[key] = localStorage.getItem(key);
          }
        }
        
        const blob = new Blob([JSON.stringify(allData, null, 2)], {
          type: 'application/json'
        });
        
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `pricehunter-backup-${new Date().toISOString().split('T')[0]}.json`;
        a.click();
        
        URL.revokeObjectURL(url);
        alert('ë°ì´í„° ë‚´ë³´ë‚´ê¸°ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
      }
      
      // ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
      function importData(file) {
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = function(e) {
          try {
            const data = JSON.parse(e.target.result);
            
            // localStorage ì´ˆê¸°í™”
            localStorage.clear();
            
            // ë°ì´í„° ë³µì›
            Object.keys(data).forEach(key => {
              localStorage.setItem(key, data[key]);
            });
            
            alert('ë°ì´í„° ë³µì›ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.');
            location.reload();
          } catch (error) {
            alert('ë°ì´í„° íŒŒì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
            console.error('Import error:', error);
          }
        };
        reader.readAsText(file);
      }
      
      // í›„ê¸°ê²Œì‹œíŒì— ì˜¬ë¦¬ê¸° í•¨ìˆ˜
      async function postToReviewBoard(request, result, reqNum) {
        try {
          // Firebase ì´ˆê¸°í™” í™•ì¸
          if (!window.firebaseDb || !window.firebaseFirestoreFunctions) {
            throw new Error('Firebaseê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
          }
          
          const { collection, addDoc, serverTimestamp } = window.firebaseFirestoreFunctions;
          const reviewsRef = collection(window.firebaseDb, 'reviews');
          
          // ì ˆì•½ ê¸ˆì•¡ ê³„ì‚°
          const originalPriceNum = parseInt(String(request.price || '0').replace(/[^0-9]/g, '')) || 0;
          const finalPriceNum = parseInt(String(result.price || '0').replace(/[^0-9]/g, '')) || 0;
          const savingsNum = originalPriceNum - finalPriceNum;
          const savingsPercent = originalPriceNum > 0 ? Math.round((savingsNum / originalPriceNum) * 100) : 0;
          
          // ê°€ê²© í¬ë§·íŒ…
          const formatPrice = (price) => {
            if (typeof price === 'number') {
              return price.toLocaleString() + 'ì›';
            }
            if (typeof price === 'string') {
              if (price.includes('ì›')) return price;
              const num = parseInt(price.replace(/[^0-9]/g, ''));
              return num.toLocaleString() + 'ì›';
            }
            return String(price);
          };
          
          // í›„ê¸° ë°ì´í„° ìƒì„±
          const reviewData = {
            name: request.userName || 'ìµëª…',
            productName: request.name || 'ì œí’ˆëª… ì—†ìŒ',
            originalPrice: formatPrice(originalPriceNum),
            finalPrice: formatPrice(finalPriceNum),
            savings: savingsNum > 0 ? formatPrice(savingsNum) : '0ì›',
            savingsPercent: savingsPercent,
            rating: 5, // ê¸°ë³¸ í‰ì 
            review: result.summary || 'PriceHunterë¥¼ í†µí•´ ì ˆì•½í–ˆìŠµë‹ˆë‹¤.',
            country: 'ëŒ€í•œë¯¼êµ­',
            shipping: '3ì¼',
            method: result.origin || 'PriceHunter ê²€ì¦',
            badge: 'ì‹¤ì œ êµ¬ë§¤ì',
            purchaseDate: new Date().toISOString().split('T')[0],
            category: 'ì¼ë°˜',
            photos: request.images || [],
            approved: true, // ê´€ë¦¬ìê°€ ì˜¬ë¦¬ëŠ” ê²ƒì´ë¯€ë¡œ ìë™ ìŠ¹ì¸
            views: 0,
            createdAt: serverTimestamp(),
            updatedAt: serverTimestamp(),
            requestId: reqNum, // ì˜ë¢° ë²ˆí˜¸ ì—°ê²°
            requestNumber: reqNum
          };
          
          // Firebaseì— í›„ê¸° ì €ì¥
          const reviewDoc = await addDoc(reviewsRef, reviewData);
          
          console.log('âœ… í›„ê¸°ê²Œì‹œíŒì— ë“±ë¡ ì™„ë£Œ:', reviewDoc.id);
          
          const adminMsg = document.getElementById('admin-msg');
          if (adminMsg) {
            adminMsg.innerHTML = `
              <div class="text-green-600 font-bold mb-2">âœ… í›„ê¸°ê²Œì‹œíŒì— ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!</div>
              <div class="text-sm text-gray-600">í›„ê¸° ID: ${reviewDoc.id}</div>
            `;
          }
          
          alert('í›„ê¸°ê²Œì‹œíŒì— ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
          
        } catch (error) {
          console.error('âŒ í›„ê¸°ê²Œì‹œíŒ ë“±ë¡ ì‹¤íŒ¨:', error);
          throw error;
        }
      }
    </script>
  </body>
</html>
