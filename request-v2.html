<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PriceHunter - ìµœì €ê°€ ê²€ì¦ ì˜ë¢° (ìµœì í™”)</title>
  
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-N7R437NT77"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-N7R437NT77');
  </script>
  
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Firebase v9 SDK (ëª¨ë“ˆì‹) -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
    import { getAuth } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js';
    import { getFirestore, collection, addDoc, serverTimestamp, getDocs, query, where, orderBy, doc, updateDoc, deleteDoc } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js';
    
    // Firebase ì„¤ì •
    const firebaseConfig = {
      apiKey: "AIzaSyDBZxKyMS7eeBTbPnbZkj0WWOZQHNldoL4",
      authDomain: "pricehunter-99a1b.firebaseapp.com",
      projectId: "pricehunter-99a1b",
      storageBucket: "pricehunter-99a1b.firebasestorage.app",
      messagingSenderId: "242265693919",
      appId: "1:242265693919:web:74234d942b82a51541136a",
      measurementId: "G-4BKLV4EVB9"
    };

    // Firebase ì´ˆê¸°í™”
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // ì „ì—­ ë³€ìˆ˜ë¡œ ë…¸ì¶œ
    window.firebaseApp = app;
    window.firebaseAuth = auth;
    window.firebaseDb = db;
    window.firebaseFirestoreFunctions = { 
      collection, 
      addDoc, 
      serverTimestamp, 
      query, 
      orderBy, 
      getDocs, 
      where, 
      doc, 
      updateDoc, 
      deleteDoc 
    };

    console.log('âœ… Firebase v9 ì´ˆê¸°í™” ì™„ë£Œ (request-v2.html)');
  </script>
  
  <style>
    /* í…ìŠ¤íŠ¸ ì„ íƒ í—ˆìš© (ë“œë˜ê·¸ ê°€ëŠ¥) */
    body {
      -webkit-user-select: text;
      -moz-user-select: text;
      -ms-user-select: text;
      user-select: text;
    }
    
    /* ë²„íŠ¼ê³¼ ë§í¬, ì…ë ¥ í•„ë“œëŠ” í…ìŠ¤íŠ¸ ì„ íƒ í—ˆìš© */
    button, a, input, textarea, select {
      -webkit-user-select: text;
      -moz-user-select: text;
      -ms-user-select: text;
      user-select: text;
    }
    
    /* ì»¤ì„œ ê¹œë¹¡ì„ ë°©ì§€ */
    body, div, p, h1, h2, h3, h4, h5, h6, span, label {
      caret-color: transparent;
    }
    
    /* ì…ë ¥ ìš”ì†ŒëŠ” ì»¤ì„œ í‘œì‹œ */
    input, textarea {
      caret-color: auto;
    }
    
    .fadein-step {
      animation: fadein-step 0.7s cubic-bezier(.4,0,.2,1) both;
    }
    @keyframes fadein-step {
      0% { opacity: 0; transform: translateY(40px) scale(0.98); }
      100% { opacity: 1; transform: translateY(0) scale(1); }
    }
    
    .stepper-dot-animate {
      transition: background 0.4s, box-shadow 0.4s, transform 0.4s;
    }
    .stepper-dot-active {
      background: linear-gradient(90deg, #f472b6 0%, #fbbf24 100%);
      box-shadow: 0 4px 16px 0 rgba(255, 99, 132, 0.15);
      transform: scale(1.15);
    }
    .stepper-dot {
      background: #d1d5db;
    }
    .input-animate:focus {
      box-shadow: 0 0 0 3px #fbbf24aa;
      transition: box-shadow 0.3s;
    }
    .btn-animate {
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .btn-animate:hover {
      transform: translateY(-2px) scale(1.04);
      box-shadow: 0 8px 32px 0 rgba(236, 72, 153, 0.12);
    }
    
    /* ìŠ¤í…ë³„ ìƒ‰ìƒ í…Œë§ˆ */
    .step-1-theme {
      --primary-color: #3b82f6;
      --primary-bg: #dbeafe;
      --primary-border: #93c5fd;
    }
    .step-2-theme {
      --primary-color: #10b981;
      --primary-bg: #d1fae5;
      --primary-border: #6ee7b7;
    }
    
    /* íŒì—… ì• ë‹ˆë©”ì´ì…˜ */
    .popup-enter {
      animation: popup-enter 0.3s ease-out;
    }
    .popup-exit {
      animation: popup-exit 0.3s ease-in;
    }
    @keyframes popup-enter {
      0% { 
        opacity: 0; 
        transform: scale(0.9) translateY(-20px); 
      }
      100% { 
        opacity: 1; 
        transform: scale(1) translateY(0); 
      }
    }
    @keyframes popup-exit {
      0% { 
        opacity: 1; 
        transform: scale(1) translateY(0); 
      }
      100% { 
        opacity: 0; 
        transform: scale(0.9) translateY(-20px); 
      }
    }
  </style>
</head>
<body class="bg-gradient-to-br from-gray-100 via-blue-50 to-emerald-50 min-h-screen flex flex-col items-center justify-center py-4 md:py-12">
  <div class="w-full max-w-4xl bg-white/90 rounded-2xl shadow-2xl p-4 md:p-8 lg:p-10 backdrop-blur-md">
    <h2 class="text-2xl sm:text-3xl md:text-4xl font-bold text-blue-800 mb-4 md:mb-6 text-center">ìµœì €ê°€<br class="sm:hidden">ìš”ì²­í•˜ê¸°</h2>
    
    <!-- 2ë‹¨ê³„ ìŠ¤í…Œí¼ -->
    <div id="stepper" class="flex justify-center items-center mb-8">
      <div class="flex items-center">
        <div class="flex flex-col items-center">
          <div class="w-12 h-12 md:w-14 md:h-14 rounded-full flex items-center justify-center font-bold text-white stepper-dot stepper-dot-animate text-lg md:text-xl" id="step-1-dot">1</div>
          <div class="text-sm mt-2 font-medium text-gray-700">ì œí’ˆ ì •ë³´ & ì°¸ê³ ìë£Œ</div>
        </div>
        <div class="w-24 md:w-32 h-1 bg-gradient-to-r from-blue-300 to-pink-300 mx-4"></div>
        <div class="flex flex-col items-center">
          <div class="w-12 h-12 md:w-14 md:h-14 rounded-full flex items-center justify-center font-bold text-white stepper-dot stepper-dot-animate text-lg md:text-xl" id="step-2-dot">2</div>
          <div class="text-sm mt-2 font-medium text-gray-700">ì—°ë½ì²˜ & ìµœì¢… í™•ì¸</div>
        </div>
      </div>
    </div>
    
    <form id="step-form">
      <!-- Step 1: ì œí’ˆì •ë³´ + ì°¸ê³ ìë£Œ í†µí•© -->
      <div class="step step-1-theme" id="step-1">
        <!-- í—¤ë” ì„¹ì…˜ -->
        <div class="mb-6 p-4 rounded-xl bg-blue-50 border border-blue-200 text-blue-800 text-center shadow-sm">
          <div class="text-lg font-bold mb-2">ğŸ“ ì œí’ˆ ì •ë³´ë¥¼ ìƒì„¸íˆ ì…ë ¥í•´ì£¼ì„¸ìš”</div>
          <div class="text-sm text-blue-700">
            ì •í™•í•œ ì •ë³´ ì œê³µìœ¼ë¡œ ë” ë‚˜ì€ ìµœì €ê°€ ê²€ì¦ ê²°ê³¼ë¥¼ ë°›ìœ¼ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤
          </div>
          <div class="mt-3">
            <a href="support.html#faq" class="inline-block px-4 py-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 transition-colors">
              ğŸ“‹ êµ¬ë§¤ì „í•„ë…ì‚¬í•­ ë³´ê¸°
            </a>
          </div>
        </div>

        <!-- ì œí’ˆ ê¸°ë³¸ ì •ë³´ -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
          <div class="space-y-4">
            <div>
              <label class="block text-gray-700 font-semibold mb-2" for="productName">
                ì œí’ˆëª… <span class="text-red-500">*</span>
              </label>
              <input type="text" id="productName" required 
                     class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-400 focus:outline-none transition input-animate" 
                     placeholder="ì˜ˆ: ìº í•‘ìš© ì ‘ì´ì‹ ì˜ì, ì±…ìƒ, ì˜·ì¥ ë“±" />
              <div class="text-xs text-gray-500 mt-1">
                ğŸ’¡ êµ¬ì²´ì ì¸ ì œí’ˆëª…ì„ ì…ë ¥í•˜ë©´ ë” ì •í™•í•œ ê²€ì¦ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤
              </div>
            </div>
            
            <div>
              <label class="block text-gray-700 font-semibold mb-2" for="productPrice">
                ì˜ˆìƒ ê°€ê²©(ì›) <span class="text-red-500">*</span>
              </label>
              <input type="number" id="productPrice" min="1000" step="1" required
                     class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-400 focus:outline-none transition input-animate" 
                     placeholder="ì˜ˆ: 50000" />
              <div class="text-xs text-gray-500 mt-1">
                ğŸ’¡ ìµœì†Œ 1,000ì› ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”
              </div>
            </div>
          </div>
          
          <div>
            <label class="block text-gray-700 font-semibold mb-2" for="productDesc">
              ì œí’ˆ ìƒì„¸ ì„¤ëª… <span class="text-red-500">*</span>
            </label>
            <textarea id="productDesc" required rows="6"
                      class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-400 focus:outline-none transition input-animate" 
                      placeholder="ì˜ˆ: 4ì¸ìš©, ë°©ìˆ˜ì²œ, ë“±ë°›ì´ ì¡°ì ˆ ê°€ëŠ¥, ì ‘ì´ì‹, íœ´ëŒ€ìš©, ìµœëŒ€ í•˜ì¤‘ 120kg, ìƒ‰ìƒ: ë„¤ì´ë¹„"></textarea>
            <div class="text-xs text-gray-500 mt-1">
              ğŸ’¡ í¬ê¸°, ì¬ì§ˆ, ìƒ‰ìƒ, ê¸°ëŠ¥ ë“± êµ¬ì²´ì ì¸ íŠ¹ì§•ì„ ì…ë ¥í•´ì£¼ì„¸ìš”
            </div>
          </div>
        </div>

        <!-- ë¸Œëœë“œ ë°°ì œ ì•ˆë‚´ -->
        <div class="bg-pink-50 p-4 rounded-lg mb-6 border border-pink-200">
          <div class="flex items-start">
            <div class="text-pink-600 mr-3 text-xl">âš ï¸</div>
            <div>
              <div class="font-bold text-pink-800 mb-1">ë¸Œëœë“œ ì œí’ˆ ê²€ì¦ ì œì™¸ ì•ˆë‚´</div>
              <div class="text-sm text-pink-700">
                ì• í”Œ, ì‚¼ì„±, LG, ëª…í’ˆ, ìŠ¤ë‹ˆì»¤ì¦ˆ, ëŒ€í˜•TV ë“± ë¸Œëœë“œ ì œí’ˆì€ ê°€ê²© ë³€ë™ì´ ì‹¬í•˜ê³  ì •í™•í•œ ë¹„êµê°€ ì–´ë ¤ì›Œ ê²€ì¦ì—ì„œ ì œì™¸ë©ë‹ˆë‹¤.<br>
                <span class="font-medium text-blue-600">ğŸ’¡ ë¸Œëœë“œê°€ ì—†ëŠ” ì œí’ˆ, ë˜ëŠ” ë¸Œëœë“œê°€ ì¤‘ìš”í•˜ì§€ ì•Šì€ ì œí’ˆ ìœ„ì£¼ë¡œ ì˜ë¢°í•´ ì£¼ì„¸ìš”!</span>
              </div>
            </div>
          </div>
        </div>

        <!-- ì°¸ê³ ìë£Œ ì„¹ì…˜ -->
        <div class="bg-emerald-50 p-4 rounded-lg mb-6 border border-emerald-200">
          <div class="text-emerald-800 font-semibold mb-3">ğŸ”— ì°¸ê³ ìë£Œ (ì„ íƒì‚¬í•­ì´ì§€ë§Œ ê¶Œì¥)</div>
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
            <div>
              <label class="block text-gray-700 font-semibold mb-2" for="productUrl">
                ì°¸ê³ ì‚¬ì´íŠ¸ ë§í¬
              </label>
              <input type="text" id="productUrl" 
                     class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-400 focus:outline-none transition input-animate" 
                     placeholder="ì˜ˆ: https://example.com ë˜ëŠ” www.example.com" />
              <div class="text-xs text-emerald-600 mt-1">
                ğŸ’¡ ê³µì‹ ì‡¼í•‘ëª°, ê°€ê²©ë¹„êµ ì‚¬ì´íŠ¸, ë¸”ë¡œê·¸ ë“± ì–´ë–¤ ë§í¬ë“  ë„ì›€ë©ë‹ˆë‹¤
              </div>
            </div>
            
            <div>
              <label class="block text-gray-700 font-semibold mb-2" for="productImage">
                ì œí’ˆ ì´ë¯¸ì§€ (ìµœëŒ€ 5ì¥)
              </label>
              <input type="file" id="productImage" accept="image/*" multiple 
                     class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-400 focus:outline-none transition" />
              <div id="imagePreview" class="mt-2 flex flex-wrap gap-2"></div>
              <div class="text-xs text-emerald-600 mt-1">
                ğŸ’¡ ì œí’ˆ ì‚¬ì§„, ìº¡ì²˜, ì„¤ëª…ì„œ ë“± ì–´ë–¤ ì´ë¯¸ì§€ë“  ë„ì›€ì´ ë©ë‹ˆë‹¤
              </div>
            </div>
          </div>
        </div>

        <!-- ë¹„êµ ì˜µì…˜ -->
        <div class="bg-gray-50 p-4 rounded-lg mb-6">
          <h4 class="font-semibold text-gray-800 mb-3">ğŸ” ë¹„êµ ì˜µì…˜</h4>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <label class="flex items-center p-3 bg-white rounded-lg border border-gray-200 hover:border-blue-300 transition">
              <input type="radio" name="comparisonType" value="exact" checked class="mr-3 text-blue-600">
              <div>
                <div class="font-medium">ì™„ì „ ë™ì¼ë§Œ ë¹„êµ</div>
                <div class="text-xs text-gray-500">ìƒ‰ìƒ, íŒ¨í‚¤ì§•ê¹Œì§€ ì •í™•íˆ ì¼ì¹˜í•˜ëŠ” ì œí’ˆë§Œ</div>
              </div>
            </label>
            <label class="flex items-center p-3 bg-white rounded-lg border border-gray-200 hover:border-blue-300 transition">
              <input type="radio" name="comparisonType" value="flexible" class="mr-3 text-blue-600">
              <div>
                <div class="font-medium">ìƒ‰ìƒÂ·íŒ¨í‚¤ì§• ë¬´ê´€</div>
                <div class="text-xs text-gray-500">ê¸°ëŠ¥ì´ ë™ì¼í•˜ë©´ ìƒ‰ìƒ/íŒ¨í‚¤ì§• ì°¨ì´ í—ˆìš©</div>
              </div>
            </label>
          </div>
        </div>

        <!-- ë™ì˜ ì²´í¬ë°•ìŠ¤ -->
        <div class="space-y-3 mb-6">
          <div class="flex items-start p-3 bg-yellow-50 rounded-lg border border-yellow-200">
            <input type="checkbox" id="evidenceAgree" required class="mt-1 mr-3 w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-400">
            <div class="flex-1">
              <label for="evidenceAgree" class="text-sm text-gray-700">
                <span class="font-semibold text-yellow-800">[í•„ìˆ˜]</span> ì¦ê±° ìˆ˜ì§‘(ë§í¬/ìŠ¤í¬ë¦°ìƒ·)Â·ì‹œì ê³ ì • ì•ˆë‚´ì— ë™ì˜í•©ë‹ˆë‹¤.
                <div class="text-xs text-gray-500 mt-1">ì˜ë¢° ì²˜ë¦¬ ê³¼ì •ì—ì„œ í•„ìš”í•œ ì¦ê±°ìë£Œë¥¼ ìˆ˜ì§‘í•˜ê³  ì‹œì ì„ ê³ ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
              </label>
            </div>
            <button type="button" onclick="showEvidencePopup()" class="ml-3 px-3 py-1 bg-yellow-600 text-white text-xs rounded-lg hover:bg-yellow-700 transition-colors">
              ì•ˆë‚´ì‚¬í•­ ìì„¸íˆë³´ê¸°
            </button>
          </div>
          <div class="flex items-start p-3 bg-pink-50 rounded-lg border border-pink-200">
            <input type="checkbox" id="brandExcludeAgree" required class="mt-1 mr-3 w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-400">
            <div class="flex-1">
              <label for="brandExcludeAgree" class="text-sm text-gray-700">
                <span class="font-semibold text-pink-800">[í•„ìˆ˜]</span> ë¸Œëœë“œë°°ì œ ì •ì±…(ì• í”ŒÂ·ëª…í’ˆÂ·ìŠ¤ë‹ˆì»¤ì¦ˆÂ·ëŒ€í˜•TV ë“±)ì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.
                <div class="text-xs text-gray-500 mt-1">ë¸Œëœë“œ ì œí’ˆì€ ê²€ì¦ì—ì„œ ì œì™¸ë˜ë©°, ì´ì— ë™ì˜í•˜ì‹  ê²½ìš°ì—ë§Œ ì˜ë¢°ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</div>
              </label>
            </div>
            <button type="button" onclick="showBrandPolicyPopup()" class="ml-3 px-3 py-1 bg-pink-600 text-white text-xs rounded-lg hover:bg-pink-700 transition-colors">
              ì•ˆë‚´ì‚¬í•­ ìì„¸íˆë³´ê¸°
            </button>
          </div>
          <div class="flex items-start p-3 bg-blue-50 rounded-lg border border-blue-200">
            <input type="checkbox" id="reviewConsent" class="mt-1 mr-3 w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-400">
            <div class="flex-1">
              <label for="reviewConsent" class="text-sm text-gray-700">
                <span class="font-semibold text-blue-800">[ì„ íƒ]</span> ì´ ì˜ë¢°ê±´ ë°ì´í„°ë¥¼ í›„ê¸°ê²Œì‹œíŒì— ìë™ë“±ë¡ë˜ëŠ” ê²ƒì— ë™ì˜í•©ë‹ˆë‹¤.
                <div class="text-xs text-gray-500 mt-1">ì˜ë¢°ê°€ ì™„ë£Œë˜ë©´ ê´€ë¦¬ìê°€ í›„ê¸°ê²Œì‹œíŒì— ë“±ë¡í•  ìˆ˜ ìˆìœ¼ë©°, ë™ì˜í•˜ì‹œë©´ ìë™ìœ¼ë¡œ ë“±ë¡ë©ë‹ˆë‹¤.</div>
              </label>
            </div>
          </div>
        </div>

        <!-- ë§ˆì´í¬ë¡œì¹´í”¼ -->
        <div class="bg-blue-50 p-4 rounded-lg mb-6 border border-blue-200">
          <div class="text-center">
            <div class="text-blue-800 font-semibold text-lg mb-2">ğŸ’¡ ì „ë¬¸ê°€ê°€ ë” ì €ë ´í•œ ìµœì €ê°€ë¥¼ ì°¾ì•„ë“œë¦½ë‹ˆë‹¤!</div>
            <div class="text-sm text-blue-700">
              ê³ ê°ë‹˜ì´ ì˜ë¢°í•˜ì‹  ì œí’ˆë³´ë‹¤ ë” ì €ë ´í•œ ê°€ê²©ì„ ì°¾ì•„ì„œ ìƒì„¸í•œ ê²€ì¦ ë¦¬í¬íŠ¸ë¥¼ ì œê³µí•´ë“œë¦½ë‹ˆë‹¤.
            </div>
          </div>
        </div>

        <button type="button" class="w-full py-4 bg-gradient-to-r from-blue-500 to-blue-600 text-white font-bold rounded-lg shadow-lg btn-animate text-lg" id="to-step-2">
          ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ë™ â†’
        </button>
      </div>

      <!-- Step 2: ì—°ë½ì²˜ + ìµœì¢…í™•ì¸ í†µí•© -->
      <div class="step step-2-theme hidden" id="step-2">
        <!-- í—¤ë” ì„¹ì…˜ -->
        <div class="mb-6 p-4 rounded-xl bg-emerald-50 border border-emerald-200 text-emerald-800 text-center shadow-sm">
          <div class="text-lg font-bold mb-2">ğŸ“ ì—°ë½ì²˜ í™•ì¸ & ìµœì¢… ê²€í† </div>
          <div class="text-sm text-emerald-700">
            ì •í™•í•œ ì—°ë½ì²˜ë¡œ ê²€ì¦ ê²°ê³¼ë¥¼ ì•ˆë‚´í•´ë“œë¦¬ë©°, ì…ë ¥í•˜ì‹  ëª¨ë“  ì •ë³´ë¥¼ ìµœì¢… í™•ì¸í•´ì£¼ì„¸ìš”
          </div>
        </div>

        <!-- ì—°ë½ì²˜ ì •ë³´ -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
          <div>
            <label class="block text-gray-700 font-semibold mb-2" for="userName">
              ì´ë¦„ <span class="text-red-500">*</span>
            </label>
            <input type="text" id="userName" required 
                   class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-400 focus:outline-none transition input-animate" 
                   placeholder="íšŒì›ê°€ì… ì‹œ ì…ë ¥í•œ ì´ë¦„" />
            <div class="text-xs text-emerald-600 mt-1">
              ğŸ’¡ íšŒì›ê°€ì… ì‹œ ì…ë ¥í•œ ì´ë¦„ê³¼ ë™ì¼í•´ì•¼ í•©ë‹ˆë‹¤
            </div>
          </div>
          
          <div>
            <label class="block text-gray-700 font-semibold mb-2" for="userPhone">
              ì „í™”ë²ˆí˜¸ <span class="text-red-500">*</span>
            </label>
            <input type="tel" id="userPhone" required 
                   class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-400 focus:outline-none transition input-animate" 
                   placeholder="ì˜ˆ: 01012345678" />
            <div class="text-xs text-emerald-600 mt-1">
              ğŸ“± ì •í™•í•œ ì—°ë½ì²˜ë¡œ ê²€ì¦ ê²°ê³¼ë¥¼ ì•ˆë‚´í•´ë“œë¦½ë‹ˆë‹¤
            </div>
          </div>
        </div>

        <div class="mb-6">
          <label class="block text-gray-700 font-semibold mb-2" for="userEmail">
            ì´ë©”ì¼ <span class="text-red-500">*</span>
          </label>
          <input type="email" id="userEmail" required 
                 class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-emerald-400 focus:outline-none transition input-animate" 
                 placeholder="ì˜ˆ: user@email.com" />
          <div class="text-xs text-emerald-600 mt-1">
            ğŸ“§ ê²€ì¦ ê²°ê³¼ ë¦¬í¬íŠ¸ë¥¼ ì´ë©”ì¼ë¡œ ë°œì†¡í•´ë“œë¦½ë‹ˆë‹¤
          </div>
        </div>

        <!-- ì…ë ¥ ì •ë³´ ìš”ì•½ -->
        <div class="bg-gray-50 rounded-xl p-6 mb-6">
          <h4 class="font-bold text-gray-800 mb-4 text-lg">ğŸ“‹ ì…ë ¥í•˜ì‹  ì •ë³´ ìš”ì•½</h4>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm" id="confirm-summary">
            <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
          </div>
        </div>

        <!-- ê°œì¸ì •ë³´ ë™ì˜ -->
        <div class="bg-emerald-50 p-4 rounded-lg mb-6 border border-emerald-200">
          <div class="flex items-start">
            <input type="checkbox" id="privacyAgree" required class="mt-1 mr-3 w-5 h-5 text-emerald-600 border-gray-300 rounded focus:ring-emerald-400">
            <label for="privacyAgree" class="text-sm text-gray-700">
              <span class="font-semibold text-emerald-800">[í•„ìˆ˜]</span> ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš©ì— ë™ì˜í•©ë‹ˆë‹¤.
              <div class="text-xs text-gray-500 mt-1">
                ì…ë ¥í•˜ì‹  ì •ë³´ëŠ” ì˜¤ì§ ì˜ë¢° ì²˜ë¦¬ì™€ ê²€ì¦ ê²°ê³¼ ì•ˆë‚´ë¥¼ ìœ„í•´ì„œë§Œ ì‚¬ìš©ë©ë‹ˆë‹¤. 
                ë™ì˜í•˜ì§€ ì•Šìœ¼ì‹œë©´ ì˜ë¢°ê°€ ì ‘ìˆ˜ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
              </div>
            </label>
          </div>
        </div>

        <!-- ì œì¶œ ë²„íŠ¼ -->
        <button type="submit" class="w-full py-4 bg-gradient-to-r from-emerald-500 to-emerald-600 text-white font-bold rounded-lg shadow-lg btn-animate text-lg" id="submit-btn">
          ğŸš€ ìµœì €ê°€ ê²€ì¦ ì˜ë¢° ì œì¶œí•˜ê¸°
        </button>
        
        <button type="button" class="w-full mt-3 py-2 bg-gray-200 text-gray-700 rounded-lg shadow btn-animate" id="back-step-1">
          â† ì´ì „ ë‹¨ê³„ë¡œ ëŒì•„ê°€ê¸°
        </button>
      </div>
    </form>

    <!-- ì œì¶œ ì„±ê³µ ë©”ì‹œì§€ -->
    <div id="submit-success" class="hidden mt-8 space-y-6">
      <div class="p-6 bg-emerald-50 border border-emerald-200 rounded-xl text-emerald-700 text-center">
        <div class="text-4xl mb-4">âœ…</div>
        <h3 class="text-2xl font-bold mb-2">ì˜ë¢°ê°€ ì •ìƒì ìœ¼ë¡œ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤!</h3>
        <p class="text-lg mb-4">ê²€ì¦ ë¦¬í¬íŠ¸ëŠ” 24-48ì‹œê°„ ë‚´ ì „ë‹¬ë©ë‹ˆë‹¤.</p>
        <div class="bg-white p-4 rounded-lg border border-emerald-200">
          <div class="text-sm text-gray-600 mb-2">ì˜ë¢° ë²ˆí˜¸</div>
          <div class="font-mono text-lg font-bold" id="request-number"></div>
        </div>
      </div>
      
      <!-- ë‹¤ìŒ ë‹¨ê³„ ì•ˆë‚´ -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="p-4 bg-blue-50 border border-blue-200 rounded-lg">
          <h4 class="font-semibold text-blue-800 mb-2">ğŸ“Š í˜„ì¬ ë§ˆì¼“ ìƒí™©</h4>
          <div class="text-sm text-blue-700">
            <p>â€¢ ì¿ í° ë¯¸ì ìš© ê¸°ì¤€ ëŒ€ëµì¹˜</p>
            <p>â€¢ ì •í™•í•œ ê²€ì¦ ê²°ê³¼ëŠ” ë³„ë„ ì•ˆë‚´</p>
          </div>
        </div>
        
        <div class="p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
          <h4 class="font-semibold text-yellow-800 mb-2">ğŸ† ì´ë²ˆ ì£¼ ì ˆê°ì™•</h4>
          <div class="flex items-center gap-3">
            <img src="https://images.unsplash.com/photo-1519125323398-675f0ddb6308?auto=format&fit=crop&w=80&q=80" 
                 alt="ì ˆê°ì™•" class="w-12 h-12 object-cover rounded-lg">
            <div class="flex-1">
              <p class="font-semibold text-sm">ì „ê¸°í¬íŠ¸ 3ë§Œ8ì²œì› ì ˆê°</p>
              <p class="text-xs text-gray-600">-42% ì ˆê° | ê¹€OOë‹˜</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ì¦ê±° ìˆ˜ì§‘ ì•ˆë‚´ íŒì—… -->
  <div id="evidencePopup" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
    <div class="flex items-center justify-center min-h-screen p-4">
      <div class="bg-white rounded-2xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto">
        <div class="p-6">
          <div class="flex items-center justify-between mb-6">
            <h3 class="text-2xl font-bold text-gray-800">ğŸ“‹ ì¦ê±° ìˆ˜ì§‘ ë° ì‹œì ê³ ì • ì•ˆë‚´</h3>
            <button onclick="closeEvidencePopup()" class="text-gray-400 hover:text-gray-600 text-2xl p-2 hover:bg-gray-100 rounded-full transition">&times;</button>
          </div>
          
          <div class="space-y-4 text-sm text-gray-700">
            <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
              <h4 class="font-semibold text-blue-800 mb-2">ğŸ” ì¦ê±° ìˆ˜ì§‘ì´ë€?</h4>
              <p>ìµœì €ê°€ ê²€ì¦ ê³¼ì •ì—ì„œ ì •í™•ì„±ê³¼ ì‹ ë¢°ì„±ì„ ë³´ì¥í•˜ê¸° ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì€ ì¦ê±°ìë£Œë¥¼ ìˆ˜ì§‘í•©ë‹ˆë‹¤:</p>
            </div>
            
            <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
              <h4 class="font-semibold text-yellow-800 mb-2">ğŸ“¸ ìˆ˜ì§‘ë˜ëŠ” ì¦ê±°ìë£Œ</h4>
              <ul class="list-disc list-inside space-y-1">
                <li><strong>ìŠ¤í¬ë¦°ìƒ·:</strong> ê²€ìƒ‰ëœ ì œí’ˆ í˜ì´ì§€, ê°€ê²© ì •ë³´, í• ì¸ ì¿ í° ë“±</li>
                <li><strong>ë§í¬ ì •ë³´:</strong> ì œí’ˆ íŒë§¤ í˜ì´ì§€, ë¦¬ë·° í˜ì´ì§€, ë¹„êµ ì‚¬ì´íŠ¸ ë“±</li>
                <li><strong>ì‹œì  ê¸°ë¡:</strong> ê²€ìƒ‰ ì‹œì , ê°€ê²© ë³€ë™ ì´ë ¥, ì¬ê³  ìƒíƒœ ë“±</li>
                <li><strong>ë©”íƒ€ë°ì´í„°:</strong> ê²€ìƒ‰ ì‹œê°„, ë¸Œë¼ìš°ì € ì •ë³´, ì ‘ì† ì§€ì—­ ë“±</li>
              </ul>
            </div>
            
            <div class="bg-green-50 p-4 rounded-lg border border-green-200">
              <h4 class="font-semibold text-green-800 mb-2">â° ì‹œì ê³ ì •ì˜ ëª©ì </h4>
              <ul class="list-disc list-inside space-y-1">
                <li>ì˜¨ë¼ì¸ ì‡¼í•‘ëª°ì˜ ê°€ê²©ì€ ì‹¤ì‹œê°„ìœ¼ë¡œ ë³€ë™ë©ë‹ˆë‹¤</li>
                <li>ê²€ì¦ ì‹œì ì˜ ì •í™•í•œ ê°€ê²©ì„ ê¸°ë¡í•˜ì—¬ ê³µì •í•œ ë¹„êµë¥¼ ë³´ì¥í•©ë‹ˆë‹¤</li>
                <li>í• ì¸ ì¿ í°, ì´ë²¤íŠ¸ ë“± ì¼ì‹œì  í˜œíƒì˜ ì ìš© ì—¬ë¶€ë¥¼ ëª…í™•íˆ í•©ë‹ˆë‹¤</li>
                <li>ë‚˜ì¤‘ì— ê°€ê²© ë³€ë™ ì‹œ ì°¸ê³ ìë£Œë¡œ í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
              </ul>
            </div>
            
            <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
              <h4 class="font-semibold text-purple-800 mb-2">ğŸ”’ ê°œì¸ì •ë³´ ë³´í˜¸</h4>
              <ul class="list-disc list-inside space-y-1">
                <li>ìˆ˜ì§‘ëœ ì¦ê±°ìë£ŒëŠ” ì˜¤ì§ ìµœì €ê°€ ê²€ì¦ ëª©ì ìœ¼ë¡œë§Œ ì‚¬ìš©ë©ë‹ˆë‹¤</li>
                <li>ê°œì¸ ì‹ë³„ ì •ë³´ëŠ” í¬í•¨í•˜ì§€ ì•Šìœ¼ë©°, ì œí’ˆ ì •ë³´ë§Œ ê¸°ë¡ë©ë‹ˆë‹¤</li>
                <li>ê²€ì¦ ì™„ë£Œ í›„ 30ì¼ê°„ ë³´ê´€ë˜ë©°, ì´í›„ ìë™ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤</li>
                <li>ì œ3ìì—ê²Œ ê³µê°œë˜ê±°ë‚˜ ë‹¤ë¥¸ ìš©ë„ë¡œ ì‚¬ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤</li>
              </ul>
            </div>
            
            <div class="bg-red-50 p-4 rounded-lg border border-red-200">
              <h4 class="font-semibold text-red-800 mb-2">âš ï¸ ë™ì˜í•˜ì§€ ì•Šì„ ê²½ìš°</h4>
              <p>ì¦ê±° ìˆ˜ì§‘ì— ë™ì˜í•˜ì§€ ì•Šìœ¼ì‹œë©´ ì •í™•í•œ ìµœì €ê°€ ê²€ì¦ì´ ì–´ë ¤ì›Œ ì˜ë¢°ê°€ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìµœìƒì˜ ì„œë¹„ìŠ¤ë¥¼ ìœ„í•´ ë™ì˜í•´ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.</p>
            </div>
          </div>
          
          <div class="flex gap-3 mt-6">
            <button onclick="closeEvidencePopup()" class="flex-1 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors font-medium">
              ë‚˜ì¤‘ì— í™•ì¸í•˜ê¸°
            </button>
            <button onclick="agreeEvidence()" class="flex-1 py-3 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors font-medium shadow-lg hover:shadow-xl">
              ë‚´ìš©ì„ í™•ì¸í–ˆìœ¼ë©° ë™ì˜í•©ë‹ˆë‹¤
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ë¸Œëœë“œ ë°°ì œ ì •ì±… íŒì—… -->
  <div id="brandPolicyPopup" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
    <div class="flex items-center justify-center min-h-screen p-4">
      <div class="bg-white rounded-2xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto">
        <div class="p-6">
          <div class="flex items-center justify-between mb-6">
            <h3 class="text-2xl font-bold text-gray-800">ğŸ·ï¸ ë¸Œëœë“œ ë°°ì œ ì •ì±… ì•ˆë‚´</h3>
            <button onclick="closeBrandPolicyPopup()" class="text-gray-400 hover:text-gray-600 text-2xl p-2 hover:bg-gray-100 rounded-full transition">&times;</button>
          </div>
          
          <div class="space-y-4 text-sm text-gray-700">
            <div class="bg-pink-50 p-4 rounded-lg border border-pink-200">
              <h4 class="font-semibold text-pink-800 mb-2">âŒ ê²€ì¦ ì œì™¸ ë¸Œëœë“œ</h4>
              <p class="mb-3">ë‹¤ìŒ ë¸Œëœë“œì˜ ì œí’ˆì€ ìµœì €ê°€ ê²€ì¦ì—ì„œ ì œì™¸ë©ë‹ˆë‹¤:</p>
              <div class="grid grid-cols-2 gap-2">
                <div class="bg-white p-3 rounded border">
                  <strong>ì „ìì œí’ˆ:</strong><br>
                  â€¢ Apple (ì•„ì´í°, ì•„ì´íŒ¨ë“œ, ë§¥ë¶ ë“±)<br>
                  â€¢ Samsung (ê°¤ëŸ­ì‹œ, TV, ê°€ì „ì œí’ˆ)<br>
                  â€¢ LG (TV, ê°€ì „ì œí’ˆ, ëª¨ë‹ˆí„°)<br>
                  â€¢ Sony, Panasonic ë“±
                </div>
                <div class="bg-white p-3 rounded border">
                  <strong>íŒ¨ì…˜/ì•¡ì„¸ì„œë¦¬:</strong><br>
                  â€¢ ëª…í’ˆ ë¸Œëœë“œ (ë£¨ì´ë¹„í†µ, ìƒ¤ë„¬ ë“±)<br>
                  â€¢ ìŠ¤ë‹ˆì»¤ì¦ˆ (ë‚˜ì´í‚¤, ì•„ë””ë‹¤ìŠ¤ ë“±)<br>
                  â€¢ ì‹œê³„ (ë¡¤ë ‰ìŠ¤, ì˜¤ë©”ê°€ ë“±)<br>
                  â€¢ ê°€ë°©, ì§€ê°‘ ë“±
                </div>
              </div>
            </div>
            
            <div class="bg-orange-50 p-4 rounded-lg border border-orange-200">
              <h4 class="font-semibold text-orange-800 mb-2">ğŸ“º ëŒ€í˜• TV ì œì™¸ ì‚¬ìœ </h4>
              <ul class="list-disc list-inside space-y-1">
                <li>ëŒ€í˜• TVëŠ” ëª¨ë¸ëª…ì´ ë³µì¡í•˜ê³  ì˜µì…˜(ì¸ì¹˜, í•´ìƒë„, ê¸°ëŠ¥)ì´ ë‹¤ì–‘í•©ë‹ˆë‹¤</li>
                <li>ì •í™•í•œ ëª¨ë¸ ë¹„êµë¥¼ ìœ„í•´ì„œëŠ” ë§¤ìš° ìƒì„¸í•œ ì •ë³´ê°€ í•„ìš”í•©ë‹ˆë‹¤</li>
                <li>ê°€ê²© ë³€ë™ì´ ì‹¬í•˜ê³  í”„ë¡œëª¨ì…˜ ì •ì±…ì´ ë³µì¡í•©ë‹ˆë‹¤</li>
                <li>ë°°ì†¡ë¹„, ì„¤ì¹˜ë¹„ ë“± ì¶”ê°€ ë¹„ìš©ì´ ë§ì´ ë°œìƒí•©ë‹ˆë‹¤</li>
              </ul>
            </div>
            
            <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
              <h4 class="font-semibold text-blue-800 mb-2">âœ… ê²€ì¦ ê°€ëŠ¥í•œ ì œí’ˆ</h4>
              <ul class="list-disc list-inside space-y-1">
                <li><strong>ìƒí™œìš©í’ˆ:</strong> ìº í•‘ìš©í’ˆ, ì£¼ë°©ìš©í’ˆ, ìš•ì‹¤ìš©í’ˆ, ì²­ì†Œìš©í’ˆ</li>
                <li><strong>ê°€êµ¬:</strong> ì±…ìƒ, ì˜ì, ì„ ë°˜, ì˜·ì¥ (ë¸Œëœë“œ ë¬´ê´€)</li>
                <li><strong>ì˜ë¥˜:</strong> ê¸°ë³¸ ì˜ë¥˜, ì†ì˜·, ì–‘ë§ (ë¸Œëœë“œ ë¬´ê´€)</li>
                <li><strong>ê¸°íƒ€:</strong> ë¬¸êµ¬ìš©í’ˆ, ì¸í…Œë¦¬ì–´ ì†Œí’ˆ, ìš´ë™ìš©í’ˆ</li>
              </ul>
            </div>
            
            <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
              <h4 class="font-semibold text-yellow-800 mb-2">ğŸ¤” ë¸Œëœë“œ ë°°ì œ ì´ìœ </h4>
              <ul class="list-disc list-inside space-y-1">
                <li><strong>ê°€ê²© ë³€ë™ì„±:</strong> ë¸Œëœë“œ ì œí’ˆì€ ê°€ê²© ë³€ë™ì´ ë§¤ìš° ì‹¬í•©ë‹ˆë‹¤</li>
                <li><strong>ì •í™•ì„± í•œê³„:</strong> ëª¨ë¸ëª…, ì˜µì…˜ì— ë”°ë¥¸ ë¯¸ì„¸í•œ ì°¨ì´ë¡œ ë¹„êµê°€ ì–´ë µìŠµë‹ˆë‹¤</li>
                <li><strong>í”„ë¡œëª¨ì…˜ ë³µì¡ì„±:</strong> ë‹¤ì–‘í•œ í• ì¸, ì¿ í°, ì´ë²¤íŠ¸ë¡œ ì¼ê´€ëœ ë¹„êµê°€ ì–´ë µìŠµë‹ˆë‹¤</li>
                <li><strong>ì„œë¹„ìŠ¤ í’ˆì§ˆ:</strong> ë¸Œëœë“œ ì œí’ˆë³´ë‹¤ ì¼ë°˜ ì œí’ˆì—ì„œ ë” í° ì ˆì•½ íš¨ê³¼ë¥¼ ê¸°ëŒ€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
              </ul>
            </div>
            
            <div class="bg-green-50 p-4 rounded-lg border border-green-200">
              <h4 class="font-semibold text-green-800 mb-2">ğŸ’¡ ì¶”ì²œ ì˜ë¢° ë°©ë²•</h4>
              <ul class="list-disc list-inside space-y-1">
                <li>ë¸Œëœë“œë³´ë‹¤ëŠ” <strong>ê¸°ëŠ¥ê³¼ ìš©ë„</strong>ì— ì§‘ì¤‘í•´ì„œ ì˜ë¢°í•˜ì„¸ìš”</li>
                <li>ì˜ˆ: "ì•„ì´í°" ëŒ€ì‹  "ìŠ¤ë§ˆíŠ¸í° ì¶©ì „ê¸°, 20W, USB-C"</li>
                <li>ì˜ˆ: "ë‚˜ì´í‚¤ ìš´ë™í™”" ëŒ€ì‹  "ìš´ë™í™”, í™”ì´íŠ¸, 270mm"</li>
                <li>êµ¬ì²´ì ì¸ ìŠ¤í™ê³¼ ìš©ë„ë¥¼ ëª…ì‹œí•˜ë©´ ë” ì •í™•í•œ ê²€ì¦ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤</li>
              </ul>
            </div>
            
            <div class="bg-red-50 p-4 rounded-lg border border-red-200">
              <h4 class="font-semibold text-red-800 mb-2">âš ï¸ ë¸Œëœë“œ ì œí’ˆ ì˜ë¢° ì‹œ</h4>
              <p>ë¸Œëœë“œ ì œí’ˆì„ ì˜ë¢°í•˜ì‹  ê²½ìš° ê²€ì¦ì´ ì œí•œë˜ê±°ë‚˜ ê±°ë¶€ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ì— ë™ì˜í•˜ì‹œëŠ” ê²½ìš°ì—ë§Œ ì˜ë¢°ë¥¼ ì§„í–‰í•´ ì£¼ì„¸ìš”.</p>
            </div>
          </div>
          
          <div class="flex gap-3 mt-6">
            <button onclick="closeBrandPolicyPopup()" class="flex-1 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors font-medium">
              ë‚˜ì¤‘ì— í™•ì¸í•˜ê¸°
            </button>
            <button onclick="agreeBrandPolicy()" class="flex-1 py-3 bg-pink-600 text-white rounded-lg hover:bg-pink-700 transition-colors font-medium shadow-lg hover:shadow-xl">
              ë‚´ìš©ì„ í™•ì¸í–ˆìœ¼ë©° ë™ì˜í•©ë‹ˆë‹¤
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // íŒì—…ì°½ ì œì–´ í•¨ìˆ˜ë“¤
    function showEvidencePopup() {
      const popup = document.getElementById('evidencePopup');
      popup.classList.remove('hidden');
      popup.classList.add('popup-enter');
      document.body.style.overflow = 'hidden'; // ë°°ê²½ ìŠ¤í¬ë¡¤ ë°©ì§€
    }

    function closeEvidencePopup() {
      const popup = document.getElementById('evidencePopup');
      popup.classList.add('popup-exit');
      setTimeout(() => {
        popup.classList.add('hidden');
        popup.classList.remove('popup-enter', 'popup-exit');
      }, 300);
      document.body.style.overflow = 'auto'; // ë°°ê²½ ìŠ¤í¬ë¡¤ ë³µì›
    }

    function agreeEvidence() {
      document.getElementById('evidenceAgree').checked = true;
      closeEvidencePopup();
      
      // ë™ì˜ ì™„ë£Œ ì‹œê°ì  í”¼ë“œë°±
      const checkbox = document.getElementById('evidenceAgree');
      const container = checkbox.parentElement.parentElement;
      container.classList.add('bg-green-50', 'border-green-200');
      container.classList.remove('bg-yellow-50', 'border-yellow-200');
      
      // ì²´í¬ë°•ìŠ¤ í…ìŠ¤íŠ¸ ìƒ‰ìƒ ë³€ê²½
      const label = checkbox.parentElement.querySelector('label');
      label.classList.add('text-green-700');
      label.classList.remove('text-gray-700');
    }

    function showBrandPolicyPopup() {
      const popup = document.getElementById('brandPolicyPopup');
      popup.classList.remove('hidden');
      popup.classList.add('popup-enter');
      document.body.style.overflow = 'hidden'; // ë°°ê²½ ìŠ¤í¬ë¡¤ ë°©ì§€
    }

    function closeBrandPolicyPopup() {
      const popup = document.getElementById('brandPolicyPopup');
      popup.classList.add('popup-exit');
      setTimeout(() => {
        popup.classList.add('hidden');
        popup.classList.remove('popup-enter', 'popup-exit');
      }, 300);
      document.body.style.overflow = 'auto'; // ë°°ê²½ ìŠ¤í¬ë¡¤ ë³µì›
    }

    function agreeBrandPolicy() {
      document.getElementById('brandExcludeAgree').checked = true;
      closeBrandPolicyPopup();
      
      // ë™ì˜ ì™„ë£Œ ì‹œê°ì  í”¼ë“œë°±
      const checkbox = document.getElementById('brandExcludeAgree');
      const container = checkbox.parentElement.parentElement;
      container.classList.add('bg-green-50', 'border-green-200');
      container.classList.remove('bg-pink-50', 'border-pink-200');
      
      // ì²´í¬ë°•ìŠ¤ í…ìŠ¤íŠ¸ ìƒ‰ìƒ ë³€ê²½
      const label = checkbox.parentElement.querySelector('label');
      label.classList.add('text-green-700');
      label.classList.remove('text-gray-700');
    }

    // ESC í‚¤ë¡œ íŒì—… ë‹«ê¸°
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape') {
        closeEvidencePopup();
        closeBrandPolicyPopup();
      }
    });

    // íŒì—… ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
    document.addEventListener('click', function(event) {
      if (event.target.id === 'evidencePopup') {
        closeEvidencePopup();
      }
      if (event.target.id === 'brandPolicyPopup') {
        closeBrandPolicyPopup();
      }
    });

    // ìŠ¤ë§ˆíŠ¸ ì´ë¯¸ì§€ ì••ì¶• í•¨ìˆ˜
    function compressImage(file, targetSizeKB = 500) {
      return new Promise((resolve, reject) => {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        const img = new Image();
        
        img.onload = function() {
          let { width, height } = img;
          let quality = 0.8;
          let maxWidth = 1200;
          
          if (width > maxWidth) {
            height = (height * maxWidth) / width;
            width = maxWidth;
          }
          
          canvas.width = width;
          canvas.height = height;
          ctx.drawImage(img, 0, 0, width, height);
          
          const checkSize = (q) => {
            const dataUrl = canvas.toDataURL('image/jpeg', q);
            const sizeKB = (dataUrl.length * 0.75) / 1024;
            
            if (sizeKB > targetSizeKB && q > 0.1) {
              return checkSize(q - 0.1);
            } else if (sizeKB > targetSizeKB && width > 400) {
              width = width * 0.8;
              height = height * 0.8;
              canvas.width = width;
              canvas.height = height;
              ctx.drawImage(img, 0, 0, width, height);
              return checkSize(0.8);
            } else {
              return dataUrl;
            }
          };
          
          const finalDataUrl = checkSize(quality);
          resolve(finalDataUrl);
        };
        
        img.onerror = reject;
        img.src = URL.createObjectURL(file);
      });
    }

    // ìŠ¤í… ê´€ë¦¬
    let currentStep = 1;
    const steps = [1, 2];
    
    function showStep(n) {
      console.log(`showStep(${n}) í˜¸ì¶œë¨`);
      steps.forEach(s => {
        const el = document.getElementById(`step-${s}`);
        if (el) {
          el.classList.toggle('hidden', s !== n);
        }
        const dot = document.getElementById(`step-${s}-dot`);
        if (dot) {
          dot.className = `w-12 h-12 md:w-14 md:h-14 rounded-full flex items-center justify-center font-bold text-white stepper-dot stepper-dot-animate text-lg md:text-xl${s === n ? ' stepper-dot-active' : ''}`;
        }
        if (s === n) {
          el.classList.remove('fadein-step');
          el.classList.add('fadein-step');
        }
      });
      currentStep = n;
      console.log(`í˜„ì¬ ë‹¨ê³„: ${currentStep}`);
    }
    
    showStep(1);

    // Step 1 â†’ Step 2 ì´ë™
    document.getElementById('to-step-2').onclick = function() {
      console.log('ë‹¤ìŒ ë²„íŠ¼ í´ë¦­ë¨');
      
      // Step 1 ìœ íš¨ì„± ê²€ì‚¬
      if (!document.getElementById('productName').value.trim()) {
        alert('ì œí’ˆëª…ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
        document.getElementById('productName').focus();
        return;
      }
      
      if (!document.getElementById('productDesc').value.trim()) {
        alert('ì œí’ˆ ì„¤ëª…ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
        document.getElementById('productDesc').focus();
        return;
      }
      
      const price = Number(document.getElementById('productPrice').value);
      if (isNaN(price) || price < 1000) {
        alert('ìµœì†Œ ì˜ë¢° ê¸ˆì•¡ì€ 1,000ì› ì´ìƒì…ë‹ˆë‹¤. ë” ì €ë ´í•œ ì œí’ˆì€ ì˜ë¢°ê°€ ì–´ë µìŠµë‹ˆë‹¤.');
        document.getElementById('productPrice').focus();
        return;
      }
      
      if (!document.getElementById('evidenceAgree').checked) {
        alert('ì¦ê±° ìˆ˜ì§‘ ì•ˆë‚´ì— ë™ì˜í•´ ì£¼ì„¸ìš”.');
        return;
      }
      
      if (!document.getElementById('brandExcludeAgree').checked) {
        alert('ë¸Œëœë“œ ë°°ì œ ì •ì±…ì— ë™ì˜í•´ ì£¼ì„¸ìš”.');
        return;
      }
      
      // ì°¸ê³ ì‚¬ì´íŠ¸ URL ìœ íš¨ì„± ê²€ì‚¬ (ì…ë ¥ëœ ê²½ìš°ì—ë§Œ)
      const url = document.getElementById('productUrl').value.trim();
      if (url) {
        const urlPattern = /^(https?:\/\/)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)$/;
        if (!urlPattern.test(url)) {
          alert('ì°¸ê³ ì‚¬ì´íŠ¸ëŠ” http://, https://, ë˜ëŠ” www.ë¡œ ì‹œì‘í•˜ëŠ” ì˜¬ë°”ë¥¸ ë§í¬ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
          document.getElementById('productUrl').focus();
          return;
        }
      }
      
      console.log('ìœ íš¨ì„± ê²€ì‚¬ í†µê³¼, showStep(2) í˜¸ì¶œ');
      showStep(2);
    };

    // Step 2 â†’ Step 1 ì´ë™
    document.getElementById('back-step-1').onclick = function() { 
      showStep(1); 
    };

    // ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° ë° ìµœëŒ€ 5ì¥ ì œí•œ
    const imageInput = document.getElementById('productImage');
    const imagePreview = document.getElementById('imagePreview');
    let imageFiles = [];
    
    if (imageInput) {
      imageInput.addEventListener('change', function(event) {
        const files = Array.from(event.target.files);
        if (files.length + imageFiles.length > 5) {
          alert('ì´ë¯¸ì§€ëŠ” ìµœëŒ€ 5ì¥ê¹Œì§€ ì²¨ë¶€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
          imageInput.value = '';
          return;
        }
        files.forEach(file => {
          if (imageFiles.length < 5) {
            imageFiles.push(file);
          }
        });
        renderImagePreview();
        imageInput.value = '';
      });
    }
    
    function renderImagePreview() {
      imagePreview.innerHTML = '';
      imageFiles.forEach((file, idx) => {
        const reader = new FileReader();
        reader.onload = function(e) {
          const wrapper = document.createElement('div');
          wrapper.className = 'relative';
          wrapper.innerHTML = `
            <img src="${e.target.result}" alt="ë¯¸ë¦¬ë³´ê¸°" class="w-20 h-20 object-cover rounded-lg shadow-md border border-gray-200" />
            <button type="button" class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hover:bg-red-600 transition" data-idx="${idx}">&times;</button>
          `;
          imagePreview.appendChild(wrapper);
          wrapper.querySelector('button').onclick = function() {
            imageFiles.splice(idx, 1);
            renderImagePreview();
          };
        };
        reader.readAsDataURL(file);
      });
    }

    // Step 2: í™•ì¸ ìš”ì•½ ë Œë”ë§
    function renderConfirmSummary() {
      const productName = document.getElementById('productName').value;
      const productDesc = document.getElementById('productDesc').value;
      const productUrl = document.getElementById('productUrl').value.trim();
      const price = document.getElementById('productPrice').value;
      const comparisonType = document.querySelector('input[name="comparisonType"]:checked').value;
      
      const summary = `
        <div class="bg-white p-3 rounded-lg border border-gray-200">
          <div class="font-semibold text-gray-800 mb-1">ì œí’ˆëª…</div>
          <div class="text-gray-600">${productName}</div>
        </div>
        <div class="bg-white p-3 rounded-lg border border-gray-200">
          <div class="font-semibold text-gray-800 mb-1">ì˜ˆìƒ ê°€ê²©</div>
          <div class="text-gray-600">${price ? price.toLocaleString() + 'ì›' : '(ë¯¸ì…ë ¥)'}</div>
        </div>
        <div class="bg-white p-3 rounded-lg border border-gray-200">
          <div class="font-semibold text-gray-800 mb-1">ì°¸ê³ ì‚¬ì´íŠ¸</div>
          <div class="text-gray-600">
            ${productUrl ? 
              (productUrl.startsWith('http') ? 
                `<a href='${productUrl}' target='_blank' class='text-blue-600 underline break-all'>${productUrl}</a>` : 
                `<span class='bg-gray-100 rounded px-2 py-1 break-all'>${productUrl}</span>`) : 
              '<span class="text-gray-400">(ì—†ìŒ)</span>'}
          </div>
        </div>
        <div class="bg-white p-3 rounded-lg border border-gray-200">
          <div class="font-semibold text-gray-800 mb-1">ë¹„êµ ì˜µì…˜</div>
          <div class="text-gray-600">${comparisonType === 'exact' ? 'ì™„ì „ ë™ì¼ë§Œ ë¹„êµ' : 'ìƒ‰ìƒÂ·íŒ¨í‚¤ì§• ë¬´ê´€ í—ˆìš©'}</div>
        </div>
        <div class="bg-white p-3 rounded-lg border border-gray-200">
          <div class="font-semibold text-gray-800 mb-1">ì´ë¦„</div>
          <div class="text-gray-600">${document.getElementById('userName').value}</div>
        </div>
        <div class="bg-white p-3 rounded-lg border border-gray-200">
          <div class="font-semibold text-gray-800 mb-1">ì „í™”ë²ˆí˜¸</div>
          <div class="text-gray-600">${document.getElementById('userPhone').value}</div>
        </div>
        <div class="bg-white p-3 rounded-lg border border-gray-200">
          <div class="font-semibold text-gray-800 mb-1">ì´ë©”ì¼</div>
          <div class="text-gray-600">${document.getElementById('userEmail').value}</div>
        </div>
        <div class="bg-white p-3 rounded-lg border border-gray-200">
          <div class="font-semibold text-gray-800 mb-1">ì²¨ë¶€ ì´ë¯¸ì§€</div>
          <div class="text-gray-600" id='confirm-images'>${imageFiles.length}ì¥</div>
        </div>
      `;
      document.getElementById('confirm-summary').innerHTML = summary;
      
      // ì´ë¯¸ì§€ ì¸ë„¤ì¼ ë Œë”ë§
      const imgWrap = document.getElementById('confirm-images');
      if (imageFiles.length > 0) {
        imgWrap.innerHTML = '';
        imageFiles.forEach(file => {
          const reader = new FileReader();
          reader.onload = function(e) {
            const img = document.createElement('img');
            img.src = e.target.result;
            img.className = 'inline-block h-8 w-8 object-cover rounded border border-gray-200 shadow-sm align-middle mr-1';
            imgWrap.appendChild(img);
          };
          reader.readAsDataURL(file);
        });
      } else {
        imgWrap.innerHTML = '<span class="text-gray-400">(ì—†ìŒ)</span>';
      }
    }
    
    // Step 2ë¡œ ì´ë™í•  ë•Œ ìš”ì•½ ë Œë”ë§
    document.getElementById('to-step-2').onclick = function() {
      // ê¸°ì¡´ ìœ íš¨ì„± ê²€ì‚¬...
      if (!document.getElementById('productName').value.trim()) {
        alert('ì œí’ˆëª…ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
        document.getElementById('productName').focus();
        return;
      }
      
      if (!document.getElementById('productDesc').value.trim()) {
        alert('ì œí’ˆ ì„¤ëª…ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
        document.getElementById('productDesc').focus();
        return;
      }
      
      const price = Number(document.getElementById('productPrice').value);
      if (isNaN(price) || price < 1000) {
        alert('ìµœì†Œ ì˜ë¢° ê¸ˆì•¡ì€ 1,000ì› ì´ìƒì…ë‹ˆë‹¤. ë” ì €ë ´í•œ ì œí’ˆì€ ì˜ë¢°ê°€ ì–´ë µìŠµë‹ˆë‹¤.');
        document.getElementById('productPrice').focus();
        return;
      }
      
      if (!document.getElementById('evidenceAgree').checked) {
        alert('ì¦ê±° ìˆ˜ì§‘ ì•ˆë‚´ì— ë™ì˜í•´ ì£¼ì„¸ìš”.');
        return;
      }
      
      if (!document.getElementById('brandExcludeAgree').checked) {
        alert('ë¸Œëœë“œ ë°°ì œ ì •ì±…ì— ë™ì˜í•´ ì£¼ì„¸ìš”.');
        return;
      }
      
      const url = document.getElementById('productUrl').value.trim();
      if (url) {
        const urlPattern = /^(https?:\/\/)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)$/;
        if (!urlPattern.test(url)) {
          alert('ì°¸ê³ ì‚¬ì´íŠ¸ëŠ” http://, https://, ë˜ëŠ” www.ë¡œ ì‹œì‘í•˜ëŠ” ì˜¬ë°”ë¥¸ ë§í¬ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
          document.getElementById('productUrl').focus();
          return;
        }
      }
      
      renderConfirmSummary();
      showStep(2);
    };
    
    // Firebaseì—ì„œ ì˜ë¢° ìƒíƒœ ì—…ë°ì´íŠ¸
    async function updateRequestStatus(reqNum, newStatus, newDetail, newProgress) {
      try {
        await waitForFirebase();
        const { collection, query, where, getDocs, updateDoc } = window.firebaseFirestoreFunctions;
        const db = window.firebaseDb;
        
        const requestsRef = collection(db, 'requests');
        const q = query(requestsRef, where('requestNumber', '==', reqNum));
        const querySnapshot = await getDocs(q);
        
        if (!querySnapshot.empty) {
          const doc = querySnapshot.docs[0];
          await updateDoc(doc.ref, {
            status: newStatus,
            statusDetail: newDetail,
            progress: newProgress,
            lastUpdated: new Date()
          });
          
          if (Notification.permission === 'granted') {
            new Notification('PriceHunter ì˜ë¢° ìƒíƒœ ì—…ë°ì´íŠ¸', {
              body: `${newStatus}: ${newDetail}`,
              icon: '/favicon.ico'
            });
          }
          
          console.log(`ì˜ë¢° #${reqNum} ìƒíƒœ ì—…ë°ì´íŠ¸:`, newStatus);
          return true;
        }
      } catch (error) {
        console.error('ì˜ë¢° ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
      }
      return false;
    }
    
    // í¼ ì œì¶œ
    document.getElementById('step-form').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      if (!document.getElementById('privacyAgree').checked) {
        alert('ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš©ì— ë™ì˜í•˜ì…”ì•¼ ì œì¶œì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
        return;
      }
      
      // Step 2 ìœ íš¨ì„± ê²€ì‚¬
      if (!document.getElementById('userName').value.trim() || 
          !document.getElementById('userPhone').value.trim() || 
          !document.getElementById('userEmail').value.trim()) {
        alert('ì—°ë½ì²˜ ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
        return;
      }
      
      // ì´ë¦„ ì¼ì¹˜ ê²€ì¦ (Firebaseì—ì„œ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°)
      let user = null;
      try {
        await waitForFirebase();
        const { collection, query, where, getDocs } = window.firebaseFirestoreFunctions;
        const db = window.firebaseDb;
        
        const loggedInEmail = localStorage.getItem('loggedInEmail');
        if (loggedInEmail) {
          const usersRef = collection(db, 'users');
          const q = query(usersRef, where('email', '==', loggedInEmail));
          const querySnapshot = await getDocs(q);
          
          if (!querySnapshot.empty) {
            user = querySnapshot.docs[0].data();
          }
        }
      } catch (error) {
        console.error('ì‚¬ìš©ì ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', error);
      }
      
      const userName = document.getElementById('userName').value.trim();
      if (!user || !user.name || user.name.trim() !== userName) {
        alert('íšŒì›ê°€ì… ì‹œ ì…ë ¥í•œ ì´ë¦„ê³¼ ë™ì¼í•˜ê²Œ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.');
        return;
      }
      
      // ì°¸ê³ ì‚¬ì´íŠ¸ URL ìœ íš¨ì„± ê²€ì‚¬ (ì…ë ¥ëœ ê²½ìš°ì—ë§Œ)
      const url = document.getElementById('productUrl').value.trim();
      if (url) {
        const urlPattern = /^(https?:\/\/)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)$/;
        if (!urlPattern.test(url)) {
          alert('ì°¸ê³ ì‚¬ì´íŠ¸ëŠ” http://, https://, ë˜ëŠ” www.ë¡œ ì‹œì‘í•˜ëŠ” ì˜¬ë°”ë¥¸ ë§í¬ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
          return;
        }
      }
      
      // ì´ë¯¸ì§€ ì´ ìš©ëŸ‰ ì²´í¬ (5MB ì œí•œ)
      function getTotalImageSize(files) {
        return files.reduce((sum, file) => sum + file.size, 0);
      }
      if (getTotalImageSize(imageFiles) > 5 * 1024 * 1024) {
        alert('ì²¨ë¶€í•œ ì´ë¯¸ì§€ì˜ ì´ ìš©ëŸ‰ì´ 5MBë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤. ë” ì‘ì€ ì´ë¯¸ì§€ë¡œ ì²¨ë¶€í•´ ì£¼ì„¸ìš”.');
        return;
      }
      
      // í•˜ë£¨ 10ê±´ ì œí•œ
      const today = new Date().toISOString().slice(0,10);
      const userId = user && user.email ? user.email : userName;
      const reqCount = 0; // Firebaseì—ì„œ ì¹´ìš´íŠ¸ í™•ì¸ ì˜ˆì •
      if (reqCount >= 10) {
        alert('í•˜ë£¨ ìµœëŒ€ 10ê±´ê¹Œì§€ë§Œ ì˜ë¢°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‚´ì¼ ë‹¤ì‹œ ì´ìš©í•´ ì£¼ì„¸ìš”!');
        return;
      }
      
      // ì…ë ¥ê°’ ìˆ˜ì§‘
      const name = document.getElementById('productName').value;
      const desc = document.getElementById('productDesc').value;
      const urls = url ? [url] : [];
      const email = document.getElementById('userEmail').value;
      const phone = document.getElementById('userPhone').value;
      const price = Number(document.getElementById('productPrice').value);
      
      // ê³ ìœ  ì˜ë¢°ë²ˆí˜¸ ìƒì„±
      function generateReqNum() {
        const now = new Date();
        const y = now.getFullYear();
        const m = String(now.getMonth()+1).padStart(2,'0');
        const d = String(now.getDate()).padStart(2,'0');
        const rand = String(Math.floor(Math.random()*900)+100);
        return `#PH-${y}${m}${d}${rand}`;
      }
      const reqNum = generateReqNum();
      
      // ì´ë¯¸ì§€ ì••ì¶• ë° ì €ì¥
      if (imageFiles.length > 0) {
        const submitBtn = document.querySelector('button[type="submit"]');
        if (submitBtn) {
          submitBtn.disabled = true;
          submitBtn.textContent = `ì´ë¯¸ì§€ ì••ì¶• ì¤‘... (0/${imageFiles.length})`;
        }
        
        const imgArr = [];
        let loaded = 0;
        imageFiles.forEach((file, idx) => {
          compressImage(file, 500).then(compressedDataUrl => {
            imgArr[idx] = compressedDataUrl;
            loaded++;
            
            if (submitBtn) {
              submitBtn.textContent = `ì´ë¯¸ì§€ ì••ì¶• ì¤‘... (${loaded}/${imageFiles.length})`;
            }
            
            if (loaded === imageFiles.length) {
              if (submitBtn) {
                submitBtn.textContent = 'ì˜ë¢° ì œì¶œ ì¤‘...';
              }
              saveRequest(imgArr, reqNum);
            }
          }).catch(error => {
            console.error('ì´ë¯¸ì§€ ì••ì¶• ì‹¤íŒ¨:', error);
            compressImage(file, 200).then(compressedDataUrl => {
              imgArr[idx] = compressedDataUrl;
              loaded++;
              if (loaded === imageFiles.length) {
                saveRequest(imgArr, reqNum);
              }
            }).catch(error2 => {
              console.error('ê°•í•œ ì••ì¶•ë„ ì‹¤íŒ¨:', error2);
              const reader = new FileReader();
              reader.onload = function(e2) {
                imgArr[idx] = e2.target.result;
                loaded++;
                if (loaded === imageFiles.length) {
                  saveRequest(imgArr, reqNum);
                }
              };
              reader.readAsDataURL(file);
            });
          });
        });
      } else {
        saveRequest([], reqNum);
      }
      
      async function saveRequest(imgArr, reqNum) {
        // ì´ë¯¸ì§€ ë°ì´í„° í¬ê¸° í™•ì¸ ë° ì œí•œ
        let processedImages = [];
        if (imgArr && imgArr.length > 0) {
          processedImages = imgArr.filter(imgData => {
            if (imgData && imgData.length > 1000000) {
              console.warn('ì´ë¯¸ì§€ ë°ì´í„°ê°€ Firebase ì œí•œ(1MB)ì„ ì´ˆê³¼í•©ë‹ˆë‹¤. ì œì™¸í•©ë‹ˆë‹¤.');
              return false;
            }
            return true;
          });
        }
        
        if (imgArr && imgArr.length > 0 && processedImages.length === 0) {
          console.warn('ëª¨ë“  ì´ë¯¸ì§€ê°€ Firebase í¬ê¸° ì œí•œìœ¼ë¡œ ì¸í•´ ì œì™¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
        
        const reqData = {
          name, 
          desc, 
          urls, 
          images: processedImages, 
          email, 
          phone, 
          price, 
          userName, 
          date: Date.now(),
          reqNum: reqNum,
          status: 'ì ‘ìˆ˜ë¨',
          statusDetail: 'ì˜ë¢°ê°€ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤. ê²€ìƒ‰ì„ ì‹œì‘í•©ë‹ˆë‹¤.',
          estimatedTime: '2-3ì¼ ë‚´ ì™„ë£Œ ì˜ˆì •',
          lastUpdated: Date.now(),
          progress: 10,
          reviewConsent: document.getElementById('reviewConsent').checked || false
        };
        
        try {
          await saveRequestToFirebase(reqData, reqNum);
          
          // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
          document.getElementById('submit-success').classList.remove('hidden');
          document.getElementById('request-number').textContent = reqNum;
          
          // í¬ì¸íŠ¸ ì§€ê¸‰ (ì˜ë¢° ì ‘ìˆ˜ ì‹œ)
          if (user && user.email) {
            console.log('Firebase í¬ì¸íŠ¸ ì‹œìŠ¤í…œ ì‚¬ìš© ì˜ˆì •');
          }
          
          setTimeout(() => { 
            window.location.href = 'request-complete.html'; 
          }, 2000);
          
          console.log('ì˜ë¢° ì¹´ìš´íŠ¸ ì¦ê°€:', reqCount + 1);
        } catch (error) {
          console.error('ì˜ë¢° ì €ì¥ ì‹¤íŒ¨:', error);
          alert('ì˜ë¢° ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ìºì‹œë¥¼ ì •ë¦¬í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
        }
      }
    });
    
    // Firebaseì— ì˜ë¢° ë°ì´í„° ì €ì¥
    async function saveRequestToFirebase(reqData, reqNum) {
      try {
        await waitForFirebase();
        
        const { collection, addDoc, serverTimestamp } = window.firebaseFirestoreFunctions;
        const db = window.firebaseDb;
        
        const firebaseData = {
          ...reqData,
          requestNumber: reqNum,
          createdAt: serverTimestamp(),
          status: 'pending',
          source: 'web_form'
        };
        
        const docRef = await addDoc(collection(db, 'requests'), firebaseData);
        console.log('âœ… Firebaseì— ì˜ë¢° ë°ì´í„° ì €ì¥ ì™„ë£Œ:', docRef.id);
        
        return docRef.id;
      } catch (error) {
        console.error('âŒ Firebaseì— ì˜ë¢° ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:', error);
        throw error;
      }
    }
    
    // Firebase ì´ˆê¸°í™” ëŒ€ê¸° í•¨ìˆ˜
    async function waitForFirebase() {
      return new Promise((resolve, reject) => {
        console.log('ğŸ”„ Firebase ì´ˆê¸°í™” ìƒíƒœ í™•ì¸:', {
          firebaseApp: !!window.firebaseApp,
          firebaseDb: !!window.firebaseDb,
          firebaseFirestoreFunctions: !!window.firebaseFirestoreFunctions
        });
        
        if (window.firebaseApp && window.firebaseDb && window.firebaseFirestoreFunctions) {
          console.log('âœ… Firebase ì´ˆê¸°í™” ì™„ë£Œ');
          resolve();
        } else {
          const checkInterval = setInterval(() => {
            if (window.firebaseApp && window.firebaseDb && window.firebaseFirestoreFunctions) {
              clearInterval(checkInterval);
              console.log('âœ… Firebase ì´ˆê¸°í™” ì™„ë£Œ');
              resolve();
            }
          }, 100);
          
          setTimeout(() => {
            clearInterval(checkInterval);
            console.error('âŒ Firebase ì´ˆê¸°í™” íƒ€ì„ì•„ì›ƒ');
            reject(new Error('Firebase ì´ˆê¸°í™” ì‹¤íŒ¨'));
          }, 10000);
        }
      });
    }
    
    // ì‚¬ìš©ì ì •ë³´ ìë™ ì±„ìš°ê¸°
    window.addEventListener('DOMContentLoaded', function() {
      let user = null;
      let loggedIn = false;
      
      try {
        const loggedInEmail = localStorage.getItem('loggedInEmail');
        if (loggedInEmail) {
          loggedIn = true;
          waitForFirebase().then(async () => {
            const { collection, query, where, getDocs } = window.firebaseFirestoreFunctions;
            const db = window.firebaseDb;
            
            const usersRef = collection(db, 'users');
            const q = query(usersRef, where('email', '==', loggedInEmail));
            const querySnapshot = await getDocs(q);
            
            if (!querySnapshot.empty) {
              user = querySnapshot.docs[0].data();
              const emailInput = document.getElementById('userEmail');
              const nameInput = document.getElementById('userName');
              
              if (user.email && emailInput) {
                emailInput.value = user.email;
              }
              if (user.name && nameInput) {
                nameInput.value = user.name;
              }
            }
          });
        }
      } catch (error) {
        console.error('ì‚¬ìš©ì ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', error);
      }
    });
  </script>
</body>
</html>