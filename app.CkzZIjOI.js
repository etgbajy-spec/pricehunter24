import{o as e,s as t,a as n,d as o,b as s,c as a,e as c,g as l}from"./firebase.D0v-ztDH.js";let r=null;function d(e){console.log("🔄 인증 상태 변경:",e?e.email:"로그아웃"),e?(r=e,function(e){const t=document.getElementById("loginSection"),n=document.getElementById("userSection"),o=document.getElementById("requestSection"),s=document.getElementById("inquirySection");t&&(t.style.display="none");n&&(n.style.display="block");o&&(o.style.display="block");s&&(s.style.display="block");const a=document.getElementById("userInfo");a&&(a.innerHTML=`\n      <div class="text-center">\n        <h3 class="text-lg font-semibold text-gray-800">환영합니다!</h3>\n        <p class="text-gray-600">${e.email}</p>\n        <p class="text-sm text-gray-500">${e.displayName||"사용자"}</p>\n      </div>\n    `)}(e),async function(e,t={}){try{console.log("📝 회원 정보 Firestore 저장 시작:",e.uid);const n={email:e.email,name:t.name||e.displayName||e.email.split("@")[0],provider:t.provider||"email",role:"viewer",status:"active",profileImage:e.photoURL||null,createdAt:c(),updatedAt:c()};console.log("📝 저장할 회원 데이터:",n),await a(o(s,"members",e.uid),n,{merge:!0}),console.log("✅ 회원 정보 Firestore 저장 완료:",e.uid);const r=await l(o(s,"members",e.uid));r.exists()?console.log("✅ 저장 확인됨:",r.data()):console.error("❌ 저장 확인 실패: 문서가 존재하지 않음")}catch(n){console.error("❌ 회원 정보 Firestore 저장 실패:",n),y("회원 정보 저장에 실패했습니다: "+n.message)}}(e)):(r=null,function(){const e=document.getElementById("loginSection"),t=document.getElementById("userSection"),n=document.getElementById("requestSection"),o=document.getElementById("inquirySection");e&&(e.style.display="block");t&&(t.style.display="none");n&&(n.style.display="none");o&&(o.style.display="none")}())}async function i(){try{await t(n),console.log("✅ 로그아웃 완료")}catch(e){console.error("❌ 로그아웃 실패:",e)}}async function m(e){if(e.preventDefault(),!r)return void y("로그인이 필요합니다.");const t=new FormData(e.target),n={productName:t.get("productName"),productUrl:t.get("productUrl"),description:t.get("description"),budget:t.get("budget"),createdBy:r.uid,createdByEmail:r.email,status:"pending",createdAt:c(),updatedAt:c()};try{console.log("🔄 의뢰 제출 시작...");const t=o(s,"requests",Date.now().toString());await a(t,n),console.log("✅ 의뢰 제출 완료:",t.id),g("의뢰가 성공적으로 제출되었습니다!"),e.target.reset()}catch(l){console.error("❌ 의뢰 제출 실패:",l),y("의뢰 제출에 실패했습니다: "+l.message)}}async function u(e){if(e.preventDefault(),!r)return void y("로그인이 필요합니다.");const t=new FormData(e.target),n={subject:t.get("subject"),message:t.get("message"),category:t.get("category"),createdBy:r.uid,createdByEmail:r.email,status:"pending",createdAt:c(),updatedAt:c()};try{console.log("🔄 문의 제출 시작...");const t=o(s,"inquiries",Date.now().toString());await a(t,n),console.log("✅ 문의 제출 완료:",t.id),g("문의가 성공적으로 제출되었습니다!"),e.target.reset()}catch(l){console.error("❌ 문의 제출 실패:",l),y("문의 제출에 실패했습니다: "+l.message)}}function g(e){const t=document.getElementById("message");t&&(t.className="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4",t.textContent=e,t.style.display="block",setTimeout(()=>{t.style.display="none"},3e3))}function y(e){const t=document.getElementById("message");t&&(t.className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",t.textContent=e,t.style.display="block",setTimeout(()=>{t.style.display="none"},5e3))}document.addEventListener("DOMContentLoaded",function(){console.log("🚀 메인 앱 초기화 시작..."),function(){const e=document.getElementById("logoutBtn");e&&e.addEventListener("click",i);const t=document.getElementById("requestForm");t&&t.addEventListener("submit",m);const n=document.getElementById("inquiryForm");n&&n.addEventListener("submit",u)}(),e(n,d)});
