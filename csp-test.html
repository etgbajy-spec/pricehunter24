<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSP í…ŒìŠ¤íŠ¸ - PriceHunter</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .test { margin: 20px 0; padding: 15px; border-radius: 5px; }
        .success { background: #e8f5e8; border-left: 4px solid #4caf50; }
        .error { background: #ffebee; border-left: 4px solid #f44336; }
        .info { background: #e3f2fd; border-left: 4px solid #2196f3; }
        button { background: #2196f3; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #1976d2; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 5px; overflow-x: auto; font-size: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” CSP (Content Security Policy) í…ŒìŠ¤íŠ¸</h1>
        
        <div id="results"></div>
        
        <div style="text-align: center; margin-top: 30px;">
            <button onclick="runCSPTests()">CSP í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
            <button onclick="clearResults()">ê²°ê³¼ ì§€ìš°ê¸°</button>
        </div>
    </div>

    <script>
        function addResult(title, content, type = 'info') {
            const resultsDiv = document.getElementById('results');
            const testDiv = document.createElement('div');
            testDiv.className = `test ${type}`;
            testDiv.innerHTML = `
                <h3>${title}</h3>
                <div>${content}</div>
            `;
            resultsDiv.appendChild(testDiv);
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        function runCSPTests() {
            addResult('ğŸ” CSP í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'CSP ì •ì±…ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.', 'info');
            
            // 1. eval() í…ŒìŠ¤íŠ¸
            try {
                eval('console.log("eval() í…ŒìŠ¤íŠ¸ ì„±ê³µ")');
                addResult('âœ… eval() í…ŒìŠ¤íŠ¸', 'eval() í•¨ìˆ˜ê°€ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤.', 'success');
            } catch (error) {
                addResult('âŒ eval() í…ŒìŠ¤íŠ¸', `eval() í•¨ìˆ˜ê°€ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤: ${error.message}`, 'error');
            }
            
            // 2. new Function() í…ŒìŠ¤íŠ¸
            try {
                const func = new Function('return "new Function() í…ŒìŠ¤íŠ¸ ì„±ê³µ"');
                const result = func();
                addResult('âœ… new Function() í…ŒìŠ¤íŠ¸', `new Function()ì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤: ${result}`, 'success');
            } catch (error) {
                addResult('âŒ new Function() í…ŒìŠ¤íŠ¸', `new Function()ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤: ${error.message}`, 'error');
            }
            
            // 3. setTimeout with string í…ŒìŠ¤íŠ¸
            try {
                setTimeout('console.log("setTimeout with string í…ŒìŠ¤íŠ¸ ì„±ê³µ")', 100);
                addResult('âœ… setTimeout with string í…ŒìŠ¤íŠ¸', 'setTimeout with stringì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤.', 'success');
            } catch (error) {
                addResult('âŒ setTimeout with string í…ŒìŠ¤íŠ¸', `setTimeout with stringì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤: ${error.message}`, 'error');
            }
            
            // 4. ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ í…ŒìŠ¤íŠ¸
            try {
                const script = document.createElement('script');
                script.textContent = 'console.log("ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ í…ŒìŠ¤íŠ¸ ì„±ê³µ")';
                document.head.appendChild(script);
                addResult('âœ… ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ í…ŒìŠ¤íŠ¸', 'ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ê°€ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤.', 'success');
            } catch (error) {
                addResult('âŒ ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ í…ŒìŠ¤íŠ¸', `ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ê°€ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤: ${error.message}`, 'error');
            }
            
            // 5. ì™¸ë¶€ ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© í…ŒìŠ¤íŠ¸
            try {
                const script = document.createElement('script');
                script.src = 'https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js';
                script.onload = () => {
                    addResult('âœ… ì™¸ë¶€ ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© í…ŒìŠ¤íŠ¸', 'Firebase ìŠ¤í¬ë¦½íŠ¸ê°€ ì •ìƒì ìœ¼ë¡œ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                };
                script.onerror = () => {
                    addResult('âŒ ì™¸ë¶€ ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© í…ŒìŠ¤íŠ¸', 'Firebase ìŠ¤í¬ë¦½íŠ¸ ë¡œë”©ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.', 'error');
                };
                document.head.appendChild(script);
            } catch (error) {
                addResult('âŒ ì™¸ë¶€ ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© í…ŒìŠ¤íŠ¸', `ì™¸ë¶€ ìŠ¤í¬ë¦½íŠ¸ ë¡œë”©ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤: ${error.message}`, 'error');
            }
            
            // 6. í˜„ì¬ CSP í—¤ë” í™•ì¸
            fetch(window.location.href, { method: 'HEAD' })
                .then(response => {
                    const cspHeader = response.headers.get('content-security-policy');
                    addResult('ğŸ” í˜„ì¬ CSP í—¤ë”', `
                        <p><strong>CSP í—¤ë” ì¡´ì¬:</strong> ${cspHeader ? 'Yes' : 'No'}</p>
                        ${cspHeader ? `<pre>${cspHeader}</pre>` : '<p>âŒ CSP í—¤ë”ê°€ ì—†ìŠµë‹ˆë‹¤.</p>'}
                    `, cspHeader ? 'info' : 'error');
                })
                .catch(error => {
                    addResult('âŒ CSP í—¤ë” í™•ì¸ ì‹¤íŒ¨', `CSP í—¤ë”ë¥¼ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${error.message}`, 'error');
                });
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ í…ŒìŠ¤íŠ¸
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(runCSPTests, 1000);
        });
    </script>
</body>
</html>
