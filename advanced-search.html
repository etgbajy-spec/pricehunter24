<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³ ê¸‰ ê²€ìƒ‰ - PriceHunter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ”</text></svg>">
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
    <nav class="bg-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-4">
                    <a href="index.html" class="text-2xl font-bold text-blue-600">ğŸ” PriceHunter</a>
                    <span class="text-gray-500">ê³ ê¸‰ ê²€ìƒ‰</span>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="index.html" class="text-gray-600 hover:text-blue-600 transition-colors">í™ˆìœ¼ë¡œ</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <div class="max-w-6xl mx-auto px-4 py-4 md:py-8">
        <!-- ê²€ìƒ‰ í¼ -->
        <div class="bg-white rounded-lg shadow-lg p-4 md:p-6 mb-6 md:mb-8">
            <h1 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-4 md:mb-6">ğŸ” ê³ ê¸‰ ê²€ìƒ‰</h1>
            
            <form id="search-form" class="space-y-6">
                <!-- ê¸°ë³¸ ê²€ìƒ‰ -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 md:gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ì œí’ˆëª…</label>
                        <input type="text" id="product-name" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="ì œí’ˆëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ì¹´í…Œê³ ë¦¬</label>
                        <select id="category" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">ì „ì²´ ì¹´í…Œê³ ë¦¬</option>
                            <option value="ì „ìê¸°ê¸°">ì „ìê¸°ê¸°</option>
                            <option value="ì˜ë¥˜">ì˜ë¥˜</option>
                            <option value="ê°€ì „ì œí’ˆ">ê°€ì „ì œí’ˆ</option>
                            <option value="í™”ì¥í’ˆ">í™”ì¥í’ˆ</option>
                            <option value="ì‹í’ˆ">ì‹í’ˆ</option>
                            <option value="ë„ì„œ">ë„ì„œ</option>
                            <option value="ìŠ¤í¬ì¸ ">ìŠ¤í¬ì¸ </option>
                            <option value="ìë™ì°¨">ìë™ì°¨</option>
                            <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                        </select>
                    </div>
                </div>

                <!-- ê°€ê²© ë²”ìœ„ -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ìµœì†Œ ê°€ê²©</label>
                        <input type="number" id="min-price" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="0">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ìµœëŒ€ ê°€ê²©</label>
                        <input type="number" id="max-price" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="ë¬´ì œí•œ">
                    </div>
                    <div class="sm:col-span-2 lg:col-span-1">
                        <label class="block text-sm font-medium text-gray-700 mb-2">ê°€ê²© ë‹¨ìœ„</label>
                        <select id="price-unit" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="KRW">ì› (KRW)</option>
                            <option value="USD">ë‹¬ëŸ¬ (USD)</option>
                            <option value="EUR">ìœ ë¡œ (EUR)</option>
                            <option value="JPY">ì—” (JPY)</option>
                        </select>
                    </div>
                </div>

                <!-- ë‚ ì§œ ë²”ìœ„ -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 md:gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ì‹œì‘ ë‚ ì§œ</label>
                        <input type="date" id="start-date" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ì¢…ë£Œ ë‚ ì§œ</label>
                        <input type="date" id="end-date" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                </div>

                <!-- ìƒíƒœ í•„í„° -->
                <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 md:gap-4">
                    <div class="flex items-center space-x-2">
                        <input type="checkbox" id="status-pending" class="w-4 h-4 text-blue-600" checked>
                        <label for="status-pending" class="text-gray-700">ëŒ€ê¸°ì¤‘</label>
                    </div>
                    <div class="flex items-center space-x-2">
                        <input type="checkbox" id="status-processing" class="w-4 h-4 text-blue-600" checked>
                        <label for="status-processing" class="text-gray-700">ì²˜ë¦¬ì¤‘</label>
                    </div>
                    <div class="flex items-center space-x-2">
                        <input type="checkbox" id="status-completed" class="w-4 h-4 text-blue-600" checked>
                        <label for="status-completed" class="text-gray-700">ì™„ë£Œ</label>
                    </div>
                    <div class="flex items-center space-x-2">
                        <input type="checkbox" id="status-cancelled" class="w-4 h-4 text-blue-600">
                        <label for="status-cancelled" class="text-gray-700">ì·¨ì†Œ</label>
                    </div>
                </div>

                <!-- ê²€ìƒ‰ ë²„íŠ¼ -->
                <div class="flex flex-col sm:flex-row justify-center space-y-3 sm:space-y-0 sm:space-x-4">
                    <button type="submit" class="bg-blue-600 text-white px-6 sm:px-8 py-3 rounded-lg hover:bg-blue-700 transition-colors text-sm sm:text-base">
                        ğŸ” ê²€ìƒ‰í•˜ê¸°
                    </button>
                    <button type="button" id="reset-form" class="bg-gray-600 text-white px-6 sm:px-8 py-3 rounded-lg hover:bg-gray-700 transition-colors text-sm sm:text-base">
                        ğŸ”„ ì´ˆê¸°í™”
                    </button>
                </div>
            </form>
        </div>

        <!-- ê²€ìƒ‰ ê²°ê³¼ -->
        <div id="search-results" class="bg-white rounded-lg shadow-lg p-4 md:p-6 hidden">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 md:mb-6 space-y-3 sm:space-y-0">
                <h2 class="text-xl sm:text-2xl font-bold text-gray-800">ê²€ìƒ‰ ê²°ê³¼</h2>
                <div class="flex flex-col sm:flex-row items-start sm:items-center space-y-2 sm:space-y-0 sm:space-x-4">
                    <span id="result-count" class="text-gray-600 text-sm sm:text-base">0ê°œ ê²°ê³¼</span>
                    <select id="sort-by" class="px-3 py-2 border border-gray-300 rounded-lg text-sm sm:text-base">
                        <option value="date-desc">ìµœì‹ ìˆœ</option>
                        <option value="date-asc">ì˜¤ë˜ëœìˆœ</option>
                        <option value="price-asc">ê°€ê²© ë‚®ì€ìˆœ</option>
                        <option value="price-desc">ê°€ê²© ë†’ì€ìˆœ</option>
                        <option value="name-asc">ì´ë¦„ìˆœ</option>
                    </select>
                </div>
            </div>
            
            <div id="results-container" class="space-y-4">
                <!-- ê²€ìƒ‰ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>

            <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
            <div id="pagination" class="flex justify-center mt-8">
                <!-- í˜ì´ì§€ë„¤ì´ì…˜ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
        </div>

        <!-- ê²€ìƒ‰ íˆìŠ¤í† ë¦¬ -->
        <div id="search-history" class="bg-white rounded-lg shadow-lg p-4 md:p-6 mt-6 md:mt-8">
            <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-4">ğŸ” ìµœê·¼ ê²€ìƒ‰ ê¸°ë¡</h2>
            <div id="history-list" class="space-y-2">
                <!-- ê²€ìƒ‰ íˆìŠ¤í† ë¦¬ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
        </div>
    </div>

    <script>
        class AdvancedSearch {
            constructor() {
                this.searchHistory = JSON.parse(localStorage.getItem('searchHistory') || '[]');
                this.currentResults = [];
                this.currentPage = 1;
                this.itemsPerPage = 10;
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.loadSearchHistory();
                this.setDefaultDates();
            }

            setupEventListeners() {
                document.getElementById('search-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.performSearch();
                });

                document.getElementById('reset-form').addEventListener('click', () => {
                    this.resetForm();
                });

                document.getElementById('sort-by').addEventListener('change', () => {
                    this.sortResults();
                });
            }

            setDefaultDates() {
                const today = new Date();
                const thirtyDaysAgo = new Date(today.getTime() - (30 * 24 * 60 * 60 * 1000));
                
                document.getElementById('start-date').value = thirtyDaysAgo.toISOString().split('T')[0];
                document.getElementById('end-date').value = today.toISOString().split('T')[0];
            }

            performSearch() {
                const searchCriteria = this.getSearchCriteria();
                this.saveSearchHistory(searchCriteria);
                this.searchData(searchCriteria);
            }

            getSearchCriteria() {
                return {
                    productName: document.getElementById('product-name').value,
                    category: document.getElementById('category').value,
                    minPrice: document.getElementById('min-price').value,
                    maxPrice: document.getElementById('max-price').value,
                    priceUnit: document.getElementById('price-unit').value,
                    startDate: document.getElementById('start-date').value,
                    endDate: document.getElementById('end-date').value,
                    statuses: this.getSelectedStatuses(),
                    timestamp: new Date().toISOString()
                };
            }

            getSelectedStatuses() {
                const statuses = [];
                if (document.getElementById('status-pending').checked) statuses.push('ëŒ€ê¸°ì¤‘');
                if (document.getElementById('status-processing').checked) statuses.push('ì²˜ë¦¬ì¤‘');
                if (document.getElementById('status-completed').checked) statuses.push('ì™„ë£Œ');
                if (document.getElementById('status-cancelled').checked) statuses.push('ì·¨ì†Œ');
                return statuses;
            }

            searchData(criteria) {
                const allData = this.getAllData();
                let filteredData = this.filterData(allData, criteria);
                
                this.currentResults = filteredData;
                this.currentPage = 1;
                this.displayResults();
            }

            getAllData() {
                const data = [];
                
                // ì˜ë¢° ë°ì´í„° ìˆ˜ì§‘
                Object.keys(localStorage).forEach(key => {
                    if (key.startsWith('request-') || key.startsWith('result-')) {
                        try {
                            const item = JSON.parse(localStorage.getItem(key));
                            if (item) {
                                data.push({
                                    ...item,
                                    key: key,
                                    type: key.startsWith('request-') ? 'request' : 'result'
                                });
                            }
                        } catch (e) {
                            // ë¬´ì‹œ
                        }
                    }
                });

                return data;
            }

            filterData(data, criteria) {
                return data.filter(item => {
                    // ì œí’ˆëª… í•„í„°
                    if (criteria.productName && item.productName) {
                        if (!item.productName.toLowerCase().includes(criteria.productName.toLowerCase())) {
                            return false;
                        }
                    }

                    // ì¹´í…Œê³ ë¦¬ í•„í„°
                    if (criteria.category && item.category) {
                        if (item.category !== criteria.category) {
                            return false;
                        }
                    }

                    // ê°€ê²© í•„í„°
                    if (criteria.minPrice && item.price) {
                        if (parseFloat(item.price) < parseFloat(criteria.minPrice)) {
                            return false;
                        }
                    }
                    if (criteria.maxPrice && item.price) {
                        if (parseFloat(item.price) > parseFloat(criteria.maxPrice)) {
                            return false;
                        }
                    }

                    // ë‚ ì§œ í•„í„°
                    if (criteria.startDate && item.timestamp) {
                        const itemDate = new Date(item.timestamp);
                        const startDate = new Date(criteria.startDate);
                        if (itemDate < startDate) {
                            return false;
                        }
                    }
                    if (criteria.endDate && item.timestamp) {
                        const itemDate = new Date(item.timestamp);
                        const endDate = new Date(criteria.endDate);
                        if (itemDate > endDate) {
                            return false;
                        }
                    }

                    // ìƒíƒœ í•„í„°
                    if (criteria.statuses.length > 0 && item.status) {
                        if (!criteria.statuses.includes(item.status)) {
                            return false;
                        }
                    }

                    return true;
                });
            }

            displayResults() {
                const container = document.getElementById('search-results');
                const resultsContainer = document.getElementById('results-container');
                const resultCount = document.getElementById('result-count');

                if (this.currentResults.length === 0) {
                    container.classList.remove('hidden');
                    resultCount.textContent = '0ê°œ ê²°ê³¼';
                    resultsContainer.innerHTML = `
                        <div class="text-center py-12 text-gray-500">
                            <svg class="w-16 h-16 mx-auto mb-4 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                            </svg>
                            <p class="text-lg font-medium">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                            <p class="text-sm">ê²€ìƒ‰ ì¡°ê±´ì„ ë³€ê²½í•´ë³´ì„¸ìš”.</p>
                        </div>
                    `;
                    return;
                }

                container.classList.remove('hidden');
                resultCount.textContent = `${this.currentResults.length}ê°œ ê²°ê³¼`;

                const startIndex = (this.currentPage - 1) * this.itemsPerPage;
                const endIndex = startIndex + this.itemsPerPage;
                const pageData = this.currentResults.slice(startIndex, endIndex);

                resultsContainer.innerHTML = pageData.map(item => this.createResultCard(item)).join('');
                this.createPagination();
            }

            createResultCard(item) {
                const date = new Date(item.timestamp).toLocaleDateString('ko-KR');
                const price = item.price ? `${parseInt(item.price).toLocaleString()}ì›` : 'ê°€ê²© ì •ë³´ ì—†ìŒ';
                const status = item.status || 'ìƒíƒœ ì •ë³´ ì—†ìŒ';
                const type = item.type === 'request' ? 'ì˜ë¢°' : 'ê²°ê³¼';

                return `
                    <div class="border rounded-lg p-4 hover:shadow-md transition-shadow">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <div class="flex items-center space-x-2 mb-2">
                                    <span class="text-lg font-semibold text-gray-800">${item.productName || 'ì œí’ˆëª… ì—†ìŒ'}</span>
                                    <span class="px-2 py-1 text-xs rounded-full ${this.getStatusColor(status)}">${status}</span>
                                    <span class="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800">${type}</span>
                                </div>
                                <p class="text-gray-600 mb-2">${item.description || 'ì„¤ëª… ì—†ìŒ'}</p>
                                <div class="flex items-center space-x-4 text-sm text-gray-500">
                                    <span>ğŸ’° ${price}</span>
                                    <span>ğŸ“… ${date}</span>
                                    <span>ğŸ‘¤ ${item.userName || 'ì‚¬ìš©ì ì •ë³´ ì—†ìŒ'}</span>
                                </div>
                            </div>
                            <button onclick="advancedSearch.viewDetails('${item.key}')" class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                                ìƒì„¸ë³´ê¸° â†’
                            </button>
                        </div>
                    </div>
                `;
            }

            getStatusColor(status) {
                const colors = {
                    'ëŒ€ê¸°ì¤‘': 'bg-yellow-100 text-yellow-800',
                    'ì²˜ë¦¬ì¤‘': 'bg-blue-100 text-blue-800',
                    'ì™„ë£Œ': 'bg-green-100 text-green-800',
                    'ì·¨ì†Œ': 'bg-red-100 text-red-800'
                };
                return colors[status] || 'bg-gray-100 text-gray-800';
            }

            createPagination() {
                const totalPages = Math.ceil(this.currentResults.length / this.itemsPerPage);
                const pagination = document.getElementById('pagination');

                if (totalPages <= 1) {
                    pagination.innerHTML = '';
                    return;
                }

                let paginationHTML = '';
                
                // ì´ì „ ë²„íŠ¼
                if (this.currentPage > 1) {
                    paginationHTML += `<button onclick="advancedSearch.goToPage(${this.currentPage - 1})" class="px-3 py-2 mx-1 text-gray-600 hover:text-blue-600">ì´ì „</button>`;
                }

                // í˜ì´ì§€ ë²ˆí˜¸
                for (let i = 1; i <= totalPages; i++) {
                    if (i === this.currentPage) {
                        paginationHTML += `<button class="px-3 py-2 mx-1 bg-blue-600 text-white rounded">${i}</button>`;
                    } else {
                        paginationHTML += `<button onclick="advancedSearch.goToPage(${i})" class="px-3 py-2 mx-1 text-gray-600 hover:text-blue-600">${i}</button>`;
                    }
                }

                // ë‹¤ìŒ ë²„íŠ¼
                if (this.currentPage < totalPages) {
                    paginationHTML += `<button onclick="advancedSearch.goToPage(${this.currentPage + 1})" class="px-3 py-2 mx-1 text-gray-600 hover:text-blue-600">ë‹¤ìŒ</button>`;
                }

                pagination.innerHTML = paginationHTML;
            }

            goToPage(page) {
                this.currentPage = page;
                this.displayResults();
            }

            sortResults() {
                const sortBy = document.getElementById('sort-by').value;
                
                this.currentResults.sort((a, b) => {
                    switch (sortBy) {
                        case 'date-desc':
                            return new Date(b.timestamp) - new Date(a.timestamp);
                        case 'date-asc':
                            return new Date(a.timestamp) - new Date(b.timestamp);
                        case 'price-asc':
                            return (parseFloat(a.price) || 0) - (parseFloat(b.price) || 0);
                        case 'price-desc':
                            return (parseFloat(b.price) || 0) - (parseFloat(a.price) || 0);
                        case 'name-asc':
                            return (a.productName || '').localeCompare(b.productName || '');
                        default:
                            return 0;
                    }
                });

                this.currentPage = 1;
                this.displayResults();
            }

            saveSearchHistory(criteria) {
                this.searchHistory.unshift(criteria);
                if (this.searchHistory.length > 10) {
                    this.searchHistory = this.searchHistory.slice(0, 10);
                }
                localStorage.setItem('searchHistory', JSON.stringify(this.searchHistory));
                this.loadSearchHistory();
            }

            loadSearchHistory() {
                const historyList = document.getElementById('history-list');
                
                if (this.searchHistory.length === 0) {
                    historyList.innerHTML = '<p class="text-gray-500">ê²€ìƒ‰ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                    return;
                }

                historyList.innerHTML = this.searchHistory.map((history, index) => `
                    <div class="flex justify-between items-center p-3 border rounded-lg hover:bg-gray-50">
                        <div class="flex-1">
                            <div class="flex items-center space-x-2">
                                <span class="font-medium">${history.productName || 'ì „ì²´ ê²€ìƒ‰'}</span>
                                <span class="text-sm text-gray-500">${new Date(history.timestamp).toLocaleDateString()}</span>
                            </div>
                            <div class="text-sm text-gray-600">
                                ${this.formatSearchCriteria(history)}
                            </div>
                        </div>
                        <button onclick="advancedSearch.loadSearchHistoryItem(${index})" class="text-blue-600 hover:text-blue-800 text-sm">
                            ë‹¤ì‹œ ê²€ìƒ‰
                        </button>
                    </div>
                `).join('');
            }

            formatSearchCriteria(criteria) {
                const parts = [];
                if (criteria.productName) parts.push(`ì œí’ˆ: ${criteria.productName}`);
                if (criteria.category) parts.push(`ì¹´í…Œê³ ë¦¬: ${criteria.category}`);
                if (criteria.minPrice || criteria.maxPrice) {
                    const priceRange = [];
                    if (criteria.minPrice) priceRange.push(`${criteria.minPrice}ì› ì´ìƒ`);
                    if (criteria.maxPrice) priceRange.push(`${criteria.maxPrice}ì› ì´í•˜`);
                    parts.push(`ê°€ê²©: ${priceRange.join(' ~ ')}`);
                }
                return parts.join(', ');
            }

            loadSearchHistoryItem(index) {
                const history = this.searchHistory[index];
                
                document.getElementById('product-name').value = history.productName || '';
                document.getElementById('category').value = history.category || '';
                document.getElementById('min-price').value = history.minPrice || '';
                document.getElementById('max-price').value = history.maxPrice || '';
                document.getElementById('price-unit').value = history.priceUnit || 'KRW';
                document.getElementById('start-date').value = history.startDate || '';
                document.getElementById('end-date').value = history.endDate || '';

                // ìƒíƒœ ì²´í¬ë°•ìŠ¤ ì„¤ì •
                document.getElementById('status-pending').checked = history.statuses.includes('ëŒ€ê¸°ì¤‘');
                document.getElementById('status-processing').checked = history.statuses.includes('ì²˜ë¦¬ì¤‘');
                document.getElementById('status-completed').checked = history.statuses.includes('ì™„ë£Œ');
                document.getElementById('status-cancelled').checked = history.statuses.includes('ì·¨ì†Œ');

                this.performSearch();
            }

            resetForm() {
                document.getElementById('search-form').reset();
                this.setDefaultDates();
                document.getElementById('search-results').classList.add('hidden');
            }

            viewDetails(key) {
                // ìƒì„¸ë³´ê¸° í˜ì´ì§€ë¡œ ì´ë™í•˜ê±°ë‚˜ ëª¨ë‹¬ í‘œì‹œ
                if (key.startsWith('request-')) {
                    window.open(`result-search.html?req=${key}`, '_blank');
                } else if (key.startsWith('result-')) {
                    window.open(`result-search.html?req=${key.replace('result-', 'request-')}`, '_blank');
                }
            }
        }

        // ì´ˆê¸°í™”
        const advancedSearch = new AdvancedSearch();
    </script>
</body>
</html>
