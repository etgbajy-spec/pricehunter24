<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ì˜ë¢° ê²°ê³¼ ì¡°íšŒ | PriceHunter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
      body { font-family: 'Noto Sans KR', sans-serif; }
      .fade-in { animation: fadeIn 0.7s; }
      @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
      .spinner {
        border: 4px solid #e5e7eb;
        border-top: 4px solid #38bdf8;
        border-radius: 50%;
        width: 2.5rem;
        height: 2.5rem;
        animation: spin 1s linear infinite;
        margin: 0 auto;
      }
      @keyframes spin { 100% { transform: rotate(360deg); } }
      
      /* ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ë§ */
      #result-summary img {
        max-width: 100%;
        height: auto;
        margin: 10px 0;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        display: block;
      }
      
      /* ë¦¬ì¹˜ í…ìŠ¤íŠ¸ ë‚´ìš© ìŠ¤íƒ€ì¼ë§ */
      #result-summary {
        line-height: 1.6;
        word-wrap: break-word;
      }
      
      #result-summary p {
        margin: 8px 0;
      }
      
      #result-summary strong {
        font-weight: bold;
      }
      
      #result-summary em {
        font-style: italic;
      }
      
      #result-summary u {
        text-decoration: underline;
      }
    </style>
  </head>
  <body class="bg-gradient-to-br from-blue-50 via-emerald-50 to-pink-50 min-h-screen flex items-center justify-center px-2">
    <main class="w-full max-w-2xl bg-white/90 rounded-3xl shadow-2xl p-4 md:p-8 lg:p-12 flex flex-col items-center text-center backdrop-blur-md mt-4 md:mt-8 mb-4 md:mb-8">
      <h1 class="text-xl sm:text-2xl md:text-3xl font-extrabold text-blue-600 mb-4 md:mb-6">ì˜ë¢° ê²°ê³¼ ì¡°íšŒ</h1>
      <div class="w-full mb-6">
        <label class="block text-gray-700 font-semibold mb-2 text-left" for="search-input">
          ì˜ë¢°ë²ˆí˜¸ ë˜ëŠ” íœ´ëŒ€í° ë²ˆí˜¸ë¡œ ê²°ê³¼ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </label>
        <div class="flex flex-col md:flex-row gap-3">
          <input id="search-input" type="text" class="flex-1 px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-400 focus:outline-none transition text-lg" placeholder="#PH-000000 ë˜ëŠ” 010-1234-5678" />
        </div>
        <!-- CAPTCHA Placeholder -->
        <div class="mt-4 flex justify-center">
          <div class="bg-gray-100 rounded-lg px-4 py-2 text-gray-400 text-sm select-none">(ì—¬ê¸°ì— CAPTCHAê°€ ë“¤ì–´ê°ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤)</div>
        </div>
        <button id="search-btn" class="mt-6 w-full py-3 bg-gradient-to-r from-blue-400 to-emerald-400 text-white font-bold rounded-lg shadow-lg hover:scale-105 transition-all duration-300 text-lg">ì¡°íšŒí•˜ê¸°</button>
      </div>
      <!-- ë‚´ ì˜ë¢° ë¦¬ìŠ¤íŠ¸ (ë¡œê·¸ì¸ ì‹œ) -->
      <div id="my-request-list-section" class="w-full mb-8 hidden">
        <div class="font-bold text-blue-700 mb-2 text-left">ë‚´ê°€ ì˜ë¢°í•œ ë‚´ì—­</div>
        <ul id="my-request-list" class="bg-blue-50 rounded-xl shadow-inner divide-y divide-blue-100 text-left"></ul>
      </div>
      <!-- Loading Animation -->
      <div id="loading" class="hidden my-8"><div class="spinner"></div><div class="mt-2 text-blue-400 font-semibold">ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div></div>
      <!-- Result Card -->
      <div id="result-card" class="hidden w-full fade-in">
        <div class="bg-white rounded-2xl shadow-lg p-6 mb-4 text-left">
          <!-- ì§„í–‰ìƒí™© ë°°ì§€ -->
          <div class="mb-4 flex justify-between items-center">
            <div id="status-badge" class="px-3 py-1 rounded-full text-sm font-bold text-white"></div>
          </div>
          
          <!-- ê²°ê³¼ ì •ë³´ -->
          <div id="result-info" class="hidden">
            <div class="mb-3 flex flex-col md:flex-row md:items-center md:justify-between">
              <div class="text-xl font-bold text-gray-800 mb-2 md:mb-0">ìµœì €ê°€: <span id="result-price" class="text-emerald-600">â‚©123,000</span></div>
            </div>
            <div class="mb-2 text-gray-600">ì›ì‚°ì§€/ê³µê¸‰ì²˜: <span id="result-origin">ëŒ€í•œë¯¼êµ­ / PriceHunter ê³µì‹</span></div>
            <div class="mb-4">
              <div class="font-semibold text-gray-700 mb-1">ì¢…í•©ì„¤ëª…</div>
              <div id="result-summary" class="text-gray-700 bg-gray-50 rounded-xl p-4 min-h-[60px] overflow-hidden">ê°€ê²©, ì›ì‚°ì§€, ìƒí’ˆíŠ¹ì§• ë“± ì „ì²´ì ì¸ ì„¤ëª…ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
            </div>
            
            <!-- êµ¬ë§¤ ì˜µì…˜ -->
            <div class="mb-4 p-4 bg-gradient-to-r from-blue-50 to-emerald-50 rounded-xl border border-blue-100">
              <div class="font-bold text-gray-800 mb-3 text-center">ğŸ›’ êµ¬ë§¤ ì˜µì…˜</div>
              <div class="text-sm text-gray-600 mb-3">
                ìµœì €ê°€ ì •ë³´ë¥¼ í™•ì¸í–ˆìŠµë‹ˆë‹¤. ì›í•˜ì‹œëŠ” êµ¬ë§¤ ë°©ë²•ì„ ì„ íƒí•´ì£¼ì„¸ìš”.
              </div>
              <div class="flex flex-col md:flex-row gap-3">
                <button id="buy-external-btn" onclick="goToExternalPurchase()" class="flex-1 py-3 bg-gradient-to-r from-emerald-500 to-emerald-600 text-white font-bold rounded-lg shadow-lg hover:scale-105 transition-all duration-300">
                  <div class="text-lg">ğŸ›ï¸</div>
                  <div class="text-sm">ì§ì ‘ êµ¬ë§¤í•˜ê¸°</div>
                  <div class="text-xs opacity-90">ìµœì €ê°€ ì‡¼í•‘ëª°ì—ì„œ êµ¬ë§¤</div>
                </button>
                <button onclick="showPurchaseSupport()" class="flex-1 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white font-bold rounded-lg shadow-lg hover:scale-105 transition-all duration-300">
                  <div class="text-lg">ğŸ¤</div>
                  <div class="text-sm">êµ¬ë§¤ ì§€ì› ì„œë¹„ìŠ¤</div>
                  <div class="text-xs opacity-90">ì „ë‹´ ê´€ë¦¬ & ì¶”ì </div>
                </button>
              </div>
            </div>
          </div>
          
          <!-- ì§„í–‰ì¤‘ ë©”ì‹œì§€ -->
          <div id="progress-message" class="hidden">
            <div class="text-center py-8">
              <div class="text-2xl mb-2">ğŸ”„</div>
              <div class="text-lg font-bold text-gray-700 mb-2">ì˜ë¢° ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤</div>
              <div class="text-gray-500">PriceHunterê°€ ìµœì €ê°€ë¥¼ ì°¾ê³  ìˆìŠµë‹ˆë‹¤.</div>
              <div class="text-sm text-gray-400 mt-2">ì™„ë£Œë˜ë©´ ìë™ìœ¼ë¡œ ì•Œë¦¼ì„ ë“œë¦½ë‹ˆë‹¤.</div>
            </div>
          </div>
        </div>
      </div>
      <!-- No Result Message -->
      <div id="no-result" class="hidden w-full fade-in">
        <div class="bg-white rounded-2xl shadow-lg p-6 text-center text-gray-500">
          <div class="text-lg font-bold mb-2">ì¡°íšŒëœ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
          <div class="text-sm">ì…ë ¥í•˜ì‹  ì •ë³´ë¥¼ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.</div>
        </div>
      </div>
      <!-- Help Text -->
      <div class="mt-8 text-gray-400 text-sm">
        ê²°ê³¼ ì¡°íšŒê°€ ì–´ë µë‹¤ë©´ ê³ ê°ì„¼í„°ë¡œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.<br/>
        <span class="font-semibold">ë¬¸ì˜: contact@pricehunter.kr</span>
      </div>
    </main>
    <script>
      const searchBtn = document.getElementById('search-btn');
      let currentReqKey = ''; // í˜„ì¬ í‘œì‹œëœ ì˜ë¢°ì˜ í‚¤
      let currentDisplayedReq = ''; // í˜„ì¬ í‘œì‹œëœ ì˜ë¢° ë²ˆí˜¸ (í† ê¸€ìš©)
      const loading = document.getElementById('loading');
      const resultCard = document.getElementById('result-card');
      const noResult = document.getElementById('no-result');
      
      // ì§„í–‰ìƒí™© íŒë‹¨ í•¨ìˆ˜
      function getRequestStatus(reqKey) {
        const reqNum = reqKey.replace('request-', '');
        const hasResult = !!localStorage.getItem('result-' + reqNum);
        
        if (!hasResult) {
          return { status: 'new', text: 'ì‹ ê·œì˜ë¢°', color: 'bg-red-500' };
        }
        
        const result = JSON.parse(localStorage.getItem('result-' + reqNum) || '{}');
        if (result.price && result.origin && result.summary && result.link) {
          return { status: 'complete', text: 'ì™„ë£Œ', color: 'bg-green-500' };
        }
        
        return { status: 'progress', text: 'ì§„í–‰ì¤‘', color: 'bg-orange-500' };
      }
      
      function getMyRequestList(email) {
        const list = [];
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          if (key.startsWith('request-')) {
            const req = JSON.parse(localStorage.getItem(key));
            if (req.email === email) {
              list.push({ key, ...req });
            }
          }
        }
        // ìµœì‹ ìˆœ ì •ë ¬(ê°€ì¥ ìµœê·¼ì´ ìœ„ë¡œ)
        return list.sort((a, b) => (b.date || 0) - (a.date || 0));
      }
      
      function renderMyRequestList() {
        const user = JSON.parse(localStorage.getItem('user') || 'null');
        const loggedIn = localStorage.getItem('loggedIn') === 'true';
        const section = document.getElementById('my-request-list-section');
        const ul = document.getElementById('my-request-list');
        if (!loggedIn || !user) {
          section.classList.add('hidden');
          return;
        }
        const list = getMyRequestList(user.email);
        section.classList.remove('hidden');
        ul.innerHTML = '';
        if (list.length === 0) {
          ul.innerHTML = '<li class="py-4 text-center text-gray-400">ë‚´ê°€ ì˜ë¢°í•œ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</li>';
          return;
        }
        list.forEach(req => {
          const li = document.createElement('li');
          li.className = 'py-3 px-4 hover:bg-blue-100 cursor-pointer';
          
          const status = getRequestStatus(req.key);
          const statusBadge = `<span class="px-2 py-1 rounded text-xs font-bold text-white ${status.color}">${status.text}</span>`;
          
          // ê´€ë¦¬ì ë‹µë³€ í™•ì¸
          const reqNum = req.key.replace('request-', '');
          const resultData = localStorage.getItem(`result-${reqNum}`);
          let adminResponse = '';
          
          if (resultData) {
            try {
              const result = JSON.parse(resultData);
              if (result.summary) {
                // HTML íƒœê·¸ ì œê±°í•˜ê³  í…ìŠ¤íŠ¸ë§Œ ì¶”ì¶œ (ìµœëŒ€ 100ì)
                const textContent = result.summary.replace(/<[^>]*>/g, '').trim();
                adminResponse = textContent.length > 100 ? textContent.substring(0, 100) + '...' : textContent;
              }
            } catch (e) {
              console.log('ê²°ê³¼ ë°ì´í„° íŒŒì‹± ì‹¤íŒ¨:', e);
            }
          }
          
          li.innerHTML = `
            <div class="flex justify-between items-start mb-2">
              <div class="flex items-center gap-3">
                <span class="font-semibold text-blue-600">${req.key.replace('request-','')}</span>
                <span class="text-gray-700">${req.name}</span>
                ${statusBadge}
              </div>
              <span class="text-xs text-gray-400">${req.date ? new Date(req.date).toLocaleString() : ''}</span>
            </div>
            ${adminResponse ? `
              <div class="text-sm text-gray-600 bg-gray-50 p-2 rounded mt-2">
                <span class="font-medium text-green-600">ğŸ’¬ ê´€ë¦¬ì ë‹µë³€:</span> ${adminResponse}
              </div>
            ` : ''}
          `;
          li.onclick = function() { 
            const reqNum = req.key.replace('request-', '');
            
            // í† ê¸€ ê¸°ëŠ¥: ê°™ì€ ì˜ë¢°ë¥¼ ë‹¤ì‹œ í´ë¦­í•˜ë©´ ìˆ¨ê¸°ê¸°
            if (currentDisplayedReq === reqNum) {
              console.log('ê°™ì€ ì˜ë¢° ë‹¤ì‹œ í´ë¦­ - í† ê¸€ ë‹«ê¸°');
              hideResult();
              currentDisplayedReq = '';
              return;
            }
            
            // ë‹¤ë¥¸ ì˜ë¢° í´ë¦­ ì‹œ í‘œì‹œ
            console.log('ìƒˆë¡œìš´ ì˜ë¢° í´ë¦­ - í‘œì‹œ');
            currentReqKey = req.key; // ì „ì—­ ë³€ìˆ˜ì— í˜„ì¬ ì˜ë¢° í‚¤ ì €ì¥
            currentDisplayedReq = reqNum;
            
            // ìƒˆë¡œìš´ ê´€ë¦¬ì ë‹µë³€ í‘œì‹œ í•¨ìˆ˜ ì‚¬ìš©
            const success = showAdminResponse(reqNum);
            if (!success) {
              // ì‹¤íŒ¨ ì‹œ ê¸°ì¡´ ë°©ë²• ì‚¬ìš©
              showResultByKey(reqNum);
            }
          };
          ul.appendChild(li);
        });
      }
      
      function showResultByKey(key) {
        console.log('=== showResultByKey í˜¸ì¶œë¨ ===');
        console.log('ì…ë ¥ëœ í‚¤:', key);
        console.log('í‚¤ íƒ€ì…:', typeof key);
        
        if (!key) {
          console.log('í‚¤ê°€ ë¹„ì–´ìˆìŒ');
          document.getElementById('no-result').classList.remove('hidden');
          return;
        }
        
        // í‚¤ ì •ê·œí™” (ë‹¤ì–‘í•œ í˜•ì‹ ì§€ì›)
        let normalizedKey = key.toString().trim();
        
        // PH- ì ‘ë‘ì‚¬ ì œê±°
        if (normalizedKey.startsWith('PH-')) {
          normalizedKey = normalizedKey.substring(3);
        }
        
        // # ì ‘ë‘ì‚¬ ì œê±°  
        if (normalizedKey.startsWith('#')) {
          normalizedKey = normalizedKey.substring(1);
        }
        
        console.log('ì •ê·œí™”ëœ í‚¤:', normalizedKey);
        
        const resultCard = document.getElementById('result-card');
        const noResult = document.getElementById('no-result');
        const resultInfo = document.getElementById('result-info');
        const progressMessage = document.getElementById('progress-message');
        
        resultCard.classList.add('hidden');
        noResult.classList.add('hidden');
        
        // ì˜ë¢° ì •ë³´ ì°¾ê¸° - ì—¬ëŸ¬ í˜•ì‹ìœ¼ë¡œ ì‹œë„
        const possibleKeys = [
          `request-${normalizedKey}`,
          `request-PH-${normalizedKey}`,
          normalizedKey,
          `PH-${normalizedKey}`
        ];
        
        console.log('ì‹œë„í•  í‚¤ë“¤:', possibleKeys);
        
        let requestData = null;
        let foundRequestKey = null;
        
        for (const testKey of possibleKeys) {
          const data = localStorage.getItem(testKey);
          if (data) {
            try {
              requestData = JSON.parse(data);
              foundRequestKey = testKey;
              console.log('ì°¾ì€ ì˜ë¢° í‚¤:', foundRequestKey);
              console.log('ì˜ë¢° ë°ì´í„°:', requestData);
              break;
            } catch (e) {
              console.log(`${testKey} íŒŒì‹± ì‹¤íŒ¨:`, e);
            }
          }
        }
        
        if (!requestData) {
          console.log('ì˜ë¢° ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
          
          // ëª¨ë“  localStorage í‚¤ í™•ì¸í•´ì„œ ìœ ì‚¬í•œ ê²ƒ ì°¾ê¸°
          const allKeys = Object.keys(localStorage);
          const similarKeys = allKeys.filter(k => 
            k.toLowerCase().includes(normalizedKey.toLowerCase()) ||
            normalizedKey.toLowerCase().includes(k.toLowerCase())
          );
          console.log('ìœ ì‚¬í•œ í‚¤ë“¤:', similarKeys);
          
          noResult.classList.remove('hidden');
          return;
        }
        
        if (requestData) {
          // userName í•„ë“œê°€ ì—†ëŠ” ê²½ìš° ì²˜ë¦¬
          if (!requestData.userName) {
            // user ë˜ëŠ” currentUserì—ì„œ ì´ë¦„ ì°¾ê¸°
            let userName = '';
            if (requestData.email) {
              const user = JSON.parse(localStorage.getItem('user') || '{}');
              const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
              
              if (user.email === requestData.email) {
                userName = user.name || '';
              } else if (currentUser.email === requestData.email) {
                userName = currentUser.name || '';
              }
            }
            
            // userName í•„ë“œ ì¶”ê°€í•˜ê³  ì €ì¥
            requestData.userName = userName;
            localStorage.setItem(foundRequestKey, JSON.stringify(requestData));
            console.log('ì˜ë¢° ë°ì´í„° userName ì¶”ê°€:', foundRequestKey, 'userName:', userName);
          }
          
          // currentReqKey ì„¤ì •
          currentReqKey = foundRequestKey;
          console.log('ì„¤ì •ëœ currentReqKey:', currentReqKey);
        
          resultCard.classList.remove('hidden');
          
          // ì§„í–‰ìƒí™© í‘œì‹œ
          const status = getRequestStatus(foundRequestKey);
          const statusBadge = document.getElementById('status-badge');
          statusBadge.textContent = status.text;
          statusBadge.className = `px-3 py-1 rounded-full text-sm font-bold text-white ${status.color}`;
        
          // ê²°ê³¼ ì •ë³´ í™•ì¸ - ì™„ì „íˆ ìƒˆë¡œìš´ ì ‘ê·¼ ë°©ë²•
          console.log('=== ê²°ê³¼ ë°ì´í„° ê²€ìƒ‰ ì‹œì‘ ===');
          console.log('foundRequestKey:', foundRequestKey);
          console.log('normalizedKey:', normalizedKey);
          
          // 1ë‹¨ê³„: localStorageì˜ ëª¨ë“  í‚¤ í™•ì¸
          const allKeys = Object.keys(localStorage);
          console.log('localStorage ì „ì²´ í‚¤ ê°œìˆ˜:', allKeys.length);
          
          // 2ë‹¨ê³„: ì˜ë¢° ë²ˆí˜¸ ì¶”ì¶œ
          let reqNum = '';
          if (foundRequestKey.startsWith('request-')) {
            reqNum = foundRequestKey.replace('request-', '');
          } else {
            reqNum = foundRequestKey;
          }
          console.log('ì¶”ì¶œëœ ì˜ë¢° ë²ˆí˜¸:', reqNum);
          
          // 3ë‹¨ê³„: ëª¨ë“  result í‚¤ ì°¾ê¸°
          const allResultKeys = allKeys.filter(key => key.startsWith('result-'));
          console.log('ëª¨ë“  result í‚¤ë“¤:', allResultKeys);
          
          // 4ë‹¨ê³„: ì˜ë¢° ë²ˆí˜¸ì™€ ê´€ë ¨ëœ result í‚¤ ì°¾ê¸°
          let resultData = null;
          let foundResultKey = null;
          
          for (const resultKey of allResultKeys) {
            console.log(`ê²€ì‚¬ ì¤‘: ${resultKey}`);
            
            // ì˜ë¢° ë²ˆí˜¸ê°€ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
            if (resultKey.includes(reqNum) || 
                resultKey.includes(normalizedKey) || 
                resultKey.includes(reqNum.replace('PH-', '')) ||
                resultKey.includes(normalizedKey.replace('PH-', ''))) {
              
              console.log(`âœ… ë§¤ì¹­ëœ result í‚¤ ë°œê²¬: ${resultKey}`);
              const data = localStorage.getItem(resultKey);
              
              if (data) {
                try {
                  resultData = JSON.parse(data);
                  foundResultKey = resultKey;
                  console.log('âœ… ê²°ê³¼ ë°ì´í„° íŒŒì‹± ì„±ê³µ:', resultData);
                  break;
                } catch (e) {
                  console.log(`âŒ ${resultKey} íŒŒì‹± ì‹¤íŒ¨:`, e);
                }
              }
            }
          }
          
          // 5ë‹¨ê³„: ê²°ê³¼ê°€ ì—†ìœ¼ë©´ ë” ë„“ì€ ê²€ìƒ‰
          if (!resultData) {
            console.log('âŒ ì •í™•í•œ ë§¤ì¹­ì„ ì°¾ì§€ ëª»í•¨, ë” ë„“ì€ ê²€ìƒ‰ ì‹œì‘');
            
            // ëª¨ë“  result ë°ì´í„° í™•ì¸
            for (const resultKey of allResultKeys) {
              const data = localStorage.getItem(resultKey);
              if (data) {
                try {
                  const parsed = JSON.parse(data);
                  console.log(`${resultKey}:`, parsed);
                  
                  // ì˜ë¢° ë°ì´í„°ì™€ ë¹„êµ
                  if (requestData.email && parsed.email && requestData.email === parsed.email) {
                    console.log(`âœ… ì´ë©”ì¼ë¡œ ë§¤ì¹­ëœ ê²°ê³¼ ë°œê²¬: ${resultKey}`);
                    resultData = parsed;
                    foundResultKey = resultKey;
                    break;
                  }
                } catch (e) {
                  console.log(`${resultKey} íŒŒì‹± ì‹¤íŒ¨:`, e);
                }
              }
            }
          }
          
          if (!resultData) {
            console.log('âŒ ê²°ê³¼ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
            console.log('=== ì „ì²´ localStorage ë‚´ìš© ===');
            allKeys.forEach(key => {
              if (key.includes('result') || key.includes('request')) {
                console.log(key, ':', localStorage.getItem(key));
              }
            });
          }
          
          if (resultData) {
            console.log('=== ê²°ê³¼ ë°ì´í„° í‘œì‹œ ì‹œì‘ ===');
            console.log('ì°¾ì€ ê²°ê³¼ í‚¤:', foundResultKey);
            console.log('resultData:', resultData);
            console.log('resultData.summary:', resultData.summary);
            console.log('resultData.summary íƒ€ì…:', typeof resultData.summary);
            console.log('resultData.summary ê¸¸ì´:', resultData.summary ? resultData.summary.length : 0);
            
            // ê²°ê³¼ ì„¹ì…˜ í‘œì‹œ
            resultInfo.classList.remove('hidden');
            progressMessage.classList.add('hidden');
            
            // DOM ìš”ì†Œë“¤ ê°€ì ¸ì˜¤ê¸°
            const resultPriceElement = document.getElementById('result-price');
            const resultOriginElement = document.getElementById('result-origin');
            const resultSummaryElement = document.getElementById('result-summary');
            const resultLinkElement = document.getElementById('result-link');
            
            console.log('DOM ìš”ì†Œë“¤ í™•ì¸:', {
              resultPriceElement: !!resultPriceElement,
              resultOriginElement: !!resultOriginElement,
              resultSummaryElement: !!resultSummaryElement,
              resultLinkElement: !!resultLinkElement
            });
            
            // ê°€ê²© ì„¤ì •
            if (resultPriceElement) {
              const price = resultData.price || 'ê°€ê²© ì •ë³´ ì—†ìŒ';
              resultPriceElement.textContent = price;
              console.log('âœ… ê°€ê²© ì„¤ì • ì™„ë£Œ:', price);
            } else {
              console.error('âŒ result-price ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
            }
            
            // ì›ì‚°ì§€ ì„¤ì •
            if (resultOriginElement) {
              const origin = resultData.origin || 'ì›ì‚°ì§€ ì •ë³´ ì—†ìŒ';
              resultOriginElement.textContent = origin;
              console.log('âœ… ì›ì‚°ì§€ ì„¤ì • ì™„ë£Œ:', origin);
            } else {
              console.error('âŒ result-origin ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
            }
            
            // ì¢…í•©ì„¤ëª… ì„¤ì • (ê°€ì¥ ì¤‘ìš”)
            if (resultSummaryElement) {
              const summary = resultData.summary || 'ì„¤ëª… ì •ë³´ ì—†ìŒ';
              console.log('renderRichContent í˜¸ì¶œ ì „ summary:', summary);
              
              // ì§ì ‘ innerHTML ì„¤ì •
              resultSummaryElement.innerHTML = summary;
              console.log('âœ… ì¢…í•©ì„¤ëª… ì„¤ì • ì™„ë£Œ');
              console.log('ì„¤ì • í›„ innerHTML:', resultSummaryElement.innerHTML);
            } else {
              console.error('âŒ result-summary ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
            }
            
            // ë§í¬ ì„¤ì •
            if (resultLinkElement) {
              if (resultData.link && resultData.link !== 'ë§í¬ ì •ë³´ ì—†ìŒ') {
                resultLinkElement.textContent = resultData.link;
                resultLinkElement.href = resultData.link;
                console.log('âœ… ë§í¬ ì„¤ì • ì™„ë£Œ:', resultData.link);
              } else {
                resultLinkElement.textContent = 'ë§í¬ ì •ë³´ ì—†ìŒ';
                resultLinkElement.href = '#';
                console.log('âœ… ë§í¬ ì •ë³´ ì—†ìŒìœ¼ë¡œ ì„¤ì •');
              }
            } else {
              console.error('âŒ result-link ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
            }
            
            console.log('=== ê²°ê³¼ ë°ì´í„° í‘œì‹œ ì™„ë£Œ ===');
          } else {
            console.log('âŒ ê²°ê³¼ ë°ì´í„°ê°€ ì—†ì–´ì„œ ì§„í–‰ì¤‘ ë©”ì‹œì§€ í‘œì‹œ');
            resultInfo.classList.add('hidden');
            progressMessage.classList.remove('hidden');
          }
        }
      }
      
      // ì´ë¯¸ì§€ê°€ í¬í•¨ëœ HTML ë‚´ìš©ì„ ì•ˆì „í•˜ê²Œ ë Œë”ë§í•˜ëŠ” í•¨ìˆ˜
      function renderRichContent(element, content) {
        console.log('=== renderRichContent í•¨ìˆ˜ ì‹œì‘ ===');
        console.log('element:', element);
        console.log('content:', content);
        console.log('content íƒ€ì…:', typeof content);
        console.log('content ê¸¸ì´:', content ? content.length : 0);
        
        if (!element) {
          console.error('elementê°€ nullì…ë‹ˆë‹¤!');
          return;
        }
        
        if (content && content.trim()) {
          console.log('contentë¥¼ innerHTMLë¡œ ì„¤ì •:', content);
          element.innerHTML = content;
          console.log('ì„¤ì • í›„ element.innerHTML:', element.innerHTML);
        } else {
          console.log('contentê°€ ë¹„ì–´ìˆì–´ì„œ ê¸°ë³¸ ë©”ì‹œì§€ í‘œì‹œ');
          element.textContent = 'ì„¤ëª… ì •ë³´ ì—†ìŒ';
        }
        
        console.log('=== renderRichContent í•¨ìˆ˜ ì™„ë£Œ ===');
      }
      
      // êµ¬ë§¤ ë²„íŠ¼ ê¸°ëŠ¥
      function goToDirectPurchase() {
        console.log('=== êµ¬ë§¤ ë²„íŠ¼ í´ë¦­ ===');
        console.log('currentReqKey:', currentReqKey);
        
        // í˜„ì¬ í‘œì‹œëœ ì˜ë¢° ì •ë³´ë¥¼ ì „ì—­ ë³€ìˆ˜ì—ì„œ ê°€ì ¸ì˜¤ê¸°
        if (!currentReqKey) {
          alert('ì˜ë¢° ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ì˜ë¢° ê²°ê³¼ë¥¼ ì¡°íšŒí•´ì£¼ì„¸ìš”.');
          return;
        }
        
        const currentKey = currentReqKey.replace('request-', '');
        const requestKey = currentReqKey;
        const requestData = localStorage.getItem(requestKey);
        const resultData = localStorage.getItem('result-' + currentKey);
        
        console.log('êµ¬ë§¤ ë²„íŠ¼ í´ë¦­:', {
          currentReqKey: currentReqKey,
          currentKey: currentKey,
          requestKey: requestKey,
          requestData: requestData,
          resultData: resultData
        });
        
        // localStorageì˜ ëª¨ë“  í‚¤ í™•ì¸
        console.log('localStorage ëª¨ë“  í‚¤:');
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          console.log(key, ':', localStorage.getItem(key));
        }
        
        if (!requestData || !resultData) {
          alert('êµ¬ë§¤ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n\nì˜ë¢°ë²ˆí˜¸: ' + currentKey + '\nìš”ì²­ ë°ì´í„°: ' + (requestData ? 'ìˆìŒ' : 'ì—†ìŒ') + '\nê²°ê³¼ ë°ì´í„°: ' + (resultData ? 'ìˆìŒ' : 'ì—†ìŒ'));
          return;
        }
        
        const request = JSON.parse(requestData);
        const result = JSON.parse(resultData);
        
        console.log('íŒŒì‹±ëœ ë°ì´í„°:', { request, result });
        
        // ê²°ì œ í˜ì´ì§€ë¡œ ì´ë™ (ìƒˆ ì°½)
        const paymentUrl = `payment.html?req=${currentKey}&price=${encodeURIComponent(result.price)}&name=${encodeURIComponent(request.name)}&origin=${encodeURIComponent(result.origin)}`;
        console.log('ê²°ì œ URL:', paymentUrl);
        
        // ìƒˆ ì°½ ì—´ê¸°
        const paymentWindow = window.open(paymentUrl, '_blank', 'width=1000,height=800,scrollbars=yes,resizable=yes');
        
        if (paymentWindow) {
          console.log('ê²°ì œ ì°½ì´ ì„±ê³µì ìœ¼ë¡œ ì—´ë ¸ìŠµë‹ˆë‹¤.');
        } else {
          console.error('ê²°ì œ ì°½ì„ ì—´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. íŒì—… ì°¨ë‹¨ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
          alert('ê²°ì œ ì°½ì„ ì—´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì €ì˜ íŒì—… ì°¨ë‹¨ì„ í•´ì œí•´ì£¼ì„¸ìš”.');
        }
      }
      
      function showPurchaseSupport() {
        const supportContent = `
          <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-6 max-w-lg mx-4">
              <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold text-gray-800">ğŸ¤ êµ¬ë§¤ ì§€ì› ì„œë¹„ìŠ¤</h3>
                <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700">
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                  </svg>
                </button>
              </div>
              <div class="space-y-4">
                <div class="p-4 bg-blue-50 rounded-lg">
                  <h4 class="font-bold text-blue-800 mb-2">âœ¨ í”„ë¦¬ë¯¸ì—„ êµ¬ë§¤ ì§€ì›</h4>
                  <div class="space-y-2 text-sm text-blue-700">
                    <div class="flex items-center space-x-2">
                      <span>âœ…</span>
                      <span>ì „ë‹´ êµ¬ë§¤ ëŒ€í–‰ ì„œë¹„ìŠ¤</span>
                    </div>
                    <div class="flex items-center space-x-2">
                      <span>âœ…</span>
                      <span>ì‹¤ì‹œê°„ ë°°ì†¡ ì¶”ì </span>
                    </div>
                    <div class="flex items-center space-x-2">
                      <span>âœ…</span>
                      <span>í’ˆì§ˆ ë³´ì¦ & í™˜ë¶ˆ ì§€ì›</span>
                    </div>
                    <div class="flex items-center space-x-2">
                      <span>âœ…</span>
                      <span>24ì‹œê°„ ê³ ê° ì§€ì›</span>
                    </div>
                  </div>
                </div>
                
                <div class="p-4 bg-green-50 rounded-lg">
                  <h4 class="font-bold text-green-800 mb-2">ğŸ’° ì„œë¹„ìŠ¤ ìš”ê¸ˆ</h4>
                  <div class="text-sm text-green-700">
                    <p>â€¢ êµ¬ë§¤ ê¸ˆì•¡ì˜ <strong>3%</strong> ìˆ˜ìˆ˜ë£Œ</p>
                    <p>â€¢ ìµœì†Œ ìˆ˜ìˆ˜ë£Œ: <strong>5,000ì›</strong></p>
                    <p>â€¢ ë°°ì†¡ë¹„ ë³„ë„ (ì‹¤ì œ ë°°ì†¡ë¹„)</p>
                  </div>
                </div>
                

              </div>
              
              <div class="mt-4 flex space-x-3">
                <button onclick="this.closest('.fixed').remove(); goToExternalPurchase()" class="flex-1 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition">
                  ì§ì ‘ êµ¬ë§¤í•˜ê¸°
                </button>
                <button onclick="contactSupport()" class="flex-1 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition">
                  ì§€ì› ì„œë¹„ìŠ¤ ì‹ ì²­
                </button>
              </div>
            </div>
          </div>
        `;
        document.body.insertAdjacentHTML('beforeend', supportContent);
      }

             function contactSupport() {
        // ì˜ë¢° ê²°ê³¼ê°€ í‘œì‹œëœ ìƒíƒœì¸ì§€ í™•ì¸
        console.log('=== contactSupport í•¨ìˆ˜ ì‹œì‘ ===');
        console.log('currentReqKey ê°’:', currentReqKey);
        console.log('currentReqKey íƒ€ì…:', typeof currentReqKey);
        console.log('currentReqKey ê¸¸ì´:', currentReqKey ? currentReqKey.length : 0);
        
        if (!currentReqKey) {
          console.log('currentReqKeyê°€ ì—†ìŒ - ì—ëŸ¬ ë°œìƒ');
          alert('ë¨¼ì € ì˜ë¢° ê²°ê³¼ë¥¼ ì¡°íšŒí•´ì£¼ì„¸ìš”.');
          return;
        }
        
        // í‚¤ì—ì„œ ì˜ë¢°ë²ˆí˜¸ ì¶”ì¶œ (ë‹¤ì–‘í•œ í˜•ì‹ ì§€ì›)
        let currentKey = currentReqKey;
        
        // request- ì ‘ë‘ì‚¬ ì œê±°
        if (currentKey.startsWith('request-')) {
          currentKey = currentKey.substring(8); // 'request-' ì œê±°
        }
        
        // PH- ì ‘ë‘ì‚¬ ì œê±° (ìˆë‹¤ë©´)
        if (currentKey.startsWith('PH-')) {
          currentKey = currentKey.substring(3); // 'PH-' ì œê±°
        }
        
        console.log('=== contactSupport í˜¸ì¶œë¨ ===');
        console.log('ì›ë³¸ currentReqKey:', currentReqKey);
        console.log('ì¶”ì¶œëœ currentKey:', currentKey);
        console.log('currentKey íƒ€ì…:', typeof currentKey);
        console.log('currentKey ê¸¸ì´:', currentKey.length);
        
        // êµ¬ë§¤ ì§€ì› ì„œë¹„ìŠ¤ í˜ì´ì§€ë¡œ ì´ë™
        const supportUrl = `purchase-support.html?req=${currentKey}`;
        console.log('ìƒì„±ëœ URL:', supportUrl);
        console.log('í˜„ì¬ í˜ì´ì§€ URL:', window.location.href);
        console.log('í˜„ì¬ í˜ì´ì§€ ê²½ë¡œ:', window.location.pathname);
        
        // URLì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸
        console.log('URL ê²€ì¦:');
        console.log('- req íŒŒë¼ë¯¸í„° í¬í•¨ ì—¬ë¶€:', supportUrl.includes('req='));
        console.log('- currentKey ê°’ì´ URLì— í¬í•¨ë¨:', supportUrl.includes(currentKey));
        console.log('- ìµœì¢… URL íŒŒë¼ë¯¸í„°:', `req=${currentKey}`);
        
        // ìƒˆ íƒ­ì—ì„œ ì—´ê¸°
        console.log('ìƒˆ íƒ­ì—ì„œ URL ì—´ê¸°:', supportUrl);
        window.open(supportUrl, '_blank');
        
        // ëª¨ë‹¬ ë‹«ê¸°
        const modal = document.querySelector('.fixed');
        if (modal) {
          modal.remove();
        }
      }

      function goToExternalPurchase() {
        if (!currentReqKey) {
          alert('ì˜ë¢° ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ì˜ë¢° ê²°ê³¼ë¥¼ ì¡°íšŒí•´ì£¼ì„¸ìš”.');
          return;
        }
        
        const currentKey = currentReqKey.replace('request-', '');
        const resultData = localStorage.getItem('result-' + currentKey);
        
        if (!resultData) {
          alert('êµ¬ë§¤ ë§í¬ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }
        
        const result = JSON.parse(resultData);
        
        if (!result.link || result.link === 'ë§í¬ ì •ë³´ ì—†ìŒ') {
          alert('ìµœì €ê°€ ì‡¼í•‘ëª° ë§í¬ê°€ ë“±ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
          return;
        }
        
        // ì™¸ë¶€ ë§í¬ë¡œ ì´ë™
        if (confirm('ìµœì €ê°€ ì‡¼í•‘ëª°ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâš ï¸ ì‹¤ì œ êµ¬ë§¤ëŠ” í•´ë‹¹ ì‡¼í•‘ëª°ì—ì„œ ì§„í–‰ë©ë‹ˆë‹¤.')) {
          // ì™¸ë¶€ êµ¬ë§¤ ì •ë³´ ì €ì¥
          const request = JSON.parse(localStorage.getItem(currentReqKey));
          const purchaseInfo = {
            method: 'external',
            status: 'ordered',
            orderDate: new Date().toISOString(),
            externalLink: result.link,
            productName: request.name,
            price: result.price,
            origin: result.origin
          };
          localStorage.setItem('order-' + currentKey, JSON.stringify(purchaseInfo));
          
          window.open(result.link, '_blank');
        }
      }
      

      
      // ê¸°ì¡´ ë°ì´í„° ë¶„ì„ ë° í‘œì‹œ í•¨ìˆ˜
      function analyzeExistingData() {
        console.log('=== ê¸°ì¡´ ë°ì´í„° ë¶„ì„ ===');
        const allKeys = Object.keys(localStorage);
        console.log('ëª¨ë“  localStorage í‚¤ë“¤:', allKeys);
        
        // ì˜ë¢° ê´€ë ¨ ë°ì´í„° ì°¾ê¸° (í…ŒìŠ¤íŠ¸ ë°ì´í„° ì œì™¸)
        const requestKeys = allKeys.filter(key => 
          (key.includes('request') || key.includes('PH-')) && 
          !key.includes('TEST') &&
          !key.startsWith('requestCount-')
        );
        const resultKeys = allKeys.filter(key => 
          key.includes('result') && 
          !key.includes('TEST')
        );
        const orderKeys = allKeys.filter(key => 
          key.includes('order') && 
          !key.includes('TEST')
        );
        
        console.log('ì˜ë¢° ê´€ë ¨ í‚¤ë“¤ (í…ŒìŠ¤íŠ¸ ì œì™¸):', requestKeys);
        console.log('ê²°ê³¼ ê´€ë ¨ í‚¤ë“¤ (í…ŒìŠ¤íŠ¸ ì œì™¸):', resultKeys);
        console.log('ì£¼ë¬¸ ê´€ë ¨ í‚¤ë“¤ (í…ŒìŠ¤íŠ¸ ì œì™¸):', orderKeys);
        
        // ê° ë°ì´í„°ì˜ êµ¬ì¡° ë¶„ì„
        requestKeys.forEach(key => {
          try {
            const data = JSON.parse(localStorage.getItem(key));
            console.log(`${key} ë°ì´í„° êµ¬ì¡°:`, data);
          } catch (e) {
            console.log(`${key} JSON íŒŒì‹± ì‹¤íŒ¨:`, localStorage.getItem(key));
          }
        });
        
        resultKeys.forEach(key => {
          try {
            const data = JSON.parse(localStorage.getItem(key));
            console.log(`${key} ë°ì´í„° êµ¬ì¡°:`, data);
          } catch (e) {
            console.log(`${key} JSON íŒŒì‹± ì‹¤íŒ¨:`, localStorage.getItem(key));
          }
        });
        
        return { requestKeys, resultKeys, orderKeys };
      }
      
      // ê¸°ì¡´ ë°ì´í„° ëª©ë¡ í‘œì‹œ í•¨ìˆ˜
      function showExistingRequests() {
        const { requestKeys, resultKeys } = analyzeExistingData();
        
        // ê´€ë¦¬ì ëª¨ë“œ í™•ì¸
        const isAdmin = localStorage.getItem('adminMode') === 'true';
        
        // í…ŒìŠ¤íŠ¸ ë°ì´í„° ê°•ë ¥ í•„í„°ë§
        const filteredRequestKeys = requestKeys.filter(key => {
          // í…ŒìŠ¤íŠ¸ ë°ì´í„° íŒ¨í„´ë“¤ ì œì™¸
          const isTestData = 
            key.includes('TEST') || 
            key.startsWith('requestCount-') ||
            key.includes('#PH-') ||
            key.includes('result-#PH-') ||
            key.includes('order-#PH-') ||
            key.includes('notify-#PH-') ||
            key.includes('inquiry-#PH-');
          
          return !isTestData;
        });
        
        console.log('í•„í„°ë§ëœ ì˜ë¢° í‚¤ë“¤:', filteredRequestKeys);
        
        const container = document.querySelector('main');
        const existingDiv = document.createElement('div');
        existingDiv.className = 'mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg';
        existingDiv.innerHTML = `
          <h3 class="font-bold text-blue-800 mb-2">ğŸ“‹ ê¸°ì¡´ ì˜ë¢° ëª©ë¡</h3>
          <div class="space-y-2 text-sm">
            ${filteredRequestKeys.map(key => {
              try {
                const data = JSON.parse(localStorage.getItem(key));
                const reqNum = key.replace('request-', '');
                const hasResult = resultKeys.includes(`result-${reqNum}`);
                return `
                  <div class="flex justify-between items-center p-2 bg-white rounded border">
                    <div>
                      <span class="font-medium">${reqNum}</span> - ${data.name || 'ì œí’ˆëª… ì—†ìŒ'}
                      ${hasResult ? '<span class="text-green-600 ml-2">âœ… ê²°ê³¼ìˆìŒ</span>' : '<span class="text-gray-500 ml-2">â³ ëŒ€ê¸°ì¤‘</span>'}
                    </div>
                    <div class="flex gap-2">
                      <button onclick="testRequest('${reqNum}')" class="px-2 py-1 bg-blue-500 text-white rounded text-xs hover:bg-blue-600">
                        ì¡°íšŒ
                      </button>
                      ${isAdmin ? `
                        <button onclick="deleteRequest('${reqNum}')" class="px-2 py-1 bg-red-500 text-white rounded text-xs hover:bg-red-600">
                          ì‚­ì œ
                        </button>
                      ` : ''}
                    </div>
                  </div>
                `;
              } catch (e) {
                return `<div class="text-red-600">${key} - ë°ì´í„° ì˜¤ë¥˜</div>`;
              }
            }).join('')}
          </div>
        `;
        
        container.insertBefore(existingDiv, container.children[1]);
      }
      
      // íŠ¹ì • ì˜ë¢° í…ŒìŠ¤íŠ¸ í•¨ìˆ˜
      function testRequest(reqNum) {
        console.log(`=== ${reqNum} í…ŒìŠ¤íŠ¸ ì‹œì‘ ===`);
        
        // ìƒˆë¡œìš´ ê´€ë¦¬ì ë‹µë³€ í‘œì‹œ í•¨ìˆ˜ ì‚¬ìš©
        const success = showAdminResponse(reqNum);
        if (success) {
          console.log(`${reqNum} ê´€ë¦¬ì ë‹µë³€ í‘œì‹œ ì„±ê³µ`);
        } else {
          console.log(`${reqNum} ê´€ë¦¬ì ë‹µë³€ í‘œì‹œ ì‹¤íŒ¨`);
          
          // ê¸°ì¡´ ë°©ë²•ìœ¼ë¡œë„ ì‹œë„
          const searchInput = document.getElementById('search-input');
          if (searchInput) {
            searchInput.value = reqNum;
            document.getElementById('search-btn').click();
          }
        }
      }

      function deleteRequest(reqNum) {
        if (confirm(`ì˜ë¢°ë²ˆí˜¸ ${reqNum}ì„(ë¥¼) ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâš ï¸ ì‚­ì œë˜ëŠ” ë°ì´í„°:\nâ€¢ ì˜ë¢° ì •ë³´\nâ€¢ ì˜ë¢° ê²°ê³¼\nâ€¢ ì£¼ë¬¸ ì •ë³´\nâ€¢ ì•Œë¦¼ ë°œì†¡ ê¸°ë¡\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) {
          const requestKey = `request-${reqNum}`;
          const resultKey = `result-${reqNum}`;
          const orderKey = `order-${reqNum}`;
          const notifyKey = `notify-${reqNum}`;

          // ëª¨ë“  ê´€ë ¨ ë°ì´í„° ì‚­ì œ
          localStorage.removeItem(requestKey);
          localStorage.removeItem(resultKey);
          localStorage.removeItem(orderKey);
          localStorage.removeItem(notifyKey);

          alert(`ì˜ë¢°ë²ˆí˜¸ ${reqNum}ì™€ ê´€ë ¨ ë°ì´í„°ê°€ ì™„ì „íˆ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
          // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
          window.location.reload();
        }
      }
      
      // í…ŒìŠ¤íŠ¸ ë°ì´í„° ì™„ì „ ì‚­ì œ í•¨ìˆ˜
      function cleanupTestData() {
        console.log('=== í…ŒìŠ¤íŠ¸ ë°ì´í„° ì™„ì „ ì‚­ì œ ì‹œì‘ ===');
        
        // ëª¨ë“  localStorage í‚¤ í™•ì¸
        const allKeys = Object.keys(localStorage);
        
        // í…ŒìŠ¤íŠ¸ ê´€ë ¨ í‚¤ë“¤ ì‚­ì œ
        allKeys.forEach(key => {
          if (key.includes('TEST') || key.includes('test')) {
            localStorage.removeItem(key);
            console.log('ì‚­ì œëœ í…ŒìŠ¤íŠ¸ í‚¤:', key);
          }
        });
        
        console.log('âœ… í…ŒìŠ¤íŠ¸ ë°ì´í„° ì™„ì „ ì‚­ì œ ì™„ë£Œ');
      }
      
      // ê²°ê³¼ ìˆ¨ê¸°ê¸° í•¨ìˆ˜
      function hideResult() {
        console.log('=== ê²°ê³¼ ìˆ¨ê¸°ê¸° ì‹¤í–‰ ===');
        
        // result-card ìˆ¨ê¸°ê¸°
        const resultCard = document.getElementById('result-card');
        if (resultCard) {
          resultCard.style.display = 'none';
          console.log('âœ… result-card ìˆ¨ê¹€ ì™„ë£Œ');
        }
        
        // result-info ìˆ¨ê¸°ê¸°
        const resultInfo = document.getElementById('result-info');
        if (resultInfo) {
          resultInfo.style.display = 'none';
          console.log('âœ… result-info ìˆ¨ê¹€ ì™„ë£Œ');
        }
        
        // progress-message ìˆ¨ê¸°ê¸°
        const progressMessage = document.getElementById('progress-message');
        if (progressMessage) {
          progressMessage.style.display = 'none';
          console.log('âœ… progress-message ìˆ¨ê¹€ ì™„ë£Œ');
        }
        
        // no-result ìˆ¨ê¸°ê¸°
        const noResult = document.getElementById('no-result');
        if (noResult) {
          noResult.style.display = 'none';
          console.log('âœ… no-result ìˆ¨ê¹€ ì™„ë£Œ');
        }
        
        // loading ìˆ¨ê¸°ê¸°
        const loading = document.getElementById('loading');
        if (loading) {
          loading.style.display = 'none';
          console.log('âœ… loading ìˆ¨ê¹€ ì™„ë£Œ');
        }
        
        console.log('=== ê²°ê³¼ ìˆ¨ê¸°ê¸° ì™„ë£Œ ===');
      }
      
      // ì™„ì „íˆ ìƒˆë¡œìš´ ê´€ë¦¬ì ë‹µë³€ í‘œì‹œ í•¨ìˆ˜
      function showAdminResponse(reqNum) {
        console.log('=== ìƒˆë¡œìš´ ê´€ë¦¬ì ë‹µë³€ í‘œì‹œ ì‹œë„ ===');
        console.log('ì˜ë¢° ë²ˆí˜¸:', reqNum);
        
        // ëª¨ë“  ê°€ëŠ¥í•œ ê²°ê³¼ í‚¤ ì‹œë„
        const possibleKeys = [
          `result-${reqNum}`,
          `result-PH-${reqNum}`,
          `result-${reqNum.replace('PH-', '')}`,
          `result-${reqNum.replace('#', '')}`,
          `result-${reqNum.replace('#PH-', '')}`
        ];
        
        console.log('ì‹œë„í•  í‚¤ë“¤:', possibleKeys);
        
        let resultData = null;
        let foundKey = null;
        
        for (const key of possibleKeys) {
          const data = localStorage.getItem(key);
          if (data) {
            try {
              resultData = JSON.parse(data);
              foundKey = key;
              console.log('âœ… ê²°ê³¼ ë°ì´í„° ë°œê²¬:', key, resultData);
              break;
            } catch (e) {
              console.log('âŒ íŒŒì‹± ì‹¤íŒ¨:', key, e);
            }
          }
        }
        
        if (resultData && resultData.summary) {
          console.log('=== DOM ìš”ì†Œ ê°•ì œ í‘œì‹œ ì‹œì‘ ===');
          
          // 1. result-info ì„¹ì…˜ ê°•ì œ í‘œì‹œ
          const resultInfo = document.getElementById('result-info');
          console.log('result-info ìš”ì†Œ:', resultInfo);
          
          if (resultInfo) {
            // ëª¨ë“  í´ë˜ìŠ¤ ì œê±°í•˜ê³  ê°•ì œ í‘œì‹œ
            resultInfo.className = '';
            resultInfo.style.cssText = `
              display: block !important;
              visibility: visible !important;
              opacity: 1 !important;
              background-color: #fef3c7 !important;
              border: 3px solid #f59e0b !important;
              padding: 20px !important;
              margin: 20px 0 !important;
              border-radius: 12px !important;
              box-shadow: 0 4px 12px rgba(0,0,0,0.1) !important;
            `;
            console.log('âœ… result-info ê°•ì œ í‘œì‹œ ì™„ë£Œ');
          } else {
            console.error('âŒ result-info ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
          }
          
          // 2. progress-message ìˆ¨ê¸°ê¸°
          const progressMessage = document.getElementById('progress-message');
          if (progressMessage) {
            progressMessage.style.display = 'none';
            console.log('âœ… progress-message ìˆ¨ê¹€ ì™„ë£Œ');
          }
          
          // 3. result-summary ê°•ì œ í‘œì‹œ
          const resultSummaryElement = document.getElementById('result-summary');
          console.log('result-summary ìš”ì†Œ:', resultSummaryElement);
          
          if (resultSummaryElement) {
            // ë‚´ìš© ì„¤ì •
            resultSummaryElement.innerHTML = resultData.summary;
            
            // ê°•ì œ ìŠ¤íƒ€ì¼ ì ìš©
            resultSummaryElement.style.cssText = `
              display: block !important;
              visibility: visible !important;
              opacity: 1 !important;
              background-color: #dbeafe !important;
              border: 3px solid #3b82f6 !important;
              padding: 20px !important;
              margin: 15px 0 !important;
              border-radius: 8px !important;
              font-size: 16px !important;
              line-height: 1.6 !important;
              color: #1f2937 !important;
              min-height: 100px !important;
              overflow: visible !important;
              word-wrap: break-word !important;
            `;
            
            console.log('âœ… result-summary ê°•ì œ í‘œì‹œ ì™„ë£Œ');
            console.log('ì„¤ì •ëœ ë‚´ìš©:', resultSummaryElement.innerHTML);
          } else {
            console.error('âŒ result-summary ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
          }
          
          // 4. ê°€ê²© ì •ë³´ í‘œì‹œ
          const resultPriceElement = document.getElementById('result-price');
          if (resultPriceElement) {
            resultPriceElement.textContent = resultData.price || 'ê°€ê²© ì •ë³´ ì—†ìŒ';
            resultPriceElement.style.cssText = `
              color: #059669 !important;
              font-weight: bold !important;
              font-size: 18px !important;
            `;
            console.log('âœ… ê°€ê²© ì •ë³´ ì„¤ì • ì™„ë£Œ');
          }
          
          // 5. ì›ì‚°ì§€ ì •ë³´ í‘œì‹œ
          const resultOriginElement = document.getElementById('result-origin');
          if (resultOriginElement) {
            resultOriginElement.textContent = resultData.origin || 'ì›ì‚°ì§€ ì •ë³´ ì—†ìŒ';
            resultOriginElement.style.cssText = `
              color: #374151 !important;
              font-weight: 500 !important;
            `;
            console.log('âœ… ì›ì‚°ì§€ ì •ë³´ ì„¤ì • ì™„ë£Œ');
          }
          
          // 6. ê²°ê³¼ ì¹´ë“œ í‘œì‹œ
          const resultCard = document.getElementById('result-card');
          if (resultCard) {
            resultCard.style.display = 'block';
            resultCard.classList.remove('hidden');
            console.log('âœ… result-card í‘œì‹œ ì™„ë£Œ');
          }
          
          // 7. ë¡œë”© ìˆ¨ê¸°ê¸°
          const loading = document.getElementById('loading');
          if (loading) {
            loading.style.display = 'none';
            console.log('âœ… loading ìˆ¨ê¹€ ì™„ë£Œ');
          }
          
          // 8. no-result ìˆ¨ê¸°ê¸°
          const noResult = document.getElementById('no-result');
          if (noResult) {
            noResult.style.display = 'none';
            console.log('âœ… no-result ìˆ¨ê¹€ ì™„ë£Œ');
          }
          
          console.log('=== ê´€ë¦¬ì ë‹µë³€ í‘œì‹œ ì™„ë£Œ ===');
          return true;
        } else {
          console.log('âŒ ê´€ë¦¬ì ë‹µë³€ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ');
          console.log('resultData:', resultData);
          console.log('resultData.summary:', resultData ? resultData.summary : 'resultData ì—†ìŒ');
          return false;
        }
      }
      
      // í…ŒìŠ¤íŠ¸ìš© í•¨ìˆ˜ - ê°•í™”ëœ ë””ë²„ê¹…
      function testRealAdminResponse() {
        console.log('=== ê°•í™”ëœ ê´€ë¦¬ì ë‹µë³€ í…ŒìŠ¤íŠ¸ ì‹œì‘ ===');
        
        // 1ë‹¨ê³„: localStorage ì „ì²´ ë¶„ì„
        const allKeys = Object.keys(localStorage);
        console.log('localStorage ì „ì²´ í‚¤ ê°œìˆ˜:', allKeys.length);
        
        // 2ë‹¨ê³„: ì˜ë¢°ì™€ ê²°ê³¼ ë°ì´í„° ë¶„ë¦¬
        const requestKeys = allKeys.filter(key => key.startsWith('request-') && !key.includes('TEST'));
        const resultKeys = allKeys.filter(key => key.startsWith('result-') && !key.includes('TEST'));
        
        console.log('ì˜ë¢° í‚¤ë“¤:', requestKeys);
        console.log('ê²°ê³¼ í‚¤ë“¤:', resultKeys);
        
        // 3ë‹¨ê³„: ê° ì˜ë¢°ì— ëŒ€í•œ ê²°ê³¼ í™•ì¸
        requestKeys.forEach(reqKey => {
          const reqNum = reqKey.replace('request-', '');
          console.log(`\n=== ì˜ë¢° ${reqNum} ë¶„ì„ ===`);
          
          // ì˜ë¢° ë°ì´í„° í™•ì¸
          const reqData = localStorage.getItem(reqKey);
          if (reqData) {
            try {
              const parsedReq = JSON.parse(reqData);
              console.log('ì˜ë¢° ë°ì´í„°:', parsedReq);
            } catch (e) {
              console.log('ì˜ë¢° ë°ì´í„° íŒŒì‹± ì‹¤íŒ¨:', e);
            }
          }
          
          // í•´ë‹¹ ê²°ê³¼ ì°¾ê¸°
          const matchingResults = resultKeys.filter(resultKey => 
            resultKey.includes(reqNum) || 
            resultKey.includes(reqNum.replace('PH-', ''))
          );
          
          console.log('ë§¤ì¹­ëœ ê²°ê³¼ í‚¤ë“¤:', matchingResults);
          
          matchingResults.forEach(resultKey => {
            const resultData = localStorage.getItem(resultKey);
            if (resultData) {
              try {
                const parsed = JSON.parse(resultData);
                console.log(`${resultKey} ê²°ê³¼:`, parsed);
              } catch (e) {
                console.log(`${resultKey} íŒŒì‹± ì‹¤íŒ¨:`, e);
              }
            }
          });
        });
        
        // 4ë‹¨ê³„: ì‹¤ì œ í‘œì‹œ í…ŒìŠ¤íŠ¸
        if (requestKeys.length > 0) {
          const firstReqKey = requestKeys[0];
          const reqNum = firstReqKey.replace('request-', '');
          console.log(`\n=== ì²« ë²ˆì§¸ ì˜ë¢° ${reqNum} í‘œì‹œ í…ŒìŠ¤íŠ¸ ===`);
          
          // ì§ì ‘ ê´€ë¦¬ì ë‹µë³€ í‘œì‹œ ì‹œë„
          const success = showAdminResponse(reqNum);
          if (success) {
            console.log('âœ… ê´€ë¦¬ì ë‹µë³€ í‘œì‹œ ì„±ê³µ');
          } else {
            console.log('âŒ ê´€ë¦¬ì ë‹µë³€ í‘œì‹œ ì‹¤íŒ¨');
          }
        }
        
        console.log('=== ê°•í™”ëœ ê´€ë¦¬ì ë‹µë³€ í…ŒìŠ¤íŠ¸ ì™„ë£Œ ===');
      }
      
      // ê°•í™”ëœ í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± í•¨ìˆ˜
      function createTestData() {
        console.log('=== ê°•í™”ëœ í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± ì‹œì‘ ===');
        
        // ê¸°ì¡´ í…ŒìŠ¤íŠ¸ ë°ì´í„° ì‚­ì œ
        localStorage.removeItem('request-TEST123');
        localStorage.removeItem('result-TEST123');
        
        // í…ŒìŠ¤íŠ¸ ì˜ë¢° ë°ì´í„°
        const testRequestData = {
          name: 'ğŸ”¥ í…ŒìŠ¤íŠ¸ ì œí’ˆ (ê°•í™”ë²„ì „)',
          desc: 'ì´ê²ƒì€ ê°•í™”ëœ í…ŒìŠ¤íŠ¸ ì œí’ˆì…ë‹ˆë‹¤!',
          price: '50000',
          email: 'test@test.com',
          phone: '010-1234-5678',
          userName: 'í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì',
          date: Date.now()
        };
        
        // í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë°ì´í„° (ë” ëˆˆì— ë„ëŠ” ë‚´ìš©)
        const testResultData = {
          price: 'ğŸ¯ 45,000ì› (íŠ¹ê°€!)',
          origin: 'ğŸ‡°ğŸ‡· ëŒ€í•œë¯¼êµ­',
          summary: `
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; margin: 10px 0;">
              <h2 style="color: white; margin: 0 0 15px 0;">ğŸ‰ í…ŒìŠ¤íŠ¸ ê´€ë¦¬ì ë‹µë³€ì…ë‹ˆë‹¤!</h2>
              <p style="margin: 10px 0; font-size: 16px;">ì´ê²ƒì€ ê´€ë¦¬ìê°€ ì‘ì„±í•œ <strong>ë¦¬ì¹˜ í…ìŠ¤íŠ¸</strong> ë‹µë³€ì…ë‹ˆë‹¤.</p>
              <p style="margin: 10px 0; font-size: 18px; color: #ffd700;">âœ¨ ìƒ‰ìƒê³¼ í¬ê¸°ë„ ì ìš©ë©ë‹ˆë‹¤! âœ¨</p>
              <ul style="margin: 10px 0; padding-left: 20px;">
                <li style="margin: 5px 0;">âœ… í•­ëª© 1: í…ŒìŠ¤íŠ¸ ì„±ê³µ</li>
                <li style="margin: 5px 0;">âœ… í•­ëª© 2: í‘œì‹œ í™•ì¸</li>
                <li style="margin: 5px 0;">âœ… í•­ëª© 3: ì™„ë²½ ì‘ë™</li>
              </ul>
              <div style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 5px; margin-top: 15px;">
                <p style="margin: 0; text-align: center; font-weight: bold;">ğŸŠ ì´ì œ ê´€ë¦¬ì ë‹µë³€ì´ ë³´ì¼ ê²ƒì…ë‹ˆë‹¤! ğŸŠ</p>
              </div>
            </div>
          `,
          link: 'https://example.com'
        };
        
        // localStorageì— ì €ì¥
        const testReqNum = 'TEST123';
        localStorage.setItem(`request-${testReqNum}`, JSON.stringify(testRequestData));
        localStorage.setItem(`result-${testReqNum}`, JSON.stringify(testResultData));
        
        console.log('âœ… ê°•í™”ëœ í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± ì™„ë£Œ');
        console.log('ì˜ë¢° í‚¤:', `request-${testReqNum}`);
        console.log('ê²°ê³¼ í‚¤:', `result-${testReqNum}`);
        
        // ì¦‰ì‹œ í‘œì‹œ í…ŒìŠ¤íŠ¸
        setTimeout(() => {
          const success = showAdminResponse(testReqNum);
          if (success) {
            console.log('âœ… ê°•í™”ëœ í…ŒìŠ¤íŠ¸ ë°ì´í„° í‘œì‹œ ì„±ê³µ');
          } else {
            console.log('âŒ ê°•í™”ëœ í…ŒìŠ¤íŠ¸ ë°ì´í„° í‘œì‹œ ì‹¤íŒ¨');
          }
        }, 500);
      }
      
      // í…ŒìŠ¤íŠ¸ ë°ì´í„° ì™„ì „ ì‚­ì œ í•¨ìˆ˜
      function cleanupTestData() {
        console.log('=== í…ŒìŠ¤íŠ¸ ë°ì´í„° ì™„ì „ ì‚­ì œ ì‹œì‘ ===');
        
        // ëª¨ë“  localStorage í‚¤ í™•ì¸
        const allKeys = Object.keys(localStorage);
        
        // í…ŒìŠ¤íŠ¸ ê´€ë ¨ í‚¤ë“¤ ì‚­ì œ
        allKeys.forEach(key => {
          if (key.includes('TEST') || key.includes('test')) {
            localStorage.removeItem(key);
            console.log('ì‚­ì œëœ í…ŒìŠ¤íŠ¸ í‚¤:', key);
          }
        });
        
        console.log('âœ… í…ŒìŠ¤íŠ¸ ë°ì´í„° ì™„ì „ ì‚­ì œ ì™„ë£Œ');
      }
      
      // í˜ì´ì§€ ë¡œë“œ ì‹œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
      window.addEventListener('DOMContentLoaded', function() {
        console.log('=== í˜ì´ì§€ ë¡œë“œë¨ ===');
        
        // í…ŒìŠ¤íŠ¸ ë°ì´í„° ì™„ì „ ì‚­ì œ
        cleanupTestData();
        
        // DOMì´ ì™„ì „íˆ ë¡œë“œëœ í›„ ì‹¤í–‰
        setTimeout(() => {
          console.log('=== DOM ì™„ì „ ë¡œë“œ í›„ ì‹¤í–‰ ===');
          
          // í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± ë¹„í™œì„±í™” (ì‹¤ì œ ìš´ì˜ìš©)
          // createTestData();
          
          // ì‹¤ì œ ë°ì´í„° í…ŒìŠ¤íŠ¸ ì‹¤í–‰
          testRealAdminResponse();
          
          // ê¸°ì¡´ ë°ì´í„° ë¶„ì„ ë° í‘œì‹œ
          showExistingRequests();
          
          renderMyRequestList();
        }, 100);
      });
      
      // ëª¨ë“  ë¦¬ì†ŒìŠ¤ ë¡œë“œ ì™„ë£Œ í›„ ì¶”ê°€ ì‹¤í–‰
      window.addEventListener('load', function() {
        console.log('=== ëª¨ë“  ë¦¬ì†ŒìŠ¤ ë¡œë“œ ì™„ë£Œ ===');
        
        // í…ŒìŠ¤íŠ¸ ë°ì´í„° ì™„ì „ ì‚­ì œ (ìµœì¢… í™•ì¸)
        cleanupTestData();
      });
      
      searchBtn.onclick = function() {
        resultCard.classList.add('hidden');
        noResult.classList.add('hidden');
        loading.classList.remove('hidden');
        setTimeout(() => {
          loading.classList.add('hidden');
          const val = document.getElementById('search-input').value.trim();
          showResultByKey(val);
        }, 1200);
      };
    </script>
  </body>
</html> 