<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ì˜ë¢° ê²°ê³¼ ì¡°íšŒ | PriceHunter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
      body { font-family: 'Noto Sans KR', 'Inter', sans-serif; }
      .fade-in { animation: fadeIn 0.7s; }
      @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
      .spinner {
        border: 4px solid #e5e7eb;
        border-top: 4px solid #38bdf8;
        border-radius: 50%;
        width: 2.5rem;
        height: 2.5rem;
        animation: spin 1s linear infinite;
        margin: 0 auto;
      }
      @keyframes spin { 100% { transform: rotate(360deg); } }
      
      /* ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ë§ */
      #result-summary img {
        max-width: 100%;
        height: auto;
        margin: 10px 0;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        display: block;
      }
      
      /* ë¦¬ì¹˜ í…ìŠ¤íŠ¸ ë‚´ìš© ìŠ¤íƒ€ì¼ë§ */
      #result-summary {
        line-height: 1.6;
        word-wrap: break-word;
      }
      
      #result-summary p {
        margin: 8px 0;
      }
      
      #result-summary strong {
        font-weight: bold;
      }
      
      #result-summary em {
        font-style: italic;
      }
      
      #result-summary u {
        text-decoration: underline;
      }
    </style>
  </head>
  <body class="bg-gradient-to-br from-blue-50 via-emerald-50 to-pink-50 min-h-screen flex items-center justify-center px-2">
    <main class="w-full max-w-2xl bg-white/90 rounded-3xl shadow-2xl p-8 md:p-12 flex flex-col items-center text-center backdrop-blur-md mt-8 mb-8">
      <h1 class="text-2xl md:text-3xl font-extrabold text-blue-600 mb-6">ì˜ë¢° ê²°ê³¼ ì¡°íšŒ</h1>
      <div class="w-full mb-6">
        <label class="block text-gray-700 font-semibold mb-2 text-left" for="search-input">
          ì˜ë¢°ë²ˆí˜¸ ë˜ëŠ” íœ´ëŒ€í° ë²ˆí˜¸ë¡œ ê²°ê³¼ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </label>
        <div class="flex flex-col md:flex-row gap-3">
          <input id="search-input" type="text" class="flex-1 px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-400 focus:outline-none transition text-lg" placeholder="#PH-000000 ë˜ëŠ” 010-1234-5678" />
        </div>
        <!-- CAPTCHA Placeholder -->
        <div class="mt-4 flex justify-center">
          <div class="bg-gray-100 rounded-lg px-4 py-2 text-gray-400 text-sm select-none">(ì—¬ê¸°ì— CAPTCHAê°€ ë“¤ì–´ê°ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤)</div>
        </div>
        <button id="search-btn" class="mt-6 w-full py-3 bg-gradient-to-r from-blue-400 to-emerald-400 text-white font-bold rounded-lg shadow-lg hover:scale-105 transition-all duration-300 text-lg">ì¡°íšŒí•˜ê¸°</button>
      </div>
      <!-- ë‚´ ì˜ë¢° ë¦¬ìŠ¤íŠ¸ (ë¡œê·¸ì¸ ì‹œ) -->
      <div id="my-request-list-section" class="w-full mb-8 hidden">
        <div class="font-bold text-blue-700 mb-2 text-left">ë‚´ê°€ ì˜ë¢°í•œ ë‚´ì—­</div>
        <ul id="my-request-list" class="bg-blue-50 rounded-xl shadow-inner divide-y divide-blue-100 text-left"></ul>
      </div>
      <!-- Loading Animation -->
      <div id="loading" class="hidden my-8"><div class="spinner"></div><div class="mt-2 text-blue-400 font-semibold">ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div></div>
      <!-- Result Card -->
      <div id="result-card" class="hidden w-full fade-in">
        <div class="bg-white rounded-2xl shadow-lg p-6 mb-4 text-left">
          <!-- ì§„í–‰ìƒí™© ë°°ì§€ -->
          <div class="mb-4 flex justify-between items-center">
            <div class="text-lg font-bold text-gray-800">ì˜ë¢° ìƒì„¸ ì •ë³´</div>
            <div id="status-badge" class="px-3 py-1 rounded-full text-sm font-bold text-white"></div>
          </div>
          
          <!-- ì˜ë¢° ì •ë³´ -->
          <div class="mb-4 p-4 bg-gray-50 rounded-lg">
            <div class="mb-2 text-gray-600"><span class="font-semibold">ì˜ë¢°ë²ˆí˜¸:</span> <span id="request-num"></span></div>
            <div class="mb-2 text-gray-600"><span class="font-semibold">ì œí’ˆëª…:</span> <span id="request-name"></span></div>
            <div class="mb-2 text-gray-600"><span class="font-semibold">ì œí’ˆì„¤ëª…:</span> <span id="request-desc"></span></div>
            <div class="mb-2 text-gray-600"><span class="font-semibold">ì°¸ê³ ì‚¬ì´íŠ¸:</span> <span id="request-url"></span></div>
            <div class="mb-2 text-gray-600"><span class="font-semibold">í¬ë§ê°€ê²©:</span> <span id="request-price"></span></div>
            <div class="mb-2 text-gray-600"><span class="font-semibold">ì˜ë¢°ì¼ì‹œ:</span> <span id="request-date"></span></div>
          </div>
          
          <!-- ê²°ê³¼ ì •ë³´ -->
          <div id="result-info" class="hidden">
            <div class="mb-3 flex flex-col md:flex-row md:items-center md:justify-between">
              <div class="text-xl font-bold text-gray-800 mb-2 md:mb-0">ìµœì €ê°€: <span id="result-price" class="text-emerald-600">â‚©123,000</span></div>
            </div>
            <div class="mb-2 text-gray-600">ì›ì‚°ì§€/ê³µê¸‰ì²˜: <span id="result-origin">ëŒ€í•œë¯¼êµ­ / PriceHunter ê³µì‹</span></div>
            <div class="mb-4">
              <div class="font-semibold text-gray-700 mb-1">ì¢…í•©ì„¤ëª…</div>
              <div id="result-summary" class="text-gray-700 bg-gray-50 rounded-xl p-4 min-h-[60px] overflow-hidden">ê°€ê²©, ì›ì‚°ì§€, ìƒí’ˆíŠ¹ì§• ë“± ì „ì²´ì ì¸ ì„¤ëª…ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
            </div>
            
            <!-- êµ¬ë§¤ ì˜µì…˜ -->
            <div class="mb-4 p-4 bg-gradient-to-r from-blue-50 to-emerald-50 rounded-xl border border-blue-100">
              <div class="font-bold text-gray-800 mb-3 text-center">ğŸ›’ êµ¬ë§¤ ì˜µì…˜</div>
              <div class="text-sm text-gray-600 mb-3">
                ìµœì €ê°€ ì •ë³´ë¥¼ í™•ì¸í–ˆìŠµë‹ˆë‹¤. ì›í•˜ì‹œëŠ” êµ¬ë§¤ ë°©ë²•ì„ ì„ íƒí•´ì£¼ì„¸ìš”.
              </div>
              <div class="flex flex-col md:flex-row gap-3">
                <button id="buy-external-btn" onclick="goToExternalPurchase()" class="flex-1 py-3 bg-gradient-to-r from-emerald-500 to-emerald-600 text-white font-bold rounded-lg shadow-lg hover:scale-105 transition-all duration-300">
                  <div class="text-lg">ğŸ›ï¸</div>
                  <div class="text-sm">ì§ì ‘ êµ¬ë§¤í•˜ê¸°</div>
                  <div class="text-xs opacity-90">ìµœì €ê°€ ì‡¼í•‘ëª°ì—ì„œ êµ¬ë§¤</div>
                </button>
                <button onclick="showPurchaseSupport()" class="flex-1 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white font-bold rounded-lg shadow-lg hover:scale-105 transition-all duration-300">
                  <div class="text-lg">ğŸ¤</div>
                  <div class="text-sm">êµ¬ë§¤ ì§€ì› ì„œë¹„ìŠ¤</div>
                  <div class="text-xs opacity-90">ì „ë‹´ ê´€ë¦¬ & ì¶”ì </div>
                </button>
              </div>
            </div>
          </div>
          
          <!-- ì§„í–‰ì¤‘ ë©”ì‹œì§€ -->
          <div id="progress-message" class="hidden">
            <div class="text-center py-8">
              <div class="text-2xl mb-2">ğŸ”„</div>
              <div class="text-lg font-bold text-gray-700 mb-2">ì˜ë¢° ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤</div>
              <div class="text-gray-500">PriceHunterê°€ ìµœì €ê°€ë¥¼ ì°¾ê³  ìˆìŠµë‹ˆë‹¤.</div>
              <div class="text-sm text-gray-400 mt-2">ì™„ë£Œë˜ë©´ ìë™ìœ¼ë¡œ ì•Œë¦¼ì„ ë“œë¦½ë‹ˆë‹¤.</div>
            </div>
          </div>
        </div>
      </div>
      <!-- No Result Message -->
      <div id="no-result" class="hidden w-full fade-in">
        <div class="bg-white rounded-2xl shadow-lg p-6 text-center text-gray-500">
          <div class="text-lg font-bold mb-2">ì¡°íšŒëœ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
          <div class="text-sm">ì…ë ¥í•˜ì‹  ì •ë³´ë¥¼ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.</div>
        </div>
      </div>
      <!-- Help Text -->
      <div class="mt-8 text-gray-400 text-sm">
        ê²°ê³¼ ì¡°íšŒê°€ ì–´ë µë‹¤ë©´ ê³ ê°ì„¼í„°ë¡œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.<br/>
        <span class="font-semibold">ë¬¸ì˜: contact@pricehunter.kr</span>
      </div>
    </main>
    <script>
      const searchBtn = document.getElementById('search-btn');
      let currentReqKey = ''; // í˜„ì¬ í‘œì‹œëœ ì˜ë¢°ì˜ í‚¤
      const loading = document.getElementById('loading');
      const resultCard = document.getElementById('result-card');
      const noResult = document.getElementById('no-result');
      
      // ì§„í–‰ìƒí™© íŒë‹¨ í•¨ìˆ˜
      function getRequestStatus(reqKey) {
        const reqNum = reqKey.replace('request-', '');
        const hasResult = !!localStorage.getItem('result-' + reqNum);
        
        if (!hasResult) {
          return { status: 'new', text: 'ì‹ ê·œì˜ë¢°', color: 'bg-red-500' };
        }
        
        const result = JSON.parse(localStorage.getItem('result-' + reqNum) || '{}');
        if (result.price && result.origin && result.summary && result.link) {
          return { status: 'complete', text: 'ì™„ë£Œ', color: 'bg-green-500' };
        }
        
        return { status: 'progress', text: 'ì§„í–‰ì¤‘', color: 'bg-orange-500' };
      }
      
      function getMyRequestList(email) {
        const list = [];
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          if (key.startsWith('request-')) {
            const req = JSON.parse(localStorage.getItem(key));
            if (req.email === email) {
              list.push({ key, ...req });
            }
          }
        }
        // ìµœì‹ ìˆœ ì •ë ¬(ê°€ì¥ ìµœê·¼ì´ ìœ„ë¡œ)
        return list.sort((a, b) => (b.date || 0) - (a.date || 0));
      }
      
      function renderMyRequestList() {
        const user = JSON.parse(localStorage.getItem('user') || 'null');
        const loggedIn = localStorage.getItem('loggedIn') === 'true';
        const section = document.getElementById('my-request-list-section');
        const ul = document.getElementById('my-request-list');
        if (!loggedIn || !user) {
          section.classList.add('hidden');
          return;
        }
        const list = getMyRequestList(user.email);
        section.classList.remove('hidden');
        ul.innerHTML = '';
        if (list.length === 0) {
          ul.innerHTML = '<li class="py-4 text-center text-gray-400">ë‚´ê°€ ì˜ë¢°í•œ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</li>';
          return;
        }
        list.forEach(req => {
          const li = document.createElement('li');
          li.className = 'py-3 px-4 hover:bg-blue-100 cursor-pointer flex justify-between items-center';
          
          const status = getRequestStatus(req.key);
          const statusBadge = `<span class="px-2 py-1 rounded text-xs font-bold text-white ${status.color}">${status.text}</span>`;
          
          li.innerHTML = `
            <div class="flex items-center gap-3">
              <span class="font-semibold text-blue-600">${req.key.replace('request-','')}</span>
              <span class="text-gray-700">${req.name}</span>
              ${statusBadge}
            </div>
            <span class="text-xs text-gray-400">${req.date ? new Date(req.date).toLocaleString() : ''}</span>
          `;
          li.onclick = function() { 
            currentReqKey = req.key; // ì „ì—­ ë³€ìˆ˜ì— í˜„ì¬ ì˜ë¢° í‚¤ ì €ì¥
            showResultByKey(req.key.replace('request-','')); 
          };
          ul.appendChild(li);
        });
      }
      
      function showResultByKey(key) {
        console.log('=== showResultByKey í˜¸ì¶œ ===');
        console.log('ì…ë ¥ëœ key:', key);
        
        // ê²°ê³¼ ì¹´ë“œ í‘œì‹œ
        const resultCard = document.getElementById('result-card');
        const noResult = document.getElementById('no-result');
        const resultInfo = document.getElementById('result-info');
        const progressMessage = document.getElementById('progress-message');
        
        resultCard.classList.add('hidden');
        noResult.classList.add('hidden');
        
        // ì˜ë¢° ì •ë³´ ì°¾ê¸°
        const requestKey = 'request-' + key;
        currentReqKey = requestKey; // ì „ì—­ ë³€ìˆ˜ì— í˜„ì¬ ì˜ë¢° í‚¤ ì €ì¥
        console.log('ì„¤ì •ëœ currentReqKey:', currentReqKey);
        const requestData = localStorage.getItem(requestKey);
        
        if (!requestData) {
          noResult.classList.remove('hidden');
          return;
        }
        
        const request = JSON.parse(requestData);
        resultCard.classList.remove('hidden');
        
        // ì˜ë¢° ì •ë³´ í‘œì‹œ
        const requestNumElement = document.getElementById('request-num');
        if (requestNumElement) {
          requestNumElement.textContent = key;
        } else {
          console.error('request-num ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }
        const requestNameElement = document.getElementById('request-name');
        const requestDescElement = document.getElementById('request-desc');
        const requestPriceElement = document.getElementById('request-price');
        const requestDateElement = document.getElementById('request-date');
        
        if (requestNameElement) requestNameElement.textContent = request.name || '';
        if (requestDescElement) requestDescElement.textContent = request.desc || '';
        if (requestPriceElement) requestPriceElement.textContent = request.price || '';
        if (requestDateElement) requestDateElement.textContent = request.date ? new Date(request.date).toLocaleString() : '';
        
        // ì°¸ê³ ì‚¬ì´íŠ¸ í‘œì‹œ
        const urlEl = document.getElementById('request-url');
        if (request.urls && Array.isArray(request.urls)) {
          urlEl.innerHTML = request.urls.map(u => {
            if (/^https?:\/\//.test(u)) {
              return `<a href="${u}" target="_blank" class="text-blue-600 underline break-all mr-2">${u}</a>`;
            } else {
              return `<span class="text-gray-700 bg-gray-100 rounded px-2 py-1 mr-2">${u}</span>`;
            }
          }).join('');
        } else if (request.url) {
          urlEl.innerHTML = `<a href="${request.url}" target="_blank" class="text-blue-600 underline break-all">${request.url}</a>`;
        } else {
          urlEl.innerHTML = 'ì—†ìŒ';
        }
        
        // ì§„í–‰ìƒí™© í‘œì‹œ
        const status = getRequestStatus(requestKey);
        const statusBadge = document.getElementById('status-badge');
        statusBadge.textContent = status.text;
        statusBadge.className = `px-3 py-1 rounded-full text-sm font-bold text-white ${status.color}`;
        
        // ê²°ê³¼ ì •ë³´ í™•ì¸
        const resultData = localStorage.getItem('result-' + key);
        if (resultData) {
          const result = JSON.parse(resultData);
          resultInfo.classList.remove('hidden');
          progressMessage.classList.add('hidden');
          
          const resultPriceElement = document.getElementById('result-price');
          const resultOriginElement = document.getElementById('result-origin');
          const resultSummaryElement = document.getElementById('result-summary');
          const resultLinkElement = document.getElementById('result-link');
          
          if (resultPriceElement) resultPriceElement.textContent = result.price || '';
          if (resultOriginElement) resultOriginElement.textContent = result.origin || '';
          if (resultSummaryElement) {
            renderRichContent(resultSummaryElement, result.summary);
          }
          
          if (resultLinkElement) {
            if (result.link) {
              resultLinkElement.textContent = result.link;
              resultLinkElement.href = result.link;
            } else {
              resultLinkElement.textContent = 'ë§í¬ ì •ë³´ ì—†ìŒ';
              resultLinkElement.href = '#';
            }
          }
        } else {
          resultInfo.classList.add('hidden');
          progressMessage.classList.remove('hidden');
        }
      }
      
      // ì´ë¯¸ì§€ê°€ í¬í•¨ëœ HTML ë‚´ìš©ì„ ì•ˆì „í•˜ê²Œ ë Œë”ë§í•˜ëŠ” í•¨ìˆ˜
      function renderRichContent(element, content) {
        if (!element) return;
        
        if (content && content.trim()) {
          element.innerHTML = content;
        } else {
          element.textContent = 'ì„¤ëª… ì •ë³´ ì—†ìŒ';
        }
      }
      
      // êµ¬ë§¤ ë²„íŠ¼ ê¸°ëŠ¥
      function goToDirectPurchase() {
        console.log('=== êµ¬ë§¤ ë²„íŠ¼ í´ë¦­ ===');
        console.log('currentReqKey:', currentReqKey);
        
        // í˜„ì¬ í‘œì‹œëœ ì˜ë¢° ì •ë³´ë¥¼ ì „ì—­ ë³€ìˆ˜ì—ì„œ ê°€ì ¸ì˜¤ê¸°
        if (!currentReqKey) {
          alert('ì˜ë¢° ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ì˜ë¢° ê²°ê³¼ë¥¼ ì¡°íšŒí•´ì£¼ì„¸ìš”.');
          return;
        }
        
        const currentKey = currentReqKey.replace('request-', '');
        const requestKey = currentReqKey;
        const requestData = localStorage.getItem(requestKey);
        const resultData = localStorage.getItem('result-' + currentKey);
        
        console.log('êµ¬ë§¤ ë²„íŠ¼ í´ë¦­:', {
          currentReqKey: currentReqKey,
          currentKey: currentKey,
          requestKey: requestKey,
          requestData: requestData,
          resultData: resultData
        });
        
        // localStorageì˜ ëª¨ë“  í‚¤ í™•ì¸
        console.log('localStorage ëª¨ë“  í‚¤:');
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          console.log(key, ':', localStorage.getItem(key));
        }
        
        if (!requestData || !resultData) {
          alert('êµ¬ë§¤ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n\nì˜ë¢°ë²ˆí˜¸: ' + currentKey + '\nìš”ì²­ ë°ì´í„°: ' + (requestData ? 'ìˆìŒ' : 'ì—†ìŒ') + '\nê²°ê³¼ ë°ì´í„°: ' + (resultData ? 'ìˆìŒ' : 'ì—†ìŒ'));
          return;
        }
        
        const request = JSON.parse(requestData);
        const result = JSON.parse(resultData);
        
        console.log('íŒŒì‹±ëœ ë°ì´í„°:', { request, result });
        
        // ê²°ì œ í˜ì´ì§€ë¡œ ì´ë™ (ìƒˆ ì°½)
        const paymentUrl = `payment.html?req=${currentKey}&price=${encodeURIComponent(result.price)}&name=${encodeURIComponent(request.name)}&origin=${encodeURIComponent(result.origin)}`;
        console.log('ê²°ì œ URL:', paymentUrl);
        
        // ìƒˆ ì°½ ì—´ê¸°
        const paymentWindow = window.open(paymentUrl, '_blank', 'width=1000,height=800,scrollbars=yes,resizable=yes');
        
        if (paymentWindow) {
          console.log('ê²°ì œ ì°½ì´ ì„±ê³µì ìœ¼ë¡œ ì—´ë ¸ìŠµë‹ˆë‹¤.');
        } else {
          console.error('ê²°ì œ ì°½ì„ ì—´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. íŒì—… ì°¨ë‹¨ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
          alert('ê²°ì œ ì°½ì„ ì—´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì €ì˜ íŒì—… ì°¨ë‹¨ì„ í•´ì œí•´ì£¼ì„¸ìš”.');
        }
      }
      
      function showPurchaseSupport() {
        const supportContent = `
          <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-6 max-w-lg mx-4">
              <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold text-gray-800">ğŸ¤ êµ¬ë§¤ ì§€ì› ì„œë¹„ìŠ¤</h3>
                <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700">
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                  </svg>
                </button>
              </div>
              <div class="space-y-4">
                <div class="p-4 bg-blue-50 rounded-lg">
                  <h4 class="font-bold text-blue-800 mb-2">âœ¨ í”„ë¦¬ë¯¸ì—„ êµ¬ë§¤ ì§€ì›</h4>
                  <div class="space-y-2 text-sm text-blue-700">
                    <div class="flex items-center space-x-2">
                      <span>âœ…</span>
                      <span>ì „ë‹´ êµ¬ë§¤ ëŒ€í–‰ ì„œë¹„ìŠ¤</span>
                    </div>
                    <div class="flex items-center space-x-2">
                      <span>âœ…</span>
                      <span>ì‹¤ì‹œê°„ ë°°ì†¡ ì¶”ì </span>
                    </div>
                    <div class="flex items-center space-x-2">
                      <span>âœ…</span>
                      <span>í’ˆì§ˆ ë³´ì¦ & í™˜ë¶ˆ ì§€ì›</span>
                    </div>
                    <div class="flex items-center space-x-2">
                      <span>âœ…</span>
                      <span>24ì‹œê°„ ê³ ê° ì§€ì›</span>
                    </div>
                  </div>
                </div>
                
                <div class="p-4 bg-green-50 rounded-lg">
                  <h4 class="font-bold text-green-800 mb-2">ğŸ’° ì„œë¹„ìŠ¤ ìš”ê¸ˆ</h4>
                  <div class="text-sm text-green-700">
                    <p>â€¢ êµ¬ë§¤ ê¸ˆì•¡ì˜ <strong>3%</strong> ìˆ˜ìˆ˜ë£Œ</p>
                    <p>â€¢ ìµœì†Œ ìˆ˜ìˆ˜ë£Œ: <strong>5,000ì›</strong></p>
                    <p>â€¢ ë°°ì†¡ë¹„ ë³„ë„ (ì‹¤ì œ ë°°ì†¡ë¹„)</p>
                  </div>
                </div>
                
                <div class="p-4 bg-yellow-50 rounded-lg">
                  <h4 class="font-bold text-yellow-800 mb-2">ğŸ“ ì‹ ì²­ ë°©ë²•</h4>
                  <div class="text-sm text-yellow-700">
                    <p>â€¢ ê³ ê°ì„¼í„°: <strong>1588-1234</strong></p>
                    <p>â€¢ ì¹´ì¹´ì˜¤í†¡: <strong>@pricehunter</strong></p>
                    <p>â€¢ ì´ë©”ì¼: <strong>support@pricehunter.kr</strong></p>
                  </div>
                </div>
              </div>
              
              <div class="mt-4 flex space-x-3">
                <button onclick="this.closest('.fixed').remove(); goToExternalPurchase()" class="flex-1 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition">
                  ì§ì ‘ êµ¬ë§¤í•˜ê¸°
                </button>
                <button onclick="contactSupport()" class="flex-1 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition">
                  ì§€ì› ì„œë¹„ìŠ¤ ì‹ ì²­
                </button>
              </div>
            </div>
          </div>
        `;
        document.body.insertAdjacentHTML('beforeend', supportContent);
      }

      function contactSupport() {
        const currentKey = currentReqKey.replace('request-', '');
        const request = JSON.parse(localStorage.getItem(currentReqKey) || '{}');
        const result = JSON.parse(localStorage.getItem('result-' + currentKey) || '{}');
        
        const message = `êµ¬ë§¤ ì§€ì› ì„œë¹„ìŠ¤ ì‹ ì²­

ì˜ë¢°ë²ˆí˜¸: ${currentKey}
ì œí’ˆëª…: ${request.name}
ìµœì €ê°€: ${result.price}
ìµœì €ê°€ ì‡¼í•‘ëª°: ${result.link}

êµ¬ë§¤ ì§€ì› ì„œë¹„ìŠ¤ë¥¼ ì‹ ì²­í•©ë‹ˆë‹¤.`;

        // ì¹´ì¹´ì˜¤í†¡ ì±„ë„ë¡œ ì—°ê²°
        if (confirm('ì¹´ì¹´ì˜¤í†¡ ì±„ë„ë¡œ ì—°ê²°í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          window.open('https://open.kakao.com/o/pricehunter', '_blank');
        }
        
        // ëª¨ë‹¬ ë‹«ê¸°
        document.querySelector('.fixed').remove();
      }

      function goToExternalPurchase() {
        if (!currentReqKey) {
          alert('ì˜ë¢° ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ì˜ë¢° ê²°ê³¼ë¥¼ ì¡°íšŒí•´ì£¼ì„¸ìš”.');
          return;
        }
        
        const currentKey = currentReqKey.replace('request-', '');
        const resultData = localStorage.getItem('result-' + currentKey);
        
        if (!resultData) {
          alert('êµ¬ë§¤ ë§í¬ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }
        
        const result = JSON.parse(resultData);
        
        if (!result.link || result.link === 'ë§í¬ ì •ë³´ ì—†ìŒ') {
          alert('ìµœì €ê°€ ì‡¼í•‘ëª° ë§í¬ê°€ ë“±ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
          return;
        }
        
        // ì™¸ë¶€ ë§í¬ë¡œ ì´ë™
        if (confirm('ìµœì €ê°€ ì‡¼í•‘ëª°ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâš ï¸ ì‹¤ì œ êµ¬ë§¤ëŠ” í•´ë‹¹ ì‡¼í•‘ëª°ì—ì„œ ì§„í–‰ë©ë‹ˆë‹¤.')) {
          // ì™¸ë¶€ êµ¬ë§¤ ì •ë³´ ì €ì¥
          const request = JSON.parse(localStorage.getItem(currentReqKey));
          const purchaseInfo = {
            method: 'external',
            status: 'ordered',
            orderDate: new Date().toISOString(),
            externalLink: result.link,
            productName: request.name,
            price: result.price,
            origin: result.origin
          };
          localStorage.setItem('order-' + currentKey, JSON.stringify(purchaseInfo));
          
          window.open(result.link, '_blank');
        }
      }
      
      window.addEventListener('DOMContentLoaded', function() {
        renderMyRequestList();
      });
      
      searchBtn.onclick = function() {
        resultCard.classList.add('hidden');
        noResult.classList.add('hidden');
        loading.classList.remove('hidden');
        setTimeout(() => {
          loading.classList.add('hidden');
          const val = document.getElementById('search-input').value.trim();
          showResultByKey(val);
        }, 1200);
      };
    </script>
  </body>
</html> 