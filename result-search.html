<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>의뢰 결과 조회 | PriceHunter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
      body { font-family: 'Noto Sans KR', 'Inter', sans-serif; }
      .fade-in { animation: fadeIn 0.7s; }
      @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
      .spinner {
        border: 4px solid #e5e7eb;
        border-top: 4px solid #38bdf8;
        border-radius: 50%;
        width: 2.5rem;
        height: 2.5rem;
        animation: spin 1s linear infinite;
        margin: 0 auto;
      }
      @keyframes spin { 100% { transform: rotate(360deg); } }
      
      /* 이미지 스타일링 */
      #result-summary img {
        max-width: 100%;
        height: auto;
        margin: 10px 0;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        display: block;
      }
      
      /* 리치 텍스트 내용 스타일링 */
      #result-summary {
        line-height: 1.6;
        word-wrap: break-word;
      }
      
      #result-summary p {
        margin: 8px 0;
      }
      
      #result-summary strong {
        font-weight: bold;
      }
      
      #result-summary em {
        font-style: italic;
      }
      
      #result-summary u {
        text-decoration: underline;
      }
    </style>
  </head>
  <body class="bg-gradient-to-br from-blue-50 via-emerald-50 to-pink-50 min-h-screen flex items-center justify-center px-2">
    <main class="w-full max-w-2xl bg-white/90 rounded-3xl shadow-2xl p-4 md:p-8 lg:p-12 flex flex-col items-center text-center backdrop-blur-md mt-4 md:mt-8 mb-4 md:mb-8">
      <h1 class="text-xl sm:text-2xl md:text-3xl font-extrabold text-blue-600 mb-4 md:mb-6">의뢰 결과 조회</h1>
      <div class="w-full mb-6">
        <label class="block text-gray-700 font-semibold mb-2 text-left" for="search-input">
          의뢰번호 또는 휴대폰 번호로 결과를 조회할 수 있습니다.
        </label>
        <div class="flex flex-col md:flex-row gap-3">
          <input id="search-input" type="text" class="flex-1 px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-400 focus:outline-none transition text-lg" placeholder="#PH-000000 또는 010-1234-5678" />
        </div>
        <!-- CAPTCHA Placeholder -->
        <div class="mt-4 flex justify-center">
          <div class="bg-gray-100 rounded-lg px-4 py-2 text-gray-400 text-sm select-none">(여기에 CAPTCHA가 들어갈 수 있습니다)</div>
        </div>
        <button id="search-btn" class="mt-6 w-full py-3 bg-gradient-to-r from-blue-400 to-emerald-400 text-white font-bold rounded-lg shadow-lg hover:scale-105 transition-all duration-300 text-lg">조회하기</button>
      </div>
      <!-- 내 의뢰 리스트 (로그인 시) -->
      <div id="my-request-list-section" class="w-full mb-8 hidden">
        <div class="font-bold text-blue-700 mb-2 text-left">내가 의뢰한 내역</div>
        <ul id="my-request-list" class="bg-blue-50 rounded-xl shadow-inner divide-y divide-blue-100 text-left"></ul>
      </div>
      <!-- Loading Animation -->
      <div id="loading" class="hidden my-8"><div class="spinner"></div><div class="mt-2 text-blue-400 font-semibold">결과를 불러오는 중...</div></div>
      <!-- Result Card -->
      <div id="result-card" class="hidden w-full fade-in">
        <div class="bg-white rounded-2xl shadow-lg p-6 mb-4 text-left">
          <!-- 진행상황 배지 -->
          <div class="mb-4 flex justify-between items-center">
            <div id="status-badge" class="px-3 py-1 rounded-full text-sm font-bold text-white"></div>
          </div>
          
          <!-- 결과 정보 -->
          <div id="result-info" class="hidden">
            <div class="mb-3 flex flex-col md:flex-row md:items-center md:justify-between">
              <div class="text-xl font-bold text-gray-800 mb-2 md:mb-0">최저가: <span id="result-price" class="text-emerald-600">₩123,000</span></div>
            </div>
            <div class="mb-2 text-gray-600">원산지/공급처: <span id="result-origin">대한민국 / PriceHunter 공식</span></div>
            <div class="mb-4">
              <div class="font-semibold text-gray-700 mb-1">종합설명</div>
              <div id="result-summary" class="text-gray-700 bg-gray-50 rounded-xl p-4 min-h-[60px] overflow-hidden">가격, 원산지, 상품특징 등 전체적인 설명이 여기에 표시됩니다.</div>
            </div>
            
            <!-- 구매 옵션 -->
            <div class="mb-4 p-4 bg-gradient-to-r from-blue-50 to-emerald-50 rounded-xl border border-blue-100">
              <div class="font-bold text-gray-800 mb-3 text-center">🛒 구매 옵션</div>
              <div class="text-sm text-gray-600 mb-3">
                최저가 정보를 확인했습니다. 원하시는 구매 방법을 선택해주세요.
              </div>
              <div class="flex flex-col md:flex-row gap-3">
                <button id="buy-external-btn" onclick="goToExternalPurchase()" class="flex-1 py-3 bg-gradient-to-r from-emerald-500 to-emerald-600 text-white font-bold rounded-lg shadow-lg hover:scale-105 transition-all duration-300">
                  <div class="text-lg">🛍️</div>
                  <div class="text-sm">직접 구매하기</div>
                  <div class="text-xs opacity-90">최저가 쇼핑몰에서 구매</div>
                </button>
                <button onclick="showPurchaseSupport()" class="flex-1 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white font-bold rounded-lg shadow-lg hover:scale-105 transition-all duration-300">
                  <div class="text-lg">🤝</div>
                  <div class="text-sm">구매 지원 서비스</div>
                  <div class="text-xs opacity-90">전담 관리 & 추적</div>
                </button>
              </div>
            </div>
          </div>
          
          <!-- 진행중 메시지 -->
          <div id="progress-message" class="hidden">
            <div class="text-center py-8">
              <div class="text-2xl mb-2">🔄</div>
              <div class="text-lg font-bold text-gray-700 mb-2">의뢰 처리 중입니다</div>
              <div class="text-gray-500">PriceHunter가 최저가를 찾고 있습니다.</div>
              <div class="text-sm text-gray-400 mt-2">완료되면 자동으로 알림을 드립니다.</div>
            </div>
          </div>
        </div>
      </div>
      <!-- No Result Message -->
      <div id="no-result" class="hidden w-full fade-in">
        <div class="bg-white rounded-2xl shadow-lg p-6 text-center text-gray-500">
          <div class="text-lg font-bold mb-2">조회된 결과가 없습니다.</div>
          <div class="text-sm">입력하신 정보를 다시 확인해주세요.</div>
        </div>
      </div>
      <!-- Help Text -->
      <div class="mt-8 text-gray-400 text-sm">
        결과 조회가 어렵다면 고객센터로 문의해주세요.<br/>
        <span class="font-semibold">문의: contact@pricehunter.kr</span>
      </div>
    </main>
    <script>
      const searchBtn = document.getElementById('search-btn');
      let currentReqKey = ''; // 현재 표시된 의뢰의 키
      let currentDisplayedReq = ''; // 현재 표시된 의뢰 번호 (토글용)
      const loading = document.getElementById('loading');
      const resultCard = document.getElementById('result-card');
      const noResult = document.getElementById('no-result');
      
      // 진행상황 판단 함수
      function getRequestStatus(reqKey) {
        const reqNum = reqKey.replace('request-', '');
        const hasResult = !!localStorage.getItem('result-' + reqNum);
        
        if (!hasResult) {
          return { status: 'new', text: '신규의뢰', color: 'bg-red-500' };
        }
        
        const result = JSON.parse(localStorage.getItem('result-' + reqNum) || '{}');
        if (result.price && result.origin && result.summary && result.link) {
          return { status: 'complete', text: '완료', color: 'bg-green-500' };
        }
        
        return { status: 'progress', text: '진행중', color: 'bg-orange-500' };
      }
      
      function getMyRequestList(email) {
        const list = [];
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          if (key.startsWith('request-')) {
            const req = JSON.parse(localStorage.getItem(key));
            if (req.email === email) {
              list.push({ key, ...req });
            }
          }
        }
        // 최신순 정렬(가장 최근이 위로)
        return list.sort((a, b) => (b.date || 0) - (a.date || 0));
      }
      
      function renderMyRequestList() {
        const user = JSON.parse(localStorage.getItem('user') || 'null');
        const loggedIn = localStorage.getItem('loggedIn') === 'true';
        const section = document.getElementById('my-request-list-section');
        const ul = document.getElementById('my-request-list');
        if (!loggedIn || !user) {
          section.classList.add('hidden');
          return;
        }
        const list = getMyRequestList(user.email);
        section.classList.remove('hidden');
        ul.innerHTML = '';
        if (list.length === 0) {
          ul.innerHTML = '<li class="py-4 text-center text-gray-400">내가 의뢰한 내역이 없습니다.</li>';
          return;
        }
        list.forEach(req => {
          const li = document.createElement('li');
          li.className = 'py-3 px-4 hover:bg-blue-100 cursor-pointer';
          
          const status = getRequestStatus(req.key);
          const statusBadge = `<span class="px-2 py-1 rounded text-xs font-bold text-white ${status.color}">${status.text}</span>`;
          
          // 관리자 답변 확인
          const reqNum = req.key.replace('request-', '');
          const resultData = localStorage.getItem(`result-${reqNum}`);
          let adminResponse = '';
          
          if (resultData) {
            try {
              const result = JSON.parse(resultData);
              if (result.summary) {
                // HTML 태그 제거하고 텍스트만 추출 (최대 100자)
                const textContent = result.summary.replace(/<[^>]*>/g, '').trim();
                adminResponse = textContent.length > 100 ? textContent.substring(0, 100) + '...' : textContent;
              }
            } catch (e) {
              console.log('결과 데이터 파싱 실패:', e);
            }
          }
          
          li.innerHTML = `
            <div class="flex justify-between items-start mb-2">
              <div class="flex items-center gap-3">
                <span class="font-semibold text-blue-600">${req.key.replace('request-','')}</span>
                <span class="text-gray-700">${req.name}</span>
                ${statusBadge}
              </div>
              <span class="text-xs text-gray-400">${req.date ? new Date(req.date).toLocaleString() : ''}</span>
            </div>
            ${adminResponse ? `
              <div class="text-sm text-gray-600 bg-gray-50 p-2 rounded mt-2">
                <span class="font-medium text-green-600">💬 관리자 답변:</span> ${adminResponse}
              </div>
            ` : ''}
          `;
          li.onclick = function() { 
            const reqNum = req.key.replace('request-', '');
            
            // 토글 기능: 같은 의뢰를 다시 클릭하면 숨기기
            if (currentDisplayedReq === reqNum) {
              console.log('같은 의뢰 다시 클릭 - 토글 닫기');
              hideResult();
              currentDisplayedReq = '';
              return;
            }
            
            // 다른 의뢰 클릭 시 표시
            console.log('새로운 의뢰 클릭 - 표시');
            currentReqKey = req.key; // 전역 변수에 현재 의뢰 키 저장
            currentDisplayedReq = reqNum;
            
            // 새로운 관리자 답변 표시 함수 사용
            const success = showAdminResponse(reqNum);
            if (!success) {
              // 실패 시 기존 방법 사용
              showResultByKey(reqNum);
            }
          };
          ul.appendChild(li);
        });
      }
      
      function showResultByKey(key) {
        console.log('=== showResultByKey 호출됨 ===');
        console.log('입력된 키:', key);
        console.log('키 타입:', typeof key);
        
        if (!key) {
          console.log('키가 비어있음');
          document.getElementById('no-result').classList.remove('hidden');
          return;
        }
        
        // 키 정규화 (다양한 형식 지원)
        let normalizedKey = key.toString().trim();
        
        // PH- 접두사 제거
        if (normalizedKey.startsWith('PH-')) {
          normalizedKey = normalizedKey.substring(3);
        }
        
        // # 접두사 제거  
        if (normalizedKey.startsWith('#')) {
          normalizedKey = normalizedKey.substring(1);
        }
        
        console.log('정규화된 키:', normalizedKey);
        
        const resultCard = document.getElementById('result-card');
        const noResult = document.getElementById('no-result');
        const resultInfo = document.getElementById('result-info');
        const progressMessage = document.getElementById('progress-message');
        
        resultCard.classList.add('hidden');
        noResult.classList.add('hidden');
        
        // 의뢰 정보 찾기 - 여러 형식으로 시도
        const possibleKeys = [
          `request-${normalizedKey}`,
          `request-PH-${normalizedKey}`,
          normalizedKey,
          `PH-${normalizedKey}`
        ];
        
        console.log('시도할 키들:', possibleKeys);
        
        let requestData = null;
        let foundRequestKey = null;
        
        for (const testKey of possibleKeys) {
          const data = localStorage.getItem(testKey);
          if (data) {
            try {
              requestData = JSON.parse(data);
              foundRequestKey = testKey;
              console.log('찾은 의뢰 키:', foundRequestKey);
              console.log('의뢰 데이터:', requestData);
              break;
            } catch (e) {
              console.log(`${testKey} 파싱 실패:`, e);
            }
          }
        }
        
        if (!requestData) {
          console.log('의뢰 데이터를 찾을 수 없음');
          
          // 모든 localStorage 키 확인해서 유사한 것 찾기
          const allKeys = Object.keys(localStorage);
          const similarKeys = allKeys.filter(k => 
            k.toLowerCase().includes(normalizedKey.toLowerCase()) ||
            normalizedKey.toLowerCase().includes(k.toLowerCase())
          );
          console.log('유사한 키들:', similarKeys);
          
          noResult.classList.remove('hidden');
          return;
        }
        
        if (requestData) {
          // userName 필드가 없는 경우 처리
          if (!requestData.userName) {
            // user 또는 currentUser에서 이름 찾기
            let userName = '';
            if (requestData.email) {
              const user = JSON.parse(localStorage.getItem('user') || '{}');
              const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
              
              if (user.email === requestData.email) {
                userName = user.name || '';
              } else if (currentUser.email === requestData.email) {
                userName = currentUser.name || '';
              }
            }
            
            // userName 필드 추가하고 저장
            requestData.userName = userName;
            localStorage.setItem(foundRequestKey, JSON.stringify(requestData));
            console.log('의뢰 데이터 userName 추가:', foundRequestKey, 'userName:', userName);
          }
          
          // currentReqKey 설정
          currentReqKey = foundRequestKey;
          console.log('설정된 currentReqKey:', currentReqKey);
        
          resultCard.classList.remove('hidden');
          
          // 진행상황 표시
          const status = getRequestStatus(foundRequestKey);
          const statusBadge = document.getElementById('status-badge');
          statusBadge.textContent = status.text;
          statusBadge.className = `px-3 py-1 rounded-full text-sm font-bold text-white ${status.color}`;
        
          // 결과 정보 확인 - 완전히 새로운 접근 방법
          console.log('=== 결과 데이터 검색 시작 ===');
          console.log('foundRequestKey:', foundRequestKey);
          console.log('normalizedKey:', normalizedKey);
          
          // 1단계: localStorage의 모든 키 확인
          const allKeys = Object.keys(localStorage);
          console.log('localStorage 전체 키 개수:', allKeys.length);
          
          // 2단계: 의뢰 번호 추출
          let reqNum = '';
          if (foundRequestKey.startsWith('request-')) {
            reqNum = foundRequestKey.replace('request-', '');
          } else {
            reqNum = foundRequestKey;
          }
          console.log('추출된 의뢰 번호:', reqNum);
          
          // 3단계: 모든 result 키 찾기
          const allResultKeys = allKeys.filter(key => key.startsWith('result-'));
          console.log('모든 result 키들:', allResultKeys);
          
          // 4단계: 의뢰 번호와 관련된 result 키 찾기
          let resultData = null;
          let foundResultKey = null;
          
          for (const resultKey of allResultKeys) {
            console.log(`검사 중: ${resultKey}`);
            
            // 의뢰 번호가 포함되어 있는지 확인
            if (resultKey.includes(reqNum) || 
                resultKey.includes(normalizedKey) || 
                resultKey.includes(reqNum.replace('PH-', '')) ||
                resultKey.includes(normalizedKey.replace('PH-', ''))) {
              
              console.log(`✅ 매칭된 result 키 발견: ${resultKey}`);
              const data = localStorage.getItem(resultKey);
              
              if (data) {
                try {
                  resultData = JSON.parse(data);
                  foundResultKey = resultKey;
                  console.log('✅ 결과 데이터 파싱 성공:', resultData);
                  break;
                } catch (e) {
                  console.log(`❌ ${resultKey} 파싱 실패:`, e);
                }
              }
            }
          }
          
          // 5단계: 결과가 없으면 더 넓은 검색
          if (!resultData) {
            console.log('❌ 정확한 매칭을 찾지 못함, 더 넓은 검색 시작');
            
            // 모든 result 데이터 확인
            for (const resultKey of allResultKeys) {
              const data = localStorage.getItem(resultKey);
              if (data) {
                try {
                  const parsed = JSON.parse(data);
                  console.log(`${resultKey}:`, parsed);
                  
                  // 의뢰 데이터와 비교
                  if (requestData.email && parsed.email && requestData.email === parsed.email) {
                    console.log(`✅ 이메일로 매칭된 결과 발견: ${resultKey}`);
                    resultData = parsed;
                    foundResultKey = resultKey;
                    break;
                  }
                } catch (e) {
                  console.log(`${resultKey} 파싱 실패:`, e);
                }
              }
            }
          }
          
          if (!resultData) {
            console.log('❌ 결과 데이터를 찾을 수 없음');
            console.log('=== 전체 localStorage 내용 ===');
            allKeys.forEach(key => {
              if (key.includes('result') || key.includes('request')) {
                console.log(key, ':', localStorage.getItem(key));
              }
            });
          }
          
          if (resultData) {
            console.log('=== 결과 데이터 표시 시작 ===');
            console.log('찾은 결과 키:', foundResultKey);
            console.log('resultData:', resultData);
            console.log('resultData.summary:', resultData.summary);
            console.log('resultData.summary 타입:', typeof resultData.summary);
            console.log('resultData.summary 길이:', resultData.summary ? resultData.summary.length : 0);
            
            // 결과 섹션 표시
            resultInfo.classList.remove('hidden');
            progressMessage.classList.add('hidden');
            
            // DOM 요소들 가져오기
            const resultPriceElement = document.getElementById('result-price');
            const resultOriginElement = document.getElementById('result-origin');
            const resultSummaryElement = document.getElementById('result-summary');
            const resultLinkElement = document.getElementById('result-link');
            
            console.log('DOM 요소들 확인:', {
              resultPriceElement: !!resultPriceElement,
              resultOriginElement: !!resultOriginElement,
              resultSummaryElement: !!resultSummaryElement,
              resultLinkElement: !!resultLinkElement
            });
            
            // 가격 설정
            if (resultPriceElement) {
              const price = resultData.price || '가격 정보 없음';
              resultPriceElement.textContent = price;
              console.log('✅ 가격 설정 완료:', price);
            } else {
              console.error('❌ result-price 요소를 찾을 수 없음');
            }
            
            // 원산지 설정
            if (resultOriginElement) {
              const origin = resultData.origin || '원산지 정보 없음';
              resultOriginElement.textContent = origin;
              console.log('✅ 원산지 설정 완료:', origin);
            } else {
              console.error('❌ result-origin 요소를 찾을 수 없음');
            }
            
            // 종합설명 설정 (가장 중요)
            if (resultSummaryElement) {
              const summary = resultData.summary || '설명 정보 없음';
              console.log('renderRichContent 호출 전 summary:', summary);
              
              // 직접 innerHTML 설정
              resultSummaryElement.innerHTML = summary;
              console.log('✅ 종합설명 설정 완료');
              console.log('설정 후 innerHTML:', resultSummaryElement.innerHTML);
            } else {
              console.error('❌ result-summary 요소를 찾을 수 없음');
            }
            
            // 링크 설정
            if (resultLinkElement) {
              if (resultData.link && resultData.link !== '링크 정보 없음') {
                resultLinkElement.textContent = resultData.link;
                resultLinkElement.href = resultData.link;
                console.log('✅ 링크 설정 완료:', resultData.link);
              } else {
                resultLinkElement.textContent = '링크 정보 없음';
                resultLinkElement.href = '#';
                console.log('✅ 링크 정보 없음으로 설정');
              }
            } else {
              console.error('❌ result-link 요소를 찾을 수 없음');
            }
            
            console.log('=== 결과 데이터 표시 완료 ===');
          } else {
            console.log('❌ 결과 데이터가 없어서 진행중 메시지 표시');
            resultInfo.classList.add('hidden');
            progressMessage.classList.remove('hidden');
          }
        }
      }
      
      // 이미지가 포함된 HTML 내용을 안전하게 렌더링하는 함수
      function renderRichContent(element, content) {
        console.log('=== renderRichContent 함수 시작 ===');
        console.log('element:', element);
        console.log('content:', content);
        console.log('content 타입:', typeof content);
        console.log('content 길이:', content ? content.length : 0);
        
        if (!element) {
          console.error('element가 null입니다!');
          return;
        }
        
        if (content && content.trim()) {
          console.log('content를 innerHTML로 설정:', content);
          element.innerHTML = content;
          console.log('설정 후 element.innerHTML:', element.innerHTML);
        } else {
          console.log('content가 비어있어서 기본 메시지 표시');
          element.textContent = '설명 정보 없음';
        }
        
        console.log('=== renderRichContent 함수 완료 ===');
      }
      
      // 구매 버튼 기능
      function goToDirectPurchase() {
        console.log('=== 구매 버튼 클릭 ===');
        console.log('currentReqKey:', currentReqKey);
        
        // 현재 표시된 의뢰 정보를 전역 변수에서 가져오기
        if (!currentReqKey) {
          alert('의뢰 정보를 찾을 수 없습니다. 먼저 의뢰 결과를 조회해주세요.');
          return;
        }
        
        const currentKey = currentReqKey.replace('request-', '');
        const requestKey = currentReqKey;
        const requestData = localStorage.getItem(requestKey);
        const resultData = localStorage.getItem('result-' + currentKey);
        
        console.log('구매 버튼 클릭:', {
          currentReqKey: currentReqKey,
          currentKey: currentKey,
          requestKey: requestKey,
          requestData: requestData,
          resultData: resultData
        });
        
        // localStorage의 모든 키 확인
        console.log('localStorage 모든 키:');
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          console.log(key, ':', localStorage.getItem(key));
        }
        
        if (!requestData || !resultData) {
          alert('구매 정보를 불러올 수 없습니다.\n\n의뢰번호: ' + currentKey + '\n요청 데이터: ' + (requestData ? '있음' : '없음') + '\n결과 데이터: ' + (resultData ? '있음' : '없음'));
          return;
        }
        
        const request = JSON.parse(requestData);
        const result = JSON.parse(resultData);
        
        console.log('파싱된 데이터:', { request, result });
        
        // 결제 페이지로 이동 (새 창)
        const paymentUrl = `payment.html?req=${currentKey}&price=${encodeURIComponent(result.price)}&name=${encodeURIComponent(request.name)}&origin=${encodeURIComponent(result.origin)}`;
        console.log('결제 URL:', paymentUrl);
        
        // 새 창 열기
        const paymentWindow = window.open(paymentUrl, '_blank', 'width=1000,height=800,scrollbars=yes,resizable=yes');
        
        if (paymentWindow) {
          console.log('결제 창이 성공적으로 열렸습니다.');
        } else {
          console.error('결제 창을 열 수 없습니다. 팝업 차단을 확인해주세요.');
          alert('결제 창을 열 수 없습니다. 브라우저의 팝업 차단을 해제해주세요.');
        }
      }
      
      function showPurchaseSupport() {
        const supportContent = `
          <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-6 max-w-lg mx-4">
              <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold text-gray-800">🤝 구매 지원 서비스</h3>
                <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700">
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                  </svg>
                </button>
              </div>
              <div class="space-y-4">
                <div class="p-4 bg-blue-50 rounded-lg">
                  <h4 class="font-bold text-blue-800 mb-2">✨ 프리미엄 구매 지원</h4>
                  <div class="space-y-2 text-sm text-blue-700">
                    <div class="flex items-center space-x-2">
                      <span>✅</span>
                      <span>전담 구매 대행 서비스</span>
                    </div>
                    <div class="flex items-center space-x-2">
                      <span>✅</span>
                      <span>실시간 배송 추적</span>
                    </div>
                    <div class="flex items-center space-x-2">
                      <span>✅</span>
                      <span>품질 보증 & 환불 지원</span>
                    </div>
                    <div class="flex items-center space-x-2">
                      <span>✅</span>
                      <span>24시간 고객 지원</span>
                    </div>
                  </div>
                </div>
                
                <div class="p-4 bg-green-50 rounded-lg">
                  <h4 class="font-bold text-green-800 mb-2">💰 서비스 요금</h4>
                  <div class="text-sm text-green-700">
                    <p>• 구매 금액의 <strong>3%</strong> 수수료</p>
                    <p>• 최소 수수료: <strong>5,000원</strong></p>
                    <p>• 배송비 별도 (실제 배송비)</p>
                  </div>
                </div>
                

              </div>
              
              <div class="mt-4 flex space-x-3">
                <button onclick="this.closest('.fixed').remove(); goToExternalPurchase()" class="flex-1 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition">
                  직접 구매하기
                </button>
                <button onclick="contactSupport()" class="flex-1 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition">
                  지원 서비스 신청
                </button>
              </div>
            </div>
          </div>
        `;
        document.body.insertAdjacentHTML('beforeend', supportContent);
      }

             function contactSupport() {
        // 의뢰 결과가 표시된 상태인지 확인
        console.log('=== contactSupport 함수 시작 ===');
        console.log('currentReqKey 값:', currentReqKey);
        console.log('currentReqKey 타입:', typeof currentReqKey);
        console.log('currentReqKey 길이:', currentReqKey ? currentReqKey.length : 0);
        
        if (!currentReqKey) {
          console.log('currentReqKey가 없음 - 에러 발생');
          alert('먼저 의뢰 결과를 조회해주세요.');
          return;
        }
        
        // 키에서 의뢰번호 추출 (다양한 형식 지원)
        let currentKey = currentReqKey;
        
        // request- 접두사 제거
        if (currentKey.startsWith('request-')) {
          currentKey = currentKey.substring(8); // 'request-' 제거
        }
        
        // PH- 접두사 제거 (있다면)
        if (currentKey.startsWith('PH-')) {
          currentKey = currentKey.substring(3); // 'PH-' 제거
        }
        
        console.log('=== contactSupport 호출됨 ===');
        console.log('원본 currentReqKey:', currentReqKey);
        console.log('추출된 currentKey:', currentKey);
        console.log('currentKey 타입:', typeof currentKey);
        console.log('currentKey 길이:', currentKey.length);
        
        // 구매 지원 서비스 페이지로 이동
        const supportUrl = `purchase-support.html?req=${currentKey}`;
        console.log('생성된 URL:', supportUrl);
        console.log('현재 페이지 URL:', window.location.href);
        console.log('현재 페이지 경로:', window.location.pathname);
        
        // URL이 올바른지 확인
        console.log('URL 검증:');
        console.log('- req 파라미터 포함 여부:', supportUrl.includes('req='));
        console.log('- currentKey 값이 URL에 포함됨:', supportUrl.includes(currentKey));
        console.log('- 최종 URL 파라미터:', `req=${currentKey}`);
        
        // 새 탭에서 열기
        console.log('새 탭에서 URL 열기:', supportUrl);
        window.open(supportUrl, '_blank');
        
        // 모달 닫기
        const modal = document.querySelector('.fixed');
        if (modal) {
          modal.remove();
        }
      }

      function goToExternalPurchase() {
        if (!currentReqKey) {
          alert('의뢰 정보를 찾을 수 없습니다. 먼저 의뢰 결과를 조회해주세요.');
          return;
        }
        
        const currentKey = currentReqKey.replace('request-', '');
        const resultData = localStorage.getItem('result-' + currentKey);
        
        if (!resultData) {
          alert('구매 링크를 찾을 수 없습니다.');
          return;
        }
        
        const result = JSON.parse(resultData);
        
        if (!result.link || result.link === '링크 정보 없음') {
          alert('최저가 쇼핑몰 링크가 등록되지 않았습니다.');
          return;
        }
        
        // 외부 링크로 이동
        if (confirm('최저가 쇼핑몰로 이동하시겠습니까?\n\n⚠️ 실제 구매는 해당 쇼핑몰에서 진행됩니다.')) {
          // 외부 구매 정보 저장
          const request = JSON.parse(localStorage.getItem(currentReqKey));
          const purchaseInfo = {
            method: 'external',
            status: 'ordered',
            orderDate: new Date().toISOString(),
            externalLink: result.link,
            productName: request.name,
            price: result.price,
            origin: result.origin
          };
          localStorage.setItem('order-' + currentKey, JSON.stringify(purchaseInfo));
          
          window.open(result.link, '_blank');
        }
      }
      

      
      // 기존 데이터 분석 및 표시 함수
      function analyzeExistingData() {
        console.log('=== 기존 데이터 분석 ===');
        const allKeys = Object.keys(localStorage);
        console.log('모든 localStorage 키들:', allKeys);
        
        // 의뢰 관련 데이터 찾기 (테스트 데이터 제외)
        const requestKeys = allKeys.filter(key => 
          (key.includes('request') || key.includes('PH-')) && 
          !key.includes('TEST') &&
          !key.startsWith('requestCount-')
        );
        const resultKeys = allKeys.filter(key => 
          key.includes('result') && 
          !key.includes('TEST')
        );
        const orderKeys = allKeys.filter(key => 
          key.includes('order') && 
          !key.includes('TEST')
        );
        
        console.log('의뢰 관련 키들 (테스트 제외):', requestKeys);
        console.log('결과 관련 키들 (테스트 제외):', resultKeys);
        console.log('주문 관련 키들 (테스트 제외):', orderKeys);
        
        // 각 데이터의 구조 분석
        requestKeys.forEach(key => {
          try {
            const data = JSON.parse(localStorage.getItem(key));
            console.log(`${key} 데이터 구조:`, data);
          } catch (e) {
            console.log(`${key} JSON 파싱 실패:`, localStorage.getItem(key));
          }
        });
        
        resultKeys.forEach(key => {
          try {
            const data = JSON.parse(localStorage.getItem(key));
            console.log(`${key} 데이터 구조:`, data);
          } catch (e) {
            console.log(`${key} JSON 파싱 실패:`, localStorage.getItem(key));
          }
        });
        
        return { requestKeys, resultKeys, orderKeys };
      }
      
      // 기존 데이터 목록 표시 함수
      function showExistingRequests() {
        const { requestKeys, resultKeys } = analyzeExistingData();
        
        // 관리자 모드 확인
        const isAdmin = localStorage.getItem('adminMode') === 'true';
        
        // 테스트 데이터 강력 필터링
        const filteredRequestKeys = requestKeys.filter(key => {
          // 테스트 데이터 패턴들 제외
          const isTestData = 
            key.includes('TEST') || 
            key.startsWith('requestCount-') ||
            key.includes('#PH-') ||
            key.includes('result-#PH-') ||
            key.includes('order-#PH-') ||
            key.includes('notify-#PH-') ||
            key.includes('inquiry-#PH-');
          
          return !isTestData;
        });
        
        console.log('필터링된 의뢰 키들:', filteredRequestKeys);
        
        const container = document.querySelector('main');
        const existingDiv = document.createElement('div');
        existingDiv.className = 'mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg';
        existingDiv.innerHTML = `
          <h3 class="font-bold text-blue-800 mb-2">📋 기존 의뢰 목록</h3>
          <div class="space-y-2 text-sm">
            ${filteredRequestKeys.map(key => {
              try {
                const data = JSON.parse(localStorage.getItem(key));
                const reqNum = key.replace('request-', '');
                const hasResult = resultKeys.includes(`result-${reqNum}`);
                return `
                  <div class="flex justify-between items-center p-2 bg-white rounded border">
                    <div>
                      <span class="font-medium">${reqNum}</span> - ${data.name || '제품명 없음'}
                      ${hasResult ? '<span class="text-green-600 ml-2">✅ 결과있음</span>' : '<span class="text-gray-500 ml-2">⏳ 대기중</span>'}
                    </div>
                    <div class="flex gap-2">
                      <button onclick="testRequest('${reqNum}')" class="px-2 py-1 bg-blue-500 text-white rounded text-xs hover:bg-blue-600">
                        조회
                      </button>
                      ${isAdmin ? `
                        <button onclick="deleteRequest('${reqNum}')" class="px-2 py-1 bg-red-500 text-white rounded text-xs hover:bg-red-600">
                          삭제
                        </button>
                      ` : ''}
                    </div>
                  </div>
                `;
              } catch (e) {
                return `<div class="text-red-600">${key} - 데이터 오류</div>`;
              }
            }).join('')}
          </div>
        `;
        
        container.insertBefore(existingDiv, container.children[1]);
      }
      
      // 특정 의뢰 테스트 함수
      function testRequest(reqNum) {
        console.log(`=== ${reqNum} 테스트 시작 ===`);
        
        // 새로운 관리자 답변 표시 함수 사용
        const success = showAdminResponse(reqNum);
        if (success) {
          console.log(`${reqNum} 관리자 답변 표시 성공`);
        } else {
          console.log(`${reqNum} 관리자 답변 표시 실패`);
          
          // 기존 방법으로도 시도
          const searchInput = document.getElementById('search-input');
          if (searchInput) {
            searchInput.value = reqNum;
            document.getElementById('search-btn').click();
          }
        }
      }

      function deleteRequest(reqNum) {
        if (confirm(`의뢰번호 ${reqNum}을(를) 삭제하시겠습니까?\n\n⚠️ 삭제되는 데이터:\n• 의뢰 정보\n• 의뢰 결과\n• 주문 정보\n• 알림 발송 기록\n\n이 작업은 되돌릴 수 없습니다.`)) {
          const requestKey = `request-${reqNum}`;
          const resultKey = `result-${reqNum}`;
          const orderKey = `order-${reqNum}`;
          const notifyKey = `notify-${reqNum}`;

          // 모든 관련 데이터 삭제
          localStorage.removeItem(requestKey);
          localStorage.removeItem(resultKey);
          localStorage.removeItem(orderKey);
          localStorage.removeItem(notifyKey);

          alert(`의뢰번호 ${reqNum}와 관련 데이터가 완전히 삭제되었습니다.`);
          // 페이지 새로고침
          window.location.reload();
        }
      }
      
      // 테스트 데이터 완전 삭제 함수
      function cleanupTestData() {
        console.log('=== 테스트 데이터 완전 삭제 시작 ===');
        
        // 모든 localStorage 키 확인
        const allKeys = Object.keys(localStorage);
        
        // 테스트 관련 키들 삭제
        allKeys.forEach(key => {
          if (key.includes('TEST') || key.includes('test')) {
            localStorage.removeItem(key);
            console.log('삭제된 테스트 키:', key);
          }
        });
        
        console.log('✅ 테스트 데이터 완전 삭제 완료');
      }
      
      // 결과 숨기기 함수
      function hideResult() {
        console.log('=== 결과 숨기기 실행 ===');
        
        // result-card 숨기기
        const resultCard = document.getElementById('result-card');
        if (resultCard) {
          resultCard.style.display = 'none';
          console.log('✅ result-card 숨김 완료');
        }
        
        // result-info 숨기기
        const resultInfo = document.getElementById('result-info');
        if (resultInfo) {
          resultInfo.style.display = 'none';
          console.log('✅ result-info 숨김 완료');
        }
        
        // progress-message 숨기기
        const progressMessage = document.getElementById('progress-message');
        if (progressMessage) {
          progressMessage.style.display = 'none';
          console.log('✅ progress-message 숨김 완료');
        }
        
        // no-result 숨기기
        const noResult = document.getElementById('no-result');
        if (noResult) {
          noResult.style.display = 'none';
          console.log('✅ no-result 숨김 완료');
        }
        
        // loading 숨기기
        const loading = document.getElementById('loading');
        if (loading) {
          loading.style.display = 'none';
          console.log('✅ loading 숨김 완료');
        }
        
        console.log('=== 결과 숨기기 완료 ===');
      }
      
      // 완전히 새로운 관리자 답변 표시 함수
      function showAdminResponse(reqNum) {
        console.log('=== 새로운 관리자 답변 표시 시도 ===');
        console.log('의뢰 번호:', reqNum);
        
        // 모든 가능한 결과 키 시도
        const possibleKeys = [
          `result-${reqNum}`,
          `result-PH-${reqNum}`,
          `result-${reqNum.replace('PH-', '')}`,
          `result-${reqNum.replace('#', '')}`,
          `result-${reqNum.replace('#PH-', '')}`
        ];
        
        console.log('시도할 키들:', possibleKeys);
        
        let resultData = null;
        let foundKey = null;
        
        for (const key of possibleKeys) {
          const data = localStorage.getItem(key);
          if (data) {
            try {
              resultData = JSON.parse(data);
              foundKey = key;
              console.log('✅ 결과 데이터 발견:', key, resultData);
              break;
            } catch (e) {
              console.log('❌ 파싱 실패:', key, e);
            }
          }
        }
        
        if (resultData && resultData.summary) {
          console.log('=== DOM 요소 강제 표시 시작 ===');
          
          // 1. result-info 섹션 강제 표시
          const resultInfo = document.getElementById('result-info');
          console.log('result-info 요소:', resultInfo);
          
          if (resultInfo) {
            // 모든 클래스 제거하고 강제 표시
            resultInfo.className = '';
            resultInfo.style.cssText = `
              display: block !important;
              visibility: visible !important;
              opacity: 1 !important;
              background-color: #fef3c7 !important;
              border: 3px solid #f59e0b !important;
              padding: 20px !important;
              margin: 20px 0 !important;
              border-radius: 12px !important;
              box-shadow: 0 4px 12px rgba(0,0,0,0.1) !important;
            `;
            console.log('✅ result-info 강제 표시 완료');
          } else {
            console.error('❌ result-info 요소를 찾을 수 없음');
          }
          
          // 2. progress-message 숨기기
          const progressMessage = document.getElementById('progress-message');
          if (progressMessage) {
            progressMessage.style.display = 'none';
            console.log('✅ progress-message 숨김 완료');
          }
          
          // 3. result-summary 강제 표시
          const resultSummaryElement = document.getElementById('result-summary');
          console.log('result-summary 요소:', resultSummaryElement);
          
          if (resultSummaryElement) {
            // 내용 설정
            resultSummaryElement.innerHTML = resultData.summary;
            
            // 강제 스타일 적용
            resultSummaryElement.style.cssText = `
              display: block !important;
              visibility: visible !important;
              opacity: 1 !important;
              background-color: #dbeafe !important;
              border: 3px solid #3b82f6 !important;
              padding: 20px !important;
              margin: 15px 0 !important;
              border-radius: 8px !important;
              font-size: 16px !important;
              line-height: 1.6 !important;
              color: #1f2937 !important;
              min-height: 100px !important;
              overflow: visible !important;
              word-wrap: break-word !important;
            `;
            
            console.log('✅ result-summary 강제 표시 완료');
            console.log('설정된 내용:', resultSummaryElement.innerHTML);
          } else {
            console.error('❌ result-summary 요소를 찾을 수 없음');
          }
          
          // 4. 가격 정보 표시
          const resultPriceElement = document.getElementById('result-price');
          if (resultPriceElement) {
            resultPriceElement.textContent = resultData.price || '가격 정보 없음';
            resultPriceElement.style.cssText = `
              color: #059669 !important;
              font-weight: bold !important;
              font-size: 18px !important;
            `;
            console.log('✅ 가격 정보 설정 완료');
          }
          
          // 5. 원산지 정보 표시
          const resultOriginElement = document.getElementById('result-origin');
          if (resultOriginElement) {
            resultOriginElement.textContent = resultData.origin || '원산지 정보 없음';
            resultOriginElement.style.cssText = `
              color: #374151 !important;
              font-weight: 500 !important;
            `;
            console.log('✅ 원산지 정보 설정 완료');
          }
          
          // 6. 결과 카드 표시
          const resultCard = document.getElementById('result-card');
          if (resultCard) {
            resultCard.style.display = 'block';
            resultCard.classList.remove('hidden');
            console.log('✅ result-card 표시 완료');
          }
          
          // 7. 로딩 숨기기
          const loading = document.getElementById('loading');
          if (loading) {
            loading.style.display = 'none';
            console.log('✅ loading 숨김 완료');
          }
          
          // 8. no-result 숨기기
          const noResult = document.getElementById('no-result');
          if (noResult) {
            noResult.style.display = 'none';
            console.log('✅ no-result 숨김 완료');
          }
          
          console.log('=== 관리자 답변 표시 완료 ===');
          return true;
        } else {
          console.log('❌ 관리자 답변을 찾을 수 없음');
          console.log('resultData:', resultData);
          console.log('resultData.summary:', resultData ? resultData.summary : 'resultData 없음');
          return false;
        }
      }
      
      // 테스트용 함수 - 강화된 디버깅
      function testRealAdminResponse() {
        console.log('=== 강화된 관리자 답변 테스트 시작 ===');
        
        // 1단계: localStorage 전체 분석
        const allKeys = Object.keys(localStorage);
        console.log('localStorage 전체 키 개수:', allKeys.length);
        
        // 2단계: 의뢰와 결과 데이터 분리
        const requestKeys = allKeys.filter(key => key.startsWith('request-') && !key.includes('TEST'));
        const resultKeys = allKeys.filter(key => key.startsWith('result-') && !key.includes('TEST'));
        
        console.log('의뢰 키들:', requestKeys);
        console.log('결과 키들:', resultKeys);
        
        // 3단계: 각 의뢰에 대한 결과 확인
        requestKeys.forEach(reqKey => {
          const reqNum = reqKey.replace('request-', '');
          console.log(`\n=== 의뢰 ${reqNum} 분석 ===`);
          
          // 의뢰 데이터 확인
          const reqData = localStorage.getItem(reqKey);
          if (reqData) {
            try {
              const parsedReq = JSON.parse(reqData);
              console.log('의뢰 데이터:', parsedReq);
            } catch (e) {
              console.log('의뢰 데이터 파싱 실패:', e);
            }
          }
          
          // 해당 결과 찾기
          const matchingResults = resultKeys.filter(resultKey => 
            resultKey.includes(reqNum) || 
            resultKey.includes(reqNum.replace('PH-', ''))
          );
          
          console.log('매칭된 결과 키들:', matchingResults);
          
          matchingResults.forEach(resultKey => {
            const resultData = localStorage.getItem(resultKey);
            if (resultData) {
              try {
                const parsed = JSON.parse(resultData);
                console.log(`${resultKey} 결과:`, parsed);
              } catch (e) {
                console.log(`${resultKey} 파싱 실패:`, e);
              }
            }
          });
        });
        
        // 4단계: 실제 표시 테스트
        if (requestKeys.length > 0) {
          const firstReqKey = requestKeys[0];
          const reqNum = firstReqKey.replace('request-', '');
          console.log(`\n=== 첫 번째 의뢰 ${reqNum} 표시 테스트 ===`);
          
          // 직접 관리자 답변 표시 시도
          const success = showAdminResponse(reqNum);
          if (success) {
            console.log('✅ 관리자 답변 표시 성공');
          } else {
            console.log('❌ 관리자 답변 표시 실패');
          }
        }
        
        console.log('=== 강화된 관리자 답변 테스트 완료 ===');
      }
      
      // 강화된 테스트 데이터 생성 함수
      function createTestData() {
        console.log('=== 강화된 테스트 데이터 생성 시작 ===');
        
        // 기존 테스트 데이터 삭제
        localStorage.removeItem('request-TEST123');
        localStorage.removeItem('result-TEST123');
        
        // 테스트 의뢰 데이터
        const testRequestData = {
          name: '🔥 테스트 제품 (강화버전)',
          desc: '이것은 강화된 테스트 제품입니다!',
          price: '50000',
          email: 'test@test.com',
          phone: '010-1234-5678',
          userName: '테스트 사용자',
          date: Date.now()
        };
        
        // 테스트 결과 데이터 (더 눈에 띄는 내용)
        const testResultData = {
          price: '🎯 45,000원 (특가!)',
          origin: '🇰🇷 대한민국',
          summary: `
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; margin: 10px 0;">
              <h2 style="color: white; margin: 0 0 15px 0;">🎉 테스트 관리자 답변입니다!</h2>
              <p style="margin: 10px 0; font-size: 16px;">이것은 관리자가 작성한 <strong>리치 텍스트</strong> 답변입니다.</p>
              <p style="margin: 10px 0; font-size: 18px; color: #ffd700;">✨ 색상과 크기도 적용됩니다! ✨</p>
              <ul style="margin: 10px 0; padding-left: 20px;">
                <li style="margin: 5px 0;">✅ 항목 1: 테스트 성공</li>
                <li style="margin: 5px 0;">✅ 항목 2: 표시 확인</li>
                <li style="margin: 5px 0;">✅ 항목 3: 완벽 작동</li>
              </ul>
              <div style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 5px; margin-top: 15px;">
                <p style="margin: 0; text-align: center; font-weight: bold;">🎊 이제 관리자 답변이 보일 것입니다! 🎊</p>
              </div>
            </div>
          `,
          link: 'https://example.com'
        };
        
        // localStorage에 저장
        const testReqNum = 'TEST123';
        localStorage.setItem(`request-${testReqNum}`, JSON.stringify(testRequestData));
        localStorage.setItem(`result-${testReqNum}`, JSON.stringify(testResultData));
        
        console.log('✅ 강화된 테스트 데이터 생성 완료');
        console.log('의뢰 키:', `request-${testReqNum}`);
        console.log('결과 키:', `result-${testReqNum}`);
        
        // 즉시 표시 테스트
        setTimeout(() => {
          const success = showAdminResponse(testReqNum);
          if (success) {
            console.log('✅ 강화된 테스트 데이터 표시 성공');
          } else {
            console.log('❌ 강화된 테스트 데이터 표시 실패');
          }
        }, 500);
      }
      
      // 테스트 데이터 완전 삭제 함수
      function cleanupTestData() {
        console.log('=== 테스트 데이터 완전 삭제 시작 ===');
        
        // 모든 localStorage 키 확인
        const allKeys = Object.keys(localStorage);
        
        // 테스트 관련 키들 삭제
        allKeys.forEach(key => {
          if (key.includes('TEST') || key.includes('test')) {
            localStorage.removeItem(key);
            console.log('삭제된 테스트 키:', key);
          }
        });
        
        console.log('✅ 테스트 데이터 완전 삭제 완료');
      }
      
      // 페이지 로드 시 테스트 실행
      window.addEventListener('DOMContentLoaded', function() {
        console.log('=== 페이지 로드됨 ===');
        
        // 테스트 데이터 완전 삭제
        cleanupTestData();
        
        // DOM이 완전히 로드된 후 실행
        setTimeout(() => {
          console.log('=== DOM 완전 로드 후 실행 ===');
          
          // 테스트 데이터 생성 비활성화 (실제 운영용)
          // createTestData();
          
          // 실제 데이터 테스트 실행
          testRealAdminResponse();
          
          // 기존 데이터 분석 및 표시
          showExistingRequests();
          
          renderMyRequestList();
        }, 100);
      });
      
      // 모든 리소스 로드 완료 후 추가 실행
      window.addEventListener('load', function() {
        console.log('=== 모든 리소스 로드 완료 ===');
        
        // 테스트 데이터 완전 삭제 (최종 확인)
        cleanupTestData();
      });
      
      searchBtn.onclick = function() {
        resultCard.classList.add('hidden');
        noResult.classList.add('hidden');
        loading.classList.remove('hidden');
        setTimeout(() => {
          loading.classList.add('hidden');
          const val = document.getElementById('search-input').value.trim();
          showResultByKey(val);
        }, 1200);
      };
    </script>
  </body>
</html> 