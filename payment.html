<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ê²°ì œ - PriceHunter</title>
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-N7R437NT77"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-N7R437NT77');
    </script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://js.tosspayments.com/v1/payment"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
      /* í…ìŠ¤íŠ¸ ì„ íƒ ë° í¸ì§‘ ë°©ì§€ */
      body {
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }
      
      /* ë²„íŠ¼ê³¼ ë§í¬, ì…ë ¥ í•„ë“œëŠ” í…ìŠ¤íŠ¸ ì„ íƒ í—ˆìš© */
      button, a, input, textarea, select {
        -webkit-user-select: text;
        -moz-user-select: text;
        -ms-user-select: text;
        user-select: text;
      }
      
      /* í¼ ë¼ë²¨ê³¼ ì„¤ëª… í…ìŠ¤íŠ¸ëŠ” ì„ íƒ ë°©ì§€ */
      label, .form-description {
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }
      body { font-family: 'Noto Sans KR', 'Inter', sans-serif; }
      .fade-in { animation: fadeIn 0.7s; }
      @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
      .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
      .card-shadow { box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
      .input-focus:focus { box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); }
    </style>
  </head>
  <body class="gradient-bg min-h-screen py-4 md:py-8 px-4">
    <div class="max-w-4xl mx-auto">
      <!-- í—¤ë” -->
      <div class="text-center mb-6 md:mb-8">
        <h1 class="text-2xl sm:text-3xl font-bold text-white mb-2">ğŸ›’ PriceHunter ê²°ì œ</h1>
        <p class="text-white/80 text-sm md:text-base">ì•ˆì „í•˜ê³  ë¹ ë¥¸ êµ¬ë§¤ë¥¼ ë„ì™€ë“œë¦½ë‹ˆë‹¤</p>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- ì™¼ìª½: ìƒí’ˆ ì •ë³´ -->
        <div class="lg:col-span-2">
          <div class="bg-white rounded-2xl card-shadow p-6 mb-6 fade-in">
            <h2 class="text-xl font-bold text-gray-800 mb-4">ğŸ“¦ ìƒí’ˆ ì •ë³´</h2>
            <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-4 mb-4">
              <div class="flex items-center justify-between mb-2">
                <span class="font-semibold text-gray-700">ìƒí’ˆëª…</span>
                <span id="product-name" class="text-gray-800 font-bold"></span>
              </div>
              <div class="flex items-center justify-between mb-2">
                <span class="font-semibold text-gray-700">ì›ì‚°ì§€</span>
                <span id="product-origin" class="text-gray-600"></span>
              </div>
              <div class="flex items-center justify-between mb-2">
                <span class="font-semibold text-gray-700">êµ¬ë§¤ ë°©ì‹</span>
                <span id="purchase-method" class="text-blue-600 font-semibold"></span>
              </div>
              <div class="flex items-center justify-between">
                <span class="font-semibold text-gray-700">íŒë§¤ê°€</span>
                <span id="product-price" class="text-2xl font-bold text-emerald-600"></span>
              </div>
            </div>
            
            <!-- ë°°ì†¡ ì •ë³´ -->
            <h3 class="text-lg font-bold text-gray-800 mb-4">ğŸšš ë°°ì†¡ ì •ë³´</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">ìˆ˜ë ¹ì¸ *</label>
                <input type="text" id="recipient-name" class="w-full px-4 py-3 rounded-lg border border-gray-300 input-focus focus:outline-none transition" placeholder="í™ê¸¸ë™" required>
              </div>
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">ì—°ë½ì²˜ *</label>
                <input type="tel" id="recipient-phone" class="w-full px-4 py-3 rounded-lg border border-gray-300 input-focus focus:outline-none transition" placeholder="010-1234-5678" required>
              </div>
            </div>
            <div class="mb-4">
              <label class="block text-sm font-semibold text-gray-700 mb-2">ë°°ì†¡ì§€ ì£¼ì†Œ *</label>
              <input type="text" id="shipping-address" class="w-full px-4 py-3 rounded-lg border border-gray-300 input-focus focus:outline-none transition" placeholder="ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123" required>
            </div>
            <div class="mb-4">
              <label class="block text-sm font-semibold text-gray-700 mb-2">ë°°ì†¡ ìš”ì²­ì‚¬í•­</label>
              <textarea id="shipping-note" rows="3" class="w-full px-4 py-3 rounded-lg border border-gray-300 input-focus focus:outline-none transition" placeholder="ë°°ì†¡ ì‹œ ìš”ì²­ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ì…ë ¥í•´ì£¼ì„¸ìš”"></textarea>
            </div>
          </div>

          <!-- ê²°ì œ ì •ë³´ -->
          <div class="bg-white rounded-2xl card-shadow p-6 fade-in">
            <h3 class="text-lg font-bold text-gray-800 mb-4">ğŸ’³ ê²°ì œ ì •ë³´</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">ê²°ì œìëª… *</label>
                <input type="text" id="payer-name" class="w-full px-4 py-3 rounded-lg border border-gray-300 input-focus focus:outline-none transition" placeholder="í™ê¸¸ë™" required>
              </div>
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">ê²°ì œì ì—°ë½ì²˜ *</label>
                <input type="tel" id="payer-phone" class="w-full px-4 py-3 rounded-lg border border-gray-300 input-focus focus:outline-none transition" placeholder="010-1234-5678" required>
              </div>
            </div>
            <div class="mb-4">
              <label class="block text-sm font-semibold text-gray-700 mb-2">ê²°ì œì ì´ë©”ì¼ *</label>
              <input type="email" id="payer-email" class="w-full px-4 py-3 rounded-lg border border-gray-300 input-focus focus:outline-none transition" placeholder="example@email.com" required>
            </div>
            
            <!-- ê²°ì œ ë°©ë²• ì„ íƒ -->
            <div class="mb-4">
              <label class="block text-sm font-semibold text-gray-700 mb-3">ê²°ì œ ë°©ë²• *</label>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                <label class="flex items-center p-4 border border-gray-300 rounded-lg cursor-pointer hover:bg-blue-50 transition">
                  <input type="radio" name="payment-method" value="card" class="mr-3" checked>
                  <div>
                    <div class="font-semibold">ğŸ’³ ì‹ ìš©ì¹´ë“œ</div>
                    <div class="text-sm text-gray-500">ëª¨ë“  ì¹´ë“œ ê²°ì œ ê°€ëŠ¥</div>
                  </div>
                </label>
                <label class="flex items-center p-4 border border-gray-300 rounded-lg cursor-pointer hover:bg-blue-50 transition">
                  <input type="radio" name="payment-method" value="bank" class="mr-3">
                  <div>
                    <div class="font-semibold">ğŸ¦ ê³„ì¢Œì´ì²´</div>
                    <div class="text-sm text-gray-500">ì‹¤ì‹œê°„ ê³„ì¢Œì´ì²´</div>
                  </div>
                </label>
                <label class="flex items-center p-4 border border-gray-300 rounded-lg cursor-pointer hover:bg-blue-50 transition">
                  <input type="radio" name="payment-method" value="kakao" class="mr-3">
                  <div>
                    <div class="font-semibold">ğŸ’› ì¹´ì¹´ì˜¤í˜ì´</div>
                    <div class="text-sm text-gray-500">ê°„í¸ ê²°ì œ</div>
                  </div>
                </label>
                <label class="flex items-center p-4 border border-gray-300 rounded-lg cursor-pointer hover:bg-blue-50 transition">
                  <input type="radio" name="payment-method" value="naver" class="mr-3">
                  <div>
                    <div class="font-semibold">ğŸŸ¢ ë„¤ì´ë²„í˜ì´</div>
                    <div class="text-sm text-gray-500">ê°„í¸ ê²°ì œ</div>
                  </div>
                </label>
              </div>
            </div>
          </div>
        </div>

        <!-- ì˜¤ë¥¸ìª½: ì£¼ë¬¸ ìš”ì•½ -->
        <div class="lg:col-span-1">
          <div class="bg-white rounded-2xl card-shadow p-6 sticky top-8 fade-in">
            <h3 class="text-lg font-bold text-gray-800 mb-4">ğŸ“‹ ì£¼ë¬¸ ìš”ì•½</h3>
            
            <div class="space-y-3 mb-6">
              <div class="flex justify-between">
                <span class="text-gray-600">ìƒí’ˆ ê¸ˆì•¡</span>
                <span id="subtotal" class="font-semibold"></span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">ë°°ì†¡ë¹„</span>
                <span class="font-semibold text-emerald-600">ë¬´ë£Œ</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">í• ì¸</span>
                <span class="font-semibold text-red-600">-â‚©0</span>
              </div>
              <hr class="my-3">
              <div class="flex justify-between text-lg font-bold">
                <span>ì´ ê²°ì œê¸ˆì•¡</span>
                <span id="total-amount" class="text-emerald-600"></span>
              </div>
            </div>

            <!-- ì•½ê´€ ë™ì˜ -->
            <div class="mb-6">
              <label class="flex items-start cursor-pointer">
                <input type="checkbox" id="agree-terms" class="mt-1 mr-3" required>
                <span class="text-sm text-gray-600">
                  <span class="font-semibold text-gray-800">êµ¬ë§¤ì¡°ê±´ ë° ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</span>ì— ë™ì˜í•©ë‹ˆë‹¤.
                  <a href="#" class="text-blue-600 underline">ìì„¸íˆ ë³´ê¸°</a>
                </span>
              </label>
            </div>

            <!-- ê²°ì œ ë²„íŠ¼ -->
            <button id="payment-btn" onclick="processPayment()" class="w-full py-4 bg-gradient-to-r from-emerald-500 to-emerald-600 text-white font-bold rounded-lg shadow-lg hover:scale-105 transition-all duration-300 text-lg disabled:opacity-50 disabled:cursor-not-allowed">
              ğŸ’³ ê²°ì œí•˜ê¸°
            </button>

            <!-- ë³´ì•ˆ ì•ˆë‚´ -->
            <div class="mt-4 text-center">
              <div class="text-xs text-gray-500 mb-2">ğŸ”’ SSL ë³´ì•ˆ ì—°ê²°</div>
              <div class="text-xs text-gray-500">ê²°ì œ ì •ë³´ëŠ” ì•”í˜¸í™”ë˜ì–´ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬ë©ë‹ˆë‹¤</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // URL íŒŒë¼ë¯¸í„°ì—ì„œ ìƒí’ˆ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
      function getProductInfo() {
        console.log('=== getProductInfo í˜¸ì¶œ ===');
        console.log('í˜„ì¬ URL:', window.location.href);
        
        // URLì—ì„œ ì§ì ‘ íŒŒë¼ë¯¸í„° ì¶”ì¶œ (URLSearchParams ëŒ€ì‹ )
        const url = window.location.href;
        const queryString = url.split('?')[1];
        
        console.log('Query string:', queryString);
        
        if (!queryString) {
          console.error('ì¿¼ë¦¬ ìŠ¤íŠ¸ë§ì´ ì—†ìŠµë‹ˆë‹¤.');
          alert('ìƒí’ˆ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }
        
        // íŒŒë¼ë¯¸í„° íŒŒì‹±
        const params = {};
        const pairs = queryString.split('&');
        
        pairs.forEach(pair => {
          const [key, value] = pair.split('=');
          if (key && value) {
            params[key] = decodeURIComponent(value);
          }
        });
        
        console.log('íŒŒì‹±ëœ íŒŒë¼ë¯¸í„°:', params);
        
        const reqKey = params.req;
        const price = params.price;
        const name = params.name;
        const origin = params.origin;

        console.log('ì¶”ì¶œëœ ê°’:', { reqKey, price, name, origin });

        if (!reqKey || !price || !name) {
          console.error('í•„ìˆ˜ íŒŒë¼ë¯¸í„° ëˆ„ë½:', { reqKey, price, name });
          alert('ìƒí’ˆ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n\nreqKey: ' + reqKey + '\nprice: ' + price + '\nname: ' + name);
          return;
        }

        // ìƒí’ˆ ì •ë³´ í‘œì‹œ
        const productNameElement = document.getElementById('product-name');
        const productOriginElement = document.getElementById('product-origin');
        const productPriceElement = document.getElementById('product-price');
        const subtotalElement = document.getElementById('subtotal');
        const totalAmountElement = document.getElementById('total-amount');

        if (productNameElement) productNameElement.textContent = decodeURIComponent(name);
        if (productOriginElement) productOriginElement.textContent = decodeURIComponent(origin) || 'ì •ë³´ ì—†ìŒ';
        if (productPriceElement) productPriceElement.textContent = `â‚©${Number(price).toLocaleString()}`;
        if (subtotalElement) subtotalElement.textContent = `â‚©${Number(price).toLocaleString()}`;
        if (totalAmountElement) totalAmountElement.textContent = `â‚©${Number(price).toLocaleString()}`;

        // êµ¬ë§¤ ë°©ì‹ í‘œì‹œ
        const method = params.method || 'direct';
        const methodText = method === 'support' ? 'êµ¬ë§¤ ëŒ€í–‰ ì§€ì› ì„œë¹„ìŠ¤' : 'ì§ì ‘ êµ¬ë§¤';
        const purchaseMethodElement = document.getElementById('purchase-method');
        if (purchaseMethodElement) purchaseMethodElement.textContent = methodText;

        console.log('ìƒí’ˆ ì •ë³´ ì„¤ì • ì™„ë£Œ');

        // ë°°ì†¡ ì •ë³´ ìë™ ì…ë ¥ (ê¸°ì¡´ ì˜ë¢° ì •ë³´ê°€ ìˆë‹¤ë©´)
        const requestKey = 'request-' + reqKey;
        const requestData = localStorage.getItem(requestKey);
        console.log('ìš”ì²­ ë°ì´í„° í‚¤:', requestKey);
        console.log('ìš”ì²­ ë°ì´í„°:', requestData);
        
        if (requestData) {
          const request = JSON.parse(requestData);
          const recipientNameElement = document.getElementById('recipient-name');
          const payerNameElement = document.getElementById('payer-name');
          const recipientPhoneElement = document.getElementById('recipient-phone');
          const payerPhoneElement = document.getElementById('payer-phone');
          const payerEmailElement = document.getElementById('payer-email');
          
          if (request.userName && recipientNameElement) {
            recipientNameElement.value = request.userName;
          }
          if (request.userName && payerNameElement) {
            payerNameElement.value = request.userName;
          }
          if (request.phone && recipientPhoneElement) {
            recipientPhoneElement.value = request.phone;
          }
          if (request.phone && payerPhoneElement) {
            payerPhoneElement.value = request.phone;
          }
          if (request.email && payerEmailElement) {
            payerEmailElement.value = request.email;
          }
          
          console.log('ë°°ì†¡ ì •ë³´ ìë™ ì…ë ¥ ì™„ë£Œ');
        }
      }

      // ê²°ì œ ì²˜ë¦¬
      function processPayment() {
        // í•„ìˆ˜ ì…ë ¥ ê²€ì¦
        const requiredFields = [
          'recipient-name', 'recipient-phone', 'shipping-address',
          'payer-name', 'payer-phone', 'payer-email'
        ];

        for (const fieldId of requiredFields) {
          const field = document.getElementById(fieldId);
          if (!field.value.trim()) {
            alert('í•„ìˆ˜ ì…ë ¥ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            field.focus();
            return;
          }
        }

        if (!document.getElementById('agree-terms').checked) {
          alert('êµ¬ë§¤ì¡°ê±´ ë° ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨ì— ë™ì˜í•´ì£¼ì„¸ìš”.');
          return;
        }

        // ê²°ì œ ë°©ë²• í™•ì¸
        const paymentMethod = document.querySelector('input[name="payment-method"]:checked');
        if (!paymentMethod) {
          alert('ê²°ì œ ë°©ë²•ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
          return;
        }

        // ê²°ì œ ë²„íŠ¼ ë¹„í™œì„±í™”
        const paymentBtn = document.getElementById('payment-btn');
        paymentBtn.disabled = true;
        paymentBtn.textContent = 'ê²°ì œ ì²˜ë¦¬ ì¤‘...';

        // í† ìŠ¤í˜ì´ë¨¼ì¸  ê²°ì œ ì´ˆê¸°í™” (í™˜ê²½ë³€ìˆ˜ ì‚¬ìš©)
        const clientKey = process.env.TOSS_CLIENT_KEY || 'test_ck_D5GePWvyJnrK0W0k6q8gLzN97Eoq'; // í…ŒìŠ¤íŠ¸ í‚¤ (ì‹¤ì œ ìš´ì˜ì‹œì—ëŠ” live_ë¡œ ì‹œì‘í•˜ëŠ” í‚¤ ì‚¬ìš©)
        const tossPayments = TossPayments(clientKey);

        // ì£¼ë¬¸ ë²ˆí˜¸ ìƒì„±
        const orderNumber = 'PH-' + Date.now();
        
        // ì„œë²„ì—ì„œ ê²°ì œ ê¸ˆì•¡ ê²€ì¦
        const productPrice = parseInt(document.getElementById('product-price').textContent.replace(/[^0-9]/g, ''));
        const productName = document.getElementById('product-name').textContent;
        
        try {
          const validationResponse = await fetch('/api/validate-payment', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              productName: productName,
              amount: productPrice,
              orderId: orderNumber
            })
          });
          
          const validationResult = await validationResponse.json();
          
          if (!validationResponse.ok || !validationResult.valid) {
            throw new Error(validationResult.error || 'ê²°ì œ ê²€ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
          }
          
          console.log('âœ… ê²°ì œ ì •ë³´ ì„œë²„ ê²€ì¦ ì™„ë£Œ');
        } catch (error) {
          console.error('âŒ ê²°ì œ ê²€ì¦ ì‹¤íŒ¨:', error);
          alert('ê²°ì œ ì •ë³´ ê²€ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
          paymentBtn.disabled = false;
          paymentBtn.textContent = 'ê²°ì œí•˜ê¸°';
          return;
        }

        // ê²°ì œ ì •ë³´ ì„¤ì •
        const paymentData = {
          amount: productPrice,
          orderId: orderNumber,
          orderName: productName,
          customerName: document.getElementById('payer-name').value,
          customerEmail: document.getElementById('payer-email').value,
          customerMobilePhone: document.getElementById('payer-phone').value,
          successUrl: window.location.origin + '/payment-success.html?order=' + orderNumber,
          failUrl: window.location.origin + '/payment-fail.html?order=' + orderNumber,
          windowTarget: 'iframe'
        };

        // ê²°ì œ ìš”ì²­
        tossPayments.requestPayment(paymentMethod.value, paymentData)
          .then(function (data) {
            // ê²°ì œ ì„±ê³µ ì‹œ ì²˜ë¦¬
            console.log('ê²°ì œ ì„±ê³µ:', data);
            
            // ì£¼ë¬¸ ì •ë³´ ì €ì¥
            const orderInfo = {
              orderNumber: orderNumber,
              productName: document.getElementById('product-name').textContent,
              price: document.getElementById('product-price').textContent,
              recipient: {
                name: document.getElementById('recipient-name').value,
                phone: document.getElementById('recipient-phone').value,
                address: document.getElementById('shipping-address').value,
                note: document.getElementById('shipping-note').value
              },
              payer: {
                name: document.getElementById('payer-name').value,
                phone: document.getElementById('payer-phone').value,
                email: document.getElementById('payer-email').value
              },
              paymentMethod: paymentMethod.value,
              orderDate: new Date().toISOString(),
              paymentData: data
            };

            // localStorage ì£¼ë¬¸ ì •ë³´ ì €ì¥ ì œê±° - Firebase ì „ìš©
            console.log('âœ… Firebaseì—ì„œ ì£¼ë¬¸ ì •ë³´ ì €ì¥ í•„ìš”');
            
            // êµ¬ë§¤ ì •ë³´ë¥¼ ì˜ë¢°ì™€ ì—°ê²°í•˜ì—¬ ì €ì¥
            const urlParams = new URLSearchParams(window.location.search);
            const reqKey = urlParams.get('req');
            const method = urlParams.get('method') || 'direct';
            
            if (reqKey) {
              const purchaseInfo = {
                method: method,
                status: 'paid',
                orderNumber: orderNumber,
                orderDate: new Date().toISOString(),
                productName: document.getElementById('product-name').textContent,
                price: document.getElementById('product-price').textContent,
                paymentMethod: paymentMethod.value,
                recipient: {
                  name: document.getElementById('recipient-name').value,
                  phone: document.getElementById('recipient-phone').value,
                  address: document.getElementById('shipping-address').value
                },
                payer: {
                  name: document.getElementById('payer-name').value,
                  phone: document.getElementById('payer-phone').value,
                  email: document.getElementById('payer-email').value
                },
                paymentData: data
              };
              
              // localStorage êµ¬ë§¤ ì •ë³´ ì €ì¥ ì œê±° - Firebase ì „ìš©
              console.log('âœ… Firebaseì—ì„œ êµ¬ë§¤ ì •ë³´ ì €ì¥ í•„ìš”');
            }

            // ê²°ì œ ì™„ë£Œ í˜ì´ì§€ë¡œ ì´ë™
            window.location.href = paymentData.successUrl;
          })
          .catch(function (error) {
            // ê²°ì œ ì‹¤íŒ¨ ì‹œ ì²˜ë¦¬
            console.error('ê²°ì œ ì‹¤íŒ¨:', error);
            alert('ê²°ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
            
            // ë²„íŠ¼ ìƒíƒœ ë³µì›
            paymentBtn.disabled = false;
            paymentBtn.textContent = 'ê²°ì œí•˜ê¸°';
          });
      }

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ìƒí’ˆ ì •ë³´ ì„¤ì •
      window.addEventListener('DOMContentLoaded', function() {
        console.log('=== DOMContentLoaded ì´ë²¤íŠ¸ ë°œìƒ ===');
        setTimeout(() => {
          getProductInfo();
        }, 100);
      });
      
      // ì¶”ê°€ë¡œ load ì´ë²¤íŠ¸ë„ ë“±ë¡
      window.addEventListener('load', function() {
        console.log('=== load ì´ë²¤íŠ¸ ë°œìƒ ===');
        setTimeout(() => {
          if (!document.getElementById('product-name').textContent) {
            console.log('ìƒí’ˆ ì •ë³´ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•©ë‹ˆë‹¤.');
            getProductInfo();
          }
        }, 200);
      });
      
      // ì¦‰ì‹œ ì‹¤í–‰ (í˜ì´ì§€ ë¡œë“œ ì „ì—ë„)
      console.log('=== payment.html ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œë¨ ===');
      console.log('í˜„ì¬ í˜ì´ì§€ URL:', window.location.href);
      console.log('í˜„ì¬ í˜ì´ì§€ search:', window.location.search);
      
      setTimeout(() => {
        console.log('=== ì¦‰ì‹œ ì‹¤í–‰ ì‹œë„ ===');
        getProductInfo();
      }, 500);
    </script>
  </body>
</html> 