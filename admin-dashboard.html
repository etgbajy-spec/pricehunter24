<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Content Security Policy - Firebase iframe í—ˆìš© -->
    <meta http-equiv="Content-Security-Policy" content="frame-src 'self' https://www.google.com https://recaptcha.google.com https://kauth.kakao.com https://pricehunter-99a1b.firebaseapp.com https://*.firebaseapp.com https://*.googleapis.com https://apis.google.com https://accounts.google.com; connect-src 'self' https://firestore.googleapis.com https://identitytoolkit.googleapis.com https://securetoken.googleapis.com https://firebasestorage.googleapis.com https://content-firebaseappcheck.googleapis.com https://www.googleapis.com https://*.firebaseio.com wss://*.firebaseio.com https://developers.kakao.com https://kapi.kakao.com https://kauth.kakao.com https://*.firebaseapp.com https://*.cloudfunctions.net https://api.emailjs.com https://www.gstatic.com https://*.gstatic.com https://firebasejs.com https://images.unsplash.com https://*.unsplash.com https://apis.google.com https://*.firebasejs.com https://accounts.google.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.tailwindcss.com https://cdn.jsdelivr.net https://www.gstatic.com https://*.gstatic.com https://firebasejs.com https://apis.google.com; img-src 'self' data: https: http: blob:;" />
    
    <title>ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ - PriceHunter</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3EğŸ”%3C/text%3E%3C/svg%3E">
    
    <!-- Firebase v9 SDK (ëª¨ë“ˆì‹) -->
    <script type="module">
      import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
      import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js';
      import { getFirestore, collection, query, orderBy, onSnapshot, getDocs, getDoc, addDoc, serverTimestamp, doc, updateDoc, deleteDoc, where } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js';
      
      // Firebase ì„¤ì •
      const firebaseConfig = {
        apiKey: "AIzaSyDBZxKyMS7eeBTbPnbZkj0WWOZQHNldoL4",
        authDomain: "pricehunter-99a1b.firebaseapp.com",
        projectId: "pricehunter-99a1b",
        storageBucket: "pricehunter-99a1b.firebasestorage.app",
        messagingSenderId: "242265693919",
        appId: "1:242265693919:web:74234d942b82a51541136a",
        measurementId: "G-4BKLV4EVB9"
      };

      // Firebase ì´ˆê¸°í™”
      try {
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // ì „ì—­ìœ¼ë¡œ ë…¸ì¶œ
        window.firebaseApp = app;
        window.firebaseAuth = auth;
        window.firebaseDb = db;
        window.firebaseAuthFunctions = { onAuthStateChanged };
        window.firebaseFirestoreFunctions = { collection, query, orderBy, onSnapshot, getDocs, getDoc, addDoc, serverTimestamp, doc, updateDoc, deleteDoc, where };
        
        console.log('âœ… ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ Firebase v9 ì´ˆê¸°í™” ì™„ë£Œ');
      } catch (error) {
        console.error('âŒ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ Firebase ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
        // ì´ˆê¸°í™” ì‹¤íŒ¨ì‹œì—ë„ ê¸°ë³¸ ê°ì²´ë“¤ì„ ìƒì„±í•˜ì—¬ ì˜¤ë¥˜ ë°©ì§€
        window.firebaseApp = null;
        window.firebaseAuth = null;
        window.firebaseDb = null;
        window.firebaseAuthFunctions = { onAuthStateChanged: () => {} };
        window.firebaseFirestoreFunctions = { 
          collection: () => {}, 
          query: () => {}, 
          orderBy: () => {}, 
          onSnapshot: () => {},
          getDocs: () => {},
          addDoc: () => {},
          serverTimestamp: () => {},
          doc: () => {},
          updateDoc: () => {},
          deleteDoc: () => {},
          where: () => {}
        };
        
        // ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
        alert('ì‹œìŠ¤í…œ ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
      }
    </script>
    
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <!-- Tailwind CSS (ê°œì„ ëœ ë¡œë”© ë°©ì‹) -->
    <script>
        // Tailwind CSS ì„¤ì • - CSP ì˜¤ë¥˜ ë°©ì§€
        if (typeof tailwind !== 'undefined') {
            tailwind.config = {
                theme: {
                    extend: {}
                },
                corePlugins: {
                    preflight: false
                }
            }
        }
        
        // Tailwind CSS ë™ì  ë¡œë”©
        function loadTailwindCSS() {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = 'https://cdn.tailwindcss.com';
                script.onload = () => {
                    console.log('âœ… Tailwind CSS ë¡œë“œë¨ (ê°œë°œìš© CDN)');
                    resolve();
                };
                script.onerror = (error) => {
                    console.error('âŒ Tailwind CSS ë¡œë“œ ì‹¤íŒ¨:', error);
                    // Tailwind ë¡œë“œ ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ ìŠ¤íƒ€ì¼ ì ìš©
                    applyFallbackStyles();
                    reject(error);
                };
                document.head.appendChild(script);
            });
        }
        
        // Tailwind ë¡œë“œ ì‹¤íŒ¨ ì‹œ ëŒ€ì²´ ìŠ¤íƒ€ì¼
        function applyFallbackStyles() {
            const style = document.createElement('style');
            style.textContent = `
                body { font-family: 'Noto Sans KR', sans-serif; }
                .bg-gradient-to-br { background: linear-gradient(135deg, #f3f4f6, #dbeafe, #d1fae5); }
                .min-h-screen { min-height: 100vh; }
                .flex { display: flex; }
                .items-center { align-items: center; }
                .justify-center { justify-content: center; }
                .bg-white { background-color: white; }
                .rounded-xl { border-radius: 0.75rem; }
                .shadow-2xl { box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); }
                .p-8 { padding: 2rem; }
                .w-full { width: 100%; }
                .max-w-md { max-width: 28rem; }
                .text-center { text-align: center; }
                .mb-8 { margin-bottom: 2rem; }
                .text-3xl { font-size: 1.875rem; }
                .font-bold { font-weight: 700; }
                .text-pink-600 { color: #db2777; }
                .text-gray-600 { color: #4b5563; }
                .space-y-6 > * + * { margin-top: 1.5rem; }
                .block { display: block; }
                .text-sm { font-size: 0.875rem; }
                .font-medium { font-weight: 500; }
                .text-gray-700 { color: #374151; }
                .mb-2 { margin-bottom: 0.5rem; }
                .px-4 { padding-left: 1rem; padding-right: 1rem; }
                .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
                .border { border-width: 1px; }
                .border-gray-300 { border-color: #d1d5db; }
                .rounded-lg { border-radius: 0.5rem; }
                .focus\\:ring-2:focus { box-shadow: 0 0 0 2px rgba(236, 72, 153, 0.5); }
                .focus\\:ring-pink-400:focus { box-shadow: 0 0 0 2px rgba(244, 114, 182, 0.5); }
                .focus\\:outline-none:focus { outline: none; }
                .bg-gradient-to-r { background: linear-gradient(to right, #ec4899, #8b5cf6); }
                .text-white { color: white; }
                .hover\\:from-pink-600:hover { background: linear-gradient(to right, #db2777, #7c3aed); }
                .hover\\:to-purple-600:hover { background: linear-gradient(to right, #ec4899, #7c3aed); }
                .transition { transition: all 0.15s ease-in-out; }
                .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
                .mt-6 { margin-top: 1.5rem; }
                .text-pink-600 { color: #db2777; }
                .hover\\:text-pink-700:hover { color: #be185d; }
                .text-blue-600 { color: #2563eb; }
                .hover\\:text-blue-700:hover { color: #1d4ed8; }
                .text-xs { font-size: 0.75rem; }
                .text-gray-500 { color: #6b7280; }
                .mt-2 { margin-top: 0.5rem; }
            `;
            document.head.appendChild(style);
            console.log('âš ï¸ Tailwind CSS ëŒ€ì²´ ìŠ¤íƒ€ì¼ ì ìš©ë¨');
        }
        
        // Tailwind CSS ë¡œë”© ì‹œì‘
        loadTailwindCSS().catch(() => {
            console.log('âš ï¸ Tailwind CSS ë¡œë”© ì‹¤íŒ¨, ëŒ€ì²´ ìŠ¤íƒ€ì¼ ì‚¬ìš©');
        });
    </script>
    
    
    <script>
        // ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™” ì‹œì‘...');
            
            // í•¨ìˆ˜ ë“±ë¡ ìƒíƒœ í™•ì¸
            console.log('ğŸ” í•¨ìˆ˜ ë“±ë¡ ìƒíƒœ í™•ì¸:');
            console.log('- window.editReview:', typeof window.editReview);
            console.log('- window.editReviewWithModal:', typeof window.editReviewWithModal);
            console.log('- window.closeEditReviewModal:', typeof window.closeEditReviewModal);
            
            // Firebase ìƒíƒœ ëª¨ë‹ˆí„°ë§ ì¶”ê°€
            if (window.firebaseAuthFunctions && window.firebaseAuthFunctions.onAuthStateChanged) {
                window.firebaseAuthFunctions.onAuthStateChanged(window.firebaseAuth, async (user) => {
                    console.log('ğŸ” Firebase Auth ìƒíƒœ ë³€ê²½:', user ? user.email : 'ë¡œê·¸ì•„ì›ƒë¨');
                    
                    if (!user) {
                        // ë¡œê·¸ì•„ì›ƒ ìƒíƒœ - ë¡œê·¸ì¸ ì„¹ì…˜ í‘œì‹œ
                        showLoginSection();
                    } else {
                        // ë¡œê·¸ì¸ ìƒíƒœ - ê´€ë¦¬ì ê¶Œí•œ í™•ì¸ í›„ ëŒ€ì‹œë³´ë“œ í‘œì‹œ
                        const isAdmin = await checkAdminPermission(user);
                        if (isAdmin) {
                            document.getElementById('login-section').classList.add('hidden');
                            document.getElementById('dashboard-section').classList.remove('hidden');
                            loadDashboardData();
                        } else {
                            showLoginSection();
                        }
                    }
                });
            }
            
            // Firebase ì¤€ë¹„ ëŒ€ê¸° í›„ ì‹¤ì‹œê°„ êµ¬ë… ì‹œì‘
            setTimeout(async () => {
                try {
                    await waitForFirebase();
                    subscribeToUsers();
                    console.log('âœ… ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ Firebase ì—°ë™ ì™„ë£Œ');
                } catch (error) {
                    console.error('âŒ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                    // ì´ˆê¸°í™” ì‹¤íŒ¨ì‹œ 3ì´ˆ í›„ ì¬ì‹œë„
                    setTimeout(() => {
                        console.log('ğŸ”„ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ì¬ì‹œë„...');
                        location.reload();
                    }, 3000);
                }
            }, 1000);
        });
        
        // Firebase SDK ë¡œë”© ëŒ€ê¸° í•¨ìˆ˜ (ë‹¨ìˆœí™”ëœ ë²„ì „)
        function waitForFirebaseAndInitialize() {
            const maxAttempts = 8; // 8ì´ˆ ëŒ€ê¸°
            let attempts = 0;
            
            const checkFirebase = () => {
                attempts++;
                console.log(`ğŸ” Firebase SDK í™•ì¸ ì‹œë„ ${attempts}/${maxAttempts}`);
                
                // Firebase SDK ì™„ì „ ë¡œë“œ í™•ì¸
                if (typeof firebase !== 'undefined' && 
                    firebase.apps !== undefined && 
                    firebase.auth !== undefined && 
                    firebase.firestore !== undefined) {
                    
                    console.log('âœ… Firebase SDK ì™„ì „ ë¡œë“œë¨');
                    console.log('Firebase ë²„ì „:', firebase.SDK_VERSION);
                    
                    // Firebase ì´ˆê¸°í™” ì‹œë„
                    try {
                        const initResult = initializeFirebase();
                        if (initResult) {
                            console.log('âœ… Firebase ì´ˆê¸°í™” ì™„ë£Œ');
                            setupAdminDashboard();
                        } else {
                            console.error('âŒ Firebase ì´ˆê¸°í™” ì‹¤íŒ¨');
                            showFirebaseError('Firebase ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. Netlify CSP í—¤ë”ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
                        }
                    } catch (error) {
                        console.error('âŒ Firebase ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜:', error);
                        showFirebaseError('Firebase ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                    }
                } else if (attempts < maxAttempts) {
                    console.log('â³ Firebase SDK ë¡œë”© ëŒ€ê¸° ì¤‘...');
                    setTimeout(checkFirebase, 1000);
                } else {
                    console.error('âŒ Firebase SDK ë¡œë”© ì‹œê°„ ì´ˆê³¼');
                    showFirebaseError('Firebase SDK ë¡œë”© ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.\n\nNetlify CSP ì •ì±…ì—ì„œ ë‹¤ìŒ ë„ë©”ì¸ë“¤ì´ í—ˆìš©ë˜ì–´ì•¼ í•©ë‹ˆë‹¤:\n- https://www.gstatic.com\n- https://www.gstatic.com/firebasejs\n\nnetlify.toml íŒŒì¼ì˜ CSP ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”.');
                }
            };
            
            checkFirebase();
        }
        
        // Firebase ì˜¤ë¥˜ í‘œì‹œ í•¨ìˆ˜ (CSP ìµœì í™” ë²„ì „)
        function showFirebaseError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'fixed top-4 right-4 bg-red-500 text-white p-4 rounded-lg shadow-lg z-50 max-w-md';
            errorDiv.innerHTML = `
                <div class="font-bold mb-2">ğŸ”¥ Firebase ì˜¤ë¥˜</div>
                <div class="text-sm mb-2">${message}</div>
                <div class="text-xs mb-3 p-2 bg-red-600 rounded">
                    <strong>CSP í•´ê²° ë°©ë²•:</strong><br>
                    1. DevTools â†’ Network â†’ Response Headers í™•ì¸<br>
                    2. content-security-policyì— www.gstatic.com í¬í•¨ í™•ì¸<br>
                    3. ì„œë²„ ì¬ì‹œì‘ í›„ ìƒˆë¡œê³ ì¹¨<br>
                    4. ë¸Œë¼ìš°ì € ìºì‹œ ì™„ì „ ì‚­ì œ<br>
                    5. ì„œë¹„ìŠ¤ì›Œì»¤ ë“±ë¡ í•´ì œ
                </div>
                <div class="flex gap-2 flex-wrap">
                    <button onclick="location.reload()" class="px-3 py-1 bg-white text-red-500 rounded text-xs font-bold hover:bg-gray-100">
                        ğŸ”„ ìƒˆë¡œê³ ì¹¨
                    </button>
                    <button onclick="testFirebaseConnection()" class="px-3 py-1 bg-yellow-500 text-white rounded text-xs font-bold hover:bg-yellow-600">
                        ğŸ§ª ì—°ê²° í…ŒìŠ¤íŠ¸
                    </button>
                    <button onclick="clearCacheAndReload()" class="px-3 py-1 bg-orange-500 text-white rounded text-xs font-bold hover:bg-orange-600">
                        ğŸ§¹ ìºì‹œ ì •ë¦¬
                    </button>
                    <button onclick="this.parentElement.parentElement.remove()" class="px-3 py-1 bg-gray-500 text-white rounded text-xs font-bold hover:bg-gray-600">
                        âœ• ë‹«ê¸°
                    </button>
                </div>
            `;
            document.body.appendChild(errorDiv);
            
            // 20ì´ˆ í›„ ìë™ ì œê±° (CSP ë¬¸ì œëŠ” í•´ê²° ì‹œê°„ì´ ë” í•„ìš”)
            setTimeout(() => {
                if (errorDiv.parentElement) {
                    errorDiv.remove();
                }
            }, 20000);
        }
        
        // ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ì„¤ì •
        function setupAdminDashboard() {
            console.log('ğŸ”§ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ì„¤ì • ì‹œì‘...');
            
            // Firebase ìƒíƒœ ì¬í™•ì¸
            if (!window.firebaseAuth || !window.firebaseDb) {
                console.error('âŒ Firebase ì„œë¹„ìŠ¤ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                showFirebaseError('Firebase ì„œë¹„ìŠ¤ ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                return;
            }
            
            console.log('âœ… ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ì„¤ì • ì™„ë£Œ');
        }
        
        // ê´€ë¦¬ì ê¶Œí•œ í™•ì¸ í•¨ìˆ˜
        async function checkAdminPermission(user) {
            try {
                if (!user || !user.uid) return false;
                
                // Firestoreì—ì„œ ê´€ë¦¬ì ê¶Œí•œ í™•ì¸
                const { doc, getDoc } = await import('https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js');
                const adminDoc = await getDoc(doc(window.firebaseDb, 'admins', user.uid));
                
                if (adminDoc.exists()) {
                    const adminData = adminDoc.data();
                    return adminData.role === 'admin' || adminData.permissions?.includes('admin');
                }
                
                // ê¸°ë³¸ ê´€ë¦¬ì ì´ë©”ì¼ í™•ì¸ (ì„ì‹œ)
                const adminEmails = ['admin@pricehunter.com', 'admin@example.com'];
                return adminEmails.includes(user.email);
                
            } catch (error) {
                console.error('âŒ ê´€ë¦¬ì ê¶Œí•œ í™•ì¸ ì‹¤íŒ¨:', error);
                return false;
            }
        }

        // ê´€ë¦¬ì ë¡œê·¸ì¸ í•¨ìˆ˜
        window.adminLogin = async function() {
            console.log('ğŸ” ê´€ë¦¬ì ë¡œê·¸ì¸ ì‹œë„...');
            
            const email = document.getElementById('admin-email').value;
            const password = document.getElementById('admin-password').value;
            
            if (!email || !password) {
                alert('ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // Firebase ê°€ë“œ í™•ì¸
            if (!window.firebaseApp) {
                alert('Firebase SDKê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì„œë²„ CSP í—¤ë”ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!window.firebaseAuth) {
                console.error('âŒ Firebase Authê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                alert('ì¸ì¦ ì‹œìŠ¤í…œ ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            try {
                console.log('ğŸ”¥ ë¡œê·¸ì¸ ì‹œë„:', email);
                // Firebase v9ì—ì„œëŠ” signInWithEmailAndPasswordë¥¼ ì§ì ‘ importí•´ì•¼ í•¨
                const { signInWithEmailAndPassword } = await import('https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js');
                const userCredential = await signInWithEmailAndPassword(window.firebaseAuth, email, password);
                console.log('âœ… ë¡œê·¸ì¸ ì„±ê³µ:', userCredential.user.email);
                
                // ê´€ë¦¬ì ê¶Œí•œ í™•ì¸
                const isAdmin = await checkAdminPermission(userCredential.user);
                if (!isAdmin) {
                    alert('ê´€ë¦¬ì ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ê´€ë¦¬ì ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
                    // ë¡œê·¸ì•„ì›ƒ
                    const { signOut } = await import('https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js');
                    await signOut(window.firebaseAuth);
                    return;
                }
                
                console.log('âœ… ê´€ë¦¬ì ê¶Œí•œ í™•ì¸ë¨');
                
                // ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ëŒ€ì‹œë³´ë“œ í‘œì‹œ
                document.getElementById('login-section').classList.add('hidden');
                document.getElementById('dashboard-section').classList.remove('hidden');
                
                // ê´€ë¦¬ì ì •ë³´ í‘œì‹œ
                if (document.getElementById('admin-info')) {
                    document.getElementById('admin-info').textContent = userCredential.user.email;
                }
                
                // ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë“œ
                loadDashboardData();
                
            } catch (error) {
                console.error('âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨:', error);
                let errorMessage = 'ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
                
                switch (error.code) {
                    case 'auth/user-not-found':
                        errorMessage = 'ë“±ë¡ë˜ì§€ ì•Šì€ ì´ë©”ì¼ì…ë‹ˆë‹¤.';
                        break;
                    case 'auth/wrong-password':
                        errorMessage = 'ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                        break;
                    case 'auth/invalid-email':
                        errorMessage = 'ì˜¬ë°”ë¥´ì§€ ì•Šì€ ì´ë©”ì¼ í˜•ì‹ì…ë‹ˆë‹¤.';
                        break;
                    case 'auth/too-many-requests':
                        errorMessage = 'ë„ˆë¬´ ë§ì€ ë¡œê·¸ì¸ ì‹œë„ê°€ ìˆì—ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                        break;
                    default:
                        errorMessage = error.message;
                }
                
                alert('ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            }
        };
        
        // í…ŒìŠ¤íŠ¸ ê´€ë¦¬ì ê³„ì • ìƒì„± í•¨ìˆ˜
        window.createAdminAccount = async function() {
            try {
                console.log('ğŸ”§ í…ŒìŠ¤íŠ¸ ê´€ë¦¬ì ê³„ì • ìƒì„± ì‹œì‘...');
                
                if (!firebase.auth) { 
                    alert("ì¸ì¦ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì‹¤íŒ¨"); 
                    throw new Error("Auth not initialized"); 
                }
                
                if (!window.firebaseAuth) {
                    alert('Firebaseê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
                    return;
                }
                
                // Firebase v9ì—ì„œëŠ” createUserWithEmailAndPasswordë¥¼ ì§ì ‘ importí•´ì•¼ í•¨
                const { createUserWithEmailAndPassword } = await import('https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js');
                const userCredential = await createUserWithEmailAndPassword(window.firebaseAuth, 'admin@pricehunter.com', 'admin1234');
                console.log('âœ… í…ŒìŠ¤íŠ¸ ê´€ë¦¬ì ê³„ì • ìƒì„± ì™„ë£Œ:', userCredential.user.email);
                
                // Firestoreì— ê´€ë¦¬ì ì •ë³´ ì €ì¥
                if (window.firebaseDb) {
                    const { collection, doc, setDoc, serverTimestamp } = await import('https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js');
                    await setDoc(doc(collection(window.firebaseDb, 'admins'), userCredential.user.uid), {
                        email: 'admin@pricehunter.com',
                        role: 'admin',
                        createdAt: serverTimestamp(),
                        permissions: ['read', 'write', 'delete', 'admin']
                    });
                    console.log('âœ… ê´€ë¦¬ì ì •ë³´ Firestore ì €ì¥ ì™„ë£Œ');
                }
                
                alert('âœ… í…ŒìŠ¤íŠ¸ ê´€ë¦¬ì ê³„ì •ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nì´ë©”ì¼: admin@pricehunter.com\në¹„ë°€ë²ˆí˜¸: admin1234\n\nì´ì œ ì´ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                
                // ì…ë ¥ í•„ë“œì— ìë™ ì…ë ¥
                document.getElementById('admin-email').value = 'admin@pricehunter.com';
                document.getElementById('admin-password').value = 'admin1234';
                
            } catch (error) {
                console.error('âŒ í…ŒìŠ¤íŠ¸ ê³„ì • ìƒì„± ì‹¤íŒ¨:', error);
                
                if (error.code === 'auth/email-already-in-use') {
                    alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ê³„ì •ì…ë‹ˆë‹¤!\n\nì´ë©”ì¼: admin@pricehunter.com\në¹„ë°€ë²ˆí˜¸: admin1234\n\nì´ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•´ë³´ì„¸ìš”.');
                    
                    // ì…ë ¥ í•„ë“œì— ìë™ ì…ë ¥
                    document.getElementById('admin-email').value = 'admin@pricehunter.com';
                    document.getElementById('admin-password').value = 'admin1234';
                } else {
                    alert('ê³„ì • ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                }
            }
        };
        
        // Firebase v9 ê¸°ë°˜ í•¨ìˆ˜ë“¤ (ê°œì„ ëœ ë²„ì „)
        let isFirebaseReady = false;
        let usersUnsubscribe = null;

        // Firebase ì¤€ë¹„ ìƒíƒœ í™•ì¸ (Firebase v8)
        async function waitForFirebase() {
            return new Promise((resolve, reject) => {
                console.log('ğŸ”„ Firebase ì¤€ë¹„ ìƒíƒœ í™•ì¸ ì¤‘...');
                console.log('ğŸ” Firebase ì´ˆê¸°í™” ìƒíƒœ:', {
                    firebaseApp: !!window.firebaseApp,
                    firebaseAuth: !!window.firebaseAuth,
                    firebaseDb: !!window.firebaseDb,
                    firebaseFirestoreFunctions: !!window.firebaseFirestoreFunctions
                });
                
                // Firebase v9 ì´ˆê¸°í™” í™•ì¸
                if (window.firebaseApp && window.firebaseAuth && window.firebaseDb && window.firebaseFirestoreFunctions) {
                    isFirebaseReady = true;
                    console.log('âœ… Firebase v9 ì´ˆê¸°í™” ì„±ê³µ');
                    resolve();
                    return;
                }
                
                // ì¬ì‹œë„
                const checkInterval = setInterval(() => {
                    if (window.firebaseApp && window.firebaseAuth && window.firebaseDb && window.firebaseFirestoreFunctions) {
                        clearInterval(checkInterval);
                        isFirebaseReady = true;
                        console.log('âœ… Firebase v9 ì´ˆê¸°í™” ì„±ê³µ');
                        resolve();
                    }
                }, 100);
                
                // 10ì´ˆ í›„ íƒ€ì„ì•„ì›ƒ
                setTimeout(() => {
                    clearInterval(checkInterval);
                    console.error('âŒ Firebase ì´ˆê¸°í™” íƒ€ì„ì•„ì›ƒ');
                    reject(new Error('Firebase ì´ˆê¸°í™” ì‹¤íŒ¨'));
                }, 10000);
            });
        }

        // ê³µí†µ ê°€ê²© í¬ë§· í•¨ìˆ˜ (ì»´ë§ˆ í‘œì‹œ)
        function formatPrice(price) {
            if (!price && price !== 0) return 'ê°€ê²© ì •ë³´ ì—†ìŒ';
            
            // ìˆ«ìë¡œ ë³€í™˜
            let numPrice;
            if (typeof price === 'number') {
                numPrice = price;
            } else if (typeof price === 'string') {
                // ë¬¸ìì—´ì—ì„œ ìˆ«ìë§Œ ì¶”ì¶œ
                numPrice = parseInt(price.replace(/[^\d]/g, '')) || 0;
            } else {
                return 'ê°€ê²© ì •ë³´ ì—†ìŒ';
            }
            
            // ì»´ë§ˆ í¬ë§·íŒ…
            return numPrice.toLocaleString() + 'ì›';
        }
        
        // ì‹¤ì‹œê°„ ì‚¬ìš©ì ëª©ë¡ êµ¬ë… (Firebase ì „ìš©)
        function subscribeToUsers() {
            console.log('ğŸ‘¥ ì‚¬ìš©ì ëª©ë¡ êµ¬ë… ì‹œì‘...');
            
            if (!window.firebaseDb) {
                console.warn('âš ï¸ Firebaseê°€ ì•„ì§ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return;
            }
            
            try {
                const { collection, query, orderBy, onSnapshot } = window.firebaseFirestoreFunctions;
                const usersRef = collection(window.firebaseDb, 'users');
                
                // createdAt í•„ë“œê°€ ì—†ì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ê¸°ë³¸ ì¿¼ë¦¬ ì‚¬ìš©
                let usersQuery;
                try {
                    usersQuery = query(usersRef, orderBy('createdAt', 'desc'));
                } catch (error) {
                    console.warn('âš ï¸ createdAt í•„ë“œë¡œ ì •ë ¬ ì‹¤íŒ¨, ê¸°ë³¸ ì¿¼ë¦¬ ì‚¬ìš©:', error);
                    usersQuery = query(usersRef);
                }

                usersUnsubscribe = onSnapshot(usersQuery, (snapshot) => {
                    const firebaseUsers = [];
                    snapshot.forEach((doc) => {
                        const userData = doc.data();
                        firebaseUsers.push({ 
                            id: doc.id, 
                            ...userData,
                            source: 'Firebase'
                        });
                    });
                    
                    console.log('ğŸ“Š Firebase ì‚¬ìš©ì ë°ì´í„° ì—…ë°ì´íŠ¸:', firebaseUsers.length, 'ëª…');
                    console.log('ğŸ“‹ Firebase ì‚¬ìš©ì ë°ì´í„°:', firebaseUsers);
                    
                    // localStorage ì‚¬ìš©ìì™€ Firebase ì‚¬ìš©ì í•©ì¹˜ê¸°
                    const allUsers = mergeUsersData(firebaseUsers);
                    updateUsersTable(allUsers);
                    
                    // íšŒì›ìˆ˜ ì—…ë°ì´íŠ¸ (Firebase ë°ì´í„°ë§Œ ì‚¬ìš©)
                    const totalMembersElement = document.getElementById('total-members');
                    if (totalMembersElement) {
                        totalMembersElement.textContent = allUsers.length;
                    }
                    
                    // í†µê³„ ì—…ë°ì´íŠ¸
                    updateMemberStats(allUsers);
                    
                }, (error) => {
                    console.error('âŒ ì‚¬ìš©ì ëª©ë¡ ì‹¤ì‹œê°„ êµ¬ë… ì‹¤íŒ¨:', error);
                    // Firebase ì—°ê²° ì‹¤íŒ¨ì‹œ ë¹ˆ ëª©ë¡ í‘œì‹œ
                    updateUsersTable([]);
                    document.getElementById('total-members').textContent = '0';
                    
                    // ì—°ê²° ì‹¤íŒ¨ì‹œ 5ì´ˆ í›„ ì¬ì‹œë„
                    setTimeout(() => {
                        console.log('ğŸ”„ Firestore ì—°ê²° ì¬ì‹œë„...');
                        subscribeToUsers();
                    }, 5000);
                });
            } catch (error) {
                console.error('âŒ Firestore ì¿¼ë¦¬ ìƒì„± ì‹¤íŒ¨:', error);
                // ì¿¼ë¦¬ ìƒì„± ì‹¤íŒ¨ì‹œ ë¹ˆ ëª©ë¡ í‘œì‹œ
                updateUsersTable([]);
                document.getElementById('total-members').textContent = '0';
                
                // ì¿¼ë¦¬ ìƒì„± ì‹¤íŒ¨ì‹œ 3ì´ˆ í›„ ì¬ì‹œë„
                setTimeout(() => {
                    console.log('ğŸ”„ Firestore ì¿¼ë¦¬ ì¬ì‹œë„...');
                    subscribeToUsers();
                }, 3000);
            }
        }

        // localStorageì—ì„œ ì‚¬ìš©ì ë°ì´í„° ë¡œë“œ
        function loadLocalStorageUsers() {
            try {
                const users = [];
                
                // ì¼ë°˜ ì‚¬ìš©ì ë°ì´í„°
                const userData = localStorage.getItem('user');
                if (userData) {
                    const user = JSON.parse(userData);
                    users.push({
                        id: user.firebaseId || 'local_' + Date.now(),
                        ...user,
                        source: 'localStorage'
                    });
                }
                
                // ì¹´ì¹´ì˜¤ ì‚¬ìš©ì ë°ì´í„°ë“¤
                const keys = Object.keys(localStorage);
                keys.forEach(key => {
                    if (key.startsWith('kakao_') && !key.includes('auth_')) {
                        try {
                            const storedData = localStorage.getItem(key);
                            if (storedData && storedData.startsWith('{')) {
                                const kakaoUser = JSON.parse(storedData);
                                users.push({
                                    id: kakaoUser.firebaseId || key,
                                    ...kakaoUser,
                                    source: 'localStorage'
                                });
                            }
                        } catch (e) {
                            console.warn('ì¹´ì¹´ì˜¤ ì‚¬ìš©ì ë°ì´í„° íŒŒì‹± ì‹¤íŒ¨:', e);
                        }
                    }
                });
                
                console.log('ğŸ“Š localStorage ì‚¬ìš©ì ë°ì´í„°:', users.length);
                updateUsersTable(users);
                document.getElementById('total-members').textContent = users.length;
                
            } catch (error) {
                console.error('âŒ localStorage ì‚¬ìš©ì ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // Firebase ì‚¬ìš©ì ë°ì´í„°ë§Œ ì‚¬ìš© (ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ë³‘í•© ì œê±°)
        function mergeUsersData(firebaseUsers) {
            console.log('ğŸ”„ Firebase ì‚¬ìš©ì ë°ì´í„° ì‚¬ìš©:', firebaseUsers.length, 'ëª…');
            
            // Firebase ì‚¬ìš©ìì—ì„œ ì¤‘ë³µ ì œê±° (ì´ë©”ì¼ ê¸°ì¤€)
            const firebaseUserMap = new Map();
            firebaseUsers.forEach(user => {
                if (user.email) {
                    // ê°™ì€ ì´ë©”ì¼ì´ ìˆìœ¼ë©´ ë” ìµœì‹  ë°ì´í„°ë¥¼ ìœ ì§€
                    if (!firebaseUserMap.has(user.email) || 
                        (user.createdAt && firebaseUserMap.get(user.email).createdAt && 
                         user.createdAt > firebaseUserMap.get(user.email).createdAt)) {
                        firebaseUserMap.set(user.email, user);
                    }
                }
            });
            
            const uniqueFirebaseUsers = Array.from(firebaseUserMap.values());
            console.log('ğŸ“Š ì¤‘ë³µ ì œê±° í›„ Firebase ì‚¬ìš©ì:', uniqueFirebaseUsers.length, 'ëª…');
            
            // Firebase ì‚¬ìš©ìë§Œ ì‚¬ìš©
            const allUsers = [...uniqueFirebaseUsers];
            
            // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ë³‘í•© ë¡œì§ ì œê±°ë¨ - Firebase ì „ìš© ì‚¬ìš©
            
            // ìµœì¢… ì¤‘ë³µ ê²€ì‚¬
            const finalEmailSet = new Set();
            const finalUsers = [];
            allUsers.forEach(user => {
                if (user.email && !finalEmailSet.has(user.email)) {
                    finalUsers.push(user);
                    finalEmailSet.add(user.email);
                }
            });
            
            console.log('âœ… ì‚¬ìš©ì ë°ì´í„° ë³‘í•© ì™„ë£Œ:', finalUsers.length, 'ëª…');
            console.log('ğŸ“‹ ìµœì¢… ì‚¬ìš©ì ëª©ë¡:', finalUsers.map(u => ({ email: u.email, source: u.source, name: u.name || u.displayName })));
            
            return finalUsers;
        }

        // Firebase ì¤‘ë³µ ì‚¬ìš©ì ë°ì´í„° ì •ë¦¬ í•¨ìˆ˜
        async function cleanupDuplicateUsers() {
            try {
                console.log('ğŸ§¹ Firebase ì¤‘ë³µ ì‚¬ìš©ì ë°ì´í„° ì •ë¦¬ ì‹œì‘...');
                
                const { collection, getDocs, deleteDoc, doc } = window.firebaseFirestoreFunctions;
                const db = window.firebaseDb;
                
                const usersRef = collection(db, 'users');
                const querySnapshot = await getDocs(usersRef);
                
                console.log(`ğŸ“Š ì „ì²´ ì‚¬ìš©ì ë¬¸ì„œ ìˆ˜: ${querySnapshot.size}`);
                
                const userMap = new Map();
                const usersToDelete = [];
                const allUsers = [];
                
                // ëª¨ë“  ì‚¬ìš©ì ë°ì´í„° ìˆ˜ì§‘
                querySnapshot.forEach((docSnapshot) => {
                    const userData = docSnapshot.data();
                    const userEmail = userData.email;
                    
                    if (userEmail) {
                        allUsers.push({
                            id: docSnapshot.id,
                            email: userEmail,
                            createdAt: userData.createdAt,
                            uid: userData.uid,
                            ...userData
                        });
                    }
                });
                
                console.log('ğŸ“‹ ëª¨ë“  ì‚¬ìš©ì ëª©ë¡:', allUsers.map(u => ({ 
                    id: u.id, 
                    email: u.email, 
                    createdAt: u.createdAt,
                    uid: u.uid 
                })));
                
                // ì´ë©”ì¼ë³„ë¡œ ê·¸ë£¹í™”í•˜ì—¬ ì¤‘ë³µ ì°¾ê¸°
                const emailGroups = new Map();
                allUsers.forEach(user => {
                    if (!emailGroups.has(user.email)) {
                        emailGroups.set(user.email, []);
                    }
                    emailGroups.get(user.email).push(user);
                });
                
                // ì¤‘ë³µ ì´ë©”ì¼ ì°¾ê¸°
                for (const [email, users] of emailGroups) {
                    if (users.length > 1) {
                        console.log(`ğŸ” ì¤‘ë³µ ì´ë©”ì¼ ë°œê²¬: ${email} (${users.length}ê°œ ë¬¸ì„œ)`);
                        
                        // ê°€ì¥ ìµœì‹  ë°ì´í„°ë¥¼ ìœ ì§€í•˜ê³  ë‚˜ë¨¸ì§€ ì‚­ì œ
                        users.sort((a, b) => {
                            if (a.createdAt && b.createdAt) {
                                return b.createdAt.toMillis() - a.createdAt.toMillis(); // ìµœì‹ ìˆœ
                            }
                            // createdAtì´ ì—†ëŠ” ê²½ìš° uidê°€ ë” ê¸´ ê²ƒ ìœ ì§€ (ìƒˆë¡œìš´ í˜•ì‹)
                            if (a.uid && b.uid) {
                                return b.uid.length - a.uid.length;
                            }
                            return 0;
                        });
                        
                        // ì²« ë²ˆì§¸(ê°€ì¥ ìµœì‹ )ë¥¼ ì œì™¸í•˜ê³  ë‚˜ë¨¸ì§€ ì‚­ì œ ëŒ€ìƒì— ì¶”ê°€
                        for (let i = 1; i < users.length; i++) {
                            usersToDelete.push(users[i].id);
                            console.log(`ğŸ—‘ï¸ ì‚­ì œ ëŒ€ìƒ: ${users[i].id} (ì´ë©”ì¼: ${email})`);
                        }
                    }
                }
                
                console.log(`ğŸ—‘ï¸ ì´ ì‚­ì œí•  ì¤‘ë³µ ì‚¬ìš©ì: ${usersToDelete.length}ëª…`);
                
                // ì¤‘ë³µ ì‚¬ìš©ì ì‚­ì œ
                let deletedCount = 0;
                for (const userId of usersToDelete) {
                    try {
                        await deleteDoc(doc(db, 'users', userId));
                        console.log(`âœ… ì¤‘ë³µ ì‚¬ìš©ì ì‚­ì œ ì™„ë£Œ: ${userId}`);
                        deletedCount++;
                    } catch (error) {
                        console.error(`âŒ ì‚¬ìš©ì ì‚­ì œ ì‹¤íŒ¨: ${userId}`, error);
                    }
                }
                
                console.log(`âœ… Firebase ì¤‘ë³µ ì‚¬ìš©ì ë°ì´í„° ì •ë¦¬ ì™„ë£Œ: ${deletedCount}ëª… ì‚­ì œ`);
                return deletedCount;
                
            } catch (error) {
                console.error('âŒ Firebase ì¤‘ë³µ ì‚¬ìš©ì ë°ì´í„° ì •ë¦¬ ì‹¤íŒ¨:', error);
                return 0;
            }
        }

        // íŠ¹ì • ì‚¬ìš©ì ì‚­ì œ í•¨ìˆ˜
        async function deleteSpecificUser(userId) {
            try {
                console.log(`ğŸ—‘ï¸ íŠ¹ì • ì‚¬ìš©ì ì‚­ì œ ì‹œì‘: ${userId}`);
                
                const { deleteDoc, doc } = window.firebaseFirestoreFunctions;
                const db = window.firebaseDb;
                
                await deleteDoc(doc(db, 'users', userId));
                console.log(`âœ… ì‚¬ìš©ì ì‚­ì œ ì™„ë£Œ: ${userId}`);
                return true;
                
            } catch (error) {
                console.error(`âŒ ì‚¬ìš©ì ì‚­ì œ ì‹¤íŒ¨: ${userId}`, error);
                throw error;
            }
        }

        // ì˜¬ë°”ë¥¸ ì‚¬ìš©ì ë¬¸ì„œ ë‹¤ì‹œ ìƒì„± í•¨ìˆ˜
        async function recreateCorrectUser() {
            try {
                console.log('ğŸ”„ ì˜¬ë°”ë¥¸ ì‚¬ìš©ì ë¬¸ì„œ ìƒì„± ì‹œì‘...');
                
                const { doc, setDoc } = window.firebaseFirestoreFunctions;
                const db = window.firebaseDb;
                
                // ì˜¬ë°”ë¥¸ ë¬¸ì„œ ìƒì„± (ë¹„ë°€ë²ˆí˜¸ í¬í•¨)
                const correctUserData = {
                    uid: 'ffG0D4HTZ39gYiw0VNHO',
                    email: 'etgbajy@gmail.com',
                    name: 'í—ˆì§„ì˜',
                    displayName: 'í—ˆì§„ì˜',
                    phone: '010-7714-6654',
                    password: 'znznektm1@',
                    emailVerification: 'etgbajy@gmail.com',
                    agreeTerms: true,
                    agreePrivacy: true,
                    agreeMarketing: false,
                    loginMethod: 'email',
                    isActive: true,
                    createdAt: new Date('2025-09-21T16:01:37.000Z'),
                    updatedAt: new Date(),
                    lastLogin: new Date(),
                    loginCount: 4
                };
                
                const userRef = doc(db, 'users', 'ffG0D4HTZ39gYiw0VNHO');
                await setDoc(userRef, correctUserData);
                
                console.log('âœ… ì˜¬ë°”ë¥¸ ì‚¬ìš©ì ë¬¸ì„œ ìƒì„± ì™„ë£Œ');
                alert('âœ… ì˜¬ë°”ë¥¸ ì‚¬ìš©ì ë¬¸ì„œê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nì´ì œ etgbajy@gmail.comìœ¼ë¡œ ë¡œê·¸ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                
                // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                setTimeout(() => {
                    location.reload();
                }, 1000);
                
                return true;
                
            } catch (error) {
                console.error('âŒ ì˜¬ë°”ë¥¸ ì‚¬ìš©ì ë¬¸ì„œ ìƒì„± ì‹¤íŒ¨:', error);
                alert('ë¬¸ì„œ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                throw error;
            }
        }

        // íšŒì› í†µê³„ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateMemberStats(users) {
            try {
                const kakaoUsers = users.filter(user => (user.loginMethod || user.loginType) === 'kakao').length;
                const emailUsers = users.filter(user => (user.loginMethod || user.loginType) === 'email').length;
                const firebaseUsers = users.length; // ëª¨ë“  ì‚¬ìš©ìê°€ Firebase ì‚¬ìš©ì
                const localStorageUsers = 0; // Firebase ì „ìš©ì´ë¯€ë¡œ 0
                
                console.log('ğŸ“Š íšŒì› í†µê³„:', {
                    total: users.length,
                    kakao: kakaoUsers,
                    email: emailUsers,
                    firebase: firebaseUsers,
                    localStorage: localStorageUsers
                });
                
                // í†µê³„ë¥¼ í™”ë©´ì— í‘œì‹œ (í•„ìš”ì‹œ)
                const statsElement = document.getElementById('member-stats');
                if (statsElement) {
                    statsElement.innerHTML = `
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                            <div class="text-center">
                                <div class="font-bold text-lg text-blue-600">${kakaoUsers}</div>
                                <div class="text-gray-600">ì¹´ì¹´ì˜¤í†¡</div>
                            </div>
                            <div class="text-center">
                                <div class="font-bold text-lg text-green-600">${emailUsers}</div>
                                <div class="text-gray-600">ì´ë©”ì¼</div>
                            </div>
                            <div class="text-center">
                                <div class="font-bold text-lg text-purple-600">${firebaseUsers}</div>
                                <div class="text-gray-600">Firebase</div>
                            </div>
                            <div class="text-center">
                                <div class="font-bold text-lg text-gray-400">${localStorageUsers}</div>
                                <div class="text-gray-600">localStorage</div>
                            </div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('âŒ íšŒì› í†µê³„ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
            }
        }

        // ì‚¬ìš©ì í…Œì´ë¸” ì—…ë°ì´íŠ¸ (ê°œì„ ëœ ë²„ì „)
        function updateUsersTable(users) {
            console.log('ğŸ“‹ íšŒì› í…Œì´ë¸” ì—…ë°ì´íŠ¸ ì‹œì‘...');
            console.log('ğŸ‘¥ í‘œì‹œí•  ì‚¬ìš©ì ìˆ˜:', users.length);
            
            const tbody = document.getElementById('members-table-body');
            if (!tbody) {
                console.error('âŒ members-table-body ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            tbody.innerHTML = '';

            if (users.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" class="px-6 py-4 text-center text-gray-500">
                            ë“±ë¡ëœ íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤.
                        </td>
                    </tr>
                `;
                return;
            }

            // ì‚¬ìš©ì ë°ì´í„° ì •ë ¬ (Firebase ìš°ì„ , ìµœì‹ ìˆœ)
            const sortedUsers = users.sort((a, b) => {
                // Firebase ì‚¬ìš©ìë¥¼ ìš°ì„ ìœ¼ë¡œ
                if (a.source === 'Firebase' && b.source !== 'Firebase') return -1;
                if (a.source !== 'Firebase' && b.source === 'Firebase') return 1;
                
                // ê°™ì€ ì†ŒìŠ¤ ë‚´ì—ì„œëŠ” ìµœì‹ ìˆœ
                const dateA = a.createdAt ? (a.createdAt.seconds ? a.createdAt.seconds * 1000 : new Date(a.createdAt).getTime()) : 0;
                const dateB = b.createdAt ? (b.createdAt.seconds ? b.createdAt.seconds * 1000 : new Date(b.createdAt).getTime()) : 0;
                return dateB - dateA;
            });

            sortedUsers.forEach((user, index) => {
                console.log(`ğŸ‘¤ ì‚¬ìš©ì ${index + 1}:`, {
                    email: user.email,
                    name: user.displayName || user.name,
                    source: user.source,
                    phone: user.phone
                });
                
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                
                const profileImage = user.photoURL || user.profileImage || 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%236b7280"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>';
                const loginMethod = user.loginMethod || user.loginType || 'email';
                
                // ë‚ ì§œ ì²˜ë¦¬ ê°œì„ 
                let joinDate = 'ì•Œ ìˆ˜ ì—†ìŒ';
                if (user.createdAt) {
                    if (user.createdAt.seconds) {
                        joinDate = new Date(user.createdAt.seconds * 1000).toLocaleDateString('ko-KR');
                    } else if (user.createdAt.toDate) {
                        joinDate = user.createdAt.toDate().toLocaleDateString('ko-KR');
                    } else {
                        joinDate = new Date(user.createdAt).toLocaleDateString('ko-KR');
                    }
                } else if (user.joinDate) {
                    joinDate = new Date(user.joinDate).toLocaleDateString('ko-KR');
                }
                
                let lastUpdate = 'ì•Œ ìˆ˜ ì—†ìŒ';
                if (user.updatedAt) {
                    if (user.updatedAt.seconds) {
                        lastUpdate = new Date(user.updatedAt.seconds * 1000).toLocaleDateString('ko-KR');
                    } else if (user.updatedAt.toDate) {
                        lastUpdate = user.updatedAt.toDate().toLocaleDateString('ko-KR');
                    } else {
                        lastUpdate = new Date(user.updatedAt).toLocaleDateString('ko-KR');
                    }
                }
                
                const dataSource = 'Firebase';
                const dataSourceColor = 'bg-green-100 text-green-800';
                // í¬ì¸íŠ¸ ì‹œìŠ¤í…œ ì œê±°ë¨
                const userName = user.displayName || user.name || 'ì´ë¦„ ì—†ìŒ';
                const userEmail = user.email || 'ì´ë©”ì¼ ì—†ìŒ';
                const userPhone = user.phone || '-';
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="h-10 w-10 flex-shrink-0">
                                <div class="h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center text-gray-600 text-xs font-bold">
                                    ${userName.charAt(0)}
                                </div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-gray-900">${userName}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${loginMethod === 'kakao' ? 'bg-yellow-100 text-yellow-800' : 'bg-blue-100 text-blue-800'}">
                            ${loginMethod === 'kakao' ? 'ì¹´ì¹´ì˜¤í†¡' : 'ì´ë©”ì¼'}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${userEmail}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${userPhone}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${joinDate}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${lastUpdate}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${dataSourceColor}">
                            ${dataSource}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="viewUserDetails('${user.email || user.id}')" class="text-indigo-600 hover:text-indigo-900 mr-3">ìƒì„¸ë³´ê¸°</button>
                        <button onclick="deleteUser('${user.email || user.id}')" class="text-red-600 hover:text-red-900">ì‚­ì œ</button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            console.log('âœ… íšŒì› í…Œì´ë¸” ì—…ë°ì´íŠ¸ ì™„ë£Œ');
        }

        // Firebaseì—ì„œ ì˜ë¢° ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ì‹¤ì‹œê°„ êµ¬ë…)
        let requestsUnsubscribe = null;
        
        function subscribeToRequests() {
            try {
                const { collection, onSnapshot } = window.firebaseFirestoreFunctions;
                const db = window.firebaseDb;
                
                // orderBy ì—†ì´ ëª¨ë“  ë°ì´í„° êµ¬ë… (ë³µí•© ì¸ë±ìŠ¤ ë¬¸ì œ ë°©ì§€)
                const requestsRef = collection(db, 'requests');
                
                console.log('ğŸ”„ ì˜ë¢° ë°ì´í„° ì‹¤ì‹œê°„ êµ¬ë… ì‹œì‘...');
                
                requestsUnsubscribe = onSnapshot(requestsRef, (querySnapshot) => {
                    const requests = [];
                    
                    querySnapshot.forEach((doc) => {
                        requests.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });
                    
                    // í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œì—ì„œ ì •ë ¬ (createdAt ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ)
                    requests.sort((a, b) => {
                        const aTime = a.createdAt ? (a.createdAt.toDate ? a.createdAt.toDate() : new Date(a.createdAt)) : new Date(0);
                        const bTime = b.createdAt ? (b.createdAt.toDate ? b.createdAt.toDate() : new Date(b.createdAt)) : new Date(0);
                        return bTime - aTime;
                    });
                    
                    console.log(`âœ… ì‹¤ì‹œê°„ ì˜ë¢° ë°ì´í„° ì—…ë°ì´íŠ¸: ${requests.length}ê°œ`);
                    console.log('ğŸ“Š ì‹¤ì‹œê°„ ì˜ë¢° ë°ì´í„° ìƒì„¸:', requests);
                    
                    // UI ì—…ë°ì´íŠ¸
                    updateRequestListUI(requests);
                    
                    // í†µê³„ ì—…ë°ì´íŠ¸
                    updateRequestStats(requests);
                }, (error) => {
                    console.error('âŒ ì˜ë¢° ë°ì´í„° ì‹¤ì‹œê°„ êµ¬ë… ì˜¤ë¥˜:', error);
                });
                
            } catch (error) {
                console.error('âŒ ì˜ë¢° ë°ì´í„° êµ¬ë… ì„¤ì • ì‹¤íŒ¨:', error);
            }
        }
        
        // ì˜ë¢° ëª©ë¡ UI ì—…ë°ì´íŠ¸
        function updateRequestListUI(requests) {
            const requestList = document.getElementById('request-list');
            
            if (!requestList) {
                console.warn('âš ï¸ request-list ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            requestList.innerHTML = '';
            
            if (requests.length === 0) {
                requestList.innerHTML = '<tr><td colspan="7" class="text-center py-4 text-gray-500">ì˜ë¢°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }
            
            requests.forEach((request) => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                row.innerHTML = `
                    <td class="px-4 py-3">
                        <input type="checkbox" class="request-checkbox" value="${request.id}">
                    </td>
                    <td class="px-4 py-3 text-sm">${request.reqNum || request.requestNumber || 'N/A'}</td>
                    <td class="px-4 py-3 text-sm">${request.productName || request.name || 'N/A'}</td>
                    <td class="px-4 py-3 text-sm">${request.userName || request.name || 'N/A'}</td>
                    <td class="px-4 py-3 text-sm">
                        <span class="px-2 py-1 text-xs rounded-full ${request.status === 'ë‹µë³€ì™„ë£Œ' ? 'bg-green-100 text-green-800' : request.status === 'ì²˜ë¦¬ì¤‘' ? 'bg-yellow-100 text-yellow-800' : 'bg-gray-100 text-gray-800'}">
                            ${request.status || 'ëŒ€ê¸°'}
                        </span>
                    </td>
                    <td class="px-4 py-3 text-sm">
                        <span class="px-2 py-1 text-xs rounded-full ${request.reviewBoardAgree ? 'bg-purple-100 text-purple-800' : 'bg-gray-100 text-gray-500'}">
                            ${request.reviewBoardAgree ? 'âœ“ ë™ì˜' : 'âœ— ë¯¸ë™ì˜'}
                        </span>
                    </td>
                    <td class="px-4 py-3 text-sm">
                        <div class="flex gap-2">
                        <button onclick="viewRequestDetail('${request.id}')" class="px-2 py-1 bg-blue-500 text-white text-xs rounded hover:bg-blue-600">
                            ìƒì„¸ë³´ê¸°
                        </button>
                            ${request.reviewBoardAgree ? `
                            <button onclick="publishToReviewBoard('${request.id}')" class="px-2 py-1 bg-purple-500 text-white text-xs rounded hover:bg-purple-600" title="í›„ê¸°ê²Œì‹œíŒì— ì˜¬ë¦¬ê¸°">
                                í›„ê¸°ë“±ë¡
                            </button>
                            ` : ''}
                        </div>
                    </td>
                `;
                requestList.appendChild(row);
            });
        }
        
        // Firebaseì—ì„œ ì˜ë¢° ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ì¼íšŒì„± ì¡°íšŒ - í˜¸í™˜ì„± ìœ ì§€)
        async function getRequestsFromFirebase() {
            try {
                const { collection, getDocs } = window.firebaseFirestoreFunctions;
                const db = window.firebaseDb;
                
                // orderBy ì—†ì´ ëª¨ë“  ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ë³µí•© ì¸ë±ìŠ¤ ë¬¸ì œ ë°©ì§€)
                const requestsRef = collection(db, 'requests');
                const querySnapshot = await getDocs(requestsRef);
                const requests = [];
                
                querySnapshot.forEach((doc) => {
                    requests.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                
                // í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œì—ì„œ ì •ë ¬ (createdAt ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ)
                requests.sort((a, b) => {
                    const aTime = a.createdAt ? (a.createdAt.toDate ? a.createdAt.toDate() : new Date(a.createdAt)) : new Date(0);
                    const bTime = b.createdAt ? (b.createdAt.toDate ? b.createdAt.toDate() : new Date(b.createdAt)) : new Date(0);
                    return bTime - aTime;
                });
                
                console.log(`âœ… Firebaseì—ì„œ ì˜ë¢° ë°ì´í„° ${requests.length}ê°œ ê°€ì ¸ì˜´`);
                console.log('ğŸ“Š ì˜ë¢° ë°ì´í„° ìƒì„¸:', requests);
                return requests;
            } catch (error) {
                console.error('âŒ Firebaseì—ì„œ ì˜ë¢° ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
                return [];
            }
        }
        
        // Firebaseì—ì„œ ë¬¸ì˜ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ì‹¤ì‹œê°„ êµ¬ë…)
        let inquiriesUnsubscribe = null;
        
        function subscribeToInquiries() {
            try {
                const { collection, onSnapshot } = window.firebaseFirestoreFunctions;
                const db = window.firebaseDb;
                
                // orderBy ì—†ì´ ëª¨ë“  ë°ì´í„° êµ¬ë… (ë³µí•© ì¸ë±ìŠ¤ ë¬¸ì œ ë°©ì§€)
                const inquiriesRef = collection(db, 'inquiries');
                
                console.log('ğŸ”„ ë¬¸ì˜ ë°ì´í„° ì‹¤ì‹œê°„ êµ¬ë… ì‹œì‘...');
                
                inquiriesUnsubscribe = onSnapshot(inquiriesRef, (querySnapshot) => {
                    const inquiries = [];
                    
                    querySnapshot.forEach((doc) => {
                        inquiries.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });
                    
                    // í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œì—ì„œ ì •ë ¬ (createdAt ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ)
                    inquiries.sort((a, b) => {
                        const aTime = a.createdAt ? (a.createdAt.toDate ? a.createdAt.toDate() : new Date(a.createdAt)) : new Date(0);
                        const bTime = b.createdAt ? (b.createdAt.toDate ? b.createdAt.toDate() : new Date(b.createdAt)) : new Date(0);
                        return bTime - aTime;
                    });
                    
                    console.log(`âœ… ì‹¤ì‹œê°„ ë¬¸ì˜ ë°ì´í„° ì—…ë°ì´íŠ¸: ${inquiries.length}ê°œ`);
                    console.log('ğŸ“Š ì‹¤ì‹œê°„ ë¬¸ì˜ ë°ì´í„° ìƒì„¸:', inquiries);
                    
                    // UI ì—…ë°ì´íŠ¸
                    updateInquiryListUI(inquiries);
                    
                    // í†µê³„ ì—…ë°ì´íŠ¸
                    updateInquiryStats(inquiries);
                }, (error) => {
                    console.error('âŒ ë¬¸ì˜ ë°ì´í„° ì‹¤ì‹œê°„ êµ¬ë… ì˜¤ë¥˜:', error);
                });
                
            } catch (error) {
                console.error('âŒ ë¬¸ì˜ ë°ì´í„° êµ¬ë… ì„¤ì • ì‹¤íŒ¨:', error);
            }
        }
        
        // ë¬¸ì˜ ëª©ë¡ UI ì—…ë°ì´íŠ¸
        function updateInquiryListUI(inquiries) {
            const inquiryTableBody = document.getElementById('inquiries-table-body');
            
            if (!inquiryTableBody) {
                console.warn('âš ï¸ inquiries-table-body ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            inquiryTableBody.innerHTML = '';
            
            if (inquiries.length === 0) {
                inquiryTableBody.innerHTML = '<tr><td colspan="6" class="px-6 py-4 text-center text-gray-500">ë¬¸ì˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }
            
            inquiries.forEach((inquiry) => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-blue-50 transition-colors';
                
                const createdAt = inquiry.createdAt ? 
                    new Date(inquiry.createdAt.seconds * 1000).toLocaleDateString('ko-KR') : 
                    'ë‚ ì§œ ì—†ìŒ';
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <input type="checkbox" class="inquiry-checkbox" data-id="${inquiry.id}">
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                        ${inquiry.id ? inquiry.id.substring(0, 8) + '...' : 'ID ì—†ìŒ'}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <div class="font-semibold text-blue-600">${inquiry.subject || 'ì œëª© ì—†ìŒ'}</div>
                        <div class="text-sm text-gray-600">${inquiry.name || inquiry.userName || 'ì´ë¦„ ì—†ìŒ'}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-center">
                        <span class="px-2 py-1 text-xs rounded-full ${inquiry.status === 'ë‹µë³€ì™„ë£Œ' || inquiry.status === 'answered' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}">
                            ${inquiry.status === 'ë‹µë³€ì™„ë£Œ' || inquiry.status === 'answered' ? 'ë‹µë³€ì™„ë£Œ' : 'ëŒ€ê¸°ì¤‘'}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        ${createdAt}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-center">
                        <button onclick="viewInquiryDetail('${inquiry.id}')" class="px-2 py-1 bg-blue-500 text-white text-xs rounded hover:bg-blue-600">
                            ìƒì„¸ë³´ê¸°
                        </button>
                    </td>
                `;
                inquiryTableBody.appendChild(row);
            });
        }
        
        // Firebaseì—ì„œ ë¬¸ì˜ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ì¼íšŒì„± ì¡°íšŒ - í˜¸í™˜ì„± ìœ ì§€)
        async function getInquiriesFromFirebase() {
            try {
                const { collection, getDocs } = window.firebaseFirestoreFunctions;
                const db = window.firebaseDb;
                
                // orderBy ì—†ì´ ëª¨ë“  ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ë³µí•© ì¸ë±ìŠ¤ ë¬¸ì œ ë°©ì§€)
                const inquiriesRef = collection(db, 'inquiries');
                const querySnapshot = await getDocs(inquiriesRef);
                const inquiries = [];
                
                querySnapshot.forEach((doc) => {
                    inquiries.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                
                // í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œì—ì„œ ì •ë ¬ (createdAt ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ)
                inquiries.sort((a, b) => {
                    const aTime = a.createdAt ? (a.createdAt.toDate ? a.createdAt.toDate() : new Date(a.createdAt)) : new Date(0);
                    const bTime = b.createdAt ? (b.createdAt.toDate ? b.createdAt.toDate() : new Date(b.createdAt)) : new Date(0);
                    return bTime - aTime;
                });
                
                console.log(`âœ… Firebaseì—ì„œ ë¬¸ì˜ ë°ì´í„° ${inquiries.length}ê°œ ê°€ì ¸ì˜´`);
                console.log('ğŸ“Š ë¬¸ì˜ ë°ì´í„° ìƒì„¸:', inquiries);
                return inquiries;
            } catch (error) {
                console.error('âŒ Firebaseì—ì„œ ë¬¸ì˜ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
                return [];
            }
        }
        
        // Firebaseì—ì„œ ì˜ë¢° ë°ì´í„° ì‚­ì œ
        async function deleteRequestFromFirebase(requestId) {
            try {
                const { doc, deleteDoc } = window.firebaseFirestoreFunctions;
                const db = window.firebaseDb;
                
                await deleteDoc(doc(db, 'requests', requestId));
                console.log('âœ… Firebaseì—ì„œ ì˜ë¢° ë°ì´í„° ì‚­ì œ ì™„ë£Œ:', requestId);
                return true;
            } catch (error) {
                console.error('âŒ Firebaseì—ì„œ ì˜ë¢° ë°ì´í„° ì‚­ì œ ì‹¤íŒ¨:', error);
                return false;
            }
        }
        
        // Firebaseì—ì„œ ë¬¸ì˜ ë°ì´í„° ì‚­ì œ
        async function deleteInquiryFromFirebase(inquiryId) {
            try {
                const { doc, deleteDoc } = window.firebaseFirestoreFunctions;
                const db = window.firebaseDb;
                
                await deleteDoc(doc(db, 'inquiries', inquiryId));
                console.log('âœ… Firebaseì—ì„œ ë¬¸ì˜ ë°ì´í„° ì‚­ì œ ì™„ë£Œ:', inquiryId);
                return true;
            } catch (error) {
                console.error('âŒ Firebaseì—ì„œ ë¬¸ì˜ ë°ì´í„° ì‚­ì œ ì‹¤íŒ¨:', error);
                return false;
            }
        }
        
        // Firebaseì—ì„œ ì˜ë¢° ë°ì´í„° ìˆ˜ì •
        async function updateRequestInFirebase(requestId, updateData) {
            try {
                const { doc, updateDoc } = window.firebaseFirestoreFunctions;
                const db = window.firebaseDb;
                
                await updateDoc(doc(db, 'requests', requestId), updateData);
                console.log('âœ… Firebaseì—ì„œ ì˜ë¢° ë°ì´í„° ìˆ˜ì • ì™„ë£Œ:', requestId);
                return true;
            } catch (error) {
                console.error('âŒ Firebaseì—ì„œ ì˜ë¢° ë°ì´í„° ìˆ˜ì • ì‹¤íŒ¨:', error);
                return false;
            }
        }
        
        // Firebaseì—ì„œ ë¬¸ì˜ ë°ì´í„° ìˆ˜ì •
        async function updateInquiryInFirebase(inquiryId, updateData) {
            try {
                const { doc, updateDoc } = window.firebaseFirestoreFunctions;
                const db = window.firebaseDb;
                
                await updateDoc(doc(db, 'inquiries', inquiryId), updateData);
                console.log('âœ… Firebaseì—ì„œ ë¬¸ì˜ ë°ì´í„° ìˆ˜ì • ì™„ë£Œ:', inquiryId);
                return true;
            } catch (error) {
                console.error('âŒ Firebaseì—ì„œ ë¬¸ì˜ ë°ì´í„° ìˆ˜ì • ì‹¤íŒ¨:', error);
                return false;
            }
        }

        // ì˜ë¢° ëª©ë¡ ë Œë”ë§ (Firebase ë°ì´í„°)
        async function renderRequestList() {
            try {
                const requests = await getRequestsFromFirebase();
                const requestList = document.getElementById('request-list');
                
                if (!requestList) {
                    console.error('ì˜ë¢° ëª©ë¡ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                if (requests.length === 0) {
                    requestList.innerHTML = '<li class="p-4 text-center text-gray-500">ì˜ë¢° ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</li>';
                    return;
                }
                
                requestList.innerHTML = '';
                requests.forEach(request => {
                    const listItem = document.createElement('li');
                    listItem.className = 'grid grid-cols-9 gap-2 px-4 py-3 hover:bg-pink-100 transition-colors';
                    
                    const createdAt = request.createdAt ? 
                        new Date(request.createdAt.seconds * 1000).toLocaleDateString('ko-KR') : 
                        'ë‚ ì§œ ì—†ìŒ';
                    
                    listItem.innerHTML = `
                        <div class="col-span-1 flex items-center">
                            <input type="checkbox" class="request-checkbox" data-id="${request.id}">
                        </div>
                        <div class="col-span-2">
                            <div class="font-semibold text-blue-600">${request.requestNumber || 'ë²ˆí˜¸ ì—†ìŒ'}</div>
                            <div class="text-sm text-gray-600">${request.userName || request.name || 'ì´ë¦„ ì—†ìŒ'}</div>
                        </div>
                        <div class="col-span-1 text-center text-sm">${createdAt}</div>
                        <div class="col-span-1 text-center">
                            <span class="px-2 py-1 text-xs rounded-full ${request.status === 'completed' || request.status === 'ë‹µë³€ì™„ë£Œ' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}">
                                ${request.status === 'completed' || request.status === 'ë‹µë³€ì™„ë£Œ' ? 'ì™„ë£Œ' : 'ì§„í–‰ì¤‘'}
                            </span>
                        </div>
                        <div class="col-span-1 text-center text-sm">${request.purchaseMethod || '-'}</div>
                        <div class="col-span-1 text-center text-sm">${request.purchaseStatus || '-'}</div>
                        <div class="col-span-1 text-center">
                            <span class="px-2 py-1 text-xs rounded-full ${request.reviewBoardAgree ? 'bg-purple-100 text-purple-800' : 'bg-gray-100 text-gray-500'}">
                                ${request.reviewBoardAgree ? 'âœ“ ë™ì˜' : 'âœ— ë¯¸ë™ì˜'}
                            </span>
                        </div>
                        <div class="col-span-1 text-center">
                            <div class="flex gap-2 justify-center">
                            <button onclick="viewRequestDetail('${request.id}')" class="px-2 py-1 bg-blue-500 text-white text-xs rounded hover:bg-blue-600">
                                ìƒì„¸ë³´ê¸°
                            </button>
                                ${request.reviewBoardAgree ? `
                                <button onclick="publishToReviewBoard('${request.id}')" class="px-2 py-1 bg-purple-500 text-white text-xs rounded hover:bg-purple-600" title="í›„ê¸°ê²Œì‹œíŒì— ì˜¬ë¦¬ê¸°">
                                    í›„ê¸°ë“±ë¡
                                </button>
                                ` : ''}
                            </div>
                        </div>
                    `;
                    
                    requestList.appendChild(listItem);
                });
                
                console.log(`âœ… ì˜ë¢° ëª©ë¡ ${requests.length}ê°œ ë Œë”ë§ ì™„ë£Œ`);
            } catch (error) {
                console.error('âŒ ì˜ë¢° ëª©ë¡ ë Œë”ë§ ì‹¤íŒ¨:', error);
            }
        }
        
        // ë¬¸ì˜ ëª©ë¡ ë Œë”ë§ (Firebase ë°ì´í„°)
        async function renderInquiryList() {
            try {
                const inquiries = await getInquiriesFromFirebase();
                const inquiryTableBody = document.getElementById('inquiries-table-body');
                
                if (!inquiryTableBody) {
                    console.error('ë¬¸ì˜ ëª©ë¡ í…Œì´ë¸” ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                if (inquiries.length === 0) {
                    inquiryTableBody.innerHTML = '<tr><td colspan="6" class="px-6 py-4 text-center text-gray-500">ë¬¸ì˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                    return;
                }
                
                inquiryTableBody.innerHTML = '';
                inquiries.forEach(inquiry => {
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-blue-50 transition-colors';
                    
                    const createdAt = inquiry.createdAt ? 
                        new Date(inquiry.createdAt.seconds * 1000).toLocaleDateString('ko-KR') : 
                        'ë‚ ì§œ ì—†ìŒ';
                    
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap">
                            <input type="checkbox" class="inquiry-checkbox" data-id="${inquiry.id}">
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                            ${inquiry.id ? inquiry.id.substring(0, 8) + '...' : 'ID ì—†ìŒ'}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            <div class="font-semibold text-blue-600">${inquiry.subject || 'ì œëª© ì—†ìŒ'}</div>
                            <div class="text-sm text-gray-600">${inquiry.name || 'ì´ë¦„ ì—†ìŒ'}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-center">
                            <span class="px-2 py-1 text-xs rounded-full ${inquiry.status === 'ë‹µë³€ì™„ë£Œ' || inquiry.status === 'answered' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}">
                                ${inquiry.status === 'ë‹µë³€ì™„ë£Œ' || inquiry.status === 'answered' ? 'ë‹µë³€ì™„ë£Œ' : 'ëŒ€ê¸°ì¤‘'}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            ${createdAt}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-center">
                            <button onclick="viewInquiryDetail('${inquiry.id}')" class="px-2 py-1 bg-blue-500 text-white text-xs rounded hover:bg-blue-600">
                                ìƒì„¸ë³´ê¸°
                            </button>
                        </td>
                    `;
                    
                    inquiryTableBody.appendChild(row);
                });
                
                console.log(`âœ… ë¬¸ì˜ ëª©ë¡ ${inquiries.length}ê°œ ë Œë”ë§ ì™„ë£Œ`);
            } catch (error) {
                console.error('âŒ ë¬¸ì˜ ëª©ë¡ ë Œë”ë§ ì‹¤íŒ¨:', error);
            }
        }
        
        // ì˜ë¢° ìƒì„¸ë³´ê¸°
        async function viewRequestDetail(requestId) {
            try {
                const requests = await getRequestsFromFirebase();
                const request = requests.find(r => r.id === requestId);
                
                if (!request) {
                    alert('ì˜ë¢° ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                // í˜„ì¬ ì˜ë¢° ID ì €ì¥
                currentRequestId = requestId;
                
                // ê´€ë¦¬ììš© ì˜ë¢° ìƒì„¸ë³´ê¸° ëª¨ë‹¬ í‘œì‹œ
                showAdminRequestDetailModal(request);
                
            } catch (error) {
                console.error('âŒ ì˜ë¢° ìƒì„¸ë³´ê¸° ì‹¤íŒ¨:', error);
                alert('ì˜ë¢° ìƒì„¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // ë¬¸ì˜ ìƒì„¸ë³´ê¸°
        async function viewInquiryDetail(inquiryId) {
            try {
                const inquiries = await getInquiriesFromFirebase();
                const inquiry = inquiries.find(i => i.id === inquiryId);
                
                if (!inquiry) {
                    alert('ë¬¸ì˜ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                // í˜„ì¬ ë¬¸ì˜ ID ì €ì¥
                currentInquiryId = inquiryId;
                
                // ë¬¸ì˜ ìƒì„¸ë³´ê¸° ëª¨ë‹¬ í‘œì‹œ
                showInquiryDetailModal(inquiry);
                
            } catch (error) {
                console.error('âŒ ë¬¸ì˜ ìƒì„¸ë³´ê¸° ì‹¤íŒ¨:', error);
                alert('ë¬¸ì˜ ìƒì„¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì„ íƒëœ ì˜ë¢° ì‚­ì œ
        async function deleteSelectedRequests() {
            const checkboxes = document.querySelectorAll('.request-checkbox:checked');
            if (checkboxes.length === 0) {
                alert('ì‚­ì œí•  ì˜ë¢°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!confirm(`ì„ íƒëœ ${checkboxes.length}ê°œì˜ ì˜ë¢°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                return;
            }
            
            const deletePromises = Array.from(checkboxes).map(checkbox => {
                const requestId = checkbox.dataset.id;
                return deleteRequestFromFirebase(requestId);
            });
            
            try {
                await Promise.all(deletePromises);
                alert('ì„ íƒëœ ì˜ë¢°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                renderRequestList(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            } catch (error) {
                console.error('ì˜ë¢° ì‚­ì œ ì‹¤íŒ¨:', error);
                alert('ì˜ë¢° ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // ì„ íƒëœ ë¬¸ì˜ ì‚­ì œ
        async function deleteSelectedInquiries() {
            const checkboxes = document.querySelectorAll('.inquiry-checkbox:checked');
            if (checkboxes.length === 0) {
                alert('ì‚­ì œí•  ë¬¸ì˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!confirm(`ì„ íƒëœ ${checkboxes.length}ê°œì˜ ë¬¸ì˜ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                return;
            }
            
            const deletePromises = Array.from(checkboxes).map(checkbox => {
                const inquiryId = checkbox.dataset.id;
                return deleteInquiryFromFirebase(inquiryId);
            });
            
            try {
                await Promise.all(deletePromises);
                alert('ì„ íƒëœ ë¬¸ì˜ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                renderInquiryList(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            } catch (error) {
                console.error('ë¬¸ì˜ ì‚­ì œ ì‹¤íŒ¨:', error);
                alert('ë¬¸ì˜ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // ì˜ë¢° ìƒíƒœ ì—…ë°ì´íŠ¸
        async function updateRequestStatus(requestId, status) {
            try {
                const success = await updateRequestInFirebase(requestId, { 
                    status: status,
                    updatedAt: new Date()
                });
                
                if (success) {
                    alert('ì˜ë¢° ìƒíƒœê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    renderRequestList(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                } else {
                    alert('ì˜ë¢° ìƒíƒœ ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ì˜ë¢° ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
                alert('ì˜ë¢° ìƒíƒœ ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // ë¬¸ì˜ ìƒíƒœ ì—…ë°ì´íŠ¸
        async function updateInquiryStatus(inquiryId, status) {
            try {
                const success = await updateInquiryInFirebase(inquiryId, { 
                    status: status,
                    updatedAt: new Date()
                });
                
                if (success) {
                    alert('ë¬¸ì˜ ìƒíƒœê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    renderInquiryList(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                } else {
                    alert('ë¬¸ì˜ ìƒíƒœ ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ë¬¸ì˜ ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
                alert('ë¬¸ì˜ ìƒíƒœ ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì˜ë¢° í†µê³„ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateRequestStats(requests) {
            const totalRequestsElement = document.getElementById('total-requests');
            const completedRequestsElement = document.getElementById('completed-requests');
            
            if (totalRequestsElement) {
                totalRequestsElement.textContent = requests.length;
            }
            
            if (completedRequestsElement) {
                const completedCount = requests.filter(req => req.status === 'ë‹µë³€ì™„ë£Œ' || req.status === 'ì™„ë£Œ').length;
                completedRequestsElement.textContent = completedCount;
            }
            
            console.log('ğŸ“Š ì˜ë¢° í†µê³„ ì—…ë°ì´íŠ¸:', {
                total: requests.length,
                completed: requests.filter(req => req.status === 'ë‹µë³€ì™„ë£Œ' || req.status === 'ì™„ë£Œ').length
            });
        }
        
        // ë¬¸ì˜ í†µê³„ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateInquiryStats(inquiries) {
            const totalInquiriesElement = document.getElementById('total-inquiries');
            const unansweredInquiriesElement = document.getElementById('unanswered-inquiries');
            
            if (totalInquiriesElement) {
                totalInquiriesElement.textContent = inquiries.length;
            }
            
            if (unansweredInquiriesElement) {
                const unansweredCount = inquiries.filter(inq => inq.status !== 'ë‹µë³€ì™„ë£Œ' && inq.status !== 'ì™„ë£Œ').length;
                unansweredInquiriesElement.textContent = unansweredCount;
            }
            
            console.log('ğŸ“Š ë¬¸ì˜ í†µê³„ ì—…ë°ì´íŠ¸:', {
                total: inquiries.length,
                unanswered: inquiries.filter(inq => inq.status !== 'ë‹µë³€ì™„ë£Œ' && inq.status !== 'ì™„ë£Œ').length
            });
        }
        
        // ëŒ€ì‹œë³´ë“œ í†µê³„ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        async function updateDashboardStats() {
            try {
                console.log('ğŸ“Š ëŒ€ì‹œë³´ë“œ í†µê³„ ì—…ë°ì´íŠ¸ ì‹œì‘...');
                
                // ì˜ë¢° í†µê³„ ì—…ë°ì´íŠ¸
                const requests = await getRequestsFromFirebase();
                const totalRequestsElement = document.getElementById('total-requests');
                const completedRequestsElement = document.getElementById('completed-requests');
                
                if (totalRequestsElement) {
                    totalRequestsElement.textContent = requests.length;
                }
                
                if (completedRequestsElement) {
                    const completedCount = requests.filter(req => req.status === 'ë‹µë³€ì™„ë£Œ' || req.status === 'ì™„ë£Œ').length;
                    completedRequestsElement.textContent = completedCount;
                }
                
                // ë¬¸ì˜ í†µê³„ ì—…ë°ì´íŠ¸
                const inquiries = await getInquiriesFromFirebase();
                const totalInquiriesElement = document.getElementById('total-inquiries');
                const unansweredInquiriesElement = document.getElementById('unanswered-inquiries');
                
                if (totalInquiriesElement) {
                    totalInquiriesElement.textContent = inquiries.length;
                }
                
                if (unansweredInquiriesElement) {
                    const unansweredCount = inquiries.filter(inq => inq.status !== 'ë‹µë³€ì™„ë£Œ' && inq.status !== 'ì™„ë£Œ').length;
                    unansweredInquiriesElement.textContent = unansweredCount;
                }
                
                // íšŒì› í†µê³„ ì—…ë°ì´íŠ¸
                const users = await getUsersFromFirebase();
                const totalMembersElement = document.getElementById('total-members');
                
                if (totalMembersElement) {
                    totalMembersElement.textContent = users.length;
                }
                
                console.log('âœ… ëŒ€ì‹œë³´ë“œ í†µê³„ ì—…ë°ì´íŠ¸ ì™„ë£Œ:', {
                    requests: requests.length,
                    completedRequests: requests.filter(req => req.status === 'ë‹µë³€ì™„ë£Œ' || req.status === 'ì™„ë£Œ').length,
                    inquiries: inquiries.length,
                    unansweredInquiries: inquiries.filter(inq => inq.status !== 'ë‹µë³€ì™„ë£Œ' && inq.status !== 'ì™„ë£Œ').length,
                    members: users.length
                });
                
            } catch (error) {
                console.error('âŒ ëŒ€ì‹œë³´ë“œ í†µê³„ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
            }
        }
        
        // Firebaseì—ì„œ ì‚¬ìš©ì ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        async function getUsersFromFirebase() {
            try {
                const { collection, getDocs } = window.firebaseFirestoreFunctions;
                const db = window.firebaseDb;
                
                const usersRef = collection(db, 'users');
                const querySnapshot = await getDocs(usersRef);
                const users = [];
                
                querySnapshot.forEach((doc) => {
                    users.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                
                return users;
            } catch (error) {
                console.error('âŒ Firebaseì—ì„œ ì‚¬ìš©ì ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
                return [];
            }
        }

        // ë¡œê·¸ì¸ ì„¹ì…˜ í‘œì‹œ í•¨ìˆ˜
        function showLoginSection() {
            document.getElementById('login-section').classList.remove('hidden');
            document.getElementById('dashboard-section').classList.add('hidden');
            
            // ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
            if (window.firebaseAuth) {
                window.firebaseAuth.signOut().catch(error => {
                    console.error('âŒ ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨:', error);
                });
            }
        }

        // ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë“œ í•¨ìˆ˜
        async function loadDashboardData() {
            console.log('ğŸ“Š ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë“œ ì‹œì‘...');
            
            // ê´€ë¦¬ì ê¶Œí•œ ì¬í™•ì¸
            if (!window.firebaseAuth || !window.firebaseAuth.currentUser) {
                console.error('âŒ ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ìì…ë‹ˆë‹¤.');
                showLoginSection();
                return;
            }
            
            const isAdmin = await checkAdminPermission(window.firebaseAuth.currentUser);
            if (!isAdmin) {
                console.error('âŒ ê´€ë¦¬ì ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');
                showLoginSection();
                return;
            }
            
            if (!window.firebaseDb) {
                console.error('âŒ Firestoreê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ì‹¤ì‹œê°„ êµ¬ë… ì‹œì‘ (ì´ë¯¸ ì‹œì‘ë˜ì–´ ìˆìœ¼ë©´ ë¬´ì‹œ)
            if (!requestsUnsubscribe) {
                subscribeToRequests();
            }
            if (!inquiriesUnsubscribe) {
                subscribeToInquiries();
            }
            
            // ì´ˆê¸° ë°ì´í„° ë¡œë“œ (í˜¸í™˜ì„± ìœ ì§€)
            renderRequestList();
            renderInquiryList();
            
            // í†µê³„ ì—…ë°ì´íŠ¸
            updateDashboardStats();
            
            console.log('âœ… ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë“œ ì™„ë£Œ');
        }
        
        // Firebase ì—°ê²° í…ŒìŠ¤íŠ¸ í•¨ìˆ˜
        window.testFirebaseConnection = async function() {
            try {
                console.log('ğŸ”¥ Firebase ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘...');
                
                if (!window.firebaseApp || !window.firebaseDb || !window.firebaseAuth) {
                    alert('âŒ Firebase ì´ˆê¸°í™” ì‹¤íŒ¨!\n\nFirebase ì„œë¹„ìŠ¤ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                    return false;
                }
                
                const { collection, addDoc, serverTimestamp, getDoc, deleteDoc } = await import('https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js');
                const testRef = collection(window.firebaseDb, 'test');
                
                // í…ŒìŠ¤íŠ¸ ë°ì´í„° ì“°ê¸°
                console.log('ğŸ“ í…ŒìŠ¤íŠ¸ ë°ì´í„° ì“°ê¸° ì¤‘...');
                const testDoc = await addDoc(testRef, {
                    test: true,
                    timestamp: serverTimestamp(),
                    message: 'ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ Firebase ì—°ê²° í…ŒìŠ¤íŠ¸',
                    testTime: new Date().toISOString()
                });
                
                console.log('âœ… Firebase ì“°ê¸° í…ŒìŠ¤íŠ¸ ì„±ê³µ:', testDoc.id);
                
                // í…ŒìŠ¤íŠ¸ ë°ì´í„° ì½ê¸°
                console.log('ğŸ“– í…ŒìŠ¤íŠ¸ ë°ì´í„° ì½ê¸° ì¤‘...');
                const testData = await getDoc(testDoc);
                console.log('âœ… Firebase ì½ê¸° í…ŒìŠ¤íŠ¸ ì„±ê³µ:', testData.data());
                
                // í…ŒìŠ¤íŠ¸ ë°ì´í„° ì‚­ì œ
                console.log('ğŸ—‘ï¸ í…ŒìŠ¤íŠ¸ ë°ì´í„° ì‚­ì œ ì¤‘...');
                await deleteDoc(testDoc);
                console.log('âœ… Firebase ì‚­ì œ í…ŒìŠ¤íŠ¸ ì„±ê³µ');
                
                alert('âœ… Firebase ì—°ê²° í…ŒìŠ¤íŠ¸ ì„±ê³µ!\n\nëª¨ë“  ì‘ì—…(ì½ê¸°/ì“°ê¸°/ì‚­ì œ)ì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤.\n\në¬¸ì„œ ID: ' + testDoc.id);
                return true;
                
            } catch (error) {
                console.error('âŒ Firebase ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:', error);
                console.error('ì˜¤ë¥˜ ìƒì„¸:', {
                    message: error.message,
                    code: error.code,
                    stack: error.stack
                });
                
                if (error.message.includes('Missing or insufficient permissions') || error.code === 'permission-denied') {
                    alert('âŒ Firebase ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨!\n\n' +
                          'Firebase ë³´ì•ˆ ê·œì¹™ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n\n' +
                          'í•´ê²° ë°©ë²•:\n' +
                          '1. Firebase ì½˜ì†” ì ‘ì†: https://console.firebase.google.com/\n' +
                          '2. pricehunter-99a1b í”„ë¡œì íŠ¸ ì„ íƒ\n' +
                          '3. Firestore Database â†’ ê·œì¹™\n' +
                          '4. FIREBASE_SECURITY_RULES.md íŒŒì¼ ì°¸ê³ í•˜ì—¬ ê·œì¹™ ìˆ˜ì •\n' +
                          '5. ê²Œì‹œ ë²„íŠ¼ í´ë¦­');
                } else {
                    alert('ì‹œìŠ¤í…œ ì—°ê²° í…ŒìŠ¤íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                }
                
                return false;
            }
        };

        // Firebase ì‚¬ìš©ì ë°ì´í„° ì§ì ‘ í™•ì¸ í•¨ìˆ˜
        window.checkFirebaseUsers = async function() {
            try {
                console.log('ğŸ” Firebase ì‚¬ìš©ì ë°ì´í„° ì§ì ‘ í™•ì¸ ì‹œì‘...');
                
                if (!window.firebaseDb) {
                    alert('âŒ Firebaseê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                const { collection, getDocs } = await import('https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js');
                const usersRef = collection(window.firebaseDb, 'users');
                const snapshot = await getDocs(usersRef);
                
                console.log('ğŸ“Š Firebase users ì»¬ë ‰ì…˜ ì´ ë¬¸ì„œ ìˆ˜:', snapshot.size);
                
                const users = [];
                snapshot.forEach(doc => {
                    const userData = doc.data();
                    users.push({
                        id: doc.id,
                        ...userData
                    });
                    console.log('ğŸ‘¤ Firebase ì‚¬ìš©ì ìƒì„¸ ì •ë³´:', {
                        id: doc.id,
                        email: userData.email,
                        displayName: userData.displayName,
                        name: userData.name,
                        phone: userData.phone,
                        password: userData.password ? '***' : 'ì—†ìŒ',
                        agreeTerms: userData.agreeTerms,
                        agreePrivacy: userData.agreePrivacy,
                        agreeMarketing: userData.agreeMarketing,
                        createdAt: userData.createdAt,
                        loginMethod: userData.loginMethod,
                        isActive: userData.isActive,
                        loginCount: userData.loginCount
                    });
                });
                
                // í•„ìˆ˜ í•„ë“œ ëˆ„ë½ í™•ì¸
                const missingFields = [];
                users.forEach(user => {
                    const missing = [];
                    if (!user.password) missing.push('password');
                    if (!user.phone) missing.push('phone');
                    if (!user.name && !user.displayName) missing.push('name');
                    if (missing.length > 0) {
                        missingFields.push({
                            email: user.email,
                            missing: missing
                        });
                    }
                });
                
                if (missingFields.length > 0) {
                    console.warn('âš ï¸ í•„ìˆ˜ í•„ë“œ ëˆ„ë½:', missingFields);
                    let message = `âš ï¸ Firebase ì‚¬ìš©ì ë°ì´í„°ì— í•„ìˆ˜ í•„ë“œê°€ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤!\n\n`;
                    missingFields.forEach(item => {
                        message += `${item.email}: ${item.missing.join(', ')}\n`;
                    });
                    message += `\nì´ê²ƒì´ ë¡œê·¸ì¸/ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°ê°€ ì‘ë™í•˜ì§€ ì•ŠëŠ” ì´ìœ ì…ë‹ˆë‹¤.\n\në°ì´í„°ë¥¼ ìˆ˜ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;
                    
                    if (confirm(message)) {
                        await fixMissingUserData(users, missingFields);
                    }
                }
                
                // ì´ë©”ì¼ë³„ ì¤‘ë³µ í™•ì¸
                const emailCount = {};
                const emailUsers = {};
                users.forEach(user => {
                    if (user.email) {
                        emailCount[user.email] = (emailCount[user.email] || 0) + 1;
                        if (!emailUsers[user.email]) {
                            emailUsers[user.email] = [];
                        }
                        emailUsers[user.email].push(user);
                    }
                });
                
                const duplicates = Object.entries(emailCount).filter(([email, count]) => count > 1);
                
                if (duplicates.length > 0) {
                    console.warn('âš ï¸ Firebaseì—ì„œ ì¤‘ë³µ ì´ë©”ì¼ ë°œê²¬:', duplicates);
                    
                    let message = `âš ï¸ Firebaseì—ì„œ ì¤‘ë³µ ì´ë©”ì¼ ë°œê²¬!\n\nì¤‘ë³µëœ ì´ë©”ì¼:\n`;
                    duplicates.forEach(([email, count]) => {
                        message += `${email}: ${count}ê°œ\n`;
                    });
                    message += `\nì¤‘ë³µ ë¬¸ì„œë¥¼ ì •ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;
                    
                    if (confirm(message)) {
                        await cleanupDuplicateUsers(emailUsers, duplicates);
                    }
                } else {
                    console.log('âœ… Firebaseì—ì„œ ì¤‘ë³µ ì´ë©”ì¼ ì—†ìŒ');
                    alert(`âœ… Firebase ì‚¬ìš©ì ë°ì´í„° í™•ì¸ ì™„ë£Œ!\n\nì´ ì‚¬ìš©ì ìˆ˜: ${users.length}ëª…\nì¤‘ë³µ ì´ë©”ì¼: ì—†ìŒ\nëˆ„ë½ í•„ë“œ: ${missingFields.length > 0 ? 'ìˆìŒ' : 'ì—†ìŒ'}\n\nì½˜ì†”ì—ì„œ ìì„¸í•œ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”.`);
                }
                
                return users;
                
            } catch (error) {
                console.error('âŒ Firebase ì‚¬ìš©ì ë°ì´í„° í™•ì¸ ì‹¤íŒ¨:', error);
                alert('âŒ Firebase ì‚¬ìš©ì ë°ì´í„° í™•ì¸ ì‹¤íŒ¨!\n\nì˜¤ë¥˜: ' + error.message);
                return [];
            }
        };

        // ëˆ„ë½ëœ ì‚¬ìš©ì ë°ì´í„° ìˆ˜ì • í•¨ìˆ˜
        window.fixMissingUserData = async function(users, missingFields) {
            try {
                console.log('ğŸ”§ ëˆ„ë½ëœ ì‚¬ìš©ì ë°ì´í„° ìˆ˜ì • ì‹œì‘...');
                
                const { doc, updateDoc } = await import('https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js');
                
                for (const item of missingFields) {
                    const user = users.find(u => u.email === item.email);
                    if (!user) continue;
                    
                    const updates = {};
                    
                    // localStorageì—ì„œ í•´ë‹¹ ì‚¬ìš©ì ë°ì´í„° ì°¾ê¸°
                    const localUsers = JSON.parse(localStorage.getItem('users') || '[]');
                    const localUser = localUsers.find(u => u.email === item.email);
                    
                    if (localUser) {
                        // localStorageì—ì„œ ëˆ„ë½ëœ í•„ë“œ ë³µì‚¬
                        if (item.missing.includes('password') && localUser.password) {
                            updates.password = localUser.password;
                        }
                        if (item.missing.includes('phone') && localUser.phone) {
                            updates.phone = localUser.phone;
                        }
                        if (item.missing.includes('name') && localUser.name) {
                            updates.name = localUser.name;
                        }
                        if (localUser.agreeTerms !== undefined) updates.agreeTerms = localUser.agreeTerms;
                        if (localUser.agreePrivacy !== undefined) updates.agreePrivacy = localUser.agreePrivacy;
                        if (localUser.agreeMarketing !== undefined) updates.agreeMarketing = localUser.agreeMarketing;
                    }
                    
                    // ê¸°ë³¸ê°’ ì„¤ì •
                    if (item.missing.includes('password') && !updates.password) {
                        updates.password = 'temp123!'; // ì„ì‹œ ë¹„ë°€ë²ˆí˜¸
                    }
                    if (item.missing.includes('phone') && !updates.phone) {
                        updates.phone = '010-0000-0000'; // ê¸°ë³¸ ì „í™”ë²ˆí˜¸
                    }
                    if (item.missing.includes('name') && !updates.name) {
                        updates.name = user.displayName || 'ì‚¬ìš©ì';
                    }
                    if (updates.agreeTerms === undefined) updates.agreeTerms = true;
                    if (updates.agreePrivacy === undefined) updates.agreePrivacy = true;
                    if (updates.agreeMarketing === undefined) updates.agreeMarketing = false;
                    
                    // Firebase ì—…ë°ì´íŠ¸
                    const userDocRef = doc(window.firebaseDb, 'users', user.id);
                    await updateDoc(userDocRef, updates);
                    
                    console.log(`âœ… ${item.email} ì‚¬ìš©ì ë°ì´í„° ìˆ˜ì • ì™„ë£Œ:`, updates);
                }
                
                alert('âœ… ì‚¬ìš©ì ë°ì´í„° ìˆ˜ì • ì™„ë£Œ!\n\nëˆ„ë½ëœ í•„ë“œë“¤ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.\n\nì´ì œ ë¡œê·¸ì¸ê³¼ ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°ê°€ ì •ìƒ ì‘ë™í•  ê²ƒì…ë‹ˆë‹¤.');
                
            } catch (error) {
                console.error('âŒ ì‚¬ìš©ì ë°ì´í„° ìˆ˜ì • ì‹¤íŒ¨:', error);
                alert('âŒ ì‚¬ìš©ì ë°ì´í„° ìˆ˜ì • ì‹¤íŒ¨!\n\nì˜¤ë¥˜: ' + error.message);
            }
        };

        // ì¤‘ë³µ ì‚¬ìš©ì ì •ë¦¬ í•¨ìˆ˜ (ë…ë¦½ í˜¸ì¶œìš©)
        window.cleanupDuplicateUsers = async function(emailUsers, duplicates) {
            // ë§¤ê°œë³€ìˆ˜ê°€ ì—†ìœ¼ë©´ ë¨¼ì € ì¤‘ë³µ í™•ì¸
            if (!emailUsers || !duplicates) {
                const users = await checkFirebaseUsers();
                if (!users || users.length === 0) return;
                
                // ì´ë©”ì¼ë³„ ì¤‘ë³µ í™•ì¸
                const emailCount = {};
                const emailUsersMap = {};
                users.forEach(user => {
                    if (user.email) {
                        emailCount[user.email] = (emailCount[user.email] || 0) + 1;
                        if (!emailUsersMap[user.email]) {
                            emailUsersMap[user.email] = [];
                        }
                        emailUsersMap[user.email].push(user);
                    }
                });
                
                const duplicatesList = Object.entries(emailCount).filter(([email, count]) => count > 1);
                
                if (duplicatesList.length === 0) {
                    alert('âœ… ì¤‘ë³µ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤!');
                    return;
                }
                
                return await cleanupDuplicateUsers(emailUsersMap, duplicatesList);
            }
            try {
                console.log('ğŸ§¹ ì¤‘ë³µ ì‚¬ìš©ì ì •ë¦¬ ì‹œì‘...');
                
                const { doc, deleteDoc } = await import('https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js');
                let deletedCount = 0;
                
                for (const [email, count] of duplicates) {
                    const users = emailUsers[email];
                    console.log(`ğŸ“§ ${email}ì˜ ì¤‘ë³µ ë¬¸ì„œë“¤:`, users);
                    
                    // ê°€ì¥ ìµœì‹  ë¬¸ì„œë¥¼ ì œì™¸í•˜ê³  ë‚˜ë¨¸ì§€ ì‚­ì œ
                    const sortedUsers = users.sort((a, b) => {
                        const dateA = a.createdAt ? (a.createdAt.seconds ? a.createdAt.seconds : new Date(a.createdAt).getTime() / 1000) : 0;
                        const dateB = b.createdAt ? (b.createdAt.seconds ? b.createdAt.seconds : new Date(b.createdAt).getTime() / 1000) : 0;
                        return dateB - dateA; // ìµœì‹ ìˆœ ì •ë ¬
                    });
                    
                    // ê°€ì¥ ìµœì‹  ë¬¸ì„œëŠ” ìœ ì§€í•˜ê³  ë‚˜ë¨¸ì§€ ì‚­ì œ
                    for (let i = 1; i < sortedUsers.length; i++) {
                        const userToDelete = sortedUsers[i];
                        console.log(`ğŸ—‘ï¸ ì‚­ì œí•  ë¬¸ì„œ: ${userToDelete.id} (${userToDelete.name || userToDelete.displayName})`);
                        
                        const userDocRef = doc(window.firebaseDb, 'users', userToDelete.id);
                        await deleteDoc(userDocRef);
                        deletedCount++;
                        
                        console.log(`âœ… ë¬¸ì„œ ì‚­ì œ ì™„ë£Œ: ${userToDelete.id}`);
                    }
                }
                
                console.log(`âœ… ì¤‘ë³µ ì‚¬ìš©ì ì •ë¦¬ ì™„ë£Œ: ${deletedCount}ê°œ ë¬¸ì„œ ì‚­ì œ`);
                alert(`âœ… ì¤‘ë³µ ì‚¬ìš©ì ì •ë¦¬ ì™„ë£Œ!\n\nì‚­ì œëœ ë¬¸ì„œ ìˆ˜: ${deletedCount}ê°œ\n\ní˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”.`);
                
                // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                setTimeout(() => {
                    window.location.reload();
                }, 2000);
                
            } catch (error) {
                console.error('âŒ ì¤‘ë³µ ì‚¬ìš©ì ì •ë¦¬ ì‹¤íŒ¨:', error);
                alert('âŒ ì¤‘ë³µ ì‚¬ìš©ì ì •ë¦¬ ì‹¤íŒ¨!\n\nì˜¤ë¥˜: ' + error.message);
            }
        };
        
        // CSP í—¤ë” í™•ì¸ í•¨ìˆ˜
        window.checkCSPHeaders = function() {
            console.log('ğŸ” CSP í—¤ë” í™•ì¸ ì‹œì‘...');
            
            // í˜„ì¬ í˜ì´ì§€ì˜ Response Headers í™•ì¸
            fetch(window.location.href, { method: 'HEAD' })
                .then(response => {
                    const cspHeader = response.headers.get('content-security-policy');
                    const serverHeader = response.headers.get('server');
                    const cfRay = response.headers.get('cf-ray');
                    const xVercelId = response.headers.get('x-vercel-id');
                    const xCloudTrace = response.headers.get('x-cloud-trace-context');
                    
                    console.log('ğŸ“‹ Response Headers ë¶„ì„:');
                    console.log('Server:', serverHeader);
                    console.log('CF-Ray:', cfRay);
                    console.log('X-Vercel-ID:', xVercelId);
                    console.log('X-Cloud-Trace:', xCloudTrace);
                    console.log('CSP Header:', cspHeader);
                    
                    // CSP ì£¼ì… ì£¼ì²´ íŒë³„
                    let cspSource = 'Unknown';
                    if (cfRay || response.headers.get('cf-cache-status')) {
                        cspSource = 'Cloudflare';
                    } else if (serverHeader && serverHeader.includes('nginx')) {
                        cspSource = 'Nginx';
                    } else if (serverHeader && serverHeader.includes('apache')) {
                        cspSource = 'Apache';
                    } else if (xVercelId) {
                        cspSource = 'Vercel';
                    } else if (serverHeader && serverHeader.includes('Firebase')) {
                        cspSource = 'Firebase Hosting';
                    }
                    
                    // Firebase ë„ë©”ì¸ í¬í•¨ ì—¬ë¶€ í™•ì¸
                    const hasFirebaseDomains = cspHeader && (
                        cspHeader.includes('www.gstatic.com') || 
                        cspHeader.includes('www.gstatic.com/firebasejs')
                    );
                    
                    const result = `
ğŸ” CSP í—¤ë” ë¶„ì„ ê²°ê³¼:

ğŸ“¡ CSP ì£¼ì… ì£¼ì²´: ${cspSource}
ğŸ”’ CSP í—¤ë” ì¡´ì¬: ${cspHeader ? 'Yes' : 'No'}
ğŸ”¥ Firebase ë„ë©”ì¸ í¬í•¨: ${hasFirebaseDomains ? 'Yes' : 'No'}

${cspHeader ? `ğŸ“‹ í˜„ì¬ CSP ì •ì±…:
${cspHeader.substring(0, 200)}...` : 'âŒ CSP í—¤ë”ê°€ ì—†ìŠµë‹ˆë‹¤.'}

${!hasFirebaseDomains ? 'âš ï¸ Firebase ë„ë©”ì¸ì´ CSPì— í¬í•¨ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!' : 'âœ… Firebase ë„ë©”ì¸ì´ CSPì— í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.'}
                    `;
                    
                    alert(result);
                    console.log('CSP ë¶„ì„ ì™„ë£Œ:', result);
                })
                .catch(error => {
                    console.error('âŒ CSP í—¤ë” í™•ì¸ ì‹¤íŒ¨:', error);
                    alert('âŒ CSP í—¤ë” í™•ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\n\në¸Œë¼ìš°ì € DevTools â†’ Network â†’ Response Headersë¥¼ ì§ì ‘ í™•ì¸í•˜ì„¸ìš”.');
                });
        };
        
        // ìºì‹œ ë° ì„œë¹„ìŠ¤ì›Œì»¤ ì •ë¦¬ í•¨ìˆ˜ (CSP ì™„ì „ ì •ë¦¬)
        window.clearCacheAndReload = function() {
            console.log('ğŸ§¹ ìºì‹œ ë° ì„œë¹„ìŠ¤ì›Œì»¤ ì™„ì „ ì •ë¦¬ ì‹œì‘...');
            
            let cleanupPromises = [];
            
            // ì„œë¹„ìŠ¤ì›Œì»¤ ë“±ë¡ í•´ì œ
            if ('serviceWorker' in navigator) {
                const swPromise = navigator.serviceWorker.getRegistrations().then(function(registrations) {
                    const unregisterPromises = registrations.map(registration => {
                        console.log('ğŸ—‘ï¸ ì„œë¹„ìŠ¤ì›Œì»¤ ë“±ë¡ í•´ì œ:', registration.scope);
                        return registration.unregister();
                    });
                    return Promise.all(unregisterPromises);
                });
                cleanupPromises.push(swPromise);
            }
            
            // ìºì‹œ ìŠ¤í† ë¦¬ì§€ ì •ë¦¬
            if ('caches' in window) {
                const cachePromise = caches.keys().then(function(cacheNames) {
                    return Promise.all(
                        cacheNames.map(function(cacheName) {
                            console.log('ğŸ—‘ï¸ ìºì‹œ ì‚­ì œ:', cacheName);
                            return caches.delete(cacheName);
                        })
                    );
                });
                cleanupPromises.push(cachePromise);
            }
            
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì •ë¦¬
            try {
                localStorage.clear();
                sessionStorage.clear();
                console.log('âœ… ë¡œì»¬/ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ê°€ ì •ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (e) {
                console.log('âš ï¸ ìŠ¤í† ë¦¬ì§€ ì •ë¦¬ ì¤‘ ì˜¤ë¥˜:', e);
            }
            
            // IndexedDB ì •ë¦¬
            if ('indexedDB' in window) {
                try {
                    indexedDB.databases().then(databases => {
                        databases.forEach(db => {
                            indexedDB.deleteDatabase(db.name);
                            console.log('ğŸ—‘ï¸ IndexedDB ì‚­ì œ:', db.name);
                        });
                    });
                } catch (e) {
                    console.log('âš ï¸ IndexedDB ì •ë¦¬ ì¤‘ ì˜¤ë¥˜:', e);
                }
            }
            
            // ëª¨ë“  ì •ë¦¬ ì‘ì—… ì™„ë£Œ í›„ ìƒˆë¡œê³ ì¹¨
            Promise.all(cleanupPromises).then(() => {
                console.log('âœ… ëª¨ë“  ìºì‹œ ì •ë¦¬ ì™„ë£Œ');
                // ê°•ì œ ìƒˆë¡œê³ ì¹¨ (ìºì‹œ ë¬´ì‹œ + íƒ€ì„ìŠ¤íƒ¬í”„)
                const timestamp = Date.now();
                const url = new URL(window.location);
                url.searchParams.set('v', timestamp);
                url.searchParams.set('cache', 'clear');
                window.location.href = url.toString();
            }).catch(error => {
                console.error('âŒ ìºì‹œ ì •ë¦¬ ì¤‘ ì˜¤ë¥˜:', error);
                // ì˜¤ë¥˜ê°€ ìˆì–´ë„ ìƒˆë¡œê³ ì¹¨
                const timestamp = Date.now();
                const url = new URL(window.location);
                url.searchParams.set('v', timestamp);
                url.searchParams.set('cache', 'clear');
                window.location.href = url.toString();
            });
        };
        
        // í˜ì´ì§€ ì´ë™ í•¨ìˆ˜
        window.goToPage = function(page) {
            window.location.href = page;
        };
        
        // ì‚¬ì´ë“œë°” ì„¹ì…˜ ì „í™˜ í•¨ìˆ˜ (ì „ì—­ í•¨ìˆ˜)
        window.switchSection = function(sectionName) {
            console.log('ğŸ”„ ì„¹ì…˜ ì „í™˜:', sectionName);
            
            // ëª¨ë“  ì„¹ì…˜ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.section-content').forEach(section => {
                section.classList.add('hidden');
            });
            
            // ëª¨ë“  ì‚¬ì´ë“œë°” ì•„ì´í…œ ë¹„í™œì„±í™”
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // ì„ íƒëœ ì„¹ì…˜ í‘œì‹œ
            let targetSection;
            if (sectionName === 'dashboard') {
                // ëŒ€ì‹œë³´ë“œëŠ” dashboard-contentë¥¼ í‘œì‹œ
                targetSection = document.getElementById('dashboard-content');
            } else {
                targetSection = document.getElementById(sectionName + '-section');
            }
            
            if (targetSection) {
                targetSection.classList.remove('hidden');
                console.log('âœ… ì„¹ì…˜ í‘œì‹œ:', sectionName);
            } else {
                console.error('âŒ ì„¹ì…˜ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ:', sectionName);
            }
            
            // ì„ íƒëœ ì‚¬ì´ë“œë°” ì•„ì´í…œ í™œì„±í™”
            const activeItem = document.querySelector(`[data-section="${sectionName}"]`);
            if (activeItem) {
                activeItem.classList.add('active');
            }
        }
        

        // ì‚¬ìš©ì ìƒì„¸ë³´ê¸° í•¨ìˆ˜
        async function viewUserDetails(userId) {
            console.log('ğŸ‘¤ ì‚¬ìš©ì ìƒì„¸ë³´ê¸°:', userId);
            
            // Firebaseì—ì„œ ì‚¬ìš©ì ê²€ìƒ‰
            let user = null;
            try {
                await waitForFirebase();
                const { collection, query, where, getDocs, doc, getDoc } = window.firebaseFirestoreFunctions;
                const db = window.firebaseDb;
                
                // ë¨¼ì € IDë¡œ ì§ì ‘ ê²€ìƒ‰
                try {
                    const userDoc = await getDoc(doc(db, 'users', userId));
                    if (userDoc.exists()) {
                        user = { id: userDoc.id, ...userDoc.data() };
                    }
                } catch (error) {
                    // IDë¡œ ì°¾ì§€ ëª»í•˜ë©´ ì´ë©”ì¼ë¡œ ê²€ìƒ‰
                    const usersRef = collection(db, 'users');
                    const q = query(usersRef, where('email', '==', userId));
                    const querySnapshot = await getDocs(q);
                    
                    if (!querySnapshot.empty) {
                        const userDoc = querySnapshot.docs[0];
                        user = { id: userDoc.id, ...userDoc.data() };
                    }
                }
            } catch (error) {
                console.error('ì‚¬ìš©ì ê²€ìƒ‰ ì‹¤íŒ¨:', error);
            }
            
            // Firebaseì—ì„œë„ ê²€ìƒ‰ ì‹œë„
            if (!user && window.firebaseDb) {
                console.log('ğŸ” Firebaseì—ì„œ ì‚¬ìš©ì ê²€ìƒ‰ ì‹œë„...');
                // Firebase ì‚¬ìš©ì ê²€ìƒ‰ ë¡œì§ì€ ë³„ë„ë¡œ êµ¬í˜„ í•„ìš”
            }
            
            console.log('ğŸ‘¤ ì°¾ì€ ì‚¬ìš©ì:', user);
            
            if (!user) {
                console.error('âŒ ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ. ì‚¬ìš© ê°€ëŠ¥í•œ IDë“¤:', users.map(u => ({ id: u.id, firebaseId: u.firebaseId, uid: u.uid, email: u.email })));
                alert(`ì‚¬ìš©ì ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n\nê²€ìƒ‰í•œ ID: ${userId}\n\nì½˜ì†”ì—ì„œ ìì„¸í•œ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”.`);
                return;
            }
            
            // ëª¨ë‹¬ ë‚´ìš© ìƒì„±
            const content = document.getElementById('user-detail-content');
            content.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- ê¸°ë³¸ ì •ë³´ -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">ğŸ“‹ ê¸°ë³¸ ì •ë³´</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-gray-600">ì´ë¦„:</span>
                                <span class="font-medium">${user.name || user.displayName || 'ì •ë³´ ì—†ìŒ'}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">ì´ë©”ì¼:</span>
                                <span class="font-medium">${user.email || 'ì •ë³´ ì—†ìŒ'}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">íœ´ëŒ€í°:</span>
                                <span class="font-medium">${user.phone || 'ì •ë³´ ì—†ìŒ'}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">ë¡œê·¸ì¸ ë°©ì‹:</span>
                                <span class="px-2 py-1 rounded-full text-xs font-semibold ${(user.loginMethod || user.loginType) === 'kakao' ? 'bg-yellow-100 text-yellow-800' : 'bg-blue-100 text-blue-800'}">
                                    ${(user.loginMethod || user.loginType) === 'kakao' ? 'ì¹´ì¹´ì˜¤í†¡' : 'ì´ë©”ì¼'}
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ê³„ì • ì •ë³´ -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">ğŸ” ê³„ì • ì •ë³´</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-gray-600">ì‚¬ìš©ì ID:</span>
                                <span class="font-mono text-sm">${user.id || user.firebaseId || 'ì •ë³´ ì—†ìŒ'}</span>
                            </div>
                            <!-- í¬ì¸íŠ¸ ì‹œìŠ¤í…œ ì œê±°ë¨ -->
                            <div class="flex justify-between">
                                <span class="text-gray-600">ê°€ì…ì¼:</span>
                                <span class="font-medium">${user.createdAt ? new Date(user.createdAt).toLocaleDateString('ko-KR') : 'ì •ë³´ ì—†ìŒ'}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">ë§ˆì§€ë§‰ ë¡œê·¸ì¸:</span>
                                <span class="font-medium">${user.lastLogin ? new Date(user.lastLogin).toLocaleDateString('ko-KR') : 'ì •ë³´ ì—†ìŒ'}</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ì¶”ê°€ ì •ë³´ -->
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">ğŸ“Š ì¶”ê°€ ì •ë³´</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="flex justify-between">
                            <span class="text-gray-600">ë°ì´í„° ì†ŒìŠ¤:</span>
                            <span class="px-2 py-1 rounded-full text-xs font-semibold ${user.source === 'localStorage' ? 'bg-orange-100 text-orange-800' : 'bg-green-100 text-green-800'}">
                                ${user.source || 'Firebase'}
                            </span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">ë¡œê·¸ì¸ íšŸìˆ˜:</span>
                            <span class="font-medium">${user.loginCount || 0}íšŒ</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">ê³„ì • ìƒíƒœ:</span>
                            <span class="px-2 py-1 rounded-full text-xs font-semibold ${user.isActive !== false ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                ${user.isActive !== false ? 'í™œì„±' : 'ë¹„í™œì„±'}
                            </span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">ë§ˆì¼€íŒ… ë™ì˜:</span>
                            <span class="px-2 py-1 rounded-full text-xs font-semibold ${user.agreeMarketing ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'}">
                                ${user.agreeMarketing ? 'ë™ì˜' : 'ë¹„ë™ì˜'}
                            </span>
                        </div>
                    </div>
                </div>
                
                <!-- ì•½ê´€ ë™ì˜ ì •ë³´ -->
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">ğŸ“„ ì•½ê´€ ë™ì˜</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="flex justify-between">
                            <span class="text-gray-600">ì´ìš©ì•½ê´€:</span>
                            <span class="px-2 py-1 rounded-full text-xs font-semibold ${user.agreeTerms ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                ${user.agreeTerms ? 'ë™ì˜' : 'ë¹„ë™ì˜'}
                            </span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨:</span>
                            <span class="px-2 py-1 rounded-full text-xs font-semibold ${user.agreePrivacy ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                ${user.agreePrivacy ? 'ë™ì˜' : 'ë¹„ë™ì˜'}
                            </span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">ë§ˆì¼€íŒ… ìˆ˜ì‹ :</span>
                            <span class="px-2 py-1 rounded-full text-xs font-semibold ${user.agreeMarketing ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'}">
                                ${user.agreeMarketing ? 'ë™ì˜' : 'ë¹„ë™ì˜'}
                            </span>
                        </div>
                    </div>
                </div>
            `;
            
            // ëª¨ë‹¬ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
            setupUserDetailModal(userId, user);
            
            // ëª¨ë‹¬ í‘œì‹œ
            document.getElementById('user-detail-modal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }
        
        // ì‚¬ìš©ì ìƒì„¸ë³´ê¸° ëª¨ë‹¬ ì„¤ì •
        function setupUserDetailModal(userId, user) {
            // ë‹«ê¸° ë²„íŠ¼ë“¤
            document.getElementById('close-user-detail').onclick = closeUserDetailModal;
            document.getElementById('close-user-detail-btn').onclick = closeUserDetailModal;
            
            // ìˆ˜ì • ë²„íŠ¼
            document.getElementById('edit-user-btn').onclick = function() {
                alert('ì‚¬ìš©ì ì •ë³´ ìˆ˜ì • ê¸°ëŠ¥ì€ ì¶”í›„ êµ¬í˜„ ì˜ˆì •ì…ë‹ˆë‹¤.');
            };
            
            // ì‚­ì œ ë²„íŠ¼
            document.getElementById('delete-user-btn').onclick = function() {
                if (confirm(`ì •ë§ë¡œ ${user.name || user.displayName}ë‹˜ì˜ ê³„ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) {
                    deleteUser(userId);
                    closeUserDetailModal();
                }
            };
        }
        
        // ì‚¬ìš©ì ìƒì„¸ë³´ê¸° ëª¨ë‹¬ ë‹«ê¸°
        function closeUserDetailModal() {
            document.getElementById('user-detail-modal').classList.add('hidden');
            document.body.style.overflow = '';
        }

        // ì‚¬ìš©ì ì‚­ì œ í•¨ìˆ˜ (Firebase ìë™ ì—°ë™)
        async function deleteUser(userId) {
            console.log('ğŸ—‘ï¸ ì‚¬ìš©ì ì‚­ì œ ì‹œì‘:', userId);
            
            // Firebaseì—ì„œ ì‚¬ìš©ì ì •ë³´ ë¨¼ì € ì°¾ê¸°
            let user = null;
            let firebaseUser = null;
            
            try {
                if (window.firebaseDb) {
                    const { collection, getDocs, query, where } = await import('https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js');
                    const usersRef = collection(window.firebaseDb, 'users');
                    
                    // ì´ë©”ì¼ë¡œ ê²€ìƒ‰ ì‹œë„
                    if (userId.includes('@')) {
                        const q = query(usersRef, where('email', '==', userId));
                        const snapshot = await getDocs(q);
                        if (!snapshot.empty) {
                            const doc = snapshot.docs[0];
                            firebaseUser = { id: doc.id, ...doc.data() };
                        }
                    }
                    
                    // IDë¡œ ì§ì ‘ ê²€ìƒ‰ ì‹œë„
                    if (!firebaseUser) {
                        const { doc, getDoc } = await import('https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js');
                        const userDocRef = doc(window.firebaseDb, 'users', userId);
                        const userDoc = await getDoc(userDocRef);
                        if (userDoc.exists()) {
                            firebaseUser = { id: userDoc.id, ...userDoc.data() };
                        }
                    }
                }
            } catch (error) {
                console.warn('âš ï¸ Firebaseì—ì„œ ì‚¬ìš©ì ê²€ìƒ‰ ì‹¤íŒ¨:', error);
            }
            
            // Firebaseì—ì„œë§Œ ì‚¬ìš©ì ê²€ìƒ‰ (ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì œê±°)
            user = firebaseUser;
            
            if (!user) {
                console.error('âŒ ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ:', userId);
                console.log('ğŸ“‹ localStorage ì‚¬ìš©ìë“¤:', users.map(u => ({ id: u.id, email: u.email })));
                alert(`ì‚­ì œí•  ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n\nê²€ìƒ‰í•œ ID: ${userId}\n\nì½˜ì†”ì—ì„œ ìì„¸í•œ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”.`);
                return;
            }
            
            const userName = user.name || user.displayName || user.email;
            
            // ê´€ë¦¬ì ê³„ì • ë³´í˜¸
            if (user.email === 'admin@pricehunter.com') {
                alert('âŒ ê´€ë¦¬ì ê³„ì •ì€ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ì‚­ì œ í™•ì¸
            if (!confirm(`âš ï¸ ê²½ê³ : "${userName}"ë‹˜ì˜ ê³„ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n\nì‚­ì œë  ë°ì´í„°:\n- Firebase ì‚¬ìš©ì ë¬¸ì„œ (ìë™ ì—°ë™)\n- localStorage ì‚¬ìš©ì ë°ì´í„°\n\nì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                return;
            }
            
            try {
                console.log('ğŸ—‘ï¸ ì‚¬ìš©ì ì‚­ì œ ì§„í–‰ ì¤‘...');
                
                // 1. Firebaseì—ì„œ ì‚­ì œ (ìš°ì„ )
                if (window.firebaseDb && user.id) {
                    try {
                        const { doc, deleteDoc } = await import('https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js');
                        const userDocRef = doc(window.firebaseDb, 'users', user.id);
                        await deleteDoc(userDocRef);
                        console.log('âœ… Firebaseì—ì„œ ì‚¬ìš©ì ì‚­ì œ ì™„ë£Œ:', user.id);
                    } catch (firebaseError) {
                        console.error('âŒ Firebase ì‚­ì œ ì‹¤íŒ¨:', firebaseError);
                        alert('âŒ Firebaseì—ì„œ ì‚¬ìš©ì ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\n\nì˜¤ë¥˜: ' + firebaseError.message);
                        return;
                    }
                } else {
                    console.warn('âš ï¸ Firebase ì—°ê²°ì´ ì—†ê±°ë‚˜ ì‚¬ìš©ì IDê°€ ì—†ìŠµë‹ˆë‹¤.');
                }
                
                // 2. localStorageì—ì„œ ì‚­ì œ (ì‚¬ìš©ì ì´ë©”ì¼ ê¸°ì¤€ìœ¼ë¡œ ì‚­ì œ)
                // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì‚­ì œ ë¡œì§ ì œê±°ë¨ - Firebase ì „ìš© ì‚¬ìš©
                
                // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì‚­ì œ ë¡œì§ ì œê±°ë¨ - Firebase ì „ìš© ì‚¬ìš©
                
                // 4. UI ì—…ë°ì´íŠ¸
                alert(`âœ… "${userName}"ë‹˜ì˜ ê³„ì •ì´ ì™„ì „íˆ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.\n\n- Firebase: ì‚­ì œ ì™„ë£Œ (ìë™ ì—°ë™)\n- localStorage: ì‚­ì œ ì™„ë£Œ`);
                
                // 5. íšŒì› ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                if (typeof subscribeToUsers === 'function') {
                    subscribeToUsers();
                }
                
                // 6. í†µê³„ ì—…ë°ì´íŠ¸
                setTimeout(() => {
                    const allUsers = JSON.parse(localStorage.getItem('users') || '[]');
                    const totalMembersElement = document.getElementById('total-members');
                    if (totalMembersElement) {
                        totalMembersElement.textContent = allUsers.length;
                    }
                    
                    // í†µê³„ ì—…ë°ì´íŠ¸
                    if (typeof updateMemberStats === 'function') {
                        updateMemberStats(allUsers);
                    }
                }, 1000);
                
                console.log('âœ… ì‚¬ìš©ì ì‚­ì œ ì™„ë£Œ');
                
            } catch (error) {
                console.error('âŒ ì‚¬ìš©ì ì‚­ì œ ì‹¤íŒ¨:', error);
                alert('âŒ ì‚¬ìš©ì ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n\nì˜¤ë¥˜: ' + error.message);
            }
        }

        // ë°©ë¬¸ì ë¦¬í¬íŠ¸ ê´€ë ¨ ë³€ìˆ˜
        let visitorChart = null;
        
        // ë‚ ì§œ í¬ë§· í•¨ìˆ˜
        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
        
        // Firebase ì´ˆê¸°í™” ëŒ€ê¸°
        async function waitForFirebase() {
            let attempts = 0;
            while ((!window.firebaseDb || !window.firebaseFirestoreFunctions) && attempts < 50) {
                await new Promise(resolve => setTimeout(resolve, 100));
                attempts++;
            }
            if (!window.firebaseDb) {
                throw new Error('Firebase ì´ˆê¸°í™” ì‹¤íŒ¨');
            }
        }
        
        // ë°©ë¬¸ì ë¦¬í¬íŠ¸ ë¡œë“œ
        async function loadVisitorReport(period, customStartDate = null, customEndDate = null) {
            console.log('ğŸ“Š ë°©ë¬¸ì ë¦¬í¬íŠ¸ ë¡œë“œ:', period, customStartDate, customEndDate);
            
            // íƒ­ í™œì„±í™”
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            const activeTab = document.querySelector(`[data-period="${period}"]`);
            if (activeTab) {
                activeTab.classList.add('active');
            }
            
            // ì‚¬ìš©ì ì •ì˜ ë‚ ì§œ ë²”ìœ„ UI í‘œì‹œ/ìˆ¨ê¹€
            const customDateRange = document.getElementById('custom-date-range');
            if (customDateRange) {
                if (period === 'custom') {
                    customDateRange.classList.remove('hidden');
                } else {
                    customDateRange.classList.add('hidden');
                }
            }
            
            try {
                await waitForFirebase();
                
                const { collection, query, where, getDocs, orderBy } = window.firebaseFirestoreFunctions;
                const db = window.firebaseDb;
                
                const visitsRef = collection(db, 'visits');
                let startDate, endDate;
                const today = new Date();
                
                // ê¸°ê°„ë³„ ë‚ ì§œ ë²”ìœ„ ì„¤ì •
                if (period === 'all') {
                    // ì „ì²´ ê¸°ê°„ - ë‚ ì§œ í•„í„° ì—†ì´ ëª¨ë“  ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                    startDate = null;
                    endDate = null;
                } else if (period === 'custom' && customStartDate && customEndDate) {
                    // ì‚¬ìš©ì ì •ì˜ ë‚ ì§œ ë²”ìœ„
                    startDate = new Date(customStartDate);
                    endDate = new Date(customEndDate);
                } else if (period === 'daily') {
                    // ìµœê·¼ 30ì¼
                    startDate = new Date(today);
                    startDate.setDate(today.getDate() - 30);
                    endDate = today;
                } else if (period === 'weekly') {
                    // ìµœê·¼ 12ì£¼
                    startDate = new Date(today);
                    startDate.setDate(today.getDate() - 84); // 12ì£¼
                    endDate = today;
                } else if (period === 'monthly') {
                    // ìµœê·¼ 12ê°œì›”
                    startDate = new Date(today);
                    startDate.setMonth(today.getMonth() - 12);
                    endDate = today;
                } else {
                    // ê¸°ë³¸ê°’: ìµœê·¼ 30ì¼
                    startDate = new Date(today);
                    startDate.setDate(today.getDate() - 30);
                    endDate = today;
                }
                
                // ë°©ë¬¸ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                // Firestore ì¿¼ë¦¬ ì œí•œì„ í”¼í•˜ê¸° ìœ„í•´ ëª¨ë“  ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¨ í›„ í´ë¼ì´ì–¸íŠ¸ì—ì„œ í•„í„°ë§
                let q;
                try {
                    // timestampë¡œ ì •ë ¬ ì‹œë„ (ë” ì •í™•í•˜ê³  ì¸ë±ìŠ¤ê°€ ìˆì„ ê°€ëŠ¥ì„±ì´ ë†’ìŒ)
                    q = query(visitsRef, orderBy('timestamp', 'desc'));
                } catch (e) {
                    // timestamp ì¸ë±ìŠ¤ê°€ ì—†ìœ¼ë©´ dateë¡œ ì‹œë„
                    console.warn('âš ï¸ timestamp ì¸ë±ìŠ¤ ì—†ìŒ, dateë¡œ ì‹œë„:', e);
                    try {
                        q = query(visitsRef, orderBy('date', 'desc'));
                    } catch (e2) {
                        // date ì¸ë±ìŠ¤ë„ ì—†ìœ¼ë©´ ì •ë ¬ ì—†ì´ ê°€ì ¸ì˜¤ê¸°
                        console.warn('âš ï¸ date ì¸ë±ìŠ¤ë„ ì—†ìŒ, ì •ë ¬ ì—†ì´ ê°€ì ¸ì˜¤ê¸°:', e2);
                        q = query(visitsRef);
                    }
                }
                
                const snapshot = await getDocs(q);
                console.log('ğŸ“Š Firestoreì—ì„œ ê°€ì ¸ì˜¨ ì´ ë°ì´í„° ê°œìˆ˜:', snapshot.size);
                
                // ë°ì´í„° ì§‘ê³„
                const dataMap = new Map();
                const uniqueVisitorsMap = new Map();
                let totalVisits = 0;
                let totalUniqueVisitors = new Set();
                let dateRange = { min: null, max: null };
                
                snapshot.forEach((doc) => {
                    const data = doc.data();
                    // date í•„ë“œê°€ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ timestampì—ì„œ ì¶”ì¶œ
                    let date = data.date;
                    if (!date && data.timestamp) {
                        const timestamp = data.timestamp.toDate ? data.timestamp.toDate() : new Date(data.timestamp);
                        date = formatDate(timestamp);
                    }
                    
                    if (!date) {
                        console.warn('âš ï¸ ë‚ ì§œ ì •ë³´ê°€ ì—†ëŠ” ë°ì´í„°:', doc.id, data);
                        return; // ë‚ ì§œê°€ ì—†ìœ¼ë©´ ìŠ¤í‚µ
                    }
                    
                    // ë‚ ì§œ ë²”ìœ„ ì¶”ì 
                    if (date) {
                        if (!dateRange.min || date < dateRange.min) {
                            dateRange.min = date;
                        }
                        if (!dateRange.max || date > dateRange.max) {
                            dateRange.max = date;
                        }
                    }
                    
                    // ê¸°ê°„ í•„í„°ë§ (í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ)
                    if (period !== 'all') {
                        if (period === 'custom' && customStartDate && customEndDate) {
                            const startStr = formatDate(new Date(customStartDate));
                            const endStr = formatDate(new Date(customEndDate));
                            if (date < startStr || date > endStr) {
                                return; // ë²”ìœ„ ë°–ì´ë©´ ìŠ¤í‚µ
                            }
                        } else if (startDate && endDate) {
                            const startStr = formatDate(startDate);
                            const endStr = formatDate(endDate);
                            if (date < startStr || date > endStr) {
                                return; // ë²”ìœ„ ë°–ì´ë©´ ìŠ¤í‚µ
                            }
                        }
                    }
                    
                    const userId = data.userId || data.sessionId || 'anonymous';
                    
                    totalVisits++;
                    totalUniqueVisitors.add(userId);
                    
                    // ê¸°ê°„ë³„ ê·¸ë£¹í•‘
                    let key;
                    if (period === 'all') {
                        // ì „ì²´ ê¸°ê°„ì€ ì›” ë‹¨ìœ„ë¡œ ê·¸ë£¹í•‘ (ë°ì´í„°ê°€ ë§ì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ)
                        const dateObj = new Date(date + 'T00:00:00');
                        key = `${dateObj.getFullYear()}-${String(dateObj.getMonth() + 1).padStart(2, '0')}`;
                    } else if (period === 'custom') {
                        // ì‚¬ìš©ì ì •ì˜ ê¸°ê°„ì€ ì¼ì¼ ë‹¨ìœ„ë¡œ í‘œì‹œ
                        key = date;
                    } else if (period === 'daily') {
                        key = date;
                    } else if (period === 'weekly') {
                        // ì£¼ ë‹¨ìœ„ë¡œ ê·¸ë£¹í•‘ (ì›”ìš”ì¼ ê¸°ì¤€)
                        const dateObj = new Date(date + 'T00:00:00');
                        const dayOfWeek = dateObj.getDay();
                        const monday = new Date(dateObj);
                        monday.setDate(dateObj.getDate() - (dayOfWeek === 0 ? 6 : dayOfWeek - 1));
                        key = formatDate(monday) + ' ì£¼';
                    } else if (period === 'monthly') {
                        // ì›” ë‹¨ìœ„ë¡œ ê·¸ë£¹í•‘
                        const dateObj = new Date(date + 'T00:00:00');
                        key = `${dateObj.getFullYear()}-${String(dateObj.getMonth() + 1).padStart(2, '0')}`;
                    } else {
                        key = date;
                    }
                    
                    if (!dataMap.has(key)) {
                        dataMap.set(key, { visits: 0, uniqueVisitors: new Set() });
                    }
                    
                    const periodData = dataMap.get(key);
                    periodData.visits++;
                    periodData.uniqueVisitors.add(userId);
                });
                
                // ë°ì´í„° ì •ë ¬ ë° ë³€í™˜
                const sortedKeys = Array.from(dataMap.keys()).sort();
                const chartData = {
                    labels: [],
                    visitors: [],
                    visits: [],
                    uniqueVisitors: []
                };
                
                let maxVisitors = 0;
                let totalPeriodVisitors = 0;
                
                sortedKeys.forEach(key => {
                    const periodData = dataMap.get(key);
                    const uniqueCount = periodData.uniqueVisitors.size;
                    
                    chartData.labels.push(key);
                    chartData.visitors.push(uniqueCount);
                    chartData.visits.push(periodData.visits);
                    chartData.uniqueVisitors.push(uniqueCount);
                    
                    totalPeriodVisitors += uniqueCount;
                    if (uniqueCount > maxVisitors) {
                        maxVisitors = uniqueCount;
                    }
                });
                
                // í†µê³„ ì—…ë°ì´íŠ¸
                document.getElementById('total-visitors-count').textContent = totalUniqueVisitors.size.toLocaleString();
                document.getElementById('total-visits-count').textContent = totalVisits.toLocaleString();
                document.getElementById('avg-visitors-count').textContent = sortedKeys.length > 0 
                    ? Math.round(totalPeriodVisitors / sortedKeys.length).toLocaleString() 
                    : '0';
                document.getElementById('max-visitors-count').textContent = maxVisitors.toLocaleString();
                
                // ë””ë²„ê¹…: ë‚ ì§œ ë²”ìœ„ ì¶œë ¥
                console.log('ğŸ“… ë°ì´í„° ë‚ ì§œ ë²”ìœ„:', dateRange);
                console.log('ğŸ“Š ì§‘ê³„ëœ ê¸°ê°„ ìˆ˜:', sortedKeys.length);
                if (dateRange.min && dateRange.max) {
                    console.log(`ğŸ“… ìµœì´ˆ ë°ì´í„°: ${dateRange.min}, ìµœì‹  ë°ì´í„°: ${dateRange.max}`);
                    
                    // UIì— ë‚ ì§œ ë²”ìœ„ í‘œì‹œ
                    const dataRangeInfo = document.getElementById('data-range-info');
                    if (dataRangeInfo) {
                        dataRangeInfo.textContent = `ë°ì´í„° ë²”ìœ„: ${dateRange.min} ~ ${dateRange.max} (ì´ ${snapshot.size}ê±´)`;
                        dataRangeInfo.classList.remove('text-gray-500');
                        dataRangeInfo.classList.add('text-blue-600');
                    }
                } else {
                    const dataRangeInfo = document.getElementById('data-range-info');
                    if (dataRangeInfo) {
                        dataRangeInfo.textContent = `ë°ì´í„° ì—†ìŒ (ì´ ${snapshot.size}ê±´)`;
                        dataRangeInfo.classList.remove('text-blue-600');
                        dataRangeInfo.classList.add('text-gray-500');
                    }
                }
                
                // ì°¨íŠ¸ ì œëª© ì—…ë°ì´íŠ¸
                let chartTitle = 'ë°©ë¬¸ì ì¶”ì´';
                if (period === 'all') {
                    chartTitle = 'ì „ì²´ ê¸°ê°„ ë°©ë¬¸ì ì¶”ì´';
                } else if (period === 'custom' && customStartDate && customEndDate) {
                    chartTitle = `ë°©ë¬¸ì ì¶”ì´ (${formatDate(new Date(customStartDate))} ~ ${formatDate(new Date(customEndDate))})`;
                } else {
                    const titles = {
                        daily: 'ì¼ì¼ ë°©ë¬¸ì ì¶”ì´ (ìµœê·¼ 30ì¼)',
                        weekly: 'ì£¼ê°„ ë°©ë¬¸ì ì¶”ì´ (ìµœê·¼ 12ì£¼)',
                        monthly: 'ì›”ê°„ ë°©ë¬¸ì ì¶”ì´ (ìµœê·¼ 12ê°œì›”)'
                    };
                    chartTitle = titles[period] || 'ë°©ë¬¸ì ì¶”ì´';
                }
                document.getElementById('chart-title').textContent = chartTitle;
                
                // ì°¨íŠ¸ ë Œë”ë§
                renderVisitorChart(chartData, period);
                
                // í…Œì´ë¸” ì—…ë°ì´íŠ¸
                updateVisitorTable(sortedKeys, dataMap, period);
                
            } catch (error) {
                console.error('âŒ ë°©ë¬¸ì ë¦¬í¬íŠ¸ ë¡œë“œ ì‹¤íŒ¨:', error);
                const tbody = document.getElementById('visitor-data-table');
                if (tbody) {
                    tbody.innerHTML = '<tr><td colspan="5" class="px-4 py-8 text-center text-red-500">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message + '</td></tr>';
                }
            }
        }
        
        // ì°¨íŠ¸ ë Œë”ë§
        function renderVisitorChart(data, period) {
            const ctx = document.getElementById('visitor-chart');
            if (!ctx) return;
            
            // ê¸°ì¡´ ì°¨íŠ¸ ì œê±°
            if (visitorChart) {
                visitorChart.destroy();
            }
            
            visitorChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.labels,
                    datasets: [
                        {
                            label: 'ë°©ë¬¸ì ìˆ˜',
                            data: data.visitors,
                            borderColor: 'rgb(236, 72, 153)',
                            backgroundColor: 'rgba(236, 72, 153, 0.1)',
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: 'ë°©ë¬¸ ìˆ˜',
                            data: data.visits,
                            borderColor: 'rgb(59, 130, 246)',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.4,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0
                            }
                        }
                    }
                }
            });
        }
        
        // í…Œì´ë¸” ì—…ë°ì´íŠ¸
        function updateVisitorTable(keys, dataMap, period) {
            const tbody = document.getElementById('visitor-data-table');
            if (!tbody) return;
            
            if (keys.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="px-4 py-8 text-center text-gray-500">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }
            
            let totalVisitors = 0;
            let totalVisits = 0;
            
            keys.forEach(key => {
                const periodData = dataMap.get(key);
                const uniqueCount = periodData.uniqueVisitors.size;
                totalVisitors += uniqueCount;
                totalVisits += periodData.visits;
            });
            
            tbody.innerHTML = keys.map(key => {
                const periodData = dataMap.get(key);
                const uniqueCount = periodData.uniqueVisitors.size;
                const percentage = totalVisitors > 0 ? ((uniqueCount / totalVisitors * 100).toFixed(1)) : 0;
                
                return `
                    <tr class="hover:bg-gray-50">
                        <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900">${key}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700">${uniqueCount.toLocaleString()}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700">${periodData.visits.toLocaleString()}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700">${uniqueCount.toLocaleString()}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700">
                            <div class="flex items-center">
                                <div class="w-16 bg-gray-200 rounded-full h-2 mr-2">
                                    <div class="bg-pink-600 h-2 rounded-full" style="width: ${percentage}%"></div>
                                </div>
                                <span>${percentage}%</span>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
            
            // í•©ê³„ í–‰ ì¶”ê°€
            tbody.innerHTML += `
                <tr class="bg-gray-50 font-semibold">
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">í•©ê³„</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">${totalVisitors.toLocaleString()}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">${totalVisits.toLocaleString()}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">${totalVisitors.toLocaleString()}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">100%</td>
                </tr>
            `;
        }
        
        // ë°©ë¬¸ì ë°ì´í„° ìƒˆë¡œê³ ì¹¨
        function refreshVisitorData() {
            const activeTab = document.querySelector('.tab-btn.active');
            const period = activeTab ? activeTab.getAttribute('data-period') : 'daily';
            
            if (period === 'custom') {
                const startDate = document.getElementById('start-date').value;
                const endDate = document.getElementById('end-date').value;
                if (startDate && endDate) {
                    loadVisitorReport(period, startDate, endDate);
                } else {
                    alert('ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                }
            } else {
                loadVisitorReport(period);
            }
        }
        
        // ì‚¬ìš©ì ì •ì˜ ë‚ ì§œ ë²”ìœ„ ë¡œë“œ
        function loadCustomDateRange() {
            const startDate = document.getElementById('start-date').value;
            const endDate = document.getElementById('end-date').value;
            
            if (!startDate || !endDate) {
                alert('ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (new Date(startDate) > new Date(endDate)) {
                alert('ì‹œì‘ì¼ì´ ì¢…ë£Œì¼ë³´ë‹¤ ëŠ¦ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            loadVisitorReport('custom', startDate, endDate);
        }
        
        // ë¹ ë¥¸ ë‚ ì§œ ë²”ìœ„ ì„¤ì •
        function setQuickDateRange(range) {
            const today = new Date();
            const startDateInput = document.getElementById('start-date');
            const endDateInput = document.getElementById('end-date');
            
            let startDate = new Date(today);
            
            if (range === 'last30') {
                startDate.setDate(today.getDate() - 30);
            } else if (range === 'last90') {
                startDate.setDate(today.getDate() - 90);
            } else if (range === 'lastYear') {
                startDate.setFullYear(today.getFullYear() - 1);
            }
            
            startDateInput.value = formatDate(startDate);
            endDateInput.value = formatDate(today);
            
            // ìë™ìœ¼ë¡œ ì¡°íšŒ
            loadCustomDateRange();
        }
        
        // ì„¹ì…˜ ì „í™˜
        function switchSection(section) {
            // ê¸°ì¡´ í™œì„± ì„¹ì…˜ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.section-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // ê¸°ì¡´ í™œì„± ì‚¬ì´ë“œë°” ì•„ì´í…œ ë¹„í™œì„±í™”
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // ìƒˆ ì„¹ì…˜ í‘œì‹œ
            const targetSection = document.getElementById(section + '-section');
            if (targetSection) {
                targetSection.classList.remove('hidden');
            }
            
            // ìƒˆ ì‚¬ì´ë“œë°” ì•„ì´í…œ í™œì„±í™”
            const activeItem = document.querySelector(`[data-section="${section}"]`);
            if (activeItem) {
                activeItem.classList.add('active');
            }
            
            // ì„¹ì…˜ë³„ ë°ì´í„° ìƒˆë¡œê³ ì¹¨
            switch(section) {
                case 'requests':
                    // ì˜ë¢° ê´€ë¦¬ ì„¹ì…˜ì¸ ê²½ìš° ì‹¤ì‹œê°„ êµ¬ë… ì‹œì‘ (ì´ë¯¸ ì‹œì‘ë˜ì–´ ìˆìœ¼ë©´ ë¬´ì‹œ)
                    if (!requestsUnsubscribe) {
                        subscribeToRequests();
                    }
                    renderRequestList();
                    break;
                case 'inquiries':
                    // ë¬¸ì˜ ê´€ë¦¬ ì„¹ì…˜ì¸ ê²½ìš° ì‹¤ì‹œê°„ êµ¬ë… ì‹œì‘ (ì´ë¯¸ ì‹œì‘ë˜ì–´ ìˆìœ¼ë©´ ë¬´ì‹œ)
                    if (!inquiriesUnsubscribe) {
                        subscribeToInquiries();
                    }
                    renderInquiryList();
                    break;
                case 'members':
                    // íšŒì› ê´€ë¦¬ ì„¹ì…˜ì¸ ê²½ìš° ì‹¤ì‹œê°„ êµ¬ë… ì‹œì‘ (ì´ë¯¸ ì‹œì‘ë˜ì–´ ìˆìœ¼ë©´ ë¬´ì‹œ)
                    if (!usersUnsubscribe) {
                        subscribeToUsers();
                    }
                    break;
                case 'reviews':
                    // í›„ê¸° ê´€ë¦¬ ì„¹ì…˜ì¸ ê²½ìš° ì‹¤ì‹œê°„ êµ¬ë… ì‹œì‘
                    if (!reviewsUnsubscribe) {
                        subscribeToReviews();
                    }
                    loadReviewsData();
                    break;
                case 'dashboard':
                    loadDashboardData();
                    break;
                case 'visitors':
                    // ë°©ë¬¸ì ë¦¬í¬íŠ¸ ì„¹ì…˜ ì§„ì… ì‹œ ê¸°ë³¸ê°’ìœ¼ë¡œ ì¼ì¼ ë¦¬í¬íŠ¸ ë¡œë“œ
                    loadVisitorReport('daily');
                    // ì „ì²´ ê¸°ê°„ ë°ì´í„°ë„ ë¯¸ë¦¬ ë¡œë“œí•  ìˆ˜ ìˆë„ë¡ ì˜µì…˜ ì œê³µ
                    break;
            }
        }
        
        console.log('ğŸš€ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì™„ë£Œ');
    </script>
    
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        .sidebar-item.active { background-color: #ec4899; color: white; }
        .tab-btn.active { background-color: #ec4899; color: white; }
        .filter-btn.active { background-color: #6b7280; color: white; }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 via-blue-50 to-emerald-50 min-h-screen">
    <!-- ë¡œê·¸ì¸ ì„¹ì…˜ -->
    <div id="login-section" class="min-h-screen flex items-center justify-center">
        <div class="bg-white rounded-xl shadow-2xl p-4 sm:p-6 md:p-8 w-full max-w-xs sm:max-w-sm md:max-w-md">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-pink-600">PriceHunter</h1>
                <p class="text-gray-600">ê´€ë¦¬ì ë¡œê·¸ì¸</p>
            </div>
            
            <form onsubmit="event.preventDefault(); adminLogin();" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ì´ë©”ì¼</label>
                    <input type="email" id="admin-email" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-400 focus:outline-none" placeholder="admin@pricehunter.com">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="admin-password" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-400 focus:outline-none" placeholder="ë¹„ë°€ë²ˆí˜¸">
                </div>
                
                <button type="submit" class="w-full bg-gradient-to-r from-pink-500 to-purple-500 text-white font-bold py-3 px-4 rounded-lg hover:from-pink-600 hover:to-purple-600 transition shadow-lg">
                    ğŸ” ë¡œê·¸ì¸
                </button>
            </form>
            
            <div class="mt-6 text-center space-y-3">
                <button onclick="goToPage('index.html')" class="text-pink-600 hover:text-pink-700 text-sm block w-full">
                    ğŸ  ë©”ì¸í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°
                </button>
                <button onclick="createAdminAccount()" class="text-blue-600 hover:text-blue-700 text-sm block w-full">
                    ğŸ”§ í…ŒìŠ¤íŠ¸ ê´€ë¦¬ì ê³„ì • ìƒì„±
                </button>
                <div class="text-xs text-gray-500 mt-2">
                    í…ŒìŠ¤íŠ¸ìš© ê³„ì •: admin@pricehunter.com / admin1234
                </div>
            </div>
        </div>
    </div>

    <!-- ëŒ€ì‹œë³´ë“œ ì„¹ì…˜ -->
    <div id="dashboard-section" class="hidden">
        <div class="flex h-screen">
            <!-- ì‚¬ì´ë“œë°” -->
            <div class="w-64 bg-white shadow-lg">
                <div class="p-6 border-b">
                    <h1 class="text-xl font-bold text-pink-600">PriceHunter</h1>
                    <p class="text-sm text-gray-500">ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</p>
                    <p id="admin-info" class="text-xs text-gray-400 mt-1"></p>
                </div>
                
                <nav class="p-4">
                    <div class="space-y-2">
                        <button class="sidebar-item w-full text-left px-4 py-3 rounded-lg font-semibold hover:bg-pink-50 transition active" data-section="dashboard" onclick="switchSection('dashboard')">
                            ğŸ“Š ëŒ€ì‹œë³´ë“œ
                        </button>
                        <button class="sidebar-item w-full text-left px-4 py-3 rounded-lg font-semibold hover:bg-pink-50 transition" data-section="requests" onclick="switchSection('requests')">
                            ğŸ“‹ ì˜ë¢° ê´€ë¦¬
                        </button>
                        <button class="sidebar-item w-full text-left px-4 py-3 rounded-lg font-semibold hover:bg-pink-50 transition" data-section="inquiries" onclick="switchSection('inquiries')">
                            ğŸ’¬ 1:1 ë¬¸ì˜
                        </button>
                        <button class="sidebar-item w-full text-left px-4 py-3 rounded-lg font-semibold hover:bg-pink-50 transition" data-section="members" onclick="switchSection('members')">
                            ğŸ‘¥ íšŒì› ê´€ë¦¬
                        </button>
                        <button class="sidebar-item w-full text-left px-4 py-3 rounded-lg font-semibold hover:bg-pink-50 transition" data-section="reviews" onclick="switchSection('reviews')">
                            â­ í›„ê¸° ê´€ë¦¬
                        </button>
                        <button class="sidebar-item w-full text-left px-4 py-3 rounded-lg font-semibold hover:bg-pink-50 transition" data-section="savings-king" onclick="switchSection('savings-king')">
                            ğŸ† ì ˆì•½ì™• ê´€ë¦¬
                        </button>
                        <button class="sidebar-item w-full text-left px-4 py-3 rounded-lg font-semibold hover:bg-pink-50 transition" data-section="visitors" onclick="switchSection('visitors')">
                            ğŸ“ˆ ë°©ë¬¸ì ë¦¬í¬íŠ¸
                        </button>
                    </div>
                </nav>
                
                <div class="absolute bottom-4 left-4 right-4">
                    <button onclick="adminLogout()" class="w-full px-4 py-2 bg-red-500 text-white rounded-lg font-semibold hover:bg-red-600 transition">
                        ğŸ”“ ë¡œê·¸ì•„ì›ƒ
                    </button>
                </div>
            </div>

            <!-- ë©”ì¸ ì½˜í…ì¸  -->
            <div class="flex-1 overflow-auto">
                <!-- ëŒ€ì‹œë³´ë“œ ì„¹ì…˜ -->
                <div id="dashboard-content" class="section-content p-8">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">ğŸ“Š ëŒ€ì‹œë³´ë“œ</h2>
                        <div class="flex gap-2 flex-wrap">
                            <button onclick="goToPage('index.html')" class="px-4 py-2 bg-blue-500 text-white rounded-lg font-semibold hover:bg-blue-600 transition">
                                ğŸ  ë©”ì¸í˜ì´ì§€ë¡œ
                            </button>
                            <button onclick="goToPage('member-dashboard.html')" class="px-4 py-2 bg-green-500 text-white rounded-lg font-semibold hover:bg-green-600 transition">
                                ğŸ‘¤ íšŒì›ëŒ€ì‹œë³´ë“œë¡œ
                            </button>
                            <button onclick="testFirebaseConnection()" class="px-4 py-2 bg-purple-500 text-white rounded-lg font-semibold hover:bg-purple-600 transition">
                                ğŸ”¥ Firebase ì—°ê²° í…ŒìŠ¤íŠ¸
                            </button>
                            <button onclick="checkFirebaseUsers()" class="px-4 py-2 bg-red-500 text-white rounded-lg font-semibold hover:bg-red-600 transition">
                                ğŸ” Firebase ì‚¬ìš©ì í™•ì¸
                            </button>
                            <button onclick="cleanupDuplicateUsers()" class="px-4 py-2 bg-pink-500 text-white rounded-lg font-semibold hover:bg-pink-600 transition">
                                ğŸ§¹ ì¤‘ë³µ ì‚¬ìš©ì ì •ë¦¬
                            </button>
                            <button onclick="checkCSPHeaders()" class="px-4 py-2 bg-indigo-500 text-white rounded-lg font-semibold hover:bg-indigo-600 transition">
                                ğŸ” CSP í—¤ë” í™•ì¸
                            </button>
                            <button onclick="clearCacheAndReload()" class="px-4 py-2 bg-orange-500 text-white rounded-lg font-semibold hover:bg-orange-600 transition">
                                ğŸ§¹ ìºì‹œ ì •ë¦¬ & ìƒˆë¡œê³ ì¹¨
                            </button>
                        </div>
                    </div>
                    
                    <!-- í†µê³„ ì¹´ë“œ -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <div class="flex items-center">
                                <div class="p-3 bg-blue-100 rounded-lg">
                                    <span class="text-2xl">ğŸ“‹</span>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm text-gray-500">ì´ ì˜ë¢°</p>
                                    <p class="text-2xl font-bold text-gray-800" id="total-requests">0</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <div class="flex items-center">
                                <div class="p-3 bg-green-100 rounded-lg">
                                    <span class="text-2xl">âœ…</span>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm text-gray-500">ì™„ë£Œëœ ì˜ë¢°</p>
                                    <p class="text-2xl font-bold text-gray-800" id="completed-requests">0</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <div class="flex items-center">
                                <div class="p-3 bg-orange-100 rounded-lg">
                                    <span class="text-2xl">ğŸ‘¥</span>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm text-gray-500">ì´ íšŒì›</p>
                                    <p class="text-2xl font-bold text-gray-800" id="total-members">0</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <div class="flex items-center">
                                <div class="p-3 bg-purple-100 rounded-lg">
                                    <span class="text-2xl">ğŸ’¬</span>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm text-gray-500">ì´ ë¬¸ì˜</p>
                                    <p class="text-2xl font-bold text-gray-800" id="total-inquiries">0</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <div class="flex items-center">
                                <div class="p-3 bg-red-100 rounded-lg">
                                    <span class="text-2xl">â°</span>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm text-gray-500">ë¯¸ë‹µë³€ ë¬¸ì˜</p>
                                    <p class="text-2xl font-bold text-gray-800" id="unanswered-inquiries">0</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ìµœê·¼ í™œë™ -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">ìµœê·¼ ì˜ë¢°</h3>
                            <div id="recent-requests" class="space-y-3">
                                <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">ìµœê·¼ ë¬¸ì˜</h3>
                            <div id="recent-inquiries" class="space-y-3">
                                <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ì˜ë¢° ê´€ë¦¬ ì„¹ì…˜ -->
                <div id="requests-section" class="section-content p-8 hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">ğŸ“‹ ì˜ë¢° ê´€ë¦¬</h2>
                        <div class="flex gap-2">
                            <button onclick="deleteSelectedRequests()" class="px-4 py-2 bg-red-500 text-white rounded-lg font-semibold hover:bg-red-600 transition">
                                ğŸ—‘ï¸ ì„ íƒ ì‚­ì œ
                            </button>
                            <button onclick="goToPage('index.html')" class="px-4 py-2 bg-blue-500 text-white rounded-lg font-semibold hover:bg-blue-600 transition">
                                ğŸ  ë©”ì¸í˜ì´ì§€ë¡œ
                            </button>
                            <button onclick="goToPage('request.html')" class="px-4 py-2 bg-green-500 text-white rounded-lg font-semibold hover:bg-green-600 transition">
                                ğŸ“ ì˜ë¢°í˜ì´ì§€ë¡œ
                            </button>
                        </div>
                    </div>
                    
                    <!-- ì˜ë¢° ëª©ë¡ -->
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                        <div class="font-bold text-gray-700 p-4 border-b">ì ‘ìˆ˜ëœ ì˜ë¢° ëª©ë¡</div>
                        <div class="grid grid-cols-9 gap-2 px-4 py-2 bg-pink-100 text-sm font-bold text-pink-700">
                            <div class="col-span-1">ì„ íƒ</div>
                            <div class="col-span-2">ì˜ë¢°ë²ˆí˜¸/íšŒì›ëª…</div>
                            <div class="col-span-1 text-center">ì˜ë¢°ì¼ì‹œ</div>
                            <div class="col-span-1 text-center">ì§„í–‰ìƒí™©</div>
                            <div class="col-span-1 text-center">êµ¬ë§¤ë°©ì‹</div>
                            <div class="col-span-1 text-center">êµ¬ë§¤ìƒíƒœ</div>
                            <div class="col-span-1 text-center">í›„ê¸° ë™ì˜</div>
                            <div class="col-span-1 text-center">ì‘ì—…</div>
                        </div>
                        <ul id="request-list" class="bg-pink-50 divide-y divide-pink-100">
                            <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                        </ul>
                    </div>
                    
                    <!-- ì˜ë¢° ìƒì„¸ ë° ê²°ê³¼ ì…ë ¥ -->
                    <div id="detail-section" class="w-full hidden mt-6">
                        <div class="bg-white rounded-xl shadow-lg p-6 mb-4">
                            <div class="mb-2 text-gray-700 font-bold">ì˜ë¢° ìƒì„¸</div>
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div><span class="font-semibold">ì˜ë¢°ë²ˆí˜¸:</span> <span id="detail-num"></span></div>
                                <div><span class="font-semibold">ì œí’ˆëª…:</span> <span id="detail-name"></span></div>
                                <div><span class="font-semibold">ì œí’ˆì„¤ëª…:</span> <span id="detail-desc"></span></div>
                                <div><span class="font-semibold">ì°¸ê³ ì‚¬ì´íŠ¸:</span> <span id="detail-url"></span></div>
                                <div><span class="font-semibold">ê°€ê²©:</span> <span id="detail-price"></span></div>
                                <div><span class="font-semibold">ì´ë¦„:</span> <span id="detail-username"></span></div>
                                <div><span class="font-semibold">ì´ë©”ì¼:</span> <span id="detail-email"></span></div>
                                <div><span class="font-semibold">íœ´ëŒ€í°:</span> <span id="detail-phone"></span></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 1:1 ë¬¸ì˜ ì„¹ì…˜ -->
                <div id="inquiries-section" class="section-content p-8 hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">ğŸ’¬ 1:1 ë¬¸ì˜ ê´€ë¦¬</h2>
                        <div class="flex gap-2">
                            <button onclick="deleteSelectedInquiries()" class="px-4 py-2 bg-red-500 text-white rounded-lg font-semibold hover:bg-red-600 transition">
                                ğŸ—‘ï¸ ì„ íƒ ì‚­ì œ
                            </button>
                            <button onclick="goToPage('index.html')" class="px-4 py-2 bg-blue-500 text-white rounded-lg font-semibold hover:bg-blue-600 transition">
                                ğŸ  ë©”ì¸í˜ì´ì§€ë¡œ
                            </button>
                            <button onclick="goToPage('support.html')" class="px-4 py-2 bg-green-500 text-white rounded-lg font-semibold hover:bg-green-600 transition">
                                ğŸ’¬ ë¬¸ì˜í˜ì´ì§€ë¡œ
                            </button>
                        </div>
                    </div>
                    
                    <!-- ë¬¸ì˜ ëª©ë¡ -->
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-blue-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-blue-700 uppercase tracking-wider">ë¬¸ì˜ë²ˆí˜¸</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-blue-700 uppercase tracking-wider">íšŒì›ëª…</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-blue-700 uppercase tracking-wider">ì œëª©</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-blue-700 uppercase tracking-wider">ìƒíƒœ</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-blue-700 uppercase tracking-wider">ë“±ë¡ì¼ì‹œ</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-blue-700 uppercase tracking-wider">ì‘ì—…</th>
                                    </tr>
                                </thead>
                                <tbody id="inquiries-table-body" class="bg-white divide-y divide-gray-200">
                                    <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- ë¬¸ì˜ ìƒì„¸ ë° ë‹µë³€ -->
                    <div id="inquiry-detail-section" class="w-full hidden mt-6">
                        <div class="bg-white rounded-xl shadow-lg p-6 mb-4">
                            <div class="mb-4">
                                <h3 class="text-lg font-bold text-gray-800 mb-2">ë¬¸ì˜ ìƒì„¸</h3>
                                <div class="grid grid-cols-2 gap-4 text-sm">
                                    <div><span class="font-semibold">ë¬¸ì˜ë²ˆí˜¸:</span> <span id="inquiry-id"></span></div>
                                    <div><span class="font-semibold">ì œëª©:</span> <span id="inquiry-title"></span></div>
                                    <div><span class="font-semibold">íšŒì›ëª…:</span> <span id="inquiry-username"></span></div>
                                    <div><span class="font-semibold">ì´ë©”ì¼:</span> <span id="inquiry-email"></span></div>
                                    <div><span class="font-semibold">ì „í™”ë²ˆí˜¸:</span> <span id="inquiry-phone"></span></div>
                                    <div><span class="font-semibold">ë¬¸ì˜ì¼ì‹œ:</span> <span id="inquiry-date"></span></div>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <h4 class="font-semibold text-gray-700 mb-2">ë¬¸ì˜ ë‚´ìš©</h4>
                                <div id="inquiry-content" class="bg-gray-50 p-4 rounded-lg text-gray-700"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- íšŒì› ê´€ë¦¬ ì„¹ì…˜ -->
                <div id="members-section" class="section-content p-8 hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">ğŸ‘¥ íšŒì› ê´€ë¦¬</h2>
                        <div class="flex gap-2">
                            <button onclick="cleanupDuplicateUsers().then(count => { alert(`ì¤‘ë³µ ì‚¬ìš©ì ${count}ëª…ì´ ì •ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.`); setTimeout(() => subscribeToUsers(), 1000); })" class="px-4 py-2 bg-red-500 text-white rounded-lg font-semibold hover:bg-red-600 transition">
                                ğŸ§¹ ì¤‘ë³µ ì‚¬ìš©ì ì •ë¦¬
                            </button>
                            <button onclick="deleteSpecificUser('email_etgbajy_gmail_com').then(() => recreateCorrectUser())" class="px-4 py-2 bg-purple-500 text-white rounded-lg font-semibold hover:bg-purple-600 transition">
                                ğŸ—‘ï¸ ì˜ëª»ëœ ë¬¸ì„œ ì‚­ì œ í›„ ì˜¬ë°”ë¥¸ ë¬¸ì„œ ìƒì„±
                            </button>
                            <button onclick="loadLocalStorageUsers()" class="px-4 py-2 bg-orange-500 text-white rounded-lg font-semibold hover:bg-orange-600 transition">
                                ğŸ”„ localStorage ìƒˆë¡œê³ ì¹¨
                            </button>
                            <button onclick="goToPage('index.html')" class="px-4 py-2 bg-blue-500 text-white rounded-lg font-semibold hover:bg-blue-600 transition">
                                ğŸ  ë©”ì¸í˜ì´ì§€ë¡œ
                            </button>
                            <button onclick="goToPage('member-dashboard.html')" class="px-4 py-2 bg-green-500 text-white rounded-lg font-semibold hover:bg-green-600 transition">
                                ğŸ‘¤ íšŒì›ëŒ€ì‹œë³´ë“œë¡œ
                            </button>
                        </div>
                    </div>
                    
                    <!-- íšŒì› í†µê³„ -->
                    <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">ğŸ“Š íšŒì› í†µê³„</h3>
                        <div id="member-stats" class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                            <div class="text-center">
                                <div class="font-bold text-lg text-blue-600">0</div>
                                <div class="text-gray-600">ì¹´ì¹´ì˜¤í†¡</div>
                            </div>
                            <div class="text-center">
                                <div class="font-bold text-lg text-green-600">0</div>
                                <div class="text-gray-600">ì´ë©”ì¼</div>
                            </div>
                            <div class="text-center">
                                <div class="font-bold text-lg text-purple-600">0</div>
                                <div class="text-gray-600">Firebase</div>
                            </div>
                            <div class="text-center">
                                <div class="font-bold text-lg text-orange-600">0</div>
                                <div class="text-gray-600">localStorage</div>
                            </div>
                        </div>
                    </div>

                    <!-- íšŒì› ëª©ë¡ -->
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-green-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-green-700 uppercase tracking-wider">í”„ë¡œí•„</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-green-700 uppercase tracking-wider">íšŒì›ëª…</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-green-700 uppercase tracking-wider">ë¡œê·¸ì¸ ë°©ì‹</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-green-700 uppercase tracking-wider">ì´ë©”ì¼</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-green-700 uppercase tracking-wider">íœ´ëŒ€í°</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-green-700 uppercase tracking-wider">ê°€ì…ì¼</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-green-700 uppercase tracking-wider">ì—…ë°ì´íŠ¸</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-green-700 uppercase tracking-wider">ë°ì´í„° ì†ŒìŠ¤</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-green-700 uppercase tracking-wider">ì‘ì—…</th>
                                    </tr>
                                </thead>
                                <tbody id="members-table-body" class="bg-white divide-y divide-gray-200">
                                    <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- í›„ê¸° ê´€ë¦¬ ì„¹ì…˜ -->
                <div id="reviews-section" class="section-content p-8 hidden">
                    <div class="flex justify-between items-center mb-8">
                        <div>
                            <h2 class="text-3xl font-bold text-gray-800 mb-2">â­ í›„ê¸° ê´€ë¦¬</h2>
                            <p class="text-gray-600">ê³ ê° í›„ê¸°ë¥¼ ê´€ë¦¬í•˜ê³  ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
                        </div>
                        <div class="flex gap-3">
                            <button onclick="loadReviewsData()" class="px-4 py-2 bg-blue-500 text-white rounded-lg font-semibold hover:bg-blue-600 transition">
                                ğŸ”„ ìƒˆë¡œê³ ì¹¨
                            </button>
                            <a href="reviews.html" target="_blank" class="px-4 py-2 bg-green-500 text-white rounded-lg font-semibold hover:bg-green-600 transition">
                                ğŸ‘ï¸ í›„ê¸° í˜ì´ì§€ ë³´ê¸°
                            </a>
                            <button onclick="updateRequestReviewAgree('PH-20250926982')" class="px-4 py-2 bg-purple-500 text-white rounded-lg font-semibold hover:bg-purple-600 transition" title="ì˜ë¢°ë²ˆí˜¸ PH-20250926982ì˜ í›„ê¸° ë™ì˜ ìƒíƒœë¥¼ trueë¡œ ë³€ê²½">
                                ğŸ”§ ì˜ë¢° í›„ê¸°ë™ì˜ ì—…ë°ì´íŠ¸
                            </button>
                        </div>
                    </div>

                    <!-- í†µê³„ ì¹´ë“œ -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <div class="text-3xl font-bold text-blue-600" id="reviews-total">0</div>
                            <div class="text-gray-600 mt-2">ì „ì²´ í›„ê¸°</div>
                                </div>
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <div class="text-3xl font-bold text-green-600" id="reviews-approved">0</div>
                            <div class="text-gray-600 mt-2">ìŠ¹ì¸ëœ í›„ê¸°</div>
                            </div>
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <div class="text-3xl font-bold text-yellow-600" id="reviews-pending">0</div>
                            <div class="text-gray-600 mt-2">ëŒ€ê¸° ì¤‘</div>
                        </div>
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <div class="text-3xl font-bold text-purple-600" id="reviews-avg-rating">0</div>
                            <div class="text-gray-600 mt-2">í‰ê·  í‰ì </div>
                        </div>
                    </div>

                    <!-- í•„í„° ë° ê²€ìƒ‰ -->
                    <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                        <div class="flex flex-wrap gap-4 items-center">
                            <div class="flex-1 min-w-[200px]">
                                <input type="text" id="review-search" placeholder="ì œí’ˆëª…, ì‘ì„±ìëª…, í›„ê¸° ë‚´ìš© ê²€ìƒ‰..." 
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                            </div>
                            <select id="review-status-filter" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                                <option value="all">ì „ì²´</option>
                                    <option value="approved">ìŠ¹ì¸ë¨</option>
                                    <option value="pending">ëŒ€ê¸° ì¤‘</option>
                                </select>
                            <button onclick="clearReviewFilters()" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition">
                                í•„í„° ì´ˆê¸°í™”
                                </button>
                        </div>
                    </div>

                    <!-- í›„ê¸° ëª©ë¡ í…Œì´ë¸” -->
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-purple-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-purple-700 uppercase tracking-wider">ì œí’ˆëª…</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-purple-700 uppercase tracking-wider">ì‘ì„±ì</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-purple-700 uppercase tracking-wider">ê°€ê²© ì •ë³´</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-purple-700 uppercase tracking-wider">í‰ì </th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-purple-700 uppercase tracking-wider">ìƒíƒœ</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-purple-700 uppercase tracking-wider">ë“±ë¡ì¼</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-purple-700 uppercase tracking-wider">ì‘ì—…</th>
                                    </tr>
                                </thead>
                                <tbody id="reviews-table-body" class="bg-white divide-y divide-gray-200">
                                    <tr>
                                        <td colspan="7" class="px-6 py-8 text-center text-gray-500">
                                            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"></div>
                                            <p class="mt-2">í›„ê¸°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- ì ˆì•½ì™• ê´€ë¦¬ ì„¹ì…˜ -->
                <div id="savings-king-section" class="section-content p-8 hidden">
                    <!-- í—¤ë” -->
                    <div class="flex justify-between items-center mb-8">
                        <div>
                            <h2 class="text-3xl font-bold text-gray-800 mb-2">ğŸ† ì ˆì•½ì™• ê´€ë¦¬</h2>
                            <p class="text-gray-600">ì´ë²ˆ ì£¼ ì ˆì•½ì™• ì •ë³´ë¥¼ ê´€ë¦¬í•˜ê³  ìˆ˜ì •í•˜ì„¸ìš”</p>
                        </div>
                        <div class="flex gap-3">
                            <button onclick="previewSavingsKing()" class="px-4 py-2 bg-blue-500 text-white rounded-lg font-semibold hover:bg-blue-600 transition">
                                ğŸ‘ï¸ ë¯¸ë¦¬ë³´ê¸°
                            </button>
                            <button onclick="resetSavingsKing()" class="px-4 py-2 bg-gray-500 text-white rounded-lg font-semibold hover:bg-gray-600 transition">
                                ğŸ”„ ì´ˆê¸°í™”
                            </button>
                        </div>
                    </div>

                    <!-- í˜„ì¬ ì ˆì•½ì™• ì •ë³´ -->
                    <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ“Š í˜„ì¬ ì ˆì•½ì™• ì •ë³´</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ì¸ë„¤ì¼ ì´ë¯¸ì§€ URL</label>
                                    <input type="url" id="savings-king-image" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent" placeholder="https://example.com/image.jpg" oninput="updateSavingsKingPreview()">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ì ˆì•½ì™• ì´ë¦„</label>
                                    <input type="text" id="savings-king-name" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent" placeholder="ê¹€ë¯¼ìˆ˜" oninput="updateSavingsKingPreview()">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ë‚˜ì´ëŒ€</label>
                                    <select id="savings-king-age" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent" onchange="updateSavingsKingPreview()">
                                        <option value="10ëŒ€">10ëŒ€</option>
                                        <option value="20ëŒ€">20ëŒ€</option>
                                        <option value="30ëŒ€" selected>30ëŒ€</option>
                                        <option value="40ëŒ€">40ëŒ€</option>
                                        <option value="50ëŒ€">50ëŒ€</option>
                                        <option value="60ëŒ€ ì´ìƒ">60ëŒ€ ì´ìƒ</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ì§ì—…</label>
                                    <select id="savings-king-job" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent" onchange="updateSavingsKingPreview()">
                                        <option value="í•™ìƒ">í•™ìƒ</option>
                                        <option value="ëŒ€í•™ìƒ">ëŒ€í•™ìƒ</option>
                                        <option value="ì§ì¥ì¸" selected>ì§ì¥ì¸</option>
                                        <option value="ì‚¬ì—…ì">ì‚¬ì—…ì</option>
                                        <option value="ì£¼ë¶€">ì£¼ë¶€</option>
                                        <option value="ê³µë¬´ì›">ê³µë¬´ì›</option>
                                        <option value="ê°œë°œì">ê°œë°œì</option>
                                        <option value="ë””ìì´ë„ˆ">ë””ìì´ë„ˆ</option>
                                        <option value="ë§ˆì¼€í„°">ë§ˆì¼€í„°</option>
                                        <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ì œí’ˆëª…</label>
                                    <input type="text" id="savings-king-product" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent" placeholder="ëª¨ë“ˆì‡¼íŒŒ" oninput="updateSavingsKingPreview()">
                                </div>
                            </div>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ì˜ë¢° ê°€ê²© (ì›)</label>
                                    <input type="number" id="savings-king-original-price" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent" placeholder="1000000" oninput="updateSavingsKingPreview()">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ì ˆê°ëœ ê°€ê²© (ì›)</label>
                                    <input type="number" id="savings-king-final-price" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent" placeholder="580000" oninput="updateSavingsKingPreview()">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ì ˆì•½ ê¸ˆì•¡ (ì›)</label>
                                    <input type="number" id="savings-king-amount" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent" placeholder="420000" oninput="updateSavingsKingPreview()" readonly>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ì ˆì•½ìœ¨ (%)</label>
                                    <input type="number" id="savings-king-rate" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent" placeholder="42" min="0" max="100" oninput="updateSavingsKingPreview()" readonly>
                                </div>
                            </div>
                        </div>
                        <div class="mt-6 flex justify-between">
                            <button onclick="testFirebaseConnection()" class="px-4 py-2 bg-blue-500 text-white rounded-lg font-medium hover:bg-blue-600 transition">
                                ğŸ”§ Firebase ì—°ê²° í…ŒìŠ¤íŠ¸
                            </button>
                            <button onclick="saveSavingsKing()" class="px-6 py-3 bg-pink-600 text-white rounded-lg font-semibold hover:bg-pink-700 transition">
                                ğŸ’¾ ì €ì¥í•˜ê¸°
                            </button>
                        </div>
                    </div>

                    <!-- ë¯¸ë¦¬ë³´ê¸° ì„¹ì…˜ -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ‘ï¸ ë¯¸ë¦¬ë³´ê¸°</h3>
                        <div class="flex justify-center">
                            <div id="savings-king-preview" class="bg-gradient-to-r from-emerald-500 to-blue-500 text-white rounded-full shadow-lg">
                                <div class="flex items-center gap-3 px-6 py-3 font-semibold text-sm">
                                    <span class="text-2xl">ğŸ†</span>
                                    <div class="text-left">
                                        <div class="font-bold">ì´ë²ˆ ì£¼ ì ˆê°ì™•</div>
                                        <div class="text-yellow-300 text-xs">-42% ì ˆì•½ ì„±ê³µ!</div>
                                    </div>
                                    <a href="#savings-hero" class="text-yellow-300 text-lg hover:text-yellow-200 transition-colors">â†’</a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ë¡œê·¸ í‘œì‹œ ì„¹ì…˜ -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-bold text-gray-800">ğŸ“‹ ìµœê·¼ ë¡œê·¸</h3>
                            <button onclick="clearSavingsKingLogs()" class="px-3 py-1 bg-gray-500 text-white text-sm rounded hover:bg-gray-600 transition">
                                ğŸ—‘ï¸ ë¡œê·¸ ì§€ìš°ê¸°
                            </button>
                        </div>
                        <div id="savings-king-logs" class="bg-gray-50 rounded-lg p-4 h-48 overflow-y-auto font-mono text-sm">
                            <div class="text-gray-500">ë¡œê·¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</div>
                        </div>
                    </div>
                </div>

                <!-- ë°©ë¬¸ì ë¦¬í¬íŠ¸ ì„¹ì…˜ -->
                <div id="visitors-section" class="section-content p-8 hidden">
                    <div class="flex justify-between items-center mb-6">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-800">ğŸ“ˆ ë°©ë¬¸ì ë¦¬í¬íŠ¸</h2>
                            <p id="data-range-info" class="text-sm text-gray-500 mt-1">ë°ì´í„° ë¡œë”© ì¤‘...</p>
                        </div>
                        <button onclick="refreshVisitorData()" class="px-4 py-2 bg-blue-500 text-white rounded-lg font-semibold hover:bg-blue-600 transition">
                            ğŸ”„ ìƒˆë¡œê³ ì¹¨
                        </button>
                    </div>

                    <!-- ê¸°ê°„ ì„ íƒ íƒ­ -->
                    <div class="mb-6">
                        <div class="flex gap-2 border-b border-gray-200 mb-4">
                            <button onclick="loadVisitorReport('daily')" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:text-pink-600 transition active" data-period="daily">
                                ğŸ“… ì¼ì¼ ë¦¬í¬íŠ¸
                            </button>
                            <button onclick="loadVisitorReport('weekly')" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:text-pink-600 transition" data-period="weekly">
                                ğŸ“† ì£¼ê°„ ë¦¬í¬íŠ¸
                            </button>
                            <button onclick="loadVisitorReport('monthly')" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:text-pink-600 transition" data-period="monthly">
                                ğŸ“Š ì›”ê°„ ë¦¬í¬íŠ¸
                            </button>
                            <button onclick="loadVisitorReport('custom')" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:text-pink-600 transition" data-period="custom">
                                ğŸ—“ï¸ ê¸°ê°„ ì„ íƒ
                            </button>
                            <button onclick="loadVisitorReport('all')" class="tab-btn px-6 py-3 font-semibold text-gray-700 hover:text-pink-600 transition" data-period="all">
                                ğŸ“ˆ ì „ì²´ ê¸°ê°„
                            </button>
                        </div>
                        
                        <!-- ì‚¬ìš©ì ì •ì˜ ë‚ ì§œ ë²”ìœ„ ì„ íƒ -->
                        <div id="custom-date-range" class="hidden bg-gray-50 rounded-lg p-4 mb-4">
                            <div class="flex flex-wrap items-center gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">ì‹œì‘ì¼</label>
                                    <input type="date" id="start-date" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">ì¢…ë£Œì¼</label>
                                    <input type="date" id="end-date" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                                </div>
                                <div class="flex items-end">
                                    <button onclick="loadCustomDateRange()" class="px-4 py-2 bg-pink-600 text-white rounded-lg font-semibold hover:bg-pink-700 transition">
                                        ğŸ” ì¡°íšŒ
                                    </button>
                                </div>
                                <div class="flex items-end">
                                    <button onclick="setQuickDateRange('last30')" class="px-3 py-2 bg-gray-200 text-gray-700 rounded-lg text-sm hover:bg-gray-300 transition">
                                        ìµœê·¼ 30ì¼
                                    </button>
                                </div>
                                <div class="flex items-end">
                                    <button onclick="setQuickDateRange('last90')" class="px-3 py-2 bg-gray-200 text-gray-700 rounded-lg text-sm hover:bg-gray-300 transition">
                                        ìµœê·¼ 90ì¼
                                    </button>
                                </div>
                                <div class="flex items-end">
                                    <button onclick="setQuickDateRange('lastYear')" class="px-3 py-2 bg-gray-200 text-gray-700 rounded-lg text-sm hover:bg-gray-300 transition">
                                        ìµœê·¼ 1ë…„
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- í†µê³„ ì¹´ë“œ -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <div class="flex items-center">
                                <div class="p-3 bg-blue-100 rounded-lg">
                                    <span class="text-2xl">ğŸ‘¥</span>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm text-gray-500">ì´ ë°©ë¬¸ì</p>
                                    <p class="text-2xl font-bold text-gray-800" id="total-visitors-count">0</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <div class="flex items-center">
                                <div class="p-3 bg-green-100 rounded-lg">
                                    <span class="text-2xl">ğŸ”„</span>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm text-gray-500">ì´ ë°©ë¬¸ ìˆ˜</p>
                                    <p class="text-2xl font-bold text-gray-800" id="total-visits-count">0</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <div class="flex items-center">
                                <div class="p-3 bg-orange-100 rounded-lg">
                                    <span class="text-2xl">ğŸ“ˆ</span>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm text-gray-500">í‰ê·  ë°©ë¬¸ì</p>
                                    <p class="text-2xl font-bold text-gray-800" id="avg-visitors-count">0</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <div class="flex items-center">
                                <div class="p-3 bg-purple-100 rounded-lg">
                                    <span class="text-2xl">ğŸ“Š</span>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm text-gray-500">ìµœëŒ€ ë°©ë¬¸ì</p>
                                    <p class="text-2xl font-bold text-gray-800" id="max-visitors-count">0</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ì°¨íŠ¸ ì˜ì—­ -->
                    <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4" id="chart-title">ì¼ì¼ ë°©ë¬¸ì ì¶”ì´</h3>
                        <div class="relative" style="height: 400px;">
                            <canvas id="visitor-chart"></canvas>
                        </div>
                    </div>

                    <!-- ìƒì„¸ ë°ì´í„° í…Œì´ë¸” -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">ìƒì„¸ ë°ì´í„°</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ê¸°ê°„</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ë°©ë¬¸ì ìˆ˜</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ë°©ë¬¸ ìˆ˜</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ê³ ìœ  ë°©ë¬¸ì</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ë¹„ìœ¨</th>
                                    </tr>
                                </thead>
                                <tbody id="visitor-data-table" class="bg-white divide-y divide-gray-200">
                                    <tr>
                                        <td colspan="5" class="px-4 py-8 text-center text-gray-500">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ì‚¬ìš©ì ìƒì„¸ë³´ê¸° ëª¨ë‹¬ -->
    <div id="user-detail-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden" role="dialog" aria-modal="true" aria-labelledby="user-detail-modal-title">
        <div class="bg-white rounded-2xl shadow-2xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto relative">
            <button id="close-user-detail" class="absolute top-3 right-3 text-gray-400 hover:text-gray-700 text-2xl" aria-label="ì‚¬ìš©ì ìƒì„¸ë³´ê¸° ë‹«ê¸°">&times;</button>
            <h2 id="user-detail-modal-title" class="text-2xl font-bold text-center mb-6 text-gray-700">ğŸ‘¤ íšŒì› ìƒì„¸ì •ë³´</h2>
            
            <div id="user-detail-content" class="space-y-6">
                <!-- ì‚¬ìš©ì ì •ë³´ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
            </div>
            
            <div class="mt-6 flex justify-end gap-3">
                <button id="edit-user-btn" class="px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition">
                    âœï¸ ì •ë³´ ìˆ˜ì •
                </button>
                <button id="delete-user-btn" class="px-4 py-2 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700 transition">
                    ğŸ—‘ï¸ íšŒì› ì‚­ì œ
                </button>
                <button id="close-user-detail-btn" class="px-4 py-2 bg-gray-500 text-white rounded-lg font-semibold hover:bg-gray-600 transition">
                    ë‹«ê¸°
                </button>
            </div>
        </div>
    </div>

    <!-- í›„ê¸° ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ (ì‚­ì œë¨) -->

    <script>
        // ì‚¬ì´ë“œë°” í´ë¦­ ì´ë²¤íŠ¸
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.addEventListener('click', function() {
                    const section = this.getAttribute('data-section');
                    switchSection(section);
                });
            });
        });
    </script>

    <!-- ê´€ë¦¬ììš© ì˜ë¢° ìƒì„¸ë³´ê¸° ëª¨ë‹¬ -->
    <div id="admin-request-detail-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-2xl shadow-2xl max-w-5xl w-full max-h-[90vh] overflow-y-auto">
                <!-- ëª¨ë‹¬ í—¤ë” -->
                <div class="sticky top-0 bg-white border-b border-gray-200 p-6 rounded-t-2xl">
                    <div class="flex justify-between items-center">
                        <h2 class="text-2xl font-bold text-gray-800">ğŸ“‹ ì˜ë¢° ìƒì„¸ ì •ë³´ (ê´€ë¦¬ì)</h2>
                        <button id="close-admin-request-modal" class="text-gray-500 hover:text-gray-700 text-3xl font-bold">&times;</button>
                    </div>
                </div>
                
                <!-- ëª¨ë‹¬ ë‚´ìš© -->
                <div class="p-6">
                    <!-- ì˜ë¢° ê¸°ë³¸ ì •ë³´ -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                            ğŸ“ ì˜ë¢° ê¸°ë³¸ ì •ë³´
                        </h3>
                        <div class="bg-blue-50 rounded-lg p-4 border-l-4 border-blue-500">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                <div><span class="font-semibold text-gray-700">ì˜ë¢°ë²ˆí˜¸:</span> <span id="admin-modal-request-number" class="text-blue-600"></span></div>
                                <div><span class="font-semibold text-gray-700">ì˜ë¢°ì¼ì‹œ:</span> <span id="admin-modal-request-date" class="text-blue-600"></span></div>
                                <div><span class="font-semibold text-gray-700">ì œí’ˆëª…:</span> <span id="admin-modal-product-name" class="text-blue-600"></span></div>
                                <div><span class="font-semibold text-gray-700">ìš”ì²­ê°€:</span> <span id="admin-modal-original-price" class="text-blue-600"></span></div>
                                <div><span class="font-semibold text-gray-700">ìƒíƒœ:</span> <span id="admin-modal-status" class="px-2 py-1 rounded-full text-xs font-bold text-white"></span></div>
                                <div><span class="font-semibold text-gray-700">ì§„í–‰ë¥ :</span> <span id="admin-modal-progress" class="text-blue-600"></span></div>
                            </div>
                        </div>
                    </div>

                    <!-- ì œí’ˆ ìƒì„¸ ì •ë³´ -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                            ğŸ›ï¸ ì œí’ˆ ìƒì„¸ ì •ë³´
                        </h3>
                        <div class="bg-green-50 rounded-lg p-4 border-l-4 border-green-500">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                <div><span class="font-semibold text-gray-700">ë¸Œëœë“œ:</span> <span id="admin-modal-brand" class="text-green-600"></span></div>
                                <div><span class="font-semibold text-gray-700">ëª¨ë¸ëª…:</span> <span id="admin-modal-model" class="text-green-600"></span></div>
                                <div><span class="font-semibold text-gray-700">ì¹´í…Œê³ ë¦¬:</span> <span id="admin-modal-category" class="text-green-600"></span></div>
                                <div><span class="font-semibold text-gray-700">ìˆ˜ëŸ‰:</span> <span id="admin-modal-quantity" class="text-green-600"></span></div>
                                <div class="md:col-span-2"><span class="font-semibold text-gray-700">ì œí’ˆ ì„¤ëª…:</span> <span id="admin-modal-description" class="text-green-600"></span></div>
                                <div class="md:col-span-2"><span class="font-semibold text-gray-700">ì°¸ê³  URL:</span> <span id="admin-modal-urls" class="text-green-600"></span></div>
                            </div>
                        </div>
                    </div>

                    <!-- ì²¨ë¶€ ì´ë¯¸ì§€ -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                            ğŸ“¸ ì²¨ë¶€ ì´ë¯¸ì§€
                        </h3>
                        <div id="admin-modal-images" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <!-- ì´ë¯¸ì§€ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                        </div>
                    </div>

                    <!-- íšŒì› ì •ë³´ -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                            ğŸ‘¤ íšŒì› ì •ë³´
                        </h3>
                        <div class="bg-yellow-50 rounded-lg p-4 border-l-4 border-yellow-500">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                <div><span class="font-semibold text-gray-700">ì´ë¦„:</span> <span id="admin-modal-user-name" class="text-yellow-600"></span></div>
                                <div><span class="font-semibold text-gray-700">ì´ë©”ì¼:</span> <span id="admin-modal-user-email" class="text-yellow-600"></span></div>
                                <div><span class="font-semibold text-gray-700">íœ´ëŒ€í°:</span> <span id="admin-modal-user-phone" class="text-yellow-600"></span></div>
                                <div><span class="font-semibold text-gray-700">ì¹´ì¹´ì˜¤ID:</span> <span id="admin-modal-user-kakao" class="text-yellow-600"></span></div>
                            </div>
                        </div>
                    </div>

                    <!-- ì¶”ê°€ ìš”ì²­ì‚¬í•­ -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                            ğŸ’¬ ì¶”ê°€ ìš”ì²­ì‚¬í•­
                        </h3>
                        <div class="bg-purple-50 rounded-lg p-4 border-l-4 border-purple-500">
                            <div class="text-sm">
                                <span class="font-semibold text-gray-700">íŠ¹ë³„ ìš”ì²­:</span> <span id="admin-modal-special-request" class="text-purple-600"></span>
                            </div>
                        </div>
                    </div>

                    <!-- ê´€ë¦¬ì ì•¡ì…˜ -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                            âš™ï¸ ê´€ë¦¬ì ì•¡ì…˜
                        </h3>
                        <div class="bg-red-50 rounded-lg p-4 border-l-4 border-red-500">
                            <div class="flex flex-wrap gap-3">
                                <button onclick="updateRequestStatusFromModal()" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition">
                                    ìƒíƒœ ì—…ë°ì´íŠ¸
                                </button>
                                <button onclick="deleteRequestFromModal()" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition">
                                    ì˜ë¢° ì‚­ì œ
                                </button>
                                <button onclick="exportRequestData()" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition">
                                    ë°ì´í„° ë‚´ë³´ë‚´ê¸°
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- ê´€ë¦¬ì ë‹µë³€ ì‘ì„± -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                            ğŸ’¬ ê´€ë¦¬ì ë‹µë³€ ì‘ì„±
                        </h3>
                        <div class="bg-indigo-50 rounded-lg p-6 border-l-4 border-indigo-500">
                            <form id="admin-response-form" class="space-y-4">
                                <!-- ê°€ê²© ì •ë³´ -->
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ’° ì°¾ì€ ìµœì €ê°€</label>
                                        <input type="text" id="response-lowest-price" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none" placeholder="ì˜ˆ: 15,000ì›">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">ğŸª íŒë§¤ì—…ì²´</label>
                                        <input type="text" id="response-seller" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none" placeholder="ì˜ˆ: ì¿ íŒ¡, ë„¤ì´ë²„ì‡¼í•‘">
                                    </div>
                                </div>

                                <!-- ë§í¬ ì •ë³´ -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ”— íŒë§¤ ë§í¬</label>
                                    <input type="url" id="response-seller-link" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none" placeholder="https://...">
                                </div>

                                <!-- ë°°ì†¡ ì •ë³´ -->
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">ğŸšš ë°°ì†¡ë¹„</label>
                                        <input type="text" id="response-shipping-cost" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none" placeholder="ì˜ˆ: 2,500ì› (ë¬´ë£Œë°°ì†¡)">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">â° ë°°ì†¡ê¸°ê°„</label>
                                        <input type="text" id="response-shipping-time" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none" placeholder="ì˜ˆ: 1-2ì¼">
                                    </div>
                                </div>

                                <!-- ì´ ë¹„ìš© -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ’³ ì´ êµ¬ë§¤ë¹„ìš©</label>
                                    <input type="text" id="response-total-cost" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none" placeholder="ì˜ˆ: 17,500ì›">
                                </div>

                                <!-- ì¶”ê°€ ì •ë³´ -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ“ ì¶”ê°€ ì •ë³´ ë° ì¶”ì²œì‚¬ìœ </label>
                                    <textarea id="response-additional-info" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none" placeholder="ì¶”ê°€ë¡œ ì•Œë ¤ë“œë¦´ ì •ë³´ë‚˜ ì¶”ì²œ ì‚¬ìœ ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”..."></textarea>
                                </div>

                                <!-- ë²„íŠ¼ë“¤ -->
                                <div class="flex gap-3 pt-4">
                                    <button type="submit" class="px-6 py-2 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 transition font-medium">
                                        ë‹µë³€ ì €ì¥
                                    </button>
                                    <button type="button" onclick="clearResponseForm()" class="px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition font-medium">
                                        ë‚´ìš© ì§€ìš°ê¸°
                                    </button>
                                    <button type="button" onclick="previewResponse()" class="px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition font-medium">
                                        ë¯¸ë¦¬ë³´ê¸°
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- ê´€ë¦¬ì ë‹µë³€ (ìˆëŠ” ê²½ìš°) -->
                    <div id="admin-modal-admin-response" class="mb-6 hidden">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                            ğŸ’¼ ê´€ë¦¬ì ë‹µë³€
                        </h3>
                        <div class="bg-gray-50 rounded-lg p-4 border-l-4 border-gray-500">
                            <div class="text-sm">
                                <div class="mb-2"><span class="font-semibold text-gray-700">ë‹µë³€ì¼ì‹œ:</span> <span id="admin-modal-response-date" class="text-gray-600"></span></div>
                                <div><span class="font-semibold text-gray-700">ë‹µë³€ë‚´ìš©:</span> <span id="admin-modal-response-content" class="text-gray-600"></span></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ê´€ë¦¬ììš© ì˜ë¢° ìƒì„¸ë³´ê¸° ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜ë“¤ -->
    <script>
        // ê´€ë¦¬ììš© ì˜ë¢° ìƒì„¸ë³´ê¸° ëª¨ë‹¬ í‘œì‹œ
        function showAdminRequestDetailModal(request) {
            console.log('ê´€ë¦¬ììš© ì˜ë¢° ìƒì„¸ë³´ê¸° ëª¨ë‹¬ í‘œì‹œ:', request);
            
            // ëª¨ë‹¬ ë°ì´í„° ì±„ìš°ê¸°
            fillAdminRequestDetailModal(request);
            
            // ëª¨ë‹¬ í‘œì‹œ
            document.getElementById('admin-request-detail-modal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        // ê´€ë¦¬ììš© ëª¨ë‹¬ ë°ì´í„° ì±„ìš°ê¸°
        function fillAdminRequestDetailModal(request) {
            // ì˜ë¢° ê¸°ë³¸ ì •ë³´
            document.getElementById('admin-modal-request-number').textContent = request.reqNum || request.requestNumber || 'N/A';
            document.getElementById('admin-modal-request-date').textContent = request.reqDate ? new Date(request.reqDate).toLocaleString('ko-KR') : 'N/A';
            document.getElementById('admin-modal-product-name').textContent = request.productName || request.name || 'N/A';
            document.getElementById('admin-modal-original-price').textContent = formatPrice(request.originalPrice || request.price);
            
            // ìƒíƒœ ë° ì§„í–‰ë¥ 
            const status = request.status || 'ì²˜ë¦¬ì¤‘';
            const statusElement = document.getElementById('admin-modal-status');
            statusElement.textContent = status;
            statusElement.className = 'px-2 py-1 rounded-full text-xs font-bold text-white ' + getAdminStatusClass(status);
            
            document.getElementById('admin-modal-progress').textContent = request.progress || '0%';

            // ì œí’ˆ ìƒì„¸ ì •ë³´
            document.getElementById('admin-modal-brand').textContent = request.brand || 'N/A';
            document.getElementById('admin-modal-model').textContent = request.model || 'N/A';
            document.getElementById('admin-modal-category').textContent = request.category || 'N/A';
            document.getElementById('admin-modal-quantity').textContent = request.quantity || '1';
            document.getElementById('admin-modal-description').textContent = request.description || request.productDescription || 'N/A';
            
            // ì°¸ê³  URL
            const urls = request.urls || [];
            document.getElementById('admin-modal-urls').innerHTML = urls.map(url => 
                `<a href="${url}" target="_blank" class="text-blue-600 hover:underline break-all">${url}</a>`
            ).join('<br>') || 'N/A';

            // ì²¨ë¶€ ì´ë¯¸ì§€
            displayAdminModalImages(request.images || request.attachedImages || []);

            // íšŒì› ì •ë³´
            document.getElementById('admin-modal-user-name').textContent = request.userName || request.name || 'N/A';
            document.getElementById('admin-modal-user-email').textContent = request.email || 'N/A';
            document.getElementById('admin-modal-user-phone').textContent = request.userPhone || request.phone || 'N/A';
            document.getElementById('admin-modal-user-kakao').textContent = request.userKakao || request.kakao || 'N/A';

            // ì¶”ê°€ ìš”ì²­ì‚¬í•­
            document.getElementById('admin-modal-special-request').textContent = request.specialRequest || request.additionalRequest || 'N/A';

            // ê¸°ì¡´ ë‹µë³€ì„ í¼ì— ì±„ìš°ê¸°
            loadExistingResponseToForm(request);

            // ê´€ë¦¬ì ë‹µë³€ (ìˆëŠ” ê²½ìš°)
            if (request.adminResponse || request.response) {
                document.getElementById('admin-modal-admin-response').classList.remove('hidden');
                document.getElementById('admin-modal-response-date').textContent = request.responseDate ? new Date(request.responseDate).toLocaleString('ko-KR') : 'N/A';
                
                // ë‹µë³€ì´ êµ¬ì¡°í™”ëœ ë°ì´í„°ì¸ì§€ í™•ì¸
                if (typeof request.adminResponse === 'object' && request.adminResponse !== null) {
                    document.getElementById('admin-modal-response-content').innerHTML = formatResponseForDisplay(request.adminResponse);
                } else {
                    document.getElementById('admin-modal-response-content').textContent = request.adminResponse || request.response || 'N/A';
                }
            } else {
                document.getElementById('admin-modal-admin-response').classList.add('hidden');
            }
        }

        // ê´€ë¦¬ììš© ìƒíƒœì— ë”°ë¥¸ CSS í´ë˜ìŠ¤ ë°˜í™˜
        function getAdminStatusClass(status) {
            switch(status) {
                case 'ë‹µë³€ì™„ë£Œ': return 'bg-green-500';
                case 'ì™„ë£Œ': return 'bg-green-500';
                case 'ì²˜ë¦¬ì¤‘': return 'bg-yellow-500';
                case 'ëŒ€ê¸°': return 'bg-gray-500';
                case 'ì·¨ì†Œ': return 'bg-red-500';
                default: return 'bg-blue-500';
            }
        }

        // ê´€ë¦¬ììš© ëª¨ë‹¬ì— ì´ë¯¸ì§€ í‘œì‹œ
        function displayAdminModalImages(images) {
            const imagesContainer = document.getElementById('admin-modal-images');
            imagesContainer.innerHTML = '';

            if (!images || images.length === 0) {
                imagesContainer.innerHTML = '<div class="col-span-full text-center text-gray-500 py-8">ì²¨ë¶€ëœ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            images.forEach((image, index) => {
                const imageElement = document.createElement('div');
                imageElement.className = 'relative group';
                
                if (typeof image === 'string') {
                    // Base64 ì´ë¯¸ì§€ ë˜ëŠ” URL
                    imageElement.innerHTML = `
                        <img src="${image}" alt="ì²¨ë¶€ ì´ë¯¸ì§€ ${index + 1}" class="w-full h-48 object-cover rounded-lg shadow-md hover:shadow-lg transition-shadow cursor-pointer" onclick="openAdminImageModal('${image}')">
                        <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all duration-200 rounded-lg flex items-center justify-center">
                            <span class="text-white opacity-0 group-hover:opacity-100 transition-opacity text-sm font-semibold">í´ë¦­í•˜ì—¬ í™•ëŒ€</span>
                        </div>
                    `;
                } else if (image.url) {
                    // ì´ë¯¸ì§€ ê°ì²´
                    imageElement.innerHTML = `
                        <img src="${image.url}" alt="${image.name || 'ì²¨ë¶€ ì´ë¯¸ì§€ ' + (index + 1)}" class="w-full h-48 object-cover rounded-lg shadow-md hover:shadow-lg transition-shadow cursor-pointer" onclick="openAdminImageModal('${image.url}')">
                        <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all duration-200 rounded-lg flex items-center justify-center">
                            <span class="text-white opacity-0 group-hover:opacity-100 transition-opacity text-sm font-semibold">í´ë¦­í•˜ì—¬ í™•ëŒ€</span>
                        </div>
                    `;
                }
                
                imagesContainer.appendChild(imageElement);
            });
        }

        // ê´€ë¦¬ììš© ì´ë¯¸ì§€ í™•ëŒ€ ëª¨ë‹¬
        function openAdminImageModal(imageSrc) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-75 z-60 flex items-center justify-center';
            modal.innerHTML = `
                <div class="relative max-w-4xl max-h-full p-4">
                    <img src="${imageSrc}" alt="í™•ëŒ€ëœ ì´ë¯¸ì§€" class="max-w-full max-h-full object-contain rounded-lg">
                    <button onclick="this.parentElement.parentElement.remove()" class="absolute top-2 right-2 text-white text-3xl font-bold hover:text-gray-300">&times;</button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // ê´€ë¦¬ììš© ëª¨ë‹¬ ë‹«ê¸°
        function closeAdminRequestDetailModal() {
            document.getElementById('admin-request-detail-modal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        // ì „ì—­ ë³€ìˆ˜
        let currentRequestId = null;
        let currentInquiryId = null;

        // ê¸°ì¡´ ë‹µë³€ì„ í¼ì— ì±„ìš°ê¸°
        function loadExistingResponseToForm(request) {
            // ê¸°ì¡´ ë‹µë³€ì´ ìˆëŠ”ì§€ í™•ì¸
            if (request.adminResponse && typeof request.adminResponse === 'object') {
                const response = request.adminResponse;
                
                // ê° í•„ë“œì— ê¸°ì¡´ ê°’ ì±„ìš°ê¸°
                document.getElementById('response-lowest-price').value = response.lowestPrice || '';
                document.getElementById('response-seller').value = response.seller || '';
                document.getElementById('response-seller-link').value = response.sellerLink || '';
                document.getElementById('response-shipping-cost').value = response.shippingCost || '';
                document.getElementById('response-shipping-time').value = response.shippingTime || '';
                document.getElementById('response-total-cost').value = response.totalCost || '';
                document.getElementById('response-additional-info').value = response.additionalInfo || '';
                
                console.log('âœ… ê¸°ì¡´ ë‹µë³€ ë°ì´í„°ë¥¼ í¼ì— ë¡œë“œí–ˆìŠµë‹ˆë‹¤:', response);
            } else {
                // ê¸°ì¡´ ë‹µë³€ì´ ì—†ìœ¼ë©´ í¼ ì´ˆê¸°í™”
                clearResponseForm();
                console.log('ğŸ“ ìƒˆë¡œìš´ ë‹µë³€ì„ ìœ„í•œ í¼ì„ ì´ˆê¸°í™”í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ë‹µë³€ í¼ ì´ˆê¸°í™”
        function clearResponseForm() {
            document.getElementById('response-lowest-price').value = '';
            document.getElementById('response-seller').value = '';
            document.getElementById('response-seller-link').value = '';
            document.getElementById('response-shipping-cost').value = '';
            document.getElementById('response-shipping-time').value = '';
            document.getElementById('response-total-cost').value = '';
            document.getElementById('response-additional-info').value = '';
        }

        // ë‹µë³€ ë¯¸ë¦¬ë³´ê¸°
        function previewResponse() {
            const formData = getResponseFormData();
            if (!formData.lowestPrice && !formData.seller && !formData.additionalInfo) {
                alert('ë¯¸ë¦¬ë³´ê¸°í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const previewModal = document.createElement('div');
            previewModal.className = 'fixed inset-0 bg-black bg-opacity-50 z-60 flex items-center justify-center';
            previewModal.innerHTML = `
                <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-y-auto p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-gray-800">ë‹µë³€ ë¯¸ë¦¬ë³´ê¸°</h3>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                    </div>
                    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-6 border-l-4 border-blue-500">
                        <div class="flex items-center mb-4">
                            <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center mr-3">
                                <span class="text-white font-bold text-lg">P</span>
                            </div>
                            <div>
                                <div class="font-semibold text-gray-800">PriceHunter íŒ€</div>
                                <div class="text-sm text-gray-500">${new Date().toLocaleString('ko-KR')}</div>
                            </div>
                        </div>
                        <div class="bg-white rounded-lg p-4 shadow-sm">
                            ${formatResponseForDisplay(formData)}
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(previewModal);
        }

        // í¼ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        function getResponseFormData() {
            return {
                lowestPrice: document.getElementById('response-lowest-price').value.trim(),
                seller: document.getElementById('response-seller').value.trim(),
                sellerLink: document.getElementById('response-seller-link').value.trim(),
                shippingCost: document.getElementById('response-shipping-cost').value.trim(),
                shippingTime: document.getElementById('response-shipping-time').value.trim(),
                totalCost: document.getElementById('response-total-cost').value.trim(),
                additionalInfo: document.getElementById('response-additional-info').value.trim()
            };
        }

        // ë‹µë³€ ì €ì¥
        async function saveResponse() {
            const formData = getResponseFormData();
            
            if (!formData.lowestPrice && !formData.seller && !formData.additionalInfo) {
                alert('ìµœì†Œí•œ í•˜ë‚˜ì˜ ì •ë³´ëŠ” ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            try {
                await waitForFirebase();
                const { collection, doc, updateDoc, serverTimestamp } = window.firebaseFirestoreFunctions;
                
                // Firebaseì—ì„œ ì˜ë¢° ë¬¸ì„œ ì—…ë°ì´íŠ¸
                const requestRef = doc(collection(window.firebaseDb, 'requests'), currentRequestId);
                await updateDoc(requestRef, {
                    adminResponse: formData,
                    responseDate: serverTimestamp(),
                    status: 'ë‹µë³€ì™„ë£Œ',
                    lastUpdated: serverTimestamp()
                });

                alert('ë‹µë³€ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                
                // ë‹µë³€ ì„¹ì…˜ ì—…ë°ì´íŠ¸
                document.getElementById('admin-modal-admin-response').classList.remove('hidden');
                document.getElementById('admin-modal-response-content').innerHTML = formatResponseForDisplay(formData);
                document.getElementById('admin-modal-response-date').textContent = new Date().toLocaleString('ko-KR');
                
                // ëª¨ë‹¬ì˜ ìƒíƒœ í‘œì‹œë„ ì—…ë°ì´íŠ¸
                const statusElement = document.getElementById('admin-modal-status');
                statusElement.textContent = 'ë‹µë³€ì™„ë£Œ';
                statusElement.className = 'px-2 py-1 rounded-full text-xs font-bold text-white ' + getAdminStatusClass('ë‹µë³€ì™„ë£Œ');
                
                // í¼ ì´ˆê¸°í™”
                clearResponseForm();
                
                // ì˜ë¢° ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                renderRequestList();
                
            } catch (error) {
                console.error('âŒ ë‹µë³€ ì €ì¥ ì‹¤íŒ¨:', error);
                alert('ë‹µë³€ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            }
        }

        // ë‹µë³€ì„ í‘œì‹œìš©ìœ¼ë¡œ í¬ë§·íŒ…
        function formatResponseForDisplay(formData) {
            let html = '<div class="space-y-4">';
            
            if (formData.lowestPrice) {
                html += `
                    <div class="flex items-center p-3 bg-green-50 rounded-lg border-l-4 border-green-500">
                        <span class="text-2xl mr-3">ğŸ’°</span>
                        <div>
                            <div class="font-semibold text-green-800">ì°¾ì€ ìµœì €ê°€</div>
                            <div class="text-green-600 text-lg font-bold">${formData.lowestPrice}</div>
                        </div>
                    </div>
                `;
            }
            
            if (formData.seller) {
                html += `
                    <div class="flex items-center p-3 bg-blue-50 rounded-lg border-l-4 border-blue-500">
                        <span class="text-2xl mr-3">ğŸª</span>
                        <div>
                            <div class="font-semibold text-blue-800">íŒë§¤ì—…ì²´</div>
                            <div class="text-blue-600">${formData.seller}</div>
                        </div>
                    </div>
                `;
            }
            
            if (formData.sellerLink) {
                html += `
                    <div class="flex items-center p-3 bg-purple-50 rounded-lg border-l-4 border-purple-500">
                        <span class="text-2xl mr-3">ğŸ”—</span>
                        <div>
                            <div class="font-semibold text-purple-800">íŒë§¤ ë§í¬</div>
                            <a href="${formData.sellerLink}" target="_blank" class="text-purple-600 hover:underline break-all">${formData.sellerLink}</a>
                        </div>
                    </div>
                `;
            }
            
            if (formData.shippingCost || formData.shippingTime) {
                html += `
                    <div class="flex items-center p-3 bg-yellow-50 rounded-lg border-l-4 border-yellow-500">
                        <span class="text-2xl mr-3">ğŸšš</span>
                        <div>
                            <div class="font-semibold text-yellow-800">ë°°ì†¡ ì •ë³´</div>
                            <div class="text-yellow-600">
                                ${formData.shippingCost ? `ë°°ì†¡ë¹„: ${formData.shippingCost}` : ''}
                                ${formData.shippingCost && formData.shippingTime ? '<br>' : ''}
                                ${formData.shippingTime ? `ë°°ì†¡ê¸°ê°„: ${formData.shippingTime}` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }
            
            if (formData.totalCost) {
                html += `
                    <div class="flex items-center p-3 bg-red-50 rounded-lg border-l-4 border-red-500">
                        <span class="text-2xl mr-3">ğŸ’³</span>
                        <div>
                            <div class="font-semibold text-red-800">ì´ êµ¬ë§¤ë¹„ìš©</div>
                            <div class="text-red-600 text-lg font-bold">${formData.totalCost}</div>
                        </div>
                    </div>
                `;
            }
            
            if (formData.additionalInfo) {
                html += `
                    <div class="p-3 bg-gray-50 rounded-lg border-l-4 border-gray-500">
                        <div class="font-semibold text-gray-800 mb-2">ğŸ“ ì¶”ê°€ ì •ë³´ ë° ì¶”ì²œì‚¬ìœ </div>
                        <div class="text-gray-600 whitespace-pre-wrap">${formData.additionalInfo}</div>
                    </div>
                `;
            }
            
            html += '</div>';
            return html;
        }

        // ê´€ë¦¬ì ì•¡ì…˜ í•¨ìˆ˜ë“¤
        function updateRequestStatusFromModal() {
            const requestNumber = document.getElementById('admin-modal-request-number').textContent;
            const newStatus = prompt('ìƒˆë¡œìš´ ìƒíƒœë¥¼ ì…ë ¥í•˜ì„¸ìš” (ëŒ€ê¸°/ì²˜ë¦¬ì¤‘/ì™„ë£Œ/ì·¨ì†Œ):');
            if (newStatus) {
                // ìƒíƒœ ì—…ë°ì´íŠ¸ ë¡œì§ êµ¬í˜„
                console.log('ìƒíƒœ ì—…ë°ì´íŠ¸:', requestNumber, newStatus);
                alert('ìƒíƒœê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        async function deleteRequestFromModal() {
            if (!currentRequestId) {
                alert('ì˜ë¢° IDë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const requestNumber = document.getElementById('admin-modal-request-number').textContent;
            if (!confirm(`ì˜ë¢° ${requestNumber}ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâš ï¸ ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) {
                return;
            }
            
            try {
                const success = await deleteRequestFromFirebase(currentRequestId);
                if (success) {
                    alert('ì˜ë¢°ê°€ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    closeAdminRequestDetailModal();
                    renderRequestList(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                } else {
                    alert('ì˜ë¢° ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                }
            } catch (error) {
                console.error('ì˜ë¢° ì‚­ì œ ì‹¤íŒ¨:', error);
                alert('ì˜ë¢° ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        function exportRequestData() {
            const requestNumber = document.getElementById('admin-modal-request-number').textContent;
            // ë°ì´í„° ë‚´ë³´ë‚´ê¸° ë¡œì§ êµ¬í˜„
            console.log('ë°ì´í„° ë‚´ë³´ë‚´ê¸°:', requestNumber);
            alert('ë°ì´í„°ê°€ ë‚´ë³´ë‚´ê¸°ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // ê´€ë¦¬ììš© ëª¨ë‹¬ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        document.addEventListener('DOMContentLoaded', function() {
            // ëª¨ë‹¬ ë‹«ê¸° ë²„íŠ¼
            document.getElementById('close-admin-request-modal').addEventListener('click', closeAdminRequestDetailModal);
            
            // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
            document.getElementById('admin-request-detail-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeAdminRequestDetailModal();
                }
            });
            
            // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && !document.getElementById('admin-request-detail-modal').classList.contains('hidden')) {
                    closeAdminRequestDetailModal();
                }
            });

            // ë‹µë³€ í¼ ì œì¶œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.getElementById('admin-response-form').addEventListener('submit', function(e) {
                e.preventDefault();
                saveResponse();
            });
        });

        // ë¬¸ì˜ ìƒì„¸ë³´ê¸° ëª¨ë‹¬ í‘œì‹œ
        function showInquiryDetailModal(inquiry) {
            console.log('ë¬¸ì˜ ìƒì„¸ë³´ê¸° ëª¨ë‹¬ í‘œì‹œ:', inquiry);
            
            // ëª¨ë‹¬ ë°ì´í„° ì±„ìš°ê¸°
            fillInquiryDetailModal(inquiry);
            
            // ëª¨ë‹¬ í‘œì‹œ
            document.getElementById('inquiry-detail-modal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        // ë¬¸ì˜ ëª¨ë‹¬ ë°ì´í„° ì±„ìš°ê¸°
        async function fillInquiryDetailModal(inquiry) {
            // ë¬¸ì˜ ê¸°ë³¸ ì •ë³´
            document.getElementById('inquiry-modal-id').textContent = inquiry.id || 'N/A';
            document.getElementById('inquiry-modal-date').textContent = inquiry.date ? new Date(inquiry.date).toLocaleString('ko-KR') : 'N/A';
            document.getElementById('inquiry-modal-subject').textContent = inquiry.subject || 'N/A';
            document.getElementById('inquiry-modal-message').textContent = inquiry.message || 'N/A';
            
            // ìƒíƒœ
            const status = inquiry.status || 'ëŒ€ê¸°';
            const statusElement = document.getElementById('inquiry-modal-status');
            statusElement.textContent = status;
            statusElement.className = 'px-2 py-1 rounded-full text-xs font-bold text-white ' + getInquiryStatusClass(status);

            // ì²¨ë¶€ íŒŒì¼ í‘œì‹œ
            displayInquiryAttachments(inquiry.file);

            // íšŒì› ì •ë³´
            document.getElementById('inquiry-modal-user-name').textContent = inquiry.name || inquiry.userName || 'N/A';
            document.getElementById('inquiry-modal-user-email').textContent = inquiry.email || 'N/A';
            document.getElementById('inquiry-modal-user-phone').textContent = inquiry.phone || inquiry.userPhone || 'N/A';
            document.getElementById('inquiry-modal-user-kakao').textContent = inquiry.kakao || inquiry.userKakao || 'N/A';

            // ê¸°ì¡´ ë‹µë³€ì„ í¼ì— ì±„ìš°ê¸°
            loadExistingInquiryResponseToForm(inquiry);

            // ê´€ë¦¬ì ë‹µë³€ (ìˆëŠ” ê²½ìš°)
            if (inquiry.adminResponse || inquiry.response) {
                document.getElementById('inquiry-modal-admin-response').classList.remove('hidden');
                document.getElementById('inquiry-modal-response-date').textContent = inquiry.responseDate ? new Date(inquiry.responseDate).toLocaleString('ko-KR') : 'N/A';
                
                // ë‹µë³€ì´ êµ¬ì¡°í™”ëœ ë°ì´í„°ì¸ì§€ í™•ì¸
                if (typeof inquiry.adminResponse === 'object' && inquiry.adminResponse !== null) {
                    document.getElementById('inquiry-modal-response-content').innerHTML = formatInquiryResponseForDisplay(inquiry.adminResponse);
                } else {
                    document.getElementById('inquiry-modal-response-content').textContent = inquiry.adminResponse || inquiry.response || 'N/A';
                }
            } else {
                document.getElementById('inquiry-modal-admin-response').classList.add('hidden');
            }
            
            // ëŒ“ê¸€ ë¡œë“œ ë° í‘œì‹œ
            await loadInquiryComments(inquiry.id);
        }
        
        // ë¬¸ì˜ ëŒ“ê¸€ ë¡œë“œ
        async function loadInquiryComments(inquiryId) {
            try {
                await waitForFirebase();
                const { collection, query, where, getDocs } = window.firebaseFirestoreFunctions;
                const commentsRef = collection(window.firebaseDb, 'inquiryComments');
                
                const commentsQuery = query(
                    commentsRef,
                    where('inquiryId', '==', inquiryId)
                );
                const commentsSnapshot = await getDocs(commentsQuery);
                
                const comments = [];
                commentsSnapshot.forEach(doc => {
                    const data = doc.data();
                    comments.push({
                        author: data.author,
                        text: data.text,
                        date: data.date || (data.createdAt?.seconds ? data.createdAt.seconds * 1000 : Date.now()),
                        email: data.email
                    });
                });
                
                // ë‚ ì§œìˆœ ì •ë ¬
                comments.sort((a, b) => a.date - b.date);
                
                // ëŒ“ê¸€ í‘œì‹œ
                const commentsList = document.getElementById('inquiry-modal-comments-list');
                if (comments.length === 0) {
                    commentsList.innerHTML = '<p class="text-gray-400 text-center py-4">ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                } else {
                    commentsList.innerHTML = comments.map(comment => `
                        <div class="bg-white rounded-lg p-3 border border-emerald-200">
                            <div class="flex items-center justify-between mb-2">
                                <div class="font-semibold text-emerald-700 text-sm">${escapeHtml(comment.author)}</div>
                                <div class="text-gray-400 text-xs">${new Date(comment.date).toLocaleString('ko-KR')}</div>
                            </div>
                            <div class="text-gray-800 text-sm whitespace-pre-wrap">${escapeHtml(comment.text)}</div>
                        </div>
                    `).join('');
                }
                
            } catch (error) {
                console.error('âŒ ëŒ“ê¸€ ë¡œë“œ ì‹¤íŒ¨:', error);
                console.error('âŒ ì˜¤ë¥˜ ìƒì„¸:', {
                    code: error.code,
                    message: error.message,
                    stack: error.stack,
                    inquiryId: inquiryId
                });
                const commentsList = document.getElementById('inquiry-modal-comments-list');
                if (commentsList) {
                    commentsList.innerHTML = `<p class="text-red-400 text-center py-4">ëŒ“ê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.<br><span class="text-xs">${error.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}</span></p>`;
                }
            }
        }
        
        // HTML ì´ìŠ¤ì¼€ì´í”„ í•¨ìˆ˜
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ë¬¸ì˜ ì²¨ë¶€ íŒŒì¼ í‘œì‹œ
        function displayInquiryAttachments(file) {
            const attachmentsSection = document.getElementById('inquiry-modal-attachments');
            const attachmentList = document.getElementById('inquiry-modal-attachment-list');
            
            if (!file || file === '') {
                attachmentsSection.classList.add('hidden');
                return;
            }
            
            attachmentsSection.classList.remove('hidden');
            attachmentList.innerHTML = '';
            
            // ë‹¨ì¼ íŒŒì¼ì¸ ê²½ìš°
            if (typeof file === 'string' && file.startsWith('data:image/')) {
                const attachmentItem = createAttachmentItem(file, 'ì²¨ë¶€ ì´ë¯¸ì§€');
                attachmentList.appendChild(attachmentItem);
            }
            // ë°°ì—´ì¸ ê²½ìš°
            else if (Array.isArray(file)) {
                file.forEach((fileData, index) => {
                    if (fileData && fileData.startsWith('data:image/')) {
                        const attachmentItem = createAttachmentItem(fileData, `ì²¨ë¶€ ì´ë¯¸ì§€ ${index + 1}`);
                        attachmentList.appendChild(attachmentItem);
                    }
                });
            }
        }

        // ì²¨ë¶€ íŒŒì¼ ì•„ì´í…œ ìƒì„±
        function createAttachmentItem(fileData, title) {
            const item = document.createElement('div');
            item.className = 'relative group cursor-pointer';
            
            item.innerHTML = `
                <div class="bg-white rounded-lg border-2 border-orange-200 p-3 hover:border-orange-400 transition-all duration-200 shadow-sm hover:shadow-md">
                    <div class="aspect-square rounded-lg overflow-hidden bg-gray-100 mb-2">
                        <img src="${fileData}" 
                             alt="${title}" 
                             class="w-full h-full object-cover hover:scale-105 transition-transform duration-200"
                             onclick="openInquiryImageModal('${fileData}')">
                    </div>
                    <div class="text-center">
                        <p class="text-xs font-medium text-gray-700 truncate">${title}</p>
                        <p class="text-xs text-gray-500 mt-1">í´ë¦­í•˜ì—¬ í™•ëŒ€</p>
                    </div>
                </div>
            `;
            
            return item;
        }

        // ë¬¸ì˜ ì´ë¯¸ì§€ ëª¨ë‹¬ ì—´ê¸°
        function openInquiryImageModal(imageSrc) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4';
            modal.innerHTML = `
                <div class="relative max-w-4xl max-h-full">
                    <img src="${imageSrc}" 
                         alt="í™•ëŒ€ ì´ë¯¸ì§€" 
                         class="max-w-full max-h-full object-contain rounded-lg">
                    <button onclick="this.parentElement.parentElement.remove()" 
                            class="absolute top-4 right-4 text-white text-3xl font-bold hover:text-gray-300 transition-colors">
                        &times;
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
            document.body.style.overflow = 'hidden';
            
            // ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                    document.body.style.overflow = 'auto';
                }
            });
        }

        // ë¬¸ì˜ ìƒíƒœì— ë”°ë¥¸ CSS í´ë˜ìŠ¤ ë°˜í™˜
        function getInquiryStatusClass(status) {
            switch(status) {
                case 'ë‹µë³€ì™„ë£Œ': return 'bg-green-500';
                case 'ì™„ë£Œ': return 'bg-green-500';
                case 'ì²˜ë¦¬ì¤‘': return 'bg-yellow-500';
                case 'ëŒ€ê¸°': return 'bg-gray-500';
                case 'ì·¨ì†Œ': return 'bg-red-500';
                default: return 'bg-blue-500';
            }
        }

        // ê¸°ì¡´ ë¬¸ì˜ ë‹µë³€ì„ í¼ì— ì±„ìš°ê¸°
        function loadExistingInquiryResponseToForm(inquiry) {
            // ê¸°ì¡´ ë‹µë³€ì´ ìˆëŠ”ì§€ í™•ì¸
            if (inquiry.adminResponse && typeof inquiry.adminResponse === 'object') {
                const response = inquiry.adminResponse;
                
                // ê° í•„ë“œì— ê¸°ì¡´ ê°’ ì±„ìš°ê¸°
                document.getElementById('inquiry-response-answer').value = response.answer || '';
                document.getElementById('inquiry-response-additional-info').value = response.additionalInfo || '';
                
                console.log('âœ… ê¸°ì¡´ ë¬¸ì˜ ë‹µë³€ ë°ì´í„°ë¥¼ í¼ì— ë¡œë“œí–ˆìŠµë‹ˆë‹¤:', response);
            } else {
                // ê¸°ì¡´ ë‹µë³€ì´ ì—†ìœ¼ë©´ í¼ ì´ˆê¸°í™”
                clearInquiryResponseForm();
                console.log('ğŸ“ ìƒˆë¡œìš´ ë¬¸ì˜ ë‹µë³€ì„ ìœ„í•œ í¼ì„ ì´ˆê¸°í™”í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ë¬¸ì˜ ë‹µë³€ í¼ ì´ˆê¸°í™”
        function clearInquiryResponseForm() {
            document.getElementById('inquiry-response-answer').value = '';
            document.getElementById('inquiry-response-additional-info').value = '';
            
            // í¬ì»¤ìŠ¤ë¥¼ ë‹µë³€ ë‚´ìš© í•„ë“œë¡œ ì´ë™
            document.getElementById('inquiry-response-answer').focus();
        }

        // ë¬¸ì˜ ë‹µë³€ ì €ì¥
        async function saveInquiryResponse() {
            const formData = getInquiryResponseFormData();
            
            if (!formData.answer && !formData.additionalInfo) {
                alert('ìµœì†Œí•œ í•˜ë‚˜ì˜ ì •ë³´ëŠ” ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            try {
                await waitForFirebase();
                
                if (!currentInquiryId) {
                    alert('ë¬¸ì˜ IDë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                    return;
                }
                
                // í˜„ì¬ ì‚¬ìš©ì í™•ì¸ ë° í† í° ê°•ì œ ê°±ì‹  (Firestore ê·œì¹™ ì¸ì‹ìš©)
                if (window.firebaseAuth && window.firebaseAuth.currentUser) {
                    try {
                        await window.firebaseAuth.currentUser.getIdToken(true);
                    } catch (tokenError) {
                        console.warn('âš ï¸ í† í° ê°±ì‹  ì‹¤íŒ¨:', tokenError);
                    }
                }
                
                const { collection, doc, updateDoc, serverTimestamp } = window.firebaseFirestoreFunctions;
                
                // Firebaseì—ì„œ ë¬¸ì˜ ë¬¸ì„œ ì—…ë°ì´íŠ¸ (ì˜ë¢° ê´€ë¦¬ì™€ ë™ì¼í•œ ë°©ì‹)
                const inquiryRef = doc(collection(window.firebaseDb, 'inquiries'), currentInquiryId);
                await updateDoc(inquiryRef, {
                    adminResponse: formData,
                    responseDate: serverTimestamp(),
                    status: 'ë‹µë³€ì™„ë£Œ',
                    lastUpdated: serverTimestamp()
                });

                console.log('âœ… ë¬¸ì˜ ë‹µë³€ ì €ì¥ ì™„ë£Œ');
                alert('ë‹µë³€ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                
                // ë‹µë³€ ì„¹ì…˜ ì—…ë°ì´íŠ¸
                document.getElementById('inquiry-modal-admin-response').classList.remove('hidden');
                document.getElementById('inquiry-modal-response-content').innerHTML = formatInquiryResponseForDisplay(formData);
                document.getElementById('inquiry-modal-response-date').textContent = new Date().toLocaleString('ko-KR');
                
                // ëª¨ë‹¬ì˜ ìƒíƒœ í‘œì‹œë„ ì—…ë°ì´íŠ¸
                const statusElement = document.getElementById('inquiry-modal-status');
                if (statusElement) {
                    statusElement.textContent = 'ë‹µë³€ì™„ë£Œ';
                    statusElement.className = 'px-2 py-1 rounded-full text-xs font-bold text-white ' + getInquiryStatusClass('ë‹µë³€ì™„ë£Œ');
                }
                
                // í¼ ì´ˆê¸°í™”
                clearInquiryResponseForm();
                
                // ë¬¸ì˜ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                renderInquiryList();
                
            } catch (error) {
                console.error('âŒ ë¬¸ì˜ ë‹µë³€ ì €ì¥ ì‹¤íŒ¨:', error);
                console.error('âŒ ì—ëŸ¬ ìƒì„¸ ì •ë³´:', {
                    code: error.code,
                    message: error.message,
                    stack: error.stack,
                    inquiryId: currentInquiryId,
                    formData: formData
                });
                
                let errorMessage = 'ë‹µë³€ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
                if (error.code) {
                    errorMessage += `\n\nì˜¤ë¥˜ ì½”ë“œ: ${error.code}`;
                }
                if (error.message) {
                    errorMessage += `\nì˜¤ë¥˜ ë©”ì‹œì§€: ${error.message}`;
                }
                errorMessage += '\n\në¸Œë¼ìš°ì € ì½˜ì†”(F12)ì—ì„œ ìì„¸í•œ ì˜¤ë¥˜ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.';
                
                alert(errorMessage);
            }
        }

        // ë¬¸ì˜ ë‹µë³€ í¼ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        function getInquiryResponseFormData() {
            return {
                answer: document.getElementById('inquiry-response-answer').value.trim(),
                additionalInfo: document.getElementById('inquiry-response-additional-info').value.trim()
            };
        }

        // ë¬¸ì˜ ë‹µë³€ì„ í‘œì‹œìš©ìœ¼ë¡œ í¬ë§·íŒ…
        function formatInquiryResponseForDisplay(formData) {
            let html = '<div class="space-y-4">';
            
            if (formData.answer) {
                html += `
                    <div class="p-3 bg-blue-50 rounded-lg border-l-4 border-blue-500">
                        <div class="font-semibold text-blue-800 mb-2">ğŸ’¬ ë‹µë³€</div>
                        <div class="text-blue-600 whitespace-pre-wrap">${formData.answer}</div>
                    </div>
                `;
            }
            
            if (formData.additionalInfo) {
                html += `
                    <div class="p-3 bg-gray-50 rounded-lg border-l-4 border-gray-500">
                        <div class="font-semibold text-gray-800 mb-2">ğŸ“ ì¶”ê°€ ì •ë³´</div>
                        <div class="text-gray-600 whitespace-pre-wrap">${formData.additionalInfo}</div>
                    </div>
                `;
            }
            
            html += '</div>';
            return html;
        }

        // ë¬¸ì˜ ëª¨ë‹¬ ë‹«ê¸°
        function closeInquiryDetailModal() {
            document.getElementById('inquiry-detail-modal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        // ë¬¸ì˜ ëª¨ë‹¬ì—ì„œ ì‚­ì œ
        async function deleteInquiryFromModal() {
            if (!currentInquiryId) {
                alert('ë¬¸ì˜ IDë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const inquiryId = document.getElementById('inquiry-modal-id').textContent;
            if (!confirm(`ë¬¸ì˜ ${inquiryId}ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâš ï¸ ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) {
                return;
            }
            
            try {
                const success = await deleteInquiryFromFirebase(currentInquiryId);
                if (success) {
                    alert('ë¬¸ì˜ê°€ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    closeInquiryDetailModal();
                    renderInquiryList(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                } else {
                    alert('ë¬¸ì˜ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                }
            } catch (error) {
                console.error('ë¬¸ì˜ ì‚­ì œ ì‹¤íŒ¨:', error);
                alert('ë¬¸ì˜ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // í›„ê¸° ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜ë“¤ (ì‚­ì œë¨)
    </script>

    <!-- ë¬¸ì˜ ìƒì„¸ë³´ê¸° ëª¨ë‹¬ -->
    <div id="inquiry-detail-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                <!-- ëª¨ë‹¬ í—¤ë” -->
                <div class="sticky top-0 bg-white border-b border-gray-200 p-6 rounded-t-2xl">
                    <div class="flex justify-between items-center">
                        <h2 class="text-2xl font-bold text-gray-800">ğŸ’¬ ë¬¸ì˜ ìƒì„¸ ì •ë³´</h2>
                        <button id="close-inquiry-modal" class="text-gray-500 hover:text-gray-700 text-3xl font-bold">&times;</button>
                    </div>
                </div>
                
                <!-- ëª¨ë‹¬ ë‚´ìš© -->
                <div class="p-6">
                    <!-- ë¬¸ì˜ ê¸°ë³¸ ì •ë³´ -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                            ğŸ“ ë¬¸ì˜ ê¸°ë³¸ ì •ë³´
                        </h3>
                        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-6 border-l-4 border-blue-500 shadow-sm">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                <div class="flex items-center">
                                    <span class="font-semibold text-gray-700 w-20">ë¬¸ì˜ë²ˆí˜¸:</span> 
                                    <span id="inquiry-modal-id" class="text-blue-600 font-mono text-xs bg-blue-100 px-2 py-1 rounded"></span>
                                </div>
                                <div class="flex items-center">
                                    <span class="font-semibold text-gray-700 w-20">ë¬¸ì˜ì¼ì‹œ:</span> 
                                    <span id="inquiry-modal-date" class="text-blue-600"></span>
                                </div>
                                <div class="flex items-center md:col-span-2">
                                    <span class="font-semibold text-gray-700 w-20">ì œëª©:</span> 
                                    <span id="inquiry-modal-subject" class="text-blue-600 font-medium"></span>
                                </div>
                                <div class="flex items-center">
                                    <span class="font-semibold text-gray-700 w-20">ìƒíƒœ:</span> 
                                    <span id="inquiry-modal-status" class="px-3 py-1 rounded-full text-xs font-bold text-white"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ë¬¸ì˜ ë‚´ìš© -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                            ğŸ“„ ë¬¸ì˜ ë‚´ìš©
                        </h3>
                        <div class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-6 border-l-4 border-green-500 shadow-sm">
                            <div class="bg-white rounded-lg p-4 border border-green-200">
                                <div class="whitespace-pre-wrap text-gray-700 leading-relaxed" id="inquiry-modal-message"></div>
                            </div>
                        </div>
                    </div>

                    <!-- ì²¨ë¶€ íŒŒì¼ (ì‚¬ì§„) -->
                    <div id="inquiry-modal-attachments" class="mb-6 hidden">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                            ğŸ“ ì²¨ë¶€ íŒŒì¼
                        </h3>
                        <div class="bg-orange-50 rounded-lg p-4 border-l-4 border-orange-500">
                            <div id="inquiry-modal-attachment-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                            </div>
                        </div>
                    </div>

                    <!-- íšŒì› ì •ë³´ -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                            ğŸ‘¤ íšŒì› ì •ë³´
                        </h3>
                        <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl p-6 border-l-4 border-purple-500 shadow-sm">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                <div class="flex items-center">
                                    <span class="font-semibold text-gray-700 w-20">ì´ë¦„:</span> 
                                    <span id="inquiry-modal-user-name" class="text-purple-600 font-medium"></span>
                                </div>
                                <div class="flex items-center">
                                    <span class="font-semibold text-gray-700 w-20">ì´ë©”ì¼:</span> 
                                    <span id="inquiry-modal-user-email" class="text-purple-600 font-mono text-xs bg-purple-100 px-2 py-1 rounded"></span>
                                </div>
                                <div class="flex items-center">
                                    <span class="font-semibold text-gray-700 w-20">íœ´ëŒ€í°:</span> 
                                    <span id="inquiry-modal-user-phone" class="text-purple-600"></span>
                                </div>
                                <div class="flex items-center">
                                    <span class="font-semibold text-gray-700 w-20">ì¹´ì¹´ì˜¤ID:</span> 
                                    <span id="inquiry-modal-user-kakao" class="text-purple-600"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ê´€ë¦¬ì ì•¡ì…˜ -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                            âš™ï¸ ê´€ë¦¬ì ì•¡ì…˜
                        </h3>
                        <div class="bg-red-50 rounded-lg p-4 border-l-4 border-red-500">
                            <div class="flex flex-wrap gap-3">
                                <button onclick="deleteInquiryFromModal()" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition">
                                    ë¬¸ì˜ ì‚­ì œ
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- ê´€ë¦¬ì ë‹µë³€ ì‘ì„± -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                            ğŸ’¬ ê´€ë¦¬ì ë‹µë³€ ì‘ì„±
                        </h3>
                        <div class="bg-gradient-to-r from-indigo-50 to-blue-50 rounded-xl p-6 border-l-4 border-indigo-500 shadow-sm">
                            <form id="inquiry-response-form" class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                                        ğŸ’¬ ë‹µë³€ ë‚´ìš©
                                    </label>
                                    <textarea id="inquiry-response-answer" 
                                              rows="4" 
                                              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 focus:outline-none transition-colors" 
                                              placeholder="ë¬¸ì˜ì— ëŒ€í•œ ë‹µë³€ì„ ì‘ì„±í•´ì£¼ì„¸ìš”..."></textarea>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                                        ğŸ“ ì¶”ê°€ ì •ë³´
                                    </label>
                                    <textarea id="inquiry-response-additional-info" 
                                              rows="3" 
                                              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 focus:outline-none transition-colors" 
                                              placeholder="ì¶”ê°€ë¡œ ì•Œë ¤ë“œë¦´ ì •ë³´ê°€ ìˆë‹¤ë©´ ì…ë ¥í•´ì£¼ì„¸ìš”..."></textarea>
                                </div>

                                <div class="flex gap-3 pt-4">
                                    <button type="submit" class="px-6 py-3 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 transition font-medium shadow-sm hover:shadow-md">
                                        ğŸ’¾ ë‹µë³€ ì €ì¥
                                    </button>
                                    <button type="button" onclick="clearInquiryResponseForm()" class="px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition font-medium shadow-sm hover:shadow-md">
                                        ğŸ—‘ï¸ ë‚´ìš© ì§€ìš°ê¸°
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- ê´€ë¦¬ì ë‹µë³€ (ìˆëŠ” ê²½ìš°) -->
                    <div id="inquiry-modal-admin-response" class="mb-6 hidden">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                            ğŸ’¼ ê´€ë¦¬ì ë‹µë³€
                        </h3>
                        <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl p-6 border-l-4 border-purple-500 shadow-lg">
                            <div class="flex items-center mb-4">
                                <div class="w-10 h-10 bg-purple-500 rounded-full flex items-center justify-center mr-3">
                                    <span class="text-white font-bold text-lg">A</span>
                                </div>
                                <div>
                                    <div class="font-semibold text-gray-800">ê´€ë¦¬ì</div>
                                    <div class="text-sm text-gray-500" id="inquiry-modal-response-date"></div>
                                </div>
                            </div>
                            <div class="bg-white rounded-lg p-4 shadow-sm">
                                <div id="inquiry-modal-response-content"></div>
                            </div>
                            <div class="mt-4 flex items-center text-sm text-gray-500">
                                <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                </svg>
                                ë‹µë³€ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤
                            </div>
                        </div>
                    </div>

                    <!-- ì¶”ê°€ ëŒ“ê¸€ -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                            ğŸ’¬ ì¶”ê°€ ëŒ“ê¸€
                        </h3>
                        <div class="bg-gradient-to-r from-emerald-50 to-teal-50 rounded-xl p-6 border-l-4 border-emerald-500 shadow-sm">
                            <div id="inquiry-modal-comments-list" class="space-y-3 mb-4">
                                <!-- ëŒ“ê¸€ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ í‘œì‹œë¨ -->
                            </div>
                            <div class="bg-white rounded-lg p-4 border border-emerald-200">
                                <form id="inquiry-comment-form" class="space-y-3">
                                    <textarea id="inquiry-comment-input" 
                                              rows="2" 
                                              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 focus:outline-none transition-colors" 
                                              placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                                    <button type="submit" class="px-4 py-2 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600 transition font-medium">
                                        ğŸ’¬ ëŒ“ê¸€ ë“±ë¡
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ë¬¸ì˜ ëª¨ë‹¬ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // ë¬¸ì˜ ëª¨ë‹¬ ë‹«ê¸° ë²„íŠ¼
            document.getElementById('close-inquiry-modal').addEventListener('click', closeInquiryDetailModal);
            
            // ë¬¸ì˜ ëª¨ë‹¬ ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
            document.getElementById('inquiry-detail-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeInquiryDetailModal();
                }
            });
            
            // ESC í‚¤ë¡œ ë¬¸ì˜ ëª¨ë‹¬ ë‹«ê¸°
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && !document.getElementById('inquiry-detail-modal').classList.contains('hidden')) {
                    closeInquiryDetailModal();
                }
            });

            // ë¬¸ì˜ ë‹µë³€ í¼ ì œì¶œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.getElementById('inquiry-response-form').addEventListener('submit', function(e) {
                e.preventDefault();
                saveInquiryResponse();
            });
            
            // ë¬¸ì˜ ëŒ“ê¸€ í¼ ì œì¶œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.getElementById('inquiry-comment-form').addEventListener('submit', async function(e) {
                e.preventDefault();
                await saveInquiryComment();
            });
        });
        
        // ë¬¸ì˜ ëŒ“ê¸€ ì €ì¥ (ê´€ë¦¬ììš©)
        async function saveInquiryComment() {
            const input = document.getElementById('inquiry-comment-input');
            const text = input.value.trim();
            
            if (!text) {
                alert('ëŒ“ê¸€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!currentInquiryId) {
                alert('ë¬¸ì˜ IDë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            try {
                await waitForFirebase();
                const { collection, addDoc, serverTimestamp } = window.firebaseFirestoreFunctions;
                const commentsRef = collection(window.firebaseDb, 'inquiryComments');
                
                // í˜„ì¬ ê´€ë¦¬ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                const currentUser = window.firebaseAuth?.currentUser;
                const adminEmail = currentUser?.email || 'admin@pricehunter.com';
                
                await addDoc(commentsRef, {
                    inquiryId: currentInquiryId,
                    author: 'ê´€ë¦¬ì',
                    email: adminEmail,
                    text: text,
                    date: Date.now(),
                    createdAt: serverTimestamp()
                });
                
                console.log('âœ… ê´€ë¦¬ì ëŒ“ê¸€ ì €ì¥ ì™„ë£Œ');
                
                // ëŒ“ê¸€ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                await loadInquiryComments(currentInquiryId);
                
                // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                input.value = '';
                
            } catch (error) {
                console.error('âŒ ê´€ë¦¬ì ëŒ“ê¸€ ì €ì¥ ì‹¤íŒ¨:', error);
                alert('ëŒ“ê¸€ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }
    </script>

    <!-- í›„ê¸° ê´€ë¦¬ ì‹œìŠ¤í…œ (ì‚­ì œë¨) -->
    <script>
        // ì ˆì•½ì™• ê´€ë¦¬ ê¸°ëŠ¥
        async function loadSavingsKingData() {
            console.log('ğŸ† ì ˆì•½ì™• ë°ì´í„° ë¡œë“œ ì‹œì‘');
            console.log('ğŸ” Firebase ì—°ê²° ìƒíƒœ í™•ì¸:', {
                firebaseApp: !!window.firebaseApp,
                firebaseAuth: !!window.firebaseAuth,
                firebaseDb: !!window.firebaseDb,
                firebaseFirestoreFunctions: !!window.firebaseFirestoreFunctions
            });
            
            // ê¸°ë³¸ê°’ ì„¤ì •
            const defaultData = {
                image: 'https://images.unsplash.com/photo-1548036328-c9fa89d128fa?auto=format&fit=crop&w=600&q=80',
                name: 'ìµœOO',
                age: '20ëŒ€',
                job: 'ì§ì¥ì¸',
                product: 'íŒ¨ì…˜ë°±',
                amount: 80000,
                rate: 44
            };
            
            let data = { ...defaultData };
            
            try {
                // Firebaseì—ì„œ ë°ì´í„° ë¡œë“œ ì‹œë„
                if (window.firebaseDb) {
                    console.log('ğŸ”¥ Firebase ì—°ê²° ì •ìƒ, ë°ì´í„° ë¡œë“œ ì‹œë„...');
                    const { collection, doc, getDoc } = await import('https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js');
                    console.log('ğŸ“¦ Firebase ëª¨ë“ˆ ë¡œë“œ ì™„ë£Œ');
                    
                    const savingsKingRef = doc(collection(window.firebaseDb, 'adminSettings'), 'savingsKing');
                    console.log('ğŸ“„ ë¬¸ì„œ ì°¸ì¡° ìƒì„±:', savingsKingRef.path);
                    
                    const docSnap = await getDoc(savingsKingRef);
                    console.log('ğŸ“– ë¬¸ì„œ ì½ê¸° ì™„ë£Œ, ì¡´ì¬ ì—¬ë¶€:', docSnap.exists());
                    
                    if (docSnap.exists()) {
                        const firebaseData = docSnap.data();
                        data = { ...defaultData, ...firebaseData };
                        console.log('âœ… Firebaseì—ì„œ ì ˆì•½ì™• ë°ì´í„° ë¡œë“œ ì„±ê³µ:', data);
                    } else {
                        console.log('âš ï¸ Firebaseì— ì ˆì•½ì™• ë°ì´í„°ê°€ ì—†ìŒ, ê¸°ë³¸ê°’ ì‚¬ìš©');
                    }
                } else {
                    console.warn('âš ï¸ Firebase DBê°€ ì´ˆê¸°í™”ë˜ì§€ ì•ŠìŒ, localStorageì—ì„œ ë¡œë“œ ì‹œë„');
                    throw new Error('Firebase DB not initialized');
                }
            } catch (error) {
                console.error('âŒ Firebaseì—ì„œ ì ˆì•½ì™• ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                console.error('âŒ ì—ëŸ¬ ìƒì„¸ ì •ë³´:', {
                    name: error.name,
                    message: error.message,
                    code: error.code
                });
                
                // Firebase ì‹¤íŒ¨ ì‹œ localStorageì—ì„œ ë¡œë“œ
                try {
                    const savingsKingData = JSON.parse(localStorage.getItem('savingsKingData') || '{}');
                    data = { ...defaultData, ...savingsKingData };
                    console.log('ğŸ“± localStorageì—ì„œ ì ˆì•½ì™• ë°ì´í„° ë¡œë“œ:', data);
                } catch (localError) {
                    console.error('âŒ localStorage ë¡œë“œë„ ì‹¤íŒ¨:', localError);
                    console.log('ğŸ”„ ê¸°ë³¸ê°’ ì‚¬ìš©:', defaultData);
                }
            }
            
            // í¼ì— ë°ì´í„° ì„¤ì •
            document.getElementById('savings-king-image').value = data.image;
            document.getElementById('savings-king-name').value = data.name;
            document.getElementById('savings-king-age').value = data.age || '20ëŒ€';
            document.getElementById('savings-king-job').value = data.job || 'ì§ì¥ì¸';
            document.getElementById('savings-king-product').value = data.product || 'íŒ¨ì…˜ë°±';
            
            // ì˜ë¢° ê°€ê²©ê³¼ ì ˆê°ëœ ê°€ê²© ì„¤ì • (ê¸°ì¡´ ë°ì´í„°ì—ì„œ ê³„ì‚°í•˜ê±°ë‚˜ ê¸°ë³¸ê°’ ì‚¬ìš©)
            const originalPrice = data.originalPrice || (data.amount && data.rate ? Math.round(data.amount / (data.rate / 100)) : 1000000);
            const finalPrice = data.finalPrice || (data.amount && originalPrice ? originalPrice - data.amount : 580000);
            
            document.getElementById('savings-king-original-price').value = originalPrice;
            document.getElementById('savings-king-final-price').value = finalPrice;
            
            // ì ˆì•½ ê¸ˆì•¡ê³¼ ì ˆì•½ìœ¨ ìë™ ê³„ì‚°
            updateSavingsKingAmountAndRate();
            
            // ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
            updateSavingsKingPreview();
            
            console.log('âœ… ì ˆì•½ì™• ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', data);
        }

        async function saveSavingsKing() {
            console.log('ğŸ’¾ ì ˆì•½ì™• ë°ì´í„° ì €ì¥ ì‹œì‘');
            addSavingsKingLog('ğŸ’¾ ì ˆì•½ì™• ë°ì´í„° ì €ì¥ ì‹œì‘', 'info');
            
            console.log('ğŸ” Firebase ìƒíƒœ í™•ì¸:', {
                firebaseApp: !!window.firebaseApp,
                firebaseAuth: !!window.firebaseAuth,
                firebaseDb: !!window.firebaseDb,
                firebaseFirestoreFunctions: !!window.firebaseFirestoreFunctions
            });
            
            // í¼ ë°ì´í„° ìˆ˜ì§‘
            const originalPrice = parseInt(document.getElementById('savings-king-original-price').value) || 0;
            const finalPrice = parseInt(document.getElementById('savings-king-final-price').value) || 0;
            const amount = originalPrice - finalPrice;
            const rate = originalPrice > 0 ? Math.round((amount / originalPrice) * 100) : 0;
            
            const data = {
                image: document.getElementById('savings-king-image').value,
                name: document.getElementById('savings-king-name').value,
                age: document.getElementById('savings-king-age').value,
                job: document.getElementById('savings-king-job').value,
                product: document.getElementById('savings-king-product').value,
                originalPrice: originalPrice,
                finalPrice: finalPrice,
                amount: amount,
                rate: rate
            };
            
            console.log('ğŸ“ ìˆ˜ì§‘ëœ ë°ì´í„°:', data);
            addSavingsKingLog(`ğŸ“ ìˆ˜ì§‘ëœ ë°ì´í„°: ${JSON.stringify(data)}`, 'info');
            
            // ìœ íš¨ì„± ê²€ì‚¬
            if (!data.name.trim()) {
                console.log('âŒ ìœ íš¨ì„± ê²€ì‚¬ ì‹¤íŒ¨: ì´ë¦„ì´ ë¹„ì–´ìˆìŒ');
                addSavingsKingLog('âŒ ìœ íš¨ì„± ê²€ì‚¬ ì‹¤íŒ¨: ì´ë¦„ì´ ë¹„ì–´ìˆìŒ', 'error');
                alert('âŒ ì ˆì•½ì™• ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!data.product.trim()) {
                console.log('âŒ ìœ íš¨ì„± ê²€ì‚¬ ì‹¤íŒ¨: ì œí’ˆëª…ì´ ë¹„ì–´ìˆìŒ');
                addSavingsKingLog('âŒ ìœ íš¨ì„± ê²€ì‚¬ ì‹¤íŒ¨: ì œí’ˆëª…ì´ ë¹„ì–´ìˆìŒ', 'error');
                alert('âŒ ì œí’ˆëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (data.amount <= 0) {
                console.log('âŒ ìœ íš¨ì„± ê²€ì‚¬ ì‹¤íŒ¨: ì ˆì•½ ê¸ˆì•¡ì´ 0 ì´í•˜');
                addSavingsKingLog('âŒ ìœ íš¨ì„± ê²€ì‚¬ ì‹¤íŒ¨: ì ˆì•½ ê¸ˆì•¡ì´ 0 ì´í•˜', 'error');
                alert('âŒ ì ˆì•½ ê¸ˆì•¡ì€ 0ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }
            
            if (data.rate < 0 || data.rate > 100) {
                console.log('âŒ ìœ íš¨ì„± ê²€ì‚¬ ì‹¤íŒ¨: ì ˆì•½ìœ¨ì´ ë²”ìœ„ë¥¼ ë²—ì–´ë‚¨');
                addSavingsKingLog('âŒ ìœ íš¨ì„± ê²€ì‚¬ ì‹¤íŒ¨: ì ˆì•½ìœ¨ì´ ë²”ìœ„ë¥¼ ë²—ì–´ë‚¨', 'error');
                alert('âŒ ì ˆì•½ìœ¨ì€ 0-100 ì‚¬ì´ì˜ ê°’ì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }
            
            console.log('âœ… ìœ íš¨ì„± ê²€ì‚¬ í†µê³¼');
            addSavingsKingLog('âœ… ìœ íš¨ì„± ê²€ì‚¬ í†µê³¼', 'success');
            
            try {
                // Firebase ì—°ê²° ìƒíƒœ í™•ì¸
                if (!window.firebaseDb) {
                    console.error('âŒ Firebase DBê°€ ì´ˆê¸°í™”ë˜ì§€ ì•ŠìŒ');
                    addSavingsKingLog('âŒ Firebase DBê°€ ì´ˆê¸°í™”ë˜ì§€ ì•ŠìŒ', 'error');
                    throw new Error('Firebaseê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
                }
                
                console.log('ğŸ”¥ Firebase ì—°ê²° ìƒíƒœ ì •ìƒ, ì €ì¥ ì‹œì‘...');
                addSavingsKingLog('ğŸ”¥ Firebase ì—°ê²° ìƒíƒœ ì •ìƒ, ì €ì¥ ì‹œì‘...', 'info');
                
                // Firebaseì— ì €ì¥
                const { collection, doc, setDoc, serverTimestamp } = await import('https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js');
                console.log('ğŸ“¦ Firebase ëª¨ë“ˆ ë¡œë“œ ì™„ë£Œ');
                addSavingsKingLog('ğŸ“¦ Firebase ëª¨ë“ˆ ë¡œë“œ ì™„ë£Œ', 'info');
                
                const savingsKingRef = doc(collection(window.firebaseDb, 'adminSettings'), 'savingsKing');
                console.log('ğŸ“„ ë¬¸ì„œ ì°¸ì¡° ìƒì„±:', savingsKingRef.path);
                addSavingsKingLog(`ğŸ“„ ë¬¸ì„œ ì°¸ì¡° ìƒì„±: ${savingsKingRef.path}`, 'info');
                
                const saveData = {
                    ...data,
                    updatedAt: serverTimestamp(),
                    updatedBy: 'admin'
                };
                
                console.log('ğŸ’¾ ì €ì¥í•  ë°ì´í„°:', saveData);
                addSavingsKingLog(`ğŸ’¾ ì €ì¥í•  ë°ì´í„°: ${JSON.stringify(saveData)}`, 'info');
                
                await setDoc(savingsKingRef, saveData, { merge: true });
                console.log('âœ… Firebaseì— ì ˆì•½ì™• ë°ì´í„° ì €ì¥ ì™„ë£Œ');
                addSavingsKingLog('âœ… Firebaseì— ì ˆì•½ì™• ë°ì´í„° ì €ì¥ ì™„ë£Œ', 'success');
                
                // localStorageì—ë„ ì €ì¥ (ë°±ì—…ìš©)
                localStorage.setItem('savingsKingData', JSON.stringify(data));
                console.log('ğŸ’¾ localStorage ë°±ì—… ì™„ë£Œ');
                addSavingsKingLog('ğŸ’¾ localStorage ë°±ì—… ì™„ë£Œ', 'success');
                
                // ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
                updateSavingsKingPreview();
                console.log('ğŸ‘ï¸ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                addSavingsKingLog('ğŸ‘ï¸ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸ ì™„ë£Œ', 'success');
                
                // ì„±ê³µ ë©”ì‹œì§€
                alert('âœ… ì ˆì•½ì™• ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
                addSavingsKingLog('âœ… ì ˆì•½ì™• ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                
                console.log('âœ… ì ˆì•½ì™• ë°ì´í„° ì €ì¥ ì™„ë£Œ:', data);
                
            } catch (error) {
                console.error('âŒ ì ˆì•½ì™• ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:', error);
                addSavingsKingLog(`âŒ ì ˆì•½ì™• ë°ì´í„° ì €ì¥ ì‹¤íŒ¨: ${error.message}`, 'error');
                
                console.error('âŒ ì—ëŸ¬ ìƒì„¸ ì •ë³´:', {
                    name: error.name,
                    message: error.message,
                    code: error.code,
                    stack: error.stack
                });
                
                addSavingsKingLog(`âŒ ì—ëŸ¬ ìƒì„¸ ì •ë³´: ${JSON.stringify({
                    name: error.name,
                    message: error.message,
                    code: error.code
                })}`, 'error');
                
                // ë” êµ¬ì²´ì ì¸ ì—ëŸ¬ ë©”ì‹œì§€ ì œê³µ
                let errorMessage = 'âŒ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
                if (error.message.includes('permission')) {
                    errorMessage += '\n\nê¶Œí•œ ì˜¤ë¥˜: ê´€ë¦¬ì ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
                    addSavingsKingLog('âŒ ê¶Œí•œ ì˜¤ë¥˜: ê´€ë¦¬ì ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.', 'error');
                } else if (error.message.includes('network')) {
                    errorMessage += '\n\në„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
                    addSavingsKingLog('âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.', 'error');
                } else if (error.message.includes('Firebase')) {
                    errorMessage += '\n\nFirebase ì˜¤ë¥˜: ì„œë¹„ìŠ¤ë¥¼ ë‹¤ì‹œ ì‹œì‘í•´ì£¼ì„¸ìš”.';
                    addSavingsKingLog('âŒ Firebase ì˜¤ë¥˜: ì„œë¹„ìŠ¤ë¥¼ ë‹¤ì‹œ ì‹œì‘í•´ì£¼ì„¸ìš”.', 'error');
                } else {
                    errorMessage += '\n\nì˜¤ë¥˜: ' + error.message;
                    addSavingsKingLog(`âŒ ê¸°íƒ€ ì˜¤ë¥˜: ${error.message}`, 'error');
                }
                
                alert(errorMessage);
                
                // ê°œë°œì ì½˜ì†”ì— ì¶”ê°€ ì •ë³´ ì¶œë ¥
                console.log('ğŸ”§ ë¬¸ì œ í•´ê²°ì„ ìœ„í•œ ì¶”ê°€ ì •ë³´:');
                console.log('- í˜„ì¬ ì‹œê°„:', new Date().toISOString());
                console.log('- ì‚¬ìš©ì ì—ì´ì „íŠ¸:', navigator.userAgent);
                console.log('- ì˜¨ë¼ì¸ ìƒíƒœ:', navigator.onLine);
                
                addSavingsKingLog(`ğŸ”§ ë¬¸ì œ í•´ê²° ì •ë³´: ì‹œê°„=${new Date().toISOString()}, ì˜¨ë¼ì¸=${navigator.onLine}`, 'warning');
            }
        }

        // ì ˆì•½ ê¸ˆì•¡ê³¼ ì ˆì•½ìœ¨ ìë™ ê³„ì‚° í•¨ìˆ˜
        function updateSavingsKingAmountAndRate() {
            const originalPrice = parseInt(document.getElementById('savings-king-original-price').value) || 0;
            const finalPrice = parseInt(document.getElementById('savings-king-final-price').value) || 0;
            const amount = originalPrice - finalPrice;
            const rate = originalPrice > 0 ? Math.round((amount / originalPrice) * 100) : 0;
            
            document.getElementById('savings-king-amount').value = amount > 0 ? amount : '';
            document.getElementById('savings-king-rate').value = rate > 0 ? rate : '';
        }

        function updateSavingsKingPreview() {
            // ì ˆì•½ ê¸ˆì•¡ê³¼ ì ˆì•½ìœ¨ ìë™ ê³„ì‚°
            updateSavingsKingAmountAndRate();
            
            const originalPrice = parseInt(document.getElementById('savings-king-original-price').value) || 0;
            const finalPrice = parseInt(document.getElementById('savings-king-final-price').value) || 0;
            const amount = originalPrice - finalPrice;
            const rate = originalPrice > 0 ? Math.round((amount / originalPrice) * 100) : 0;
            
            const data = {
                image: document.getElementById('savings-king-image').value,
                name: document.getElementById('savings-king-name').value,
                age: document.getElementById('savings-king-age').value,
                job: document.getElementById('savings-king-job').value,
                product: document.getElementById('savings-king-product').value,
                originalPrice: originalPrice,
                finalPrice: finalPrice,
                amount: amount,
                rate: rate
            };
            
            const preview = document.getElementById('savings-king-preview');
            if (preview) {
                preview.innerHTML = `
                    <div class="flex items-center gap-3 px-6 py-3 font-semibold text-sm">
                        <span class="text-2xl">ğŸ†</span>
                        <div class="text-left">
                            <div class="font-bold">ì´ë²ˆ ì£¼ ì ˆê°ì™•</div>
                            <div class="text-yellow-300 text-xs">-${data.rate}% ì ˆì•½ ì„±ê³µ!</div>
                        </div>
                        <a href="#savings-hero" class="text-yellow-300 text-lg hover:text-yellow-200 transition-colors">â†’</a>
                    </div>
                `;
            }
        }

        function previewSavingsKing() {
            // ë©”ì¸ í˜ì´ì§€ì—ì„œ ì ˆì•½ì™• ë°°ì§€ ë¯¸ë¦¬ë³´ê¸°
            updateSavingsKingAmountAndRate();
            
            const originalPrice = parseInt(document.getElementById('savings-king-original-price').value) || 0;
            const finalPrice = parseInt(document.getElementById('savings-king-final-price').value) || 0;
            const amount = originalPrice - finalPrice;
            const rate = originalPrice > 0 ? Math.round((amount / originalPrice) * 100) : 0;
            
            const data = {
                image: document.getElementById('savings-king-image').value,
                name: document.getElementById('savings-king-name').value,
                age: document.getElementById('savings-king-age').value,
                job: document.getElementById('savings-king-job').value,
                product: document.getElementById('savings-king-product').value,
                originalPrice: originalPrice,
                finalPrice: finalPrice,
                amount: amount,
                rate: rate
            };
            
            // ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ì—¬ ë¯¸ë¦¬ë³´ê¸°
            const mainPageUrl = new URL('index.html', window.location.origin);
            mainPageUrl.searchParams.set('preview', 'savings-king');
            mainPageUrl.searchParams.set('name', data.name);
            mainPageUrl.searchParams.set('age', data.age);
            mainPageUrl.searchParams.set('job', data.job);
            mainPageUrl.searchParams.set('product', data.product);
            mainPageUrl.searchParams.set('amount', data.amount);
            mainPageUrl.searchParams.set('rate', data.rate);
            mainPageUrl.searchParams.set('image', data.image);
            
            window.open(mainPageUrl.toString(), '_blank');
        }

        function resetSavingsKing() {
            if (confirm('ğŸ”„ ì ˆì•½ì™• ì •ë³´ë¥¼ ì´ˆê¸°ê°’ìœ¼ë¡œ ë¦¬ì…‹í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                // ê¸°ë³¸ê°’ìœ¼ë¡œ ë¦¬ì…‹
                document.getElementById('savings-king-image').value = 'https://images.unsplash.com/photo-1548036328-c9fa89d128fa?auto=format&fit=crop&w=600&q=80';
                document.getElementById('savings-king-name').value = 'ìµœOO';
                document.getElementById('savings-king-age').value = '20ëŒ€';
                document.getElementById('savings-king-job').value = 'ì§ì¥ì¸';
                document.getElementById('savings-king-product').value = 'íŒ¨ì…˜ë°±';
                document.getElementById('savings-king-original-price').value = '180000';
                document.getElementById('savings-king-final-price').value = '100000';
                updateSavingsKingAmountAndRate();
                
                // ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
                updateSavingsKingPreview();
                
                alert('âœ… ì ˆì•½ì™• ì •ë³´ê°€ ì´ˆê¸°ê°’ìœ¼ë¡œ ë¦¬ì…‹ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ë¡œê·¸ í‘œì‹œ ê¸°ëŠ¥
        function addSavingsKingLog(message, type = 'info') {
            const logsContainer = document.getElementById('savings-king-logs');
            if (!logsContainer) return;
            
            const timestamp = new Date().toLocaleTimeString('ko-KR');
            const logEntry = document.createElement('div');
            
            let bgColor = 'bg-blue-50';
            let textColor = 'text-blue-800';
            
            if (type === 'error') {
                bgColor = 'bg-red-50';
                textColor = 'text-red-800';
            } else if (type === 'success') {
                bgColor = 'bg-green-50';
                textColor = 'text-green-800';
            } else if (type === 'warning') {
                bgColor = 'bg-yellow-50';
                textColor = 'text-yellow-800';
            }
            
            logEntry.className = `mb-2 p-2 rounded ${bgColor} ${textColor}`;
            logEntry.innerHTML = `<span class="text-gray-500">[${timestamp}]</span> ${message}`;
            
            // ê¸°ì¡´ "ë¡œê·¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤..." ë©”ì‹œì§€ ì œê±°
            const placeholder = logsContainer.querySelector('.text-gray-500');
            if (placeholder) {
                placeholder.remove();
            }
            
            logsContainer.insertBefore(logEntry, logsContainer.firstChild);
            
            // ìµœëŒ€ 20ê°œ ë¡œê·¸ë§Œ ìœ ì§€
            const logs = logsContainer.children;
            if (logs.length > 20) {
                logsContainer.removeChild(logs[logs.length - 1]);
            }
            
            // ìë™ ìŠ¤í¬ë¡¤
            logsContainer.scrollTop = 0;
        }
        
        function clearSavingsKingLogs() {
            const logsContainer = document.getElementById('savings-king-logs');
            if (logsContainer) {
                logsContainer.innerHTML = '<div class="text-gray-500">ë¡œê·¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</div>';
            }
        }

        // Firebase ì—°ê²° í…ŒìŠ¤íŠ¸ í•¨ìˆ˜
        async function testFirebaseConnection() {
            console.log('ğŸ”§ Firebase ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            addSavingsKingLog('ğŸ”§ Firebase ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
            
            try {
                // Firebase ìƒíƒœ í™•ì¸
                const firebaseStatus = {
                    firebaseApp: !!window.firebaseApp,
                    firebaseAuth: !!window.firebaseAuth,
                    firebaseDb: !!window.firebaseDb,
                    firebaseFirestoreFunctions: !!window.firebaseFirestoreFunctions
                };
                
                console.log('ğŸ“Š Firebase ìƒíƒœ:', firebaseStatus);
                addSavingsKingLog(`ğŸ“Š Firebase ìƒíƒœ: ${JSON.stringify(firebaseStatus)}`, 'info');
                
                if (!firebaseStatus.firebaseDb) {
                    addSavingsKingLog('âŒ Firebase DBê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', 'error');
                    throw new Error('Firebase DBê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                }
                
                // ê°„ë‹¨í•œ ì½ê¸° í…ŒìŠ¤íŠ¸
                const { collection, doc, getDoc } = await import('https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js');
                const testRef = doc(collection(window.firebaseDb, 'adminSettings'), 'savingsKing');
                console.log('ğŸ“„ í…ŒìŠ¤íŠ¸ ë¬¸ì„œ ì°¸ì¡° ìƒì„±:', testRef.path);
                addSavingsKingLog(`ğŸ“„ í…ŒìŠ¤íŠ¸ ë¬¸ì„œ ì°¸ì¡° ìƒì„±: ${testRef.path}`, 'info');
                
                const docSnap = await getDoc(testRef);
                console.log('ğŸ“– í…ŒìŠ¤íŠ¸ ë¬¸ì„œ ì½ê¸° ì™„ë£Œ, ì¡´ì¬ ì—¬ë¶€:', docSnap.exists());
                addSavingsKingLog(`ğŸ“– í…ŒìŠ¤íŠ¸ ë¬¸ì„œ ì½ê¸° ì™„ë£Œ, ì¡´ì¬ ì—¬ë¶€: ${docSnap.exists()}`, 'info');
                
                if (docSnap.exists()) {
                    console.log('ğŸ“„ ê¸°ì¡´ ë°ì´í„°:', docSnap.data());
                    addSavingsKingLog(`ğŸ“„ ê¸°ì¡´ ë°ì´í„°: ${JSON.stringify(docSnap.data())}`, 'info');
                }
                
                // ê°„ë‹¨í•œ ì“°ê¸° í…ŒìŠ¤íŠ¸ (ê¸°ì¡´ ë°ì´í„° ìœ ì§€)
                const { setDoc, serverTimestamp } = await import('https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js');
                await setDoc(testRef, {
                    testTimestamp: serverTimestamp(),
                    testMessage: 'Firebase ì—°ê²° í…ŒìŠ¤íŠ¸ ì„±ê³µ'
                }, { merge: true });
                
                console.log('âœ… Firebase ì—°ê²° í…ŒìŠ¤íŠ¸ ì„±ê³µ');
                addSavingsKingLog('âœ… Firebase ì—°ê²° í…ŒìŠ¤íŠ¸ ì„±ê³µ', 'success');
                alert('âœ… Firebase ì—°ê²°ì´ ì •ìƒì…ë‹ˆë‹¤!\n\nì½˜ì†”ì—ì„œ ìì„¸í•œ ë¡œê·¸ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                
            } catch (error) {
                console.error('âŒ Firebase ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:', error);
                addSavingsKingLog(`âŒ Firebase ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`, 'error');
                
                console.error('âŒ ì—ëŸ¬ ìƒì„¸ ì •ë³´:', {
                    name: error.name,
                    message: error.message,
                    code: error.code,
                    stack: error.stack
                });
                
                addSavingsKingLog(`âŒ ì—ëŸ¬ ìƒì„¸ ì •ë³´: ${JSON.stringify({
                    name: error.name,
                    message: error.message,
                    code: error.code
                })}`, 'error');
                
                let errorMessage = 'âŒ Firebase ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨\n\n';
                if (error.message.includes('permission')) {
                    errorMessage += 'ê¶Œí•œ ì˜¤ë¥˜: ê´€ë¦¬ì ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
                    addSavingsKingLog('âŒ ê¶Œí•œ ì˜¤ë¥˜: ê´€ë¦¬ì ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.', 'error');
                } else if (error.message.includes('network')) {
                    errorMessage += 'ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
                    addSavingsKingLog('âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.', 'error');
                } else if (error.message.includes('Firebase')) {
                    errorMessage += 'Firebase ì˜¤ë¥˜: ì„œë¹„ìŠ¤ë¥¼ ë‹¤ì‹œ ì‹œì‘í•´ì£¼ì„¸ìš”.';
                    addSavingsKingLog('âŒ Firebase ì˜¤ë¥˜: ì„œë¹„ìŠ¤ë¥¼ ë‹¤ì‹œ ì‹œì‘í•´ì£¼ì„¸ìš”.', 'error');
                } else {
                    errorMessage += 'ì˜¤ë¥˜: ' + error.message;
                    addSavingsKingLog(`âŒ ê¸°íƒ€ ì˜¤ë¥˜: ${error.message}`, 'error');
                }
                
                alert(errorMessage);
            }
        }

        // ì „ì—­ í•¨ìˆ˜ë¡œ ë“±ë¡
        window.loadSavingsKingData = loadSavingsKingData;
        window.saveSavingsKing = saveSavingsKing;
        window.updateSavingsKingPreview = updateSavingsKingPreview;
        window.previewSavingsKing = previewSavingsKing;
        window.resetSavingsKing = resetSavingsKing;
        window.testFirebaseConnection = testFirebaseConnection;
        window.addSavingsKingLog = addSavingsKingLog;
        window.clearSavingsKingLogs = clearSavingsKingLogs;

        // Base64 ì´ë¯¸ì§€ ì••ì¶• í•¨ìˆ˜ (Firebase Storage ì—†ì´ ì‚¬ìš©)
        function compressBase64Image(base64DataUrl, targetSizeKB = 200) {
            return new Promise((resolve, reject) => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const img = new Image();
                
                img.onload = function() {
                    let { width, height } = img;
                    let quality = 0.8;
                    let maxWidth = 1200;
                    
                    // ì´ˆê¸° ì••ì¶•: ë„ˆë¹„ê°€ í¬ë©´ ë¦¬ì‚¬ì´ì¦ˆ
                    if (width > maxWidth) {
                        height = (height * maxWidth) / width;
                        width = maxWidth;
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    // í¬ê¸° ì²´í¬ ë° ì¬ì••ì¶• (ëª©í‘œ í¬ê¸°ê¹Œì§€ í’ˆì§ˆ ì¡°ì •)
                    const checkSize = (q) => {
                        const dataUrl = canvas.toDataURL('image/jpeg', q);
                        const sizeKB = (dataUrl.length * 0.75) / 1024; // base64 to KB
                        
                        if (sizeKB > targetSizeKB && q > 0.1) {
                            return checkSize(q - 0.1);
                        }
                        return dataUrl;
                    };
                    
                    const compressedDataUrl = checkSize(quality);
                    const finalSizeKB = (compressedDataUrl.length * 0.75) / 1024;
                    console.log(`ğŸ“· ì´ë¯¸ì§€ ì••ì¶• ì™„ë£Œ: ${finalSizeKB.toFixed(2)}KB (ëª©í‘œ: ${targetSizeKB}KB)`);
                    resolve(compressedDataUrl);
                };
                
                img.onerror = () => reject(new Error('ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨'));
                img.src = base64DataUrl; // Base64 ë°ì´í„°ë¥¼ ì§ì ‘ ì‚¬ìš©
            });
        }

        // ì´ë¯¸ì§€ ë°°ì—´ì„ ì²˜ë¦¬í•˜ì—¬ ì••ì¶• (Firebase Storage ì—†ì´ ì‚¬ìš©)
        async function processImagesForStorage(images) {
            if (!images || !Array.isArray(images) || images.length === 0) {
                return [];
            }

            const processedImages = [];
            for (let i = 0; i < images.length; i++) {
                const image = images[i];
                
                // ì´ë¯¸ URLì¸ ê²½ìš° ê·¸ëŒ€ë¡œ ì‚¬ìš©
                if (typeof image === 'string' && (image.startsWith('http://') || image.startsWith('https://'))) {
                    processedImages.push(image);
                } 
                // base64 ë°ì´í„°ì¸ ê²½ìš° ì••ì¶• (200KB ì´í•˜ë¡œ)
                else if (typeof image === 'string' && image.startsWith('data:image/')) {
                    try {
                        // ë¨¼ì € 200KBë¡œ ì••ì¶• ì‹œë„
                        let compressed = await compressBase64Image(image, 200);
                        const sizeKB = (compressed.length * 0.75) / 1024;
                        
                        // ì—¬ì „íˆ í¬ë©´ 100KBë¡œ ë” ê°•í•˜ê²Œ ì••ì¶•
                        if (sizeKB > 200) {
                            console.warn(`âš ï¸ ì´ë¯¸ì§€ ${i+1}ì´ ì—¬ì „íˆ í½ë‹ˆë‹¤ (${sizeKB.toFixed(2)}KB). ë” ê°•í•˜ê²Œ ì••ì¶•í•©ë‹ˆë‹¤.`);
                            compressed = await compressBase64Image(image, 100);
                        }
                        
                        processedImages.push(compressed);
                    } catch (error) {
                        console.error(`âŒ ì´ë¯¸ì§€ ${i+1} ì••ì¶• ì‹¤íŒ¨:`, error);
                        // ì••ì¶• ì‹¤íŒ¨ ì‹œ ì›ë³¸ ì‚¬ìš© (í¬ê¸° ì´ˆê³¼ ê°€ëŠ¥ì„± ìˆìŒ)
                        processedImages.push(image);
                    }
                } 
                // ê¸°íƒ€ ê²½ìš° ê·¸ëŒ€ë¡œ ì¶”ê°€
                else {
                    processedImages.push(image);
                }
            }

            return processedImages;
        }

        // ì˜ë¢° ë°ì´í„°ë¥¼ í›„ê¸° ê²Œì‹œíŒì— ì˜¬ë¦¬ê¸°
        async function publishToReviewBoard(requestId) {
            try {
                if (!confirm('ì´ ì˜ë¢°ê±´ì„ í›„ê¸°ê²Œì‹œíŒì— ë“±ë¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    return;
                }

                await waitForFirebase();
                const { collection, doc, getDoc, addDoc, serverTimestamp } = window.firebaseFirestoreFunctions;
                const db = window.firebaseDb;

                // ì˜ë¢° ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                const requestRef = doc(db, 'requests', requestId);
                const requestSnap = await getDoc(requestRef);

                if (!requestSnap.exists()) {
                    alert('ì˜ë¢° ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }

                const requestData = requestSnap.data();

                // í›„ê¸°ê²Œì‹œíŒ ë™ì˜ ì—¬ë¶€ í™•ì¸
                if (!requestData.reviewBoardAgree) {
                    alert('ì´ ì˜ë¢°ê±´ì€ í›„ê¸°ê²Œì‹œíŒ ìë™ë“±ë¡ì— ë™ì˜í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                    return;
                }

                // ì´ë¯¸ì§€ ì²˜ë¦¬: base64 ë°ì´í„°ë¥¼ ì••ì¶•í•˜ì—¬ í¬ê¸° ì¤„ì´ê¸°
                let processedImages = [];
                if (requestData.images && Array.isArray(requestData.images) && requestData.images.length > 0) {
                    console.log('ğŸ“· ì´ë¯¸ì§€ ì••ì¶• ì‹œì‘...', requestData.images.length, 'ê°œ');
                    processedImages = await processImagesForStorage(requestData.images);
                    console.log('âœ… ì´ë¯¸ì§€ ì••ì¶• ì™„ë£Œ:', processedImages.length, 'ê°œ');
                }

                // ì˜ë¢° ë°ì´í„°ì—ì„œ í›„ê¸° ë°ì´í„° ìƒì„±
                const originalPrice = requestData.price || requestData.originalPrice || '0';
                const finalPrice = requestData.adminResponse?.lowestPrice || requestData.finalPrice || '0';
                const savings = calculateSavings(originalPrice, finalPrice);
                const savingsPercent = calculateSavingsPercent(originalPrice, finalPrice);
                
                const reviewData = {
                    // ê¸°ë³¸ ì •ë³´
                    productName: requestData.productName || requestData.name || 'ì œí’ˆëª… ì—†ìŒ',
                    userName: requestData.userName || requestData.name || 'ìµëª…',
                    name: requestData.userName || requestData.name || 'ìµëª…', // í˜¸í™˜ì„±
                    email: requestData.email || '',
                    
                    // ê°€ê²© ì •ë³´
                    originalPrice: originalPrice,
                    finalPrice: finalPrice,
                    savings: savings,
                    savingsPercent: savingsPercent,
                    
                    // í›„ê¸° ë‚´ìš©
                    review: requestData.adminResponse?.additionalInfo || 
                           `PriceHunterë¥¼ í†µí•´ ${requestData.productName || requestData.name || 'ì œí’ˆ'}ì„ ê²€ì¦ë°›ì•˜ìŠµë‹ˆë‹¤. ` +
                           `ì˜ë¢° ê°€ê²© ${formatPrice(originalPrice)}ì—ì„œ ${formatPrice(finalPrice)}ë¡œ ì ˆì•½í–ˆìŠµë‹ˆë‹¤!`,
                    rating: 5, // ê¸°ë³¸ í‰ì 
                    
                    // ì´ë¯¸ì§€ (ì••ì¶•ëœ base64 ì´ë¯¸ì§€ ì‚¬ìš©)
                    images: processedImages,
                    photos: processedImages, // í˜¸í™˜ì„±
                    
                    // ì˜ë¢° ì •ë³´
                    requestId: requestId,
                    requestNumber: requestData.requestNumber || requestData.reqNum || '',
                    
                    // ê¸°íƒ€ ì •ë³´
                    badge: 'ìµœì €ê°€ ì œê³µì™„ë£Œ',
                    country: 'ëŒ€í•œë¯¼êµ­',
                    shipping: requestData.adminResponse?.shippingTime || '3ì¼',
                    method: requestData.adminResponse?.seller || 'PriceHunter ê²€ì¦',
                    
                    // ê´€ë¦¬ì ìŠ¹ì¸
                    approved: true, // ê´€ë¦¬ìê°€ ì§ì ‘ ë“±ë¡í•˜ë¯€ë¡œ ìë™ ìŠ¹ì¸
                    featured: false,
                    views: 0,
                    
                    // íƒ€ì„ìŠ¤íƒ¬í”„
                    createdAt: serverTimestamp(),
                    updatedAt: serverTimestamp()
                };

                // í›„ê¸° ì»¬ë ‰ì…˜ì— ì¶”ê°€
                const reviewsRef = collection(db, 'reviews');
                await addDoc(reviewsRef, reviewData);

                alert('í›„ê¸°ê²Œì‹œíŒì— ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
                console.log('âœ… í›„ê¸°ê²Œì‹œíŒ ë“±ë¡ ì™„ë£Œ:', reviewData);

            } catch (error) {
                console.error('âŒ í›„ê¸°ê²Œì‹œíŒ ë“±ë¡ ì‹¤íŒ¨:', error);
                alert('í›„ê¸°ê²Œì‹œíŒ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ì ˆì•½ ê¸ˆì•¡ ê³„ì‚°
        function calculateSavings(originalPrice, finalPrice) {
            const original = parseInt(String(originalPrice).replace(/[^0-9]/g, ''));
            const final = parseInt(String(finalPrice).replace(/[^0-9]/g, ''));
            if (isNaN(original) || isNaN(final)) return '0ì›';
            const savings = original - final;
            return savings > 0 ? savings.toLocaleString() + 'ì›' : '0ì›';
        }

        // ì ˆì•½ë¥  ê³„ì‚°
        function calculateSavingsPercent(originalPrice, finalPrice) {
            const original = parseInt(String(originalPrice).replace(/[^0-9]/g, ''));
            const final = parseInt(String(finalPrice).replace(/[^0-9]/g, ''));
            if (isNaN(original) || isNaN(final) || original === 0) return 0;
            const percent = Math.round(((original - final) / original) * 100);
            return percent > 0 ? percent : 0;
        }

        // Firebase ì´ˆê¸°í™” ëŒ€ê¸° í•¨ìˆ˜
        function waitForFirebase() {
            return new Promise((resolve) => {
                const checkFirebase = () => {
                    if (window.firebaseDb && window.firebaseFirestoreFunctions) {
                        resolve();
                    } else {
                        setTimeout(checkFirebase, 100);
                    }
                };
                checkFirebase();
            });
        }

        // ì „ì—­ í•¨ìˆ˜ë¡œ ë…¸ì¶œ
        window.publishToReviewBoard = publishToReviewBoard;

        // íŠ¹ì • ì˜ë¢°ë²ˆí˜¸ì˜ í›„ê¸° ë™ì˜ ìƒíƒœ ì—…ë°ì´íŠ¸ (ì„ì‹œ í•¨ìˆ˜)
        window.updateRequestReviewAgree = async function(requestNumber) {
            try {
                // # ê¸°í˜¸ ì œê±° (ìˆë“  ì—†ë“  ì‘ë™í•˜ë„ë¡)
                const cleanRequestNumber = requestNumber.replace(/^#/, '');
                const withHash = '#' + cleanRequestNumber;
                const withoutHash = cleanRequestNumber;

                if (!confirm(`ì˜ë¢°ë²ˆí˜¸ ${requestNumber}ì˜ í›„ê¸° ë™ì˜ ìƒíƒœë¥¼ trueë¡œ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                    return;
                }

                await waitForFirebase();
                const { collection, query, where, getDocs, doc, updateDoc } = window.firebaseFirestoreFunctions;
                const db = window.firebaseDb;

                const requestsRef = collection(db, 'requests');
                let found = false;

                // reqNum í•„ë“œë¡œ ê²€ìƒ‰ (# í¬í•¨)
                let q = query(requestsRef, where('reqNum', '==', withHash));
                let querySnapshot = await getDocs(q);
                
                if (!querySnapshot.empty) {
                    for (const docSnap of querySnapshot.docs) {
                        const requestRef = doc(db, 'requests', docSnap.id);
                        await updateDoc(requestRef, {
                            reviewBoardAgree: true
                        });
                        console.log(`âœ… ì˜ë¢° ${docSnap.id} (reqNum: ${withHash})ì˜ í›„ê¸° ë™ì˜ ìƒíƒœë¥¼ trueë¡œ ë³€ê²½í–ˆìŠµë‹ˆë‹¤.`);
                        found = true;
                    }
                }

                // reqNum í•„ë“œë¡œ ê²€ìƒ‰ (# ì—†ì´)
                if (!found) {
                    q = query(requestsRef, where('reqNum', '==', withoutHash));
                    querySnapshot = await getDocs(q);
                    
                    if (!querySnapshot.empty) {
                        for (const docSnap of querySnapshot.docs) {
                            const requestRef = doc(db, 'requests', docSnap.id);
                            await updateDoc(requestRef, {
                                reviewBoardAgree: true
                            });
                            console.log(`âœ… ì˜ë¢° ${docSnap.id} (reqNum: ${withoutHash})ì˜ í›„ê¸° ë™ì˜ ìƒíƒœë¥¼ trueë¡œ ë³€ê²½í–ˆìŠµë‹ˆë‹¤.`);
                            found = true;
                        }
                    }
                }

                // requestNumber í•„ë“œë¡œ ê²€ìƒ‰ (# í¬í•¨)
                if (!found) {
                    q = query(requestsRef, where('requestNumber', '==', withHash));
                    querySnapshot = await getDocs(q);
                    
                    if (!querySnapshot.empty) {
                        for (const docSnap of querySnapshot.docs) {
                            const requestRef = doc(db, 'requests', docSnap.id);
                            await updateDoc(requestRef, {
                                reviewBoardAgree: true
                            });
                            console.log(`âœ… ì˜ë¢° ${docSnap.id} (requestNumber: ${withHash})ì˜ í›„ê¸° ë™ì˜ ìƒíƒœë¥¼ trueë¡œ ë³€ê²½í–ˆìŠµë‹ˆë‹¤.`);
                            found = true;
                        }
                    }
                }

                // requestNumber í•„ë“œë¡œ ê²€ìƒ‰ (# ì—†ì´)
                if (!found) {
                    q = query(requestsRef, where('requestNumber', '==', withoutHash));
                    querySnapshot = await getDocs(q);
                    
                    if (!querySnapshot.empty) {
                        for (const docSnap of querySnapshot.docs) {
                            const requestRef = doc(db, 'requests', docSnap.id);
                            await updateDoc(requestRef, {
                                reviewBoardAgree: true
                            });
                            console.log(`âœ… ì˜ë¢° ${docSnap.id} (requestNumber: ${withoutHash})ì˜ í›„ê¸° ë™ì˜ ìƒíƒœë¥¼ trueë¡œ ë³€ê²½í–ˆìŠµë‹ˆë‹¤.`);
                            found = true;
                        }
                    }
                }

                if (!found) {
                    alert(`ì˜ë¢°ë²ˆí˜¸ ${requestNumber}ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n\nê²€ìƒ‰í•œ í˜•ì‹:\n- #${cleanRequestNumber}\n- ${cleanRequestNumber}`);
                    return;
                }

                alert(`ì˜ë¢°ë²ˆí˜¸ ${requestNumber}ì˜ í›„ê¸° ë™ì˜ ìƒíƒœë¥¼ trueë¡œ ë³€ê²½í–ˆìŠµë‹ˆë‹¤.`);
                
                // ì˜ë¢° ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                if (typeof renderRequestList === 'function') {
                    renderRequestList();
                }

            } catch (error) {
                console.error('âŒ í›„ê¸° ë™ì˜ ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
                alert('í›„ê¸° ë™ì˜ ìƒíƒœ ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        };

        // ==================== í›„ê¸° ê´€ë¦¬ ì‹œìŠ¤í…œ ====================
        let allReviews = [];
        let filteredReviews = [];
        let reviewsUnsubscribe = null;

        // í›„ê¸° ë°ì´í„° ë¡œë“œ
        async function loadReviewsData() {
            try {
                console.log('ğŸ“‹ í›„ê¸° ë°ì´í„° ë¡œë“œ ì‹œì‘...');
                
                await waitForFirebase();
                const { collection, getDocs, query, where } = window.firebaseFirestoreFunctions;
                const db = window.firebaseDb;

                const reviewsRef = collection(db, 'reviews');
                // ì¸ë±ìŠ¤ ì—†ì´ë„ ì‘ë™í•˜ë„ë¡ ëª¨ë“  í›„ê¸° ê°€ì ¸ì˜¤ê¸° (í´ë¼ì´ì–¸íŠ¸ì—ì„œ í•„í„°ë§)
                const q = query(reviewsRef);
                
                const querySnapshot = await getDocs(q);
                allReviews = [];
                
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    allReviews.push({
                        id: doc.id,
                        ...data,
                        createdAt: data.createdAt?.toDate ? data.createdAt.toDate() : new Date(data.createdAt || Date.now())
                    });
                });

                // í´ë¼ì´ì–¸íŠ¸ì—ì„œ ìµœì‹ ìˆœ ì •ë ¬
                allReviews.sort((a, b) => b.createdAt - a.createdAt);
                
                console.log(`ğŸ“Š ë¡œë“œëœ í›„ê¸°: ${allReviews.length}ê°œ (ìŠ¹ì¸: ${allReviews.filter(r => r.approved === true).length}ê°œ, ëŒ€ê¸°: ${allReviews.filter(r => r.approved !== true).length}ê°œ)`);

                filteredReviews = [...allReviews];
                updateReviewStatistics();
                renderReviewsTable();
                
                console.log(`âœ… í›„ê¸° ë°ì´í„° ë¡œë“œ ì™„ë£Œ: ${allReviews.length}ê°œ`);
                
            } catch (error) {
                console.error('âŒ í›„ê¸° ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                const tbody = document.getElementById('reviews-table-body');
                if (tbody) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="7" class="px-6 py-8 text-center text-red-500">
                                í›„ê¸°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${error.message}
                            </td>
                        </tr>
                    `;
                }
            }
        }

        // ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ êµ¬ë…
        function subscribeToReviews() {
            if (reviewsUnsubscribe) {
                reviewsUnsubscribe();
            }

            try {
                const { collection, query, where, onSnapshot } = window.firebaseFirestoreFunctions;
                const db = window.firebaseDb;

                const reviewsRef = collection(db, 'reviews');
                // ì¸ë±ìŠ¤ ì—†ì´ë„ ì‘ë™í•˜ë„ë¡ ëª¨ë“  í›„ê¸° ê°€ì ¸ì˜¤ê¸° (í´ë¼ì´ì–¸íŠ¸ì—ì„œ í•„í„°ë§)
                const q = query(reviewsRef);
                
                reviewsUnsubscribe = onSnapshot(q, (snapshot) => {
                    console.log('ğŸ”„ í›„ê¸° ë°ì´í„° ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸...');
                    allReviews = [];
                    
                    snapshot.forEach((doc) => {
                        const data = doc.data();
                        allReviews.push({
                            id: doc.id,
                            ...data,
                            createdAt: data.createdAt?.toDate ? data.createdAt.toDate() : new Date(data.createdAt || Date.now())
                        });
                    });

                    // í´ë¼ì´ì–¸íŠ¸ì—ì„œ ìµœì‹ ìˆœ ì •ë ¬
                    allReviews.sort((a, b) => b.createdAt - a.createdAt);

                    filteredReviews = [...allReviews];
                    applyReviewFilters();
                    updateReviewStatistics();
                    renderReviewsTable();
                    
                    console.log(`âœ… í›„ê¸° ë°ì´í„° ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì™„ë£Œ: ${allReviews.length}ê°œ`);
                }, (error) => {
                    console.error('âŒ í›„ê¸° ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
                });
                
            } catch (error) {
                console.error('âŒ í›„ê¸° êµ¬ë… ì‹¤íŒ¨:', error);
            }
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateReviewStatistics() {
            const total = allReviews.length;
            const approved = allReviews.filter(r => r.approved === true).length;
            const pending = allReviews.filter(r => r.approved !== true).length;
            const avgRating = total > 0 ? 
                (allReviews.reduce((sum, r) => sum + (r.rating || 5), 0) / total).toFixed(1) : 0;

            document.getElementById('reviews-total').textContent = total;
            document.getElementById('reviews-approved').textContent = approved;
            document.getElementById('reviews-pending').textContent = pending;
            document.getElementById('reviews-avg-rating').textContent = avgRating;
        }

        // í•„í„° ì ìš©
        function applyReviewFilters() {
            const searchTerm = document.getElementById('review-search')?.value.toLowerCase() || '';
            const statusFilter = document.getElementById('review-status-filter')?.value || 'all';

            filteredReviews = allReviews.filter(review => {
                // ê²€ìƒ‰ í•„í„°
                const matchesSearch = !searchTerm || 
                    (review.productName || '').toLowerCase().includes(searchTerm) ||
                    (review.userName || review.name || '').toLowerCase().includes(searchTerm) ||
                    (review.review || '').toLowerCase().includes(searchTerm);

                // ìƒíƒœ í•„í„°
                const matchesStatus = statusFilter === 'all' ||
                    (statusFilter === 'approved' && review.approved === true) ||
                    (statusFilter === 'pending' && review.approved !== true);

                return matchesSearch && matchesStatus;
            });

            renderReviewsTable();
        }

        // í•„í„° ì´ˆê¸°í™”
        function clearReviewFilters() {
            document.getElementById('review-search').value = '';
            document.getElementById('review-status-filter').value = 'all';
            applyReviewFilters();
        }

        // í›„ê¸° í…Œì´ë¸” ë Œë”ë§
        function renderReviewsTable() {
            const tbody = document.getElementById('reviews-table-body');
            if (!tbody) return;

            if (filteredReviews.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="px-6 py-8 text-center text-gray-500">
                            <div class="text-4xl mb-4">ğŸ“</div>
                            <p class="text-lg">í›„ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                            <p class="text-sm text-gray-400 mt-2">í•„í„°ë¥¼ ì¡°ì •í•˜ê±°ë‚˜ ìƒˆ í›„ê¸°ë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”</p>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = filteredReviews.map(review => {
                const savings = review.savings || '0ì›';
                const savingsPercent = review.savingsPercent || 0;
                const rating = review.rating || 5;
                const stars = 'â˜…'.repeat(rating) + 'â˜†'.repeat(5 - rating);
                const date = review.createdAt ? new Date(review.createdAt).toLocaleDateString('ko-KR') : 'ë‚ ì§œ ì—†ìŒ';
                const statusBadge = review.approved === true 
                    ? '<span class="px-2 py-1 text-xs rounded-full bg-green-100 text-green-800 font-semibold">ìŠ¹ì¸ë¨</span>'
                    : '<span class="px-2 py-1 text-xs rounded-full bg-yellow-100 text-yellow-800 font-semibold">ëŒ€ê¸° ì¤‘</span>';

                return `
                    <tr class="hover:bg-gray-50 transition-colors">
                        <td class="px-6 py-4">
                            <div class="text-sm font-medium text-gray-900">${review.productName || 'ì œí’ˆëª… ì—†ìŒ'}</div>
                            <div class="text-xs text-gray-500 mt-1 line-clamp-2">${(review.review || '').substring(0, 50)}${(review.review || '').length > 50 ? '...' : ''}</div>
                        </td>
                        <td class="px-6 py-4">
                            <div class="flex items-center">
                                <div class="w-10 h-10 bg-gradient-to-br from-purple-400 to-pink-400 rounded-full flex items-center justify-center text-white font-bold mr-3">
                                    ${(review.userName || review.name || 'ìµ').charAt(0)}
                                </div>
                                <div class="text-sm font-medium text-gray-900">${review.userName || review.name || 'ìµëª…'}</div>
                            </div>
                        </td>
                        <td class="px-6 py-4">
                            <div class="text-sm">
                                <div class="text-gray-500 line-through">ì˜ë¢° ê°€ê²©: ${formatPrice(review.originalPrice)}</div>
                                <div class="text-green-600 font-semibold">${formatPrice(review.finalPrice)}</div>
                                <div class="text-red-600 font-bold">${savings} (${savingsPercent}%)</div>
                            </div>
                        </td>
                        <td class="px-6 py-4">
                            <div class="text-yellow-500 text-lg">${stars}</div>
                            <div class="text-xs text-gray-500">${rating}/5</div>
                        </td>
                        <td class="px-6 py-4">
                            ${statusBadge}
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-500">
                            ${date}
                        </td>
                        <td class="px-6 py-4">
                            <div class="flex gap-2">
                                <button onclick="editReview('${review.id}')" class="px-3 py-1 bg-blue-500 text-white text-xs rounded hover:bg-blue-600 transition">
                                    âœï¸ ìˆ˜ì •
                                </button>
                                <button onclick="deleteReview('${review.id}')" class="px-3 py-1 bg-red-500 text-white text-xs rounded hover:bg-red-600 transition">
                                    ğŸ—‘ï¸ ì‚­ì œ
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // í›„ê¸° ìˆ˜ì •
        async function editReview(reviewId) {
            const review = allReviews.find(r => r.id === reviewId);
            if (!review) {
                alert('í›„ê¸°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // ìˆ˜ì • ëª¨ë‹¬ ìƒì„±
            const modal = document.createElement('div');
            modal.id = 'edit-review-modal';
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-xl shadow-2xl p-6 max-w-3xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">âœï¸ í›„ê¸° ìˆ˜ì •</h2>
                        <button onclick="closeEditReviewModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                    </div>
                    <form id="edit-review-form" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ì œí’ˆëª… *</label>
                                <input type="text" id="edit-productName" value="${escapeHtml(review.productName || '')}" 
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ì‘ì„±ìëª… *</label>
                                <input type="text" id="edit-userName" value="${escapeHtml(review.userName || review.name || '')}" 
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ì˜ë¢° ê°€ê²© *</label>
                                <input type="text" id="edit-originalPrice" value="${escapeHtml(review.originalPrice || '')}" 
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">êµ¬ë§¤ ê°€ê²© *</label>
                                <input type="text" id="edit-finalPrice" value="${escapeHtml(review.finalPrice || '')}" 
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">í‰ì  *</label>
                                <select id="edit-rating" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option value="5" ${review.rating === 5 ? 'selected' : ''}>5ì </option>
                                    <option value="4" ${review.rating === 4 ? 'selected' : ''}>4ì </option>
                                    <option value="3" ${review.rating === 3 ? 'selected' : ''}>3ì </option>
                                    <option value="2" ${review.rating === 2 ? 'selected' : ''}>2ì </option>
                                    <option value="1" ${review.rating === 1 ? 'selected' : ''}>1ì </option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">í›„ê¸° ë‚´ìš© *</label>
                            <textarea id="edit-review" rows="4" 
                                      class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>${escapeHtml(review.review || '')}</textarea>
                        </div>
                        <div class="flex items-center gap-6">
                            <label class="flex items-center">
                                <input type="checkbox" id="edit-approved" ${review.approved === true ? 'checked' : ''} class="mr-2 w-5 h-5">
                                <span class="text-sm font-medium text-gray-700">ìŠ¹ì¸ë¨</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="edit-featured" ${review.featured === true ? 'checked' : ''} class="mr-2 w-5 h-5">
                                <span class="text-sm font-medium text-gray-700">ì¶”ì²œ í›„ê¸°</span>
                            </label>
                        </div>
                        <div class="flex justify-end gap-3 pt-4 border-t">
                            <button type="button" onclick="closeEditReviewModal()" 
                                    class="px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition">
                                ì·¨ì†Œ
                            </button>
                            <button type="submit" 
                                    class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                                ì €ì¥
                            </button>
                        </div>
                    </form>
                </div>
            `;
            document.body.appendChild(modal);

            // í¼ ì œì¶œ ì´ë²¤íŠ¸
            document.getElementById('edit-review-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                await saveReview(reviewId);
            });
        }

        // HTML ì´ìŠ¤ì¼€ì´í”„ í•¨ìˆ˜
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // í›„ê¸° ì €ì¥
        async function saveReview(reviewId) {
            try {
                await waitForFirebase();
                const { doc, updateDoc, serverTimestamp } = window.firebaseFirestoreFunctions;
                const db = window.firebaseDb;

                const originalPrice = document.getElementById('edit-originalPrice').value;
                const finalPrice = document.getElementById('edit-finalPrice').value;
                const original = parseInt(String(originalPrice).replace(/[^0-9]/g, ''));
                const final = parseInt(String(finalPrice).replace(/[^0-9]/g, ''));
                
                let savings = '0ì›';
                let savingsPercent = 0;
                if (!isNaN(original) && !isNaN(final) && original > 0) {
                    const savingsAmount = original - final;
                    savings = savingsAmount > 0 ? savingsAmount.toLocaleString() + 'ì›' : '0ì›';
                    savingsPercent = original > 0 ? Math.round(((original - final) / original) * 100) : 0;
                }

                const reviewData = {
                    productName: document.getElementById('edit-productName').value,
                    userName: document.getElementById('edit-userName').value,
                    name: document.getElementById('edit-userName').value, // í˜¸í™˜ì„±
                    originalPrice: originalPrice,
                    finalPrice: finalPrice,
                    savings: savings,
                    savingsPercent: savingsPercent,
                    rating: parseInt(document.getElementById('edit-rating').value),
                    review: document.getElementById('edit-review').value,
                    approved: document.getElementById('edit-approved').checked,
                    featured: document.getElementById('edit-featured').checked,
                    updatedAt: serverTimestamp()
                };

                const reviewRef = doc(db, 'reviews', reviewId);
                await updateDoc(reviewRef, reviewData);

                alert('í›„ê¸°ê°€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
                closeEditReviewModal();
                
                // ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ê°€ ìë™ìœ¼ë¡œ ë°˜ì˜ë¨
                
            } catch (error) {
                console.error('í›„ê¸° ìˆ˜ì • ì‹¤íŒ¨:', error);
                alert('í›„ê¸° ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ìˆ˜ì • ëª¨ë‹¬ ë‹«ê¸°
        function closeEditReviewModal() {
            const modal = document.getElementById('edit-review-modal');
            if (modal) {
                modal.remove();
            }
        }

        // í›„ê¸° ì‚­ì œ
        async function deleteReview(reviewId) {
            if (!confirm('ì •ë§ë¡œ ì´ í›„ê¸°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì‚­ì œëœ í›„ê¸°ëŠ” ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                return;
            }

            try {
                await waitForFirebase();
                const { doc, deleteDoc } = window.firebaseFirestoreFunctions;
                const db = window.firebaseDb;

                const reviewRef = doc(db, 'reviews', reviewId);
                await deleteDoc(reviewRef);
                
                alert('í›„ê¸°ê°€ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
                
                // ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ê°€ ìë™ìœ¼ë¡œ ë°˜ì˜ë¨
                
            } catch (error) {
                console.error('í›„ê¸° ì‚­ì œ ì‹¤íŒ¨:', error);
                alert('í›„ê¸° ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ì „ì—­ í•¨ìˆ˜ë¡œ ë…¸ì¶œ
        window.loadReviewsData = loadReviewsData;
        window.subscribeToReviews = subscribeToReviews;
        window.editReview = editReview;
        window.deleteReview = deleteReview;
        window.closeEditReviewModal = closeEditReviewModal;
        window.clearReviewFilters = clearReviewFilters;

        // í•„í„° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('review-search');
            const statusFilter = document.getElementById('review-status-filter');
            
            if (searchInput) {
                searchInput.addEventListener('input', applyReviewFilters);
            }
            if (statusFilter) {
                statusFilter.addEventListener('change', applyReviewFilters);
            }
        });
    </script>
</body>
</html>
