<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ | PriceHunter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
      body { font-family: 'Noto Sans KR', 'Inter', sans-serif; }
      .tab-btn.active {
        background-color: #ec4899;
        color: white;
      }
      .filter-btn.active {
        background-color: #6b7280;
        color: white;
      }
      .sidebar-item.active {
        background-color: #ec4899;
        color: white;
      }
    </style>
  </head>
  <body class="bg-gradient-to-br from-gray-50 via-blue-50 to-emerald-50 min-h-screen">
    <div class="flex h-screen">
      <!-- ì‚¬ì´ë“œë°” -->
      <div class="w-64 bg-white shadow-lg">
        <div class="p-6 border-b">
          <h1 class="text-xl font-bold text-pink-600">PriceHunter</h1>
          <p class="text-sm text-gray-500">ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</p>
        </div>
        
        <nav class="p-4">
          <div class="space-y-2">
            <button class="sidebar-item w-full text-left px-4 py-3 rounded-lg font-semibold hover:bg-pink-50 transition active" onclick="switchSection('dashboard')">
              ğŸ“Š ëŒ€ì‹œë³´ë“œ
            </button>
            <button class="sidebar-item w-full text-left px-4 py-3 rounded-lg font-semibold hover:bg-pink-50 transition" onclick="switchSection('requests')">
              ğŸ“‹ ì˜ë¢° ê´€ë¦¬
            </button>
            <button class="sidebar-item w-full text-left px-4 py-3 rounded-lg font-semibold hover:bg-pink-50 transition" onclick="switchSection('inquiries')">
              ğŸ’¬ 1:1 ë¬¸ì˜
            </button>
            <button class="sidebar-item w-full text-left px-4 py-3 rounded-lg font-semibold hover:bg-pink-50 transition" onclick="switchSection('members')">
              ğŸ‘¥ íšŒì› ê´€ë¦¬
            </button>
            <button class="sidebar-item w-full text-left px-4 py-3 rounded-lg font-semibold hover:bg-pink-50 transition" onclick="switchSection('data')">
              ğŸ’¾ ë°ì´í„° ê´€ë¦¬
            </button>
          </div>
        </nav>
        
        <div class="absolute bottom-4 left-4 right-4">
          <button onclick="adminLogout()" class="w-full px-4 py-2 bg-red-500 text-white rounded-lg font-semibold hover:bg-red-600 transition">
            ğŸ”“ ê´€ë¦¬ì ë¡œê·¸ì•„ì›ƒ
          </button>
        </div>
      </div>

      <!-- ë©”ì¸ ì½˜í…ì¸  -->
      <div class="flex-1 overflow-auto">
        <!-- ëŒ€ì‹œë³´ë“œ ì„¹ì…˜ -->
        <div id="dashboard-section" class="section-content p-8">
          <h2 class="text-2xl font-bold text-gray-800 mb-6">ğŸ“Š ëŒ€ì‹œë³´ë“œ</h2>
          
          <!-- í†µê³„ ì¹´ë“œ -->
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-xl shadow-lg p-6">
              <div class="flex items-center">
                <div class="p-3 bg-blue-100 rounded-lg">
                  <span class="text-2xl">ğŸ“‹</span>
                </div>
                <div class="ml-4">
                  <p class="text-sm text-gray-500">ì´ ì˜ë¢°</p>
                  <p class="text-2xl font-bold text-gray-800" id="total-requests">0</p>
                </div>
              </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-lg p-6">
              <div class="flex items-center">
                <div class="p-3 bg-green-100 rounded-lg">
                  <span class="text-2xl">âœ…</span>
                </div>
                <div class="ml-4">
                  <p class="text-sm text-gray-500">ì™„ë£Œëœ ì˜ë¢°</p>
                  <p class="text-2xl font-bold text-gray-800" id="completed-requests">0</p>
                </div>
              </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-lg p-6">
              <div class="flex items-center">
                <div class="p-3 bg-orange-100 rounded-lg">
                  <span class="text-2xl">ğŸ‘¥</span>
                </div>
                <div class="ml-4">
                  <p class="text-sm text-gray-500">ì´ íšŒì›</p>
                  <p class="text-2xl font-bold text-gray-800" id="total-members">0</p>
                </div>
              </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-lg p-6">
              <div class="flex items-center">
                <div class="p-3 bg-purple-100 rounded-lg">
                  <span class="text-2xl">ğŸ’¬</span>
                </div>
                <div class="ml-4">
                  <p class="text-sm text-gray-500">ë¯¸ë‹µë³€ ë¬¸ì˜</p>
                  <p class="text-2xl font-bold text-gray-800" id="pending-inquiries">0</p>
                </div>
              </div>
            </div>
          </div>
          
          <!-- ìµœê·¼ í™œë™ -->
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="bg-white rounded-xl shadow-lg p-6">
              <h3 class="text-lg font-semibold text-gray-800 mb-4">ìµœê·¼ ì˜ë¢°</h3>
              <div id="recent-requests" class="space-y-3">
                <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
              </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-lg p-6">
              <h3 class="text-lg font-semibold text-gray-800 mb-4">ìµœê·¼ ë¬¸ì˜</h3>
              <div id="recent-inquiries" class="space-y-3">
                <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
              </div>
            </div>
          </div>
        </div>

        <!-- ì˜ë¢° ê´€ë¦¬ ì„¹ì…˜ -->
        <div id="requests-section" class="section-content p-8 hidden">
          <h2 class="text-2xl font-bold text-gray-800 mb-6">ğŸ“‹ ì˜ë¢° ê´€ë¦¬</h2>
          
          <!-- ê²€ìƒ‰ ë° í•„í„° -->
          <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <div class="flex flex-wrap gap-4 items-center">
              <input type="text" id="request-search" placeholder="ì˜ë¢°ë²ˆí˜¸, íšŒì›ëª…, ì œí’ˆëª…ìœ¼ë¡œ ê²€ìƒ‰" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-400 focus:outline-none flex-1 min-w-64">
              <button onclick="clearRequestSearch()" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition">ì´ˆê¸°í™”</button>
              
              <select id="request-filter" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-400 focus:outline-none">
                <option value="all">ì „ì²´</option>
                <option value="new">ì‹ ê·œì˜ë¢°</option>
                <option value="progress">ì§„í–‰ì¤‘</option>
                <option value="complete">ì™„ë£Œ</option>
              </select>
            </div>
          </div>
          
          <!-- ì˜ë¢° ëª©ë¡ -->
          <div class="bg-white rounded-xl shadow-lg overflow-hidden">
            <div class="overflow-x-auto">
              <table class="w-full">
                <thead class="bg-pink-50">
                  <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-pink-700 uppercase tracking-wider">ì˜ë¢°ë²ˆí˜¸</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-pink-700 uppercase tracking-wider">íšŒì›ëª…</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-pink-700 uppercase tracking-wider">ì œí’ˆëª…</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-pink-700 uppercase tracking-wider">ì§„í–‰ìƒí™©</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-pink-700 uppercase tracking-wider">ì˜ë¢°ì¼ì‹œ</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-pink-700 uppercase tracking-wider">ì‘ì—…</th>
                  </tr>
                </thead>
                <tbody id="requests-table-body" class="bg-white divide-y divide-gray-200">
                  <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- 1:1 ë¬¸ì˜ ì„¹ì…˜ -->
        <div id="inquiries-section" class="section-content p-8 hidden">
          <h2 class="text-2xl font-bold text-gray-800 mb-6">ğŸ’¬ 1:1 ë¬¸ì˜ ê´€ë¦¬</h2>
          
          <!-- ë¬¸ì˜ ëª©ë¡ -->
          <div class="bg-white rounded-xl shadow-lg overflow-hidden">
            <div class="overflow-x-auto">
              <table class="w-full">
                <thead class="bg-blue-50">
                  <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-blue-700 uppercase tracking-wider">ë¬¸ì˜ë²ˆí˜¸</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-blue-700 uppercase tracking-wider">íšŒì›ëª…</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-blue-700 uppercase tracking-wider">ì œëª©</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-blue-700 uppercase tracking-wider">ìƒíƒœ</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-blue-700 uppercase tracking-wider">ë“±ë¡ì¼ì‹œ</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-blue-700 uppercase tracking-wider">ì‘ì—…</th>
                  </tr>
                </thead>
                <tbody id="inquiries-table-body" class="bg-white divide-y divide-gray-200">
                  <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- íšŒì› ê´€ë¦¬ ì„¹ì…˜ -->
        <div id="members-section" class="section-content p-8 hidden">
          <h2 class="text-2xl font-bold text-gray-800 mb-6">ğŸ‘¥ íšŒì› ê´€ë¦¬</h2>
          
          <!-- íšŒì› ëª©ë¡ -->
          <div class="bg-white rounded-xl shadow-lg overflow-hidden">
            <div class="overflow-x-auto">
              <table class="w-full">
                <thead class="bg-green-50">
                  <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-green-700 uppercase tracking-wider">íšŒì›ëª…</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-green-700 uppercase tracking-wider">ì´ë©”ì¼</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-green-700 uppercase tracking-wider">íœ´ëŒ€í°</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-green-700 uppercase tracking-wider">ê°€ì…ì¼</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-green-700 uppercase tracking-wider">ì˜ë¢°ìˆ˜</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-green-700 uppercase tracking-wider">ì‘ì—…</th>
                  </tr>
                </thead>
                <tbody id="members-table-body" class="bg-white divide-y divide-gray-200">
                  <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- ë°ì´í„° ê´€ë¦¬ ì„¹ì…˜ -->
        <div id="data-section" class="section-content p-8 hidden">
          <h2 class="text-2xl font-bold text-gray-800 mb-6">ğŸ’¾ ë°ì´í„° ê´€ë¦¬</h2>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- ë°ì´í„° ë‚´ë³´ë‚´ê¸° -->
            <div class="bg-white rounded-xl shadow-lg p-6">
              <h3 class="text-lg font-semibold text-gray-800 mb-4">ğŸ“¥ ë°ì´í„° ë‚´ë³´ë‚´ê¸°</h3>
              <p class="text-sm text-gray-600 mb-4">í˜„ì¬ ëª¨ë“  ë°ì´í„°ë¥¼ JSON íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œí•©ë‹ˆë‹¤.</p>
              <button onclick="exportAllData()" class="w-full px-4 py-2 bg-green-500 text-white rounded-lg font-semibold hover:bg-green-600 transition">
                ë°ì´í„° ë‚´ë³´ë‚´ê¸°
              </button>
            </div>
            
            <!-- ë°ì´í„° ê°€ì ¸ì˜¤ê¸° -->
            <div class="bg-white rounded-xl shadow-lg p-6">
              <h3 class="text-lg font-semibold text-gray-800 mb-4">ğŸ“¤ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°</h3>
              <p class="text-sm text-gray-600 mb-4">ë°±ì—… íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì—¬ ë°ì´í„°ë¥¼ ë³µì›í•©ë‹ˆë‹¤.</p>
              <input type="file" id="import-file" accept=".json" class="hidden" onchange="importData(this.files[0])">
              <button onclick="document.getElementById('import-file').click()" class="w-full px-4 py-2 bg-blue-500 text-white rounded-lg font-semibold hover:bg-blue-600 transition">
                ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
              </button>
            </div>
            
            <!-- í…ŒìŠ¤íŠ¸ ë°ì´í„° ì •ë¦¬ -->
            <div class="bg-white rounded-xl shadow-lg p-6">
              <h3 class="text-lg font-semibold text-gray-800 mb-4">ğŸ§¹ í…ŒìŠ¤íŠ¸ ë°ì´í„° ì •ë¦¬</h3>
              <p class="text-sm text-gray-600 mb-4">í…ŒìŠ¤íŠ¸ìš© ë°ì´í„°ë¥¼ ëª¨ë‘ ì‚­ì œí•©ë‹ˆë‹¤.</p>
              <button onclick="cleanupTestData()" class="w-full px-4 py-2 bg-red-500 text-white rounded-lg font-semibold hover:bg-red-600 transition">
                í…ŒìŠ¤íŠ¸ ë°ì´í„° ì •ë¦¬
              </button>
            </div>
            
            <!-- ì „ì²´ ë°ì´í„° ì´ˆê¸°í™” -->
            <div class="bg-white rounded-xl shadow-lg p-6">
              <h3 class="text-lg font-semibold text-gray-800 mb-4">âš ï¸ ì „ì²´ ì´ˆê¸°í™”</h3>
              <p class="text-sm text-gray-600 mb-4">ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•©ë‹ˆë‹¤. (ë³µêµ¬ ë¶ˆê°€)</p>
              <button onclick="clearAllData()" class="w-full px-4 py-2 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700 transition">
                ì „ì²´ ë°ì´í„° ì´ˆê¸°í™”
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ëª¨ë‹¬ -->
    <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
      <div class="flex items-center justify-center min-h-screen p-4">
        <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
          <div class="p-6">
            <div class="flex justify-between items-center mb-4">
              <h3 id="modal-title" class="text-lg font-semibold text-gray-800"></h3>
              <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                <span class="text-2xl">Ã—</span>
              </button>
            </div>
            <div id="modal-content">
              <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // ê´€ë¦¬ì ê¶Œí•œ í™•ì¸
      function isAdmin() {
        const adminMode = localStorage.getItem('adminMode') === 'true';
        const isAdmin = localStorage.getItem('isAdmin') === 'true';
        return adminMode || isAdmin;
      }

      // ì „ì—­ ë³€ìˆ˜
      let currentSection = 'dashboard';
      let allRequests = [];
      let allInquiries = [];
      let allMembers = [];

      // ì„¹ì…˜ ì „í™˜
      function switchSection(section) {
        currentSection = section;
        
        // ëª¨ë“  ì„¹ì…˜ ìˆ¨ê¸°ê¸°
        document.querySelectorAll('.section-content').forEach(el => {
          el.classList.add('hidden');
        });
        
        // ëª¨ë“  ì‚¬ì´ë“œë°” ì•„ì´í…œ ë¹„í™œì„±í™”
        document.querySelectorAll('.sidebar-item').forEach(el => {
          el.classList.remove('active');
        });
        
        // ì„ íƒëœ ì„¹ì…˜ í‘œì‹œ
        document.getElementById(section + '-section').classList.remove('hidden');
        
        // ì„ íƒëœ ì‚¬ì´ë“œë°” ì•„ì´í…œ í™œì„±í™”
        event.target.classList.add('active');
        
        // ì„¹ì…˜ë³„ ë°ì´í„° ë¡œë“œ
        loadSectionData(section);
      }

      // ì„¹ì…˜ë³„ ë°ì´í„° ë¡œë“œ
      function loadSectionData(section) {
        switch(section) {
          case 'dashboard':
            loadDashboardData();
            break;
          case 'requests':
            loadRequestsData();
            break;
          case 'inquiries':
            loadInquiriesData();
            break;
          case 'members':
            loadMembersData();
            break;
        }
      }

      // ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë“œ
      function loadDashboardData() {
        // í†µê³„ ê³„ì‚°
        const requests = getAllRequests();
        const inquiries = getAllInquiries();
        const members = getAllMembers();
        
        const completedRequests = requests.filter(req => {
          const reqNum = req.key.replace('request-', '');
          const result = localStorage.getItem('result-' + reqNum);
          if (result) {
            const resultData = JSON.parse(result);
            return resultData.price && resultData.origin && resultData.summary && resultData.link;
          }
          return false;
        });
        
        const pendingInquiries = inquiries.filter(inq => !inq.answered);
        
        // í†µê³„ ì—…ë°ì´íŠ¸
        document.getElementById('total-requests').textContent = requests.length;
        document.getElementById('completed-requests').textContent = completedRequests.length;
        document.getElementById('total-members').textContent = members.length;
        document.getElementById('pending-inquiries').textContent = pendingInquiries.length;
        
        // ìµœê·¼ í™œë™ ë¡œë“œ
        loadRecentActivities();
      }

      // ì˜ë¢° ë°ì´í„° ë¡œë“œ
      function loadRequestsData() {
        allRequests = getAllRequests();
        renderRequestsTable();
      }

      // ë¬¸ì˜ ë°ì´í„° ë¡œë“œ
      function loadInquiriesData() {
        allInquiries = getAllInquiries();
        renderInquiriesTable();
      }

      // íšŒì› ë°ì´í„° ë¡œë“œ
      function loadMembersData() {
        allMembers = getAllMembers();
        renderMembersTable();
      }

      // ë°ì´í„° ê°€ì ¸ì˜¤ê¸° í•¨ìˆ˜ë“¤
      function getAllRequests() {
        const list = [];
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          if (key && key.startsWith('request-') && !key.includes('TEST') && !key.startsWith('requestCount-')) {
            try {
              const req = JSON.parse(localStorage.getItem(key));
              list.push({ key, ...req });
            } catch (e) {
              console.log(`JSON íŒŒì‹± ì‹¤íŒ¨: ${key}`, e);
            }
          }
        }
        return list.sort((a, b) => (b.date || 0) - (a.date || 0));
      }

      function getAllInquiries() {
        const list = [];
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          if (key && key.startsWith('inquiry-')) {
            try {
              const inq = JSON.parse(localStorage.getItem(key));
              list.push({ key, ...inq });
            } catch (e) {
              console.log(`JSON íŒŒì‹± ì‹¤íŒ¨: ${key}`, e);
            }
          }
        }
        return list.sort((a, b) => (b.date || 0) - (a.date || 0));
      }

      function getAllMembers() {
        const members = new Map();
        
        // userì™€ currentUserì—ì„œ íšŒì› ì •ë³´ ìˆ˜ì§‘
        const user = JSON.parse(localStorage.getItem('user') || '{}');
        const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
        
        if (user.email) {
          members.set(user.email, {
            name: user.name || '',
            email: user.email,
            phone: user.phone || '',
            joinDate: user.joinDate || new Date().toISOString()
          });
        }
        
        if (currentUser.email && currentUser.email !== user.email) {
          members.set(currentUser.email, {
            name: currentUser.name || '',
            email: currentUser.email,
            phone: currentUser.phone || '',
            joinDate: currentUser.joinDate || new Date().toISOString()
          });
        }
        
        // ì˜ë¢°ì—ì„œ ì¶”ê°€ íšŒì› ì •ë³´ ìˆ˜ì§‘
        const requests = getAllRequests();
        requests.forEach(req => {
          if (req.email && !members.has(req.email)) {
            members.set(req.email, {
              name: req.userName || req.name || '',
              email: req.email,
              phone: req.phone || '',
              joinDate: req.date || new Date().toISOString()
            });
          }
        });
        
        return Array.from(members.values()).sort((a, b) => new Date(b.joinDate) - new Date(a.joinDate));
      }

      // í…Œì´ë¸” ë Œë”ë§ í•¨ìˆ˜ë“¤
      function renderRequestsTable() {
        const tbody = document.getElementById('requests-table-body');
        tbody.innerHTML = '';
        
        allRequests.forEach(req => {
          const tr = document.createElement('tr');
          const reqNum = req.key.replace('request-', '');
          const status = getRequestStatus(req);
          
          tr.innerHTML = `
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${reqNum}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${req.userName || 'ìµëª…'}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${req.name || ''}</td>
            <td class="px-6 py-4 whitespace-nowrap">
              <span class="px-2 py-1 text-xs font-semibold rounded-full ${status.color} text-white">${status.text}</span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${req.date ? new Date(req.date).toLocaleString() : ''}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
              <button onclick="viewRequestDetail('${req.key}')" class="text-pink-600 hover:text-pink-900 mr-2">ìƒì„¸ë³´ê¸°</button>
              <button onclick="deleteRequest('${req.key}')" class="text-red-600 hover:text-red-900">ì‚­ì œ</button>
            </td>
          `;
          tbody.appendChild(tr);
        });
      }

      function renderInquiriesTable() {
        const tbody = document.getElementById('inquiries-table-body');
        tbody.innerHTML = '';
        
        allInquiries.forEach(inq => {
          const tr = document.createElement('tr');
          const inqNum = inq.key.replace('inquiry-', '');
          
          tr.innerHTML = `
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${inqNum}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${inq.userName || 'ìµëª…'}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${inq.title || ''}</td>
            <td class="px-6 py-4 whitespace-nowrap">
              <span class="px-2 py-1 text-xs font-semibold rounded-full ${inq.answered ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">${inq.answered ? 'ë‹µë³€ì™„ë£Œ' : 'ë¯¸ë‹µë³€'}</span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${inq.date ? new Date(inq.date).toLocaleString() : ''}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
              <button onclick="viewInquiryDetail('${inq.key}')" class="text-blue-600 hover:text-blue-900 mr-2">ìƒì„¸ë³´ê¸°</button>
              <button onclick="deleteInquiry('${inq.key}')" class="text-red-600 hover:text-red-900">ì‚­ì œ</button>
            </td>
          `;
          tbody.appendChild(tr);
        });
      }

      function renderMembersTable() {
        const tbody = document.getElementById('members-table-body');
        tbody.innerHTML = '';
        
        allMembers.forEach(member => {
          const tr = document.createElement('tr');
          const requestCount = allRequests.filter(req => req.email === member.email).length;
          
          tr.innerHTML = `
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${member.name}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${member.email}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${member.phone}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${new Date(member.joinDate).toLocaleDateString()}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${requestCount}ê°œ</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
              <button onclick="viewMemberDetail('${member.email}')" class="text-green-600 hover:text-green-900 mr-2">ìƒì„¸ë³´ê¸°</button>
              <button onclick="deleteMember('${member.email}')" class="text-red-600 hover:text-red-900">ì‚­ì œ</button>
            </td>
          `;
          tbody.appendChild(tr);
        });
      }

      // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
      function getRequestStatus(req) {
        const reqNum = req.key.replace('request-', '');
        const hasResult = !!localStorage.getItem('result-' + reqNum);
        
        if (!hasResult) {
          return { status: 'new', text: 'ì‹ ê·œì˜ë¢°', color: 'bg-red-500' };
        }
        
        const result = JSON.parse(localStorage.getItem('result-' + reqNum) || '{}');
        if (result.price && result.origin && result.summary && result.link) {
          return { status: 'complete', text: 'ì™„ë£Œ', color: 'bg-green-500' };
        }
        
        return { status: 'progress', text: 'ì§„í–‰ì¤‘', color: 'bg-orange-500' };
      }

      // ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜ë“¤
      function openModal(title, content) {
        document.getElementById('modal-title').textContent = title;
        document.getElementById('modal-content').innerHTML = content;
        document.getElementById('modal').classList.remove('hidden');
      }

      function closeModal() {
        document.getElementById('modal').classList.add('hidden');
      }

      // ë°ì´í„° ê´€ë¦¬ í•¨ìˆ˜ë“¤
      function exportAllData() {
        const allData = {};
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          if (key) {
            allData[key] = localStorage.getItem(key);
          }
        }
        
        const blob = new Blob([JSON.stringify(allData, null, 2)], {
          type: 'application/json'
        });
        
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `pricehunter-backup-${new Date().toISOString().split('T')[0]}.json`;
        a.click();
        
        URL.revokeObjectURL(url);
        alert('ë°ì´í„° ë‚´ë³´ë‚´ê¸°ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
      }

      function importData(file) {
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = function(e) {
          try {
            const data = JSON.parse(e.target.result);
            
            localStorage.clear();
            
            Object.keys(data).forEach(key => {
              localStorage.setItem(key, data[key]);
            });
            
            alert('ë°ì´í„° ë³µì›ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.');
            location.reload();
          } catch (error) {
            alert('ë°ì´í„° íŒŒì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
            console.error('Import error:', error);
          }
        };
        reader.readAsText(file);
      }

      function cleanupTestData() {
        if (!confirm('í…ŒìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ëª¨ë‘ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
        
        let deletedCount = 0;
        const keysToDelete = [];
        
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          if (key && key.includes('TEST')) {
            keysToDelete.push(key);
          }
        }
        
        keysToDelete.forEach(key => {
          localStorage.removeItem(key);
          deletedCount++;
        });
        
        alert(`${deletedCount}ê°œì˜ í…ŒìŠ¤íŠ¸ ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
        loadSectionData(currentSection);
      }

      function clearAllData() {
        if (!confirm('âš ï¸ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!')) return;
        
        if (!confirm('ì •ë§ë¡œ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\në§ˆì§€ë§‰ í™•ì¸ì…ë‹ˆë‹¤.')) return;
        
        localStorage.clear();
        alert('ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
        location.reload();
      }

      function adminLogout() {
        localStorage.removeItem('adminMode');
        localStorage.removeItem('isAdmin');
        localStorage.removeItem('adminEmail');
        alert('ê´€ë¦¬ì ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.');
        window.location.href = 'index.html';
      }

             // ëˆ„ë½ëœ í•¨ìˆ˜ë“¤ ì¶”ê°€
       function loadRecentActivities() {
         const requests = getAllRequests().slice(0, 5);
         const inquiries = getAllInquiries().slice(0, 5);
         
         // ìµœê·¼ ì˜ë¢° ë Œë”ë§
         const recentRequestsDiv = document.getElementById('recent-requests');
         recentRequestsDiv.innerHTML = requests.map(req => `
           <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
             <div>
               <p class="font-semibold text-sm">${req.name || 'ì œí’ˆëª… ì—†ìŒ'}</p>
               <p class="text-xs text-gray-500">${req.userName || 'ìµëª…'} â€¢ ${req.date ? new Date(req.date).toLocaleDateString() : ''}</p>
             </div>
             <span class="px-2 py-1 text-xs font-semibold rounded-full ${getRequestStatus(req).color} text-white">${getRequestStatus(req).text}</span>
           </div>
         `).join('');
         
         // ìµœê·¼ ë¬¸ì˜ ë Œë”ë§
         const recentInquiriesDiv = document.getElementById('recent-inquiries');
         recentInquiriesDiv.innerHTML = inquiries.map(inq => `
           <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
             <div>
               <p class="font-semibold text-sm">${inq.title || 'ì œëª© ì—†ìŒ'}</p>
               <p class="text-xs text-gray-500">${inq.userName || 'ìµëª…'} â€¢ ${inq.date ? new Date(inq.date).toLocaleDateString() : ''}</p>
             </div>
             <span class="px-2 py-1 text-xs font-semibold rounded-full ${inq.answered ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">${inq.answered ? 'ë‹µë³€ì™„ë£Œ' : 'ë¯¸ë‹µë³€'}</span>
           </div>
         `).join('');
       }

       function clearRequestSearch() {
         document.getElementById('request-search').value = '';
         loadRequestsData();
       }

       function viewRequestDetail(reqKey) {
         const req = allRequests.find(r => r.key === reqKey);
         if (!req) return;
         
         const reqNum = req.key.replace('request-', '');
         const result = localStorage.getItem('result-' + reqNum);
         const resultData = result ? JSON.parse(result) : {};
         
         const content = `
           <div class="space-y-4">
             <div class="grid grid-cols-2 gap-4">
               <div>
                 <label class="block text-sm font-medium text-gray-700">ì˜ë¢°ë²ˆí˜¸</label>
                 <p class="mt-1 text-sm text-gray-900">${reqNum}</p>
               </div>
               <div>
                 <label class="block text-sm font-medium text-gray-700">íšŒì›ëª…</label>
                 <p class="mt-1 text-sm text-gray-900">${req.userName || 'ìµëª…'}</p>
               </div>
               <div>
                 <label class="block text-sm font-medium text-gray-700">ì œí’ˆëª…</label>
                 <p class="mt-1 text-sm text-gray-900">${req.name || ''}</p>
               </div>
               <div>
                 <label class="block text-sm font-medium text-gray-700">ì˜ë¢°ì¼ì‹œ</label>
                 <p class="mt-1 text-sm text-gray-900">${req.date ? new Date(req.date).toLocaleString() : ''}</p>
               </div>
             </div>
             
             <div>
               <label class="block text-sm font-medium text-gray-700">ì œí’ˆì„¤ëª…</label>
               <p class="mt-1 text-sm text-gray-900">${req.description || ''}</p>
             </div>
             
             <div>
               <label class="block text-sm font-medium text-gray-700">ì°¸ê³ ì‚¬ì´íŠ¸</label>
               <p class="mt-1 text-sm text-gray-900">${req.url || ''}</p>
             </div>
             
             <div class="border-t pt-4">
               <h4 class="text-lg font-semibold text-gray-800 mb-3">ê²°ê³¼ ì •ë³´</h4>
               <div class="grid grid-cols-2 gap-4">
                 <div>
                   <label class="block text-sm font-medium text-gray-700">ìµœì €ê°€</label>
                   <p class="mt-1 text-sm text-gray-900">${resultData.price || 'ë¯¸ì…ë ¥'}</p>
                 </div>
                 <div>
                   <label class="block text-sm font-medium text-gray-700">ì›ì‚°ì§€/ê³µê¸‰ì²˜</label>
                   <p class="mt-1 text-sm text-gray-900">${resultData.origin || 'ë¯¸ì…ë ¥'}</p>
                 </div>
                 <div class="col-span-2">
                   <label class="block text-sm font-medium text-gray-700">ì¢…í•©ì„¤ëª…</label>
                   <p class="mt-1 text-sm text-gray-900">${resultData.summary || 'ë¯¸ì…ë ¥'}</p>
                 </div>
                 <div class="col-span-2">
                   <label class="block text-sm font-medium text-gray-700">êµ¬ë§¤ë§í¬</label>
                   <p class="mt-1 text-sm text-gray-900">${resultData.link || 'ë¯¸ì…ë ¥'}</p>
                 </div>
               </div>
             </div>
           </div>
         `;
         
         openModal(`ì˜ë¢° ìƒì„¸ë³´ê¸° - ${reqNum}`, content);
       }

       function deleteRequest(reqKey) {
         if (!confirm('ì´ ì˜ë¢°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
         
         const reqNum = reqKey.replace('request-', '');
         localStorage.removeItem(reqKey);
         localStorage.removeItem('result-' + reqNum);
         localStorage.removeItem('result-PH-' + reqNum);
         localStorage.removeItem('order-' + reqNum);
         localStorage.removeItem('notify-' + reqNum);
         
         alert('ì˜ë¢°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
         loadRequestsData();
       }

       function viewInquiryDetail(inqKey) {
         const inq = allInquiries.find(i => i.key === inqKey);
         if (!inq) return;
         
         const inqNum = inq.key.replace('inquiry-', '');
         
         const content = `
           <div class="space-y-4">
             <div class="grid grid-cols-2 gap-4">
               <div>
                 <label class="block text-sm font-medium text-gray-700">ë¬¸ì˜ë²ˆí˜¸</label>
                 <p class="mt-1 text-sm text-gray-900">${inqNum}</p>
               </div>
               <div>
                 <label class="block text-sm font-medium text-gray-700">íšŒì›ëª…</label>
                 <p class="mt-1 text-sm text-gray-900">${inq.userName || 'ìµëª…'}</p>
               </div>
               <div>
                 <label class="block text-sm font-medium text-gray-700">ì œëª©</label>
                 <p class="mt-1 text-sm text-gray-900">${inq.title || ''}</p>
               </div>
               <div>
                 <label class="block text-sm font-medium text-gray-700">ë“±ë¡ì¼ì‹œ</label>
                 <p class="mt-1 text-sm text-gray-900">${inq.date ? new Date(inq.date).toLocaleString() : ''}</p>
               </div>
             </div>
             
             <div>
               <label class="block text-sm font-medium text-gray-700">ë¬¸ì˜ë‚´ìš©</label>
               <p class="mt-1 text-sm text-gray-900">${inq.content || ''}</p>
             </div>
             
             ${inq.answer ? `
             <div class="border-t pt-4">
               <h4 class="text-lg font-semibold text-gray-800 mb-3">ë‹µë³€</h4>
               <p class="text-sm text-gray-900">${inq.answer}</p>
             </div>
             ` : ''}
           </div>
         `;
         
         openModal(`ë¬¸ì˜ ìƒì„¸ë³´ê¸° - ${inqNum}`, content);
       }

       function deleteInquiry(inqKey) {
         if (!confirm('ì´ ë¬¸ì˜ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
         
         localStorage.removeItem(inqKey);
         alert('ë¬¸ì˜ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
         loadInquiriesData();
       }

       function viewMemberDetail(email) {
         const member = allMembers.find(m => m.email === email);
         if (!member) return;
         
         const requests = allRequests.filter(req => req.email === email);
         
         const content = `
           <div class="space-y-4">
             <div class="grid grid-cols-2 gap-4">
               <div>
                 <label class="block text-sm font-medium text-gray-700">íšŒì›ëª…</label>
                 <p class="mt-1 text-sm text-gray-900">${member.name}</p>
               </div>
               <div>
                 <label class="block text-sm font-medium text-gray-700">ì´ë©”ì¼</label>
                 <p class="mt-1 text-sm text-gray-900">${member.email}</p>
               </div>
               <div>
                 <label class="block text-sm font-medium text-gray-700">íœ´ëŒ€í°</label>
                 <p class="mt-1 text-sm text-gray-900">${member.phone}</p>
               </div>
               <div>
                 <label class="block text-sm font-medium text-gray-700">ê°€ì…ì¼</label>
                 <p class="mt-1 text-sm text-gray-900">${new Date(member.joinDate).toLocaleDateString()}</p>
               </div>
             </div>
             
             <div class="border-t pt-4">
               <h4 class="text-lg font-semibold text-gray-800 mb-3">ì˜ë¢° ë‚´ì—­ (${requests.length}ê°œ)</h4>
               ${requests.length > 0 ? `
               <div class="space-y-2 max-h-40 overflow-y-auto">
                 ${requests.map(req => `
                   <div class="p-2 bg-gray-50 rounded text-sm">
                     <div class="font-medium">${req.name || 'ì œí’ˆëª… ì—†ìŒ'}</div>
                     <div class="text-gray-500">${req.date ? new Date(req.date).toLocaleDateString() : ''} â€¢ ${getRequestStatus(req).text}</div>
                   </div>
                 `).join('')}
               </div>
               ` : '<p class="text-sm text-gray-500">ì˜ë¢° ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>'}
             </div>
           </div>
         `;
         
         openModal(`íšŒì› ìƒì„¸ë³´ê¸° - ${member.name}`, content);
       }

       function deleteMember(email) {
         if (!confirm('ì´ íšŒì›ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nê´€ë ¨ëœ ëª¨ë“  ì˜ë¢°ì™€ ë¬¸ì˜ë„ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤.')) return;
         
         // íšŒì› ê´€ë ¨ ë°ì´í„° ì‚­ì œ
         const requests = allRequests.filter(req => req.email === email);
         const inquiries = allInquiries.filter(inq => inq.email === email);
         
         requests.forEach(req => {
           const reqNum = req.key.replace('request-', '');
           localStorage.removeItem(req.key);
           localStorage.removeItem('result-' + reqNum);
           localStorage.removeItem('result-PH-' + reqNum);
           localStorage.removeItem('order-' + reqNum);
           localStorage.removeItem('notify-' + reqNum);
         });
         
         inquiries.forEach(inq => {
           localStorage.removeItem(inq.key);
         });
         
         // user/currentUserì—ì„œë„ ì‚­ì œ
         const user = JSON.parse(localStorage.getItem('user') || '{}');
         const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
         
         if (user.email === email) {
           localStorage.removeItem('user');
         }
         if (currentUser.email === email) {
           localStorage.removeItem('currentUser');
         }
         
         alert('íšŒì›ê³¼ ê´€ë ¨ ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
         loadMembersData();
       }

       // ì´ˆê¸°í™”
       window.addEventListener('DOMContentLoaded', function() {
         if (!isAdmin()) {
           alert('ê´€ë¦¬ì ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.');
           window.location.href = 'index.html';
           return;
         }
         
         // ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë“œ
         loadDashboardData();
       });
    </script>
  </body>
</html>
