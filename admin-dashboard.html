<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ - PriceHunter</title>
    
    <!-- CSPëŠ” ì„œë²„ì—ì„œ ì„¤ì •ë¨ - HTML ë©”íƒ€ëŠ” ì œê±°í•˜ì—¬ ì¶©ëŒ ë°©ì§€ -->
    
    <!-- Firebase v9 SDK (ëª¨ë“ˆì‹) -->
    <script type="module">
      import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
      import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js';
      import { getFirestore, collection, query, orderBy, onSnapshot } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js';
      
      // Firebase ì„¤ì •
      const firebaseConfig = {
        apiKey: "AIzaSyDBZxKyMS7eeBTbPnbZkj0WWOZQHNldoL4",
        authDomain: "pricehunter-99a1b.firebaseapp.com",
        projectId: "pricehunter-99a1b",
        storageBucket: "pricehunter-99a1b.firebasestorage.app",
        messagingSenderId: "242265693919",
        appId: "1:242265693919:web:74234d942b82a51541136a",
        measurementId: "G-4BKLV4EVB9"
      };

      // Firebase ì´ˆê¸°í™”
      try {
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // ì „ì—­ìœ¼ë¡œ ë…¸ì¶œ
        window.firebaseApp = app;
        window.firebaseAuth = auth;
        window.firebaseDb = db;
        window.firebaseAuthFunctions = { onAuthStateChanged };
        window.firebaseFirestoreFunctions = { collection, query, orderBy, onSnapshot };
        
        console.log('âœ… ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ Firebase v9 ì´ˆê¸°í™” ì™„ë£Œ');
      } catch (error) {
        console.error('âŒ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ Firebase ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
        // ì´ˆê¸°í™” ì‹¤íŒ¨ì‹œì—ë„ ê¸°ë³¸ ê°ì²´ë“¤ì„ ìƒì„±í•˜ì—¬ ì˜¤ë¥˜ ë°©ì§€
        window.firebaseApp = null;
        window.firebaseAuth = null;
        window.firebaseDb = null;
        window.firebaseAuthFunctions = { onAuthStateChanged: () => {} };
        window.firebaseFirestoreFunctions = { collection: () => {}, query: () => {}, orderBy: () => {}, onSnapshot: () => {} };
        
        // ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
        alert('Firebase ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
      }
    </script>
    
    <!-- Firebase ì„¤ì • íŒŒì¼ ë¡œë“œ -->
    <script src="firebase-app.js"></script>
    
    <!-- Tailwind CSS (ê°œì„ ëœ ë¡œë”© ë°©ì‹) -->
    <script>
        // Tailwind CSS ë™ì  ë¡œë”©
        function loadTailwindCSS() {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = 'https://cdn.tailwindcss.com';
                script.onload = () => {
                    console.log('âœ… Tailwind CSS ë¡œë“œë¨');
                    resolve();
                };
                script.onerror = (error) => {
                    console.error('âŒ Tailwind CSS ë¡œë“œ ì‹¤íŒ¨:', error);
                    // Tailwind ë¡œë“œ ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ ìŠ¤íƒ€ì¼ ì ìš©
                    applyFallbackStyles();
                    reject(error);
                };
                document.head.appendChild(script);
            });
        }
        
        // Tailwind ë¡œë“œ ì‹¤íŒ¨ ì‹œ ëŒ€ì²´ ìŠ¤íƒ€ì¼
        function applyFallbackStyles() {
            const style = document.createElement('style');
            style.textContent = `
                body { font-family: system-ui, -apple-system, sans-serif; }
                .bg-gradient-to-br { background: linear-gradient(135deg, #f3f4f6, #dbeafe, #d1fae5); }
                .min-h-screen { min-height: 100vh; }
                .flex { display: flex; }
                .items-center { align-items: center; }
                .justify-center { justify-content: center; }
                .bg-white { background-color: white; }
                .rounded-xl { border-radius: 0.75rem; }
                .shadow-2xl { box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); }
                .p-8 { padding: 2rem; }
                .w-full { width: 100%; }
                .max-w-md { max-width: 28rem; }
                .text-center { text-align: center; }
                .mb-8 { margin-bottom: 2rem; }
                .text-3xl { font-size: 1.875rem; }
                .font-bold { font-weight: 700; }
                .text-pink-600 { color: #db2777; }
                .text-gray-600 { color: #4b5563; }
                .space-y-6 > * + * { margin-top: 1.5rem; }
                .block { display: block; }
                .text-sm { font-size: 0.875rem; }
                .font-medium { font-weight: 500; }
                .text-gray-700 { color: #374151; }
                .mb-2 { margin-bottom: 0.5rem; }
                .px-4 { padding-left: 1rem; padding-right: 1rem; }
                .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
                .border { border-width: 1px; }
                .border-gray-300 { border-color: #d1d5db; }
                .rounded-lg { border-radius: 0.5rem; }
                .focus\\:ring-2:focus { box-shadow: 0 0 0 2px rgba(236, 72, 153, 0.5); }
                .focus\\:ring-pink-400:focus { box-shadow: 0 0 0 2px rgba(244, 114, 182, 0.5); }
                .focus\\:outline-none:focus { outline: none; }
                .bg-gradient-to-r { background: linear-gradient(to right, #ec4899, #8b5cf6); }
                .text-white { color: white; }
                .hover\\:from-pink-600:hover { background: linear-gradient(to right, #db2777, #7c3aed); }
                .hover\\:to-purple-600:hover { background: linear-gradient(to right, #ec4899, #7c3aed); }
                .transition { transition: all 0.15s ease-in-out; }
                .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
                .mt-6 { margin-top: 1.5rem; }
                .text-pink-600 { color: #db2777; }
                .hover\\:text-pink-700:hover { color: #be185d; }
                .text-blue-600 { color: #2563eb; }
                .hover\\:text-blue-700:hover { color: #1d4ed8; }
                .text-xs { font-size: 0.75rem; }
                .text-gray-500 { color: #6b7280; }
                .mt-2 { margin-top: 0.5rem; }
            `;
            document.head.appendChild(style);
            console.log('âš ï¸ Tailwind CSS ëŒ€ì²´ ìŠ¤íƒ€ì¼ ì ìš©ë¨');
        }
        
        // Tailwind CSS ë¡œë”© ì‹œì‘
        loadTailwindCSS().catch(() => {
            console.log('âš ï¸ Tailwind CSS ë¡œë”© ì‹¤íŒ¨, ëŒ€ì²´ ìŠ¤íƒ€ì¼ ì‚¬ìš©');
        });
    </script>
    
    <!-- Firebase 8.x SDK (ìµœì í™”ëœ ë¡œë”© ë°©ì‹) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    
    <!-- Firebase ì„¤ì • (ë‹¨ì¼ ì§„ì‹¤ ì†ŒìŠ¤) -->
    <script src="firebase-config.js"></script>
    
    <script>
        // ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™” ì‹œì‘...');
            
            // Firebase ì¤€ë¹„ ëŒ€ê¸° í›„ ì‹¤ì‹œê°„ êµ¬ë… ì‹œì‘
            setTimeout(async () => {
                try {
                    await waitForFirebase();
                    subscribeToUsers();
                    console.log('âœ… ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ Firebase ì—°ë™ ì™„ë£Œ');
                } catch (error) {
                    console.error('âŒ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                    // ì´ˆê¸°í™” ì‹¤íŒ¨ì‹œ 3ì´ˆ í›„ ì¬ì‹œë„
                    setTimeout(() => {
                        console.log('ğŸ”„ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ì¬ì‹œë„...');
                        location.reload();
                    }, 3000);
                }
            }, 1000);
        });
        
        // Firebase SDK ë¡œë”© ëŒ€ê¸° í•¨ìˆ˜ (ë‹¨ìˆœí™”ëœ ë²„ì „)
        function waitForFirebaseAndInitialize() {
            const maxAttempts = 8; // 8ì´ˆ ëŒ€ê¸°
            let attempts = 0;
            
            const checkFirebase = () => {
                attempts++;
                console.log(`ğŸ” Firebase SDK í™•ì¸ ì‹œë„ ${attempts}/${maxAttempts}`);
                
                // Firebase SDK ì™„ì „ ë¡œë“œ í™•ì¸
                if (typeof firebase !== 'undefined' && 
                    firebase.apps !== undefined && 
                    firebase.auth !== undefined && 
                    firebase.firestore !== undefined) {
                    
                    console.log('âœ… Firebase SDK ì™„ì „ ë¡œë“œë¨');
                    console.log('Firebase ë²„ì „:', firebase.SDK_VERSION);
                    
                    // Firebase ì´ˆê¸°í™” ì‹œë„
                    try {
                        const initResult = initializeFirebase();
                        if (initResult) {
                            console.log('âœ… Firebase ì´ˆê¸°í™” ì™„ë£Œ');
                            setupAdminDashboard();
                        } else {
                            console.error('âŒ Firebase ì´ˆê¸°í™” ì‹¤íŒ¨');
                            showFirebaseError('Firebase ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. Netlify CSP í—¤ë”ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
                        }
                    } catch (error) {
                        console.error('âŒ Firebase ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜:', error);
                        showFirebaseError('Firebase ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                    }
                } else if (attempts < maxAttempts) {
                    console.log('â³ Firebase SDK ë¡œë”© ëŒ€ê¸° ì¤‘...');
                    setTimeout(checkFirebase, 1000);
                } else {
                    console.error('âŒ Firebase SDK ë¡œë”© ì‹œê°„ ì´ˆê³¼');
                    showFirebaseError('Firebase SDK ë¡œë”© ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.\n\nNetlify CSP ì •ì±…ì—ì„œ ë‹¤ìŒ ë„ë©”ì¸ë“¤ì´ í—ˆìš©ë˜ì–´ì•¼ í•©ë‹ˆë‹¤:\n- https://www.gstatic.com\n- https://www.gstatic.com/firebasejs\n\nnetlify.toml íŒŒì¼ì˜ CSP ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”.');
                }
            };
            
            checkFirebase();
        }
        
        // Firebase ì˜¤ë¥˜ í‘œì‹œ í•¨ìˆ˜ (CSP ìµœì í™” ë²„ì „)
        function showFirebaseError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'fixed top-4 right-4 bg-red-500 text-white p-4 rounded-lg shadow-lg z-50 max-w-md';
            errorDiv.innerHTML = `
                <div class="font-bold mb-2">ğŸ”¥ Firebase ì˜¤ë¥˜</div>
                <div class="text-sm mb-2">${message}</div>
                <div class="text-xs mb-3 p-2 bg-red-600 rounded">
                    <strong>CSP í•´ê²° ë°©ë²•:</strong><br>
                    1. DevTools â†’ Network â†’ Response Headers í™•ì¸<br>
                    2. content-security-policyì— www.gstatic.com í¬í•¨ í™•ì¸<br>
                    3. ì„œë²„ ì¬ì‹œì‘ í›„ ìƒˆë¡œê³ ì¹¨<br>
                    4. ë¸Œë¼ìš°ì € ìºì‹œ ì™„ì „ ì‚­ì œ<br>
                    5. ì„œë¹„ìŠ¤ì›Œì»¤ ë“±ë¡ í•´ì œ
                </div>
                <div class="flex gap-2 flex-wrap">
                    <button onclick="location.reload()" class="px-3 py-1 bg-white text-red-500 rounded text-xs font-bold hover:bg-gray-100">
                        ğŸ”„ ìƒˆë¡œê³ ì¹¨
                    </button>
                    <button onclick="testFirebaseConnection()" class="px-3 py-1 bg-yellow-500 text-white rounded text-xs font-bold hover:bg-yellow-600">
                        ğŸ§ª ì—°ê²° í…ŒìŠ¤íŠ¸
                    </button>
                    <button onclick="clearCacheAndReload()" class="px-3 py-1 bg-orange-500 text-white rounded text-xs font-bold hover:bg-orange-600">
                        ğŸ§¹ ìºì‹œ ì •ë¦¬
                    </button>
                    <button onclick="this.parentElement.parentElement.remove()" class="px-3 py-1 bg-gray-500 text-white rounded text-xs font-bold hover:bg-gray-600">
                        âœ• ë‹«ê¸°
                    </button>
                </div>
            `;
            document.body.appendChild(errorDiv);
            
            // 20ì´ˆ í›„ ìë™ ì œê±° (CSP ë¬¸ì œëŠ” í•´ê²° ì‹œê°„ì´ ë” í•„ìš”)
            setTimeout(() => {
                if (errorDiv.parentElement) {
                    errorDiv.remove();
                }
            }, 20000);
        }
        
        // ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ì„¤ì •
        function setupAdminDashboard() {
            console.log('ğŸ”§ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ì„¤ì • ì‹œì‘...');
            
            // Firebase ìƒíƒœ ì¬í™•ì¸
            if (!window.auth || !window.firestore) {
                console.error('âŒ Firebase ì„œë¹„ìŠ¤ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                showFirebaseError('Firebase ì„œë¹„ìŠ¤ ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                return;
            }
            
            console.log('âœ… ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ì„¤ì • ì™„ë£Œ');
        }
        
        // ê´€ë¦¬ì ë¡œê·¸ì¸ í•¨ìˆ˜
        window.adminLogin = async function() {
            console.log('ğŸ” ê´€ë¦¬ì ë¡œê·¸ì¸ ì‹œë„...');
            
            const email = document.getElementById('admin-email').value;
            const password = document.getElementById('admin-password').value;
            
            if (!email || !password) {
                alert('ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // Firebase ê°€ë“œ í™•ì¸
            if (typeof firebase === 'undefined') {
                alert('Firebase SDKê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì„œë²„ CSP í—¤ë”ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!window.auth) {
                console.error('âŒ Firebase Authê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                alert('Firebase Auth ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            try {
                console.log('ğŸ”¥ ë¡œê·¸ì¸ ì‹œë„:', email);
                const userCredential = await window.auth.signInWithEmailAndPassword(email, password);
                console.log('âœ… ê´€ë¦¬ì ë¡œê·¸ì¸ ì„±ê³µ:', userCredential.user.email);
                
                // ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ëŒ€ì‹œë³´ë“œ í‘œì‹œ
                document.getElementById('login-section').classList.add('hidden');
                document.getElementById('dashboard-section').classList.remove('hidden');
                
                // ê´€ë¦¬ì ì •ë³´ í‘œì‹œ
                if (document.getElementById('admin-info')) {
                    document.getElementById('admin-info').textContent = userCredential.user.email;
                }
                
                // ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë“œ
                loadDashboardData();
                
            } catch (error) {
                console.error('âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨:', error);
                let errorMessage = 'ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
                
                switch (error.code) {
                    case 'auth/user-not-found':
                        errorMessage = 'ë“±ë¡ë˜ì§€ ì•Šì€ ì´ë©”ì¼ì…ë‹ˆë‹¤.';
                        break;
                    case 'auth/wrong-password':
                        errorMessage = 'ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                        break;
                    case 'auth/invalid-email':
                        errorMessage = 'ì˜¬ë°”ë¥´ì§€ ì•Šì€ ì´ë©”ì¼ í˜•ì‹ì…ë‹ˆë‹¤.';
                        break;
                    case 'auth/too-many-requests':
                        errorMessage = 'ë„ˆë¬´ ë§ì€ ë¡œê·¸ì¸ ì‹œë„ê°€ ìˆì—ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                        break;
                    default:
                        errorMessage = error.message;
                }
                
                alert(errorMessage);
            }
        };
        
        // í…ŒìŠ¤íŠ¸ ê´€ë¦¬ì ê³„ì • ìƒì„± í•¨ìˆ˜
        window.createAdminAccount = async function() {
            try {
                console.log('ğŸ”§ í…ŒìŠ¤íŠ¸ ê´€ë¦¬ì ê³„ì • ìƒì„± ì‹œì‘...');
                
                if (!firebase.auth) { 
                    alert("Firebase Auth ì´ˆê¸°í™” ì‹¤íŒ¨"); 
                    throw new Error("Auth not initialized"); 
                }
                
                if (!window.auth) {
                    alert('Firebaseê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
                    return;
                }
                
                const userCredential = await window.auth.createUserWithEmailAndPassword('admin@pricehunter.com', 'admin1234');
                console.log('âœ… í…ŒìŠ¤íŠ¸ ê´€ë¦¬ì ê³„ì • ìƒì„± ì™„ë£Œ:', userCredential.user.email);
                
                // Firestoreì— ê´€ë¦¬ì ì •ë³´ ì €ì¥
                if (window.firestore) {
                    await window.firestore.collection('admins').doc(userCredential.user.uid).set({
                        email: 'admin@pricehunter.com',
                        role: 'admin',
                        createdAt: new Date(),
                        permissions: ['read', 'write', 'delete', 'admin']
                    });
                    console.log('âœ… ê´€ë¦¬ì ì •ë³´ Firestore ì €ì¥ ì™„ë£Œ');
                }
                
                alert('âœ… í…ŒìŠ¤íŠ¸ ê´€ë¦¬ì ê³„ì •ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nì´ë©”ì¼: admin@pricehunter.com\në¹„ë°€ë²ˆí˜¸: admin1234\n\nì´ì œ ì´ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                
                // ì…ë ¥ í•„ë“œì— ìë™ ì…ë ¥
                document.getElementById('admin-email').value = 'admin@pricehunter.com';
                document.getElementById('admin-password').value = 'admin1234';
                
            } catch (error) {
                console.error('âŒ í…ŒìŠ¤íŠ¸ ê³„ì • ìƒì„± ì‹¤íŒ¨:', error);
                
                if (error.code === 'auth/email-already-in-use') {
                    alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ê³„ì •ì…ë‹ˆë‹¤!\n\nì´ë©”ì¼: admin@pricehunter.com\në¹„ë°€ë²ˆí˜¸: admin1234\n\nì´ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•´ë³´ì„¸ìš”.');
                    
                    // ì…ë ¥ í•„ë“œì— ìë™ ì…ë ¥
                    document.getElementById('admin-email').value = 'admin@pricehunter.com';
                    document.getElementById('admin-password').value = 'admin1234';
                } else {
                    alert('ê³„ì • ìƒì„± ì‹¤íŒ¨: ' + error.message);
                }
            }
        };
        
        // Firebase v9 ê¸°ë°˜ í•¨ìˆ˜ë“¤
        let isFirebaseReady = false;
        let usersUnsubscribe = null;

        // Firebase ì¤€ë¹„ ìƒíƒœ í™•ì¸ (Firebase v8)
        async function waitForFirebase() {
            try {
                // Firebase v8 ì´ˆê¸°í™” í™•ì¸
                if (typeof firebase !== 'undefined' && firebase.apps && firebase.apps.length > 0) {
                    // Firebase v8 ì•±ì´ ì´ë¯¸ ì´ˆê¸°í™”ëœ ê²½ìš°
                    if (!window.auth) {
                        window.auth = firebase.auth();
                    }
                    if (!window.firestore) {
                        window.firestore = firebase.firestore();
                    }
                    isFirebaseReady = true;
                    console.log('âœ… Firebase v8 ì´ˆê¸°í™” ì„±ê³µ');
                    return;
                }
                
                // Firebase v8 ì´ˆê¸°í™” ì‹œë„
                if (typeof firebase !== 'undefined') {
                    const initResult = initializeFirebase();
                    if (initResult) {
                        window.auth = firebase.auth();
                        window.firestore = firebase.firestore();
                        isFirebaseReady = true;
                        console.log('âœ… Firebase v8 ìƒˆë¡œ ì´ˆê¸°í™” ì„±ê³µ');
                        return;
                    }
                }
                
                // ì¬ì‹œë„
                setTimeout(() => waitForFirebase(), 100);
            } catch (error) {
                console.error('âŒ Firebase ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                setTimeout(() => waitForFirebase(), 1000);
            }
        }

        // ì‹¤ì‹œê°„ ì‚¬ìš©ì ëª©ë¡ êµ¬ë… (Firebase v8 + localStorage ë°±ì—…)
        function subscribeToUsers() {
            // localStorageì—ì„œ ì‚¬ìš©ì ë°ì´í„°ë„ ê°€ì ¸ì˜¤ê¸°
            loadLocalStorageUsers();
            
            if (!window.firestore) {
                console.warn('âš ï¸ Firebaseê°€ ì•„ì§ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. localStorage ë°ì´í„°ë§Œ í‘œì‹œí•©ë‹ˆë‹¤.');
                return;
            }
            
            try {
                const usersQuery = window.firestore
                    .collection('users')
                    .orderBy('createdAt', 'desc');

                usersUnsubscribe = usersQuery.onSnapshot((snapshot) => {
                    const firebaseUsers = [];
                    snapshot.forEach((doc) => {
                        firebaseUsers.push({ id: doc.id, ...doc.data() });
                    });
                    
                    console.log('ğŸ“Š Firebase ì‚¬ìš©ì ë°ì´í„° ì—…ë°ì´íŠ¸:', firebaseUsers.length);
                    
                    // localStorage ì‚¬ìš©ìì™€ Firebase ì‚¬ìš©ì í•©ì¹˜ê¸°
                    const allUsers = mergeUsersData(firebaseUsers);
                    updateUsersTable(allUsers);
                    
                    // íšŒì›ìˆ˜ ì—…ë°ì´íŠ¸
                    document.getElementById('total-members').textContent = allUsers.length;
                }, (error) => {
                    console.error('âŒ ì‚¬ìš©ì ëª©ë¡ ì‹¤ì‹œê°„ êµ¬ë… ì‹¤íŒ¨:', error);
                    // Firebase ì—°ê²° ì‹¤íŒ¨ì‹œ localStorage ë°ì´í„°ë§Œ í‘œì‹œ
                    console.log('ğŸ”„ localStorage ë°ì´í„°ë§Œ í‘œì‹œí•©ë‹ˆë‹¤.');
                    loadLocalStorageUsers();
                    
                    // ì—°ê²° ì‹¤íŒ¨ì‹œ 5ì´ˆ í›„ ì¬ì‹œë„
                    setTimeout(() => {
                        console.log('ğŸ”„ Firestore ì—°ê²° ì¬ì‹œë„...');
                        subscribeToUsers();
                    }, 5000);
                });
            } catch (error) {
                console.error('âŒ Firestore ì¿¼ë¦¬ ìƒì„± ì‹¤íŒ¨:', error);
                // ì¿¼ë¦¬ ìƒì„± ì‹¤íŒ¨ì‹œ localStorage ë°ì´í„°ë§Œ í‘œì‹œ
                loadLocalStorageUsers();
                
                // ì¿¼ë¦¬ ìƒì„± ì‹¤íŒ¨ì‹œ 3ì´ˆ í›„ ì¬ì‹œë„
                setTimeout(() => {
                    console.log('ğŸ”„ Firestore ì¿¼ë¦¬ ì¬ì‹œë„...');
                    subscribeToUsers();
                }, 3000);
            }
        }

        // localStorageì—ì„œ ì‚¬ìš©ì ë°ì´í„° ë¡œë“œ
        function loadLocalStorageUsers() {
            try {
                const users = [];
                
                // ì¼ë°˜ ì‚¬ìš©ì ë°ì´í„°
                const userData = localStorage.getItem('user');
                if (userData) {
                    const user = JSON.parse(userData);
                    users.push({
                        id: user.firebaseId || 'local_' + Date.now(),
                        ...user,
                        source: 'localStorage'
                    });
                }
                
                // ì¹´ì¹´ì˜¤ ì‚¬ìš©ì ë°ì´í„°ë“¤
                const keys = Object.keys(localStorage);
                keys.forEach(key => {
                    if (key.startsWith('kakao_') && !key.includes('auth_')) {
                        try {
                            const storedData = localStorage.getItem(key);
                            if (storedData && storedData.startsWith('{')) {
                                const kakaoUser = JSON.parse(storedData);
                                users.push({
                                    id: kakaoUser.firebaseId || key,
                                    ...kakaoUser,
                                    source: 'localStorage'
                                });
                            }
                        } catch (e) {
                            console.warn('ì¹´ì¹´ì˜¤ ì‚¬ìš©ì ë°ì´í„° íŒŒì‹± ì‹¤íŒ¨:', e);
                        }
                    }
                });
                
                console.log('ğŸ“Š localStorage ì‚¬ìš©ì ë°ì´í„°:', users.length);
                updateUsersTable(users);
                document.getElementById('total-members').textContent = users.length;
                
            } catch (error) {
                console.error('âŒ localStorage ì‚¬ìš©ì ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // Firebaseì™€ localStorage ì‚¬ìš©ì ë°ì´í„° í•©ì¹˜ê¸°
        function mergeUsersData(firebaseUsers) {
            const allUsers = [...firebaseUsers];
            
            // localStorageì—ì„œ ì¶”ê°€ ì‚¬ìš©ì ì°¾ê¸°
            const userData = localStorage.getItem('user');
            if (userData) {
                const user = JSON.parse(userData);
                const exists = allUsers.find(u => u.email === user.email);
                if (!exists) {
                    allUsers.push({
                        id: user.firebaseId || 'local_' + Date.now(),
                        ...user,
                        source: 'localStorage'
                    });
                }
            }
            
            // ì¹´ì¹´ì˜¤ ì‚¬ìš©ìë“¤ë„ í™•ì¸
            const keys = Object.keys(localStorage);
            keys.forEach(key => {
                if (key.startsWith('kakao_') && !key.includes('auth_')) {
                    try {
                        const storedData = localStorage.getItem(key);
                        if (storedData && storedData.startsWith('{')) {
                            const kakaoUser = JSON.parse(storedData);
                            const exists = allUsers.find(u => u.email === kakaoUser.email);
                            if (!exists) {
                                allUsers.push({
                                    id: kakaoUser.firebaseId || key,
                                    ...kakaoUser,
                                    source: 'localStorage'
                                });
                            }
                        }
                    } catch (e) {
                        console.warn('ì¹´ì¹´ì˜¤ ì‚¬ìš©ì ë°ì´í„° íŒŒì‹± ì‹¤íŒ¨:', e);
                    }
                }
            });
            
            return allUsers;
        }

        // ì‚¬ìš©ì í…Œì´ë¸” ì—…ë°ì´íŠ¸
        function updateUsersTable(users) {
            const tbody = document.getElementById('members-table-body');
            if (!tbody) return;

            tbody.innerHTML = '';

            if (users.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" class="px-6 py-4 text-center text-gray-500">
                            ë“±ë¡ëœ íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤.
                        </td>
                    </tr>
                `;
                return;
            }

            users.forEach(user => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                
                const profileImage = user.photoURL || user.profileImage || '/default-avatar.png';
                const loginMethod = user.loginMethod || user.loginType || 'email';
                const joinDate = user.createdAt ? 
                    (user.createdAt.seconds ? new Date(user.createdAt.seconds * 1000).toLocaleDateString() : new Date(user.createdAt).toLocaleDateString()) : 
                    (user.joinDate ? new Date(user.joinDate).toLocaleDateString() : 'ì•Œ ìˆ˜ ì—†ìŒ');
                const lastUpdate = user.updatedAt ? 
                    (user.updatedAt.seconds ? new Date(user.updatedAt.seconds * 1000).toLocaleDateString() : new Date(user.updatedAt).toLocaleDateString()) : 
                    'ì•Œ ìˆ˜ ì—†ìŒ';
                const dataSource = user.source || 'Firebase';
                const dataSourceColor = dataSource === 'localStorage' ? 'bg-orange-100 text-orange-800' : 'bg-green-100 text-green-800';
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="h-10 w-10 flex-shrink-0">
                                <img class="h-10 w-10 rounded-full" src="${profileImage}" alt="${user.displayName || user.name || 'ì‚¬ìš©ì'}">
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-gray-900">${user.displayName || user.name || 'ì´ë¦„ ì—†ìŒ'}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${loginMethod === 'kakao' ? 'bg-yellow-100 text-yellow-800' : 'bg-blue-100 text-blue-800'}">
                            ${loginMethod === 'kakao' ? 'ì¹´ì¹´ì˜¤í†¡' : 'ì´ë©”ì¼'}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${user.email || 'ì´ë©”ì¼ ì—†ìŒ'}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${user.phone || '-'}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${joinDate}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${lastUpdate}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${dataSourceColor}">
                            ${dataSource}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="viewUserDetails('${user.id}')" class="text-indigo-600 hover:text-indigo-900 mr-3">ìƒì„¸ë³´ê¸°</button>
                        <button onclick="deleteUser('${user.id}')" class="text-red-600 hover:text-red-900">ì‚­ì œ</button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë“œ í•¨ìˆ˜
        function loadDashboardData() {
            console.log('ğŸ“Š ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë“œ ì‹œì‘...');
            
            if (!window.firestore) {
                console.error('âŒ Firestoreê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ì—¬ê¸°ì— ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë“œ ë¡œì§ ì¶”ê°€
            console.log('âœ… ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë“œ ì™„ë£Œ');
        }
        
        // Firebase ì—°ê²° í…ŒìŠ¤íŠ¸ í•¨ìˆ˜
        window.testFirebaseConnection = function() {
            console.log('ğŸ”¥ Firebase ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            
            if (typeof firebase === 'undefined') {
                alert('âŒ Firebase SDKê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\n\nì„œë²„ CSP í—¤ë”ì— www.gstatic.comì´ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.');
                return false;
            }
            
            if (!firebase.auth) { 
                alert("Firebase Auth ì´ˆê¸°í™” ì‹¤íŒ¨"); 
                return false;
            }
            
            if (!firebase.firestore) { 
                alert("Firebase Firestore ì´ˆê¸°í™” ì‹¤íŒ¨"); 
                return false;
            }
            
            if (window.firebaseApp && window.firestore && window.auth) {
                alert('âœ… Firebase ì—°ê²° ì„±ê³µ!\n\nëª¨ë“  ì„œë¹„ìŠ¤ê°€ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤.');
                return true;
            } else {
                alert('âŒ Firebase ì—°ê²° ì‹¤íŒ¨!\n\nì´ˆê¸°í™”ë¥¼ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                return false;
            }
        };
        
        // CSP í—¤ë” í™•ì¸ í•¨ìˆ˜
        window.checkCSPHeaders = function() {
            console.log('ğŸ” CSP í—¤ë” í™•ì¸ ì‹œì‘...');
            
            // í˜„ì¬ í˜ì´ì§€ì˜ Response Headers í™•ì¸
            fetch(window.location.href, { method: 'HEAD' })
                .then(response => {
                    const cspHeader = response.headers.get('content-security-policy');
                    const serverHeader = response.headers.get('server');
                    const cfRay = response.headers.get('cf-ray');
                    const xVercelId = response.headers.get('x-vercel-id');
                    const xCloudTrace = response.headers.get('x-cloud-trace-context');
                    
                    console.log('ğŸ“‹ Response Headers ë¶„ì„:');
                    console.log('Server:', serverHeader);
                    console.log('CF-Ray:', cfRay);
                    console.log('X-Vercel-ID:', xVercelId);
                    console.log('X-Cloud-Trace:', xCloudTrace);
                    console.log('CSP Header:', cspHeader);
                    
                    // CSP ì£¼ì… ì£¼ì²´ íŒë³„
                    let cspSource = 'Unknown';
                    if (cfRay || response.headers.get('cf-cache-status')) {
                        cspSource = 'Cloudflare';
                    } else if (serverHeader && serverHeader.includes('nginx')) {
                        cspSource = 'Nginx';
                    } else if (serverHeader && serverHeader.includes('apache')) {
                        cspSource = 'Apache';
                    } else if (xVercelId) {
                        cspSource = 'Vercel';
                    } else if (serverHeader && serverHeader.includes('Firebase')) {
                        cspSource = 'Firebase Hosting';
                    }
                    
                    // Firebase ë„ë©”ì¸ í¬í•¨ ì—¬ë¶€ í™•ì¸
                    const hasFirebaseDomains = cspHeader && (
                        cspHeader.includes('www.gstatic.com') || 
                        cspHeader.includes('www.gstatic.com/firebasejs')
                    );
                    
                    const result = `
ğŸ” CSP í—¤ë” ë¶„ì„ ê²°ê³¼:

ğŸ“¡ CSP ì£¼ì… ì£¼ì²´: ${cspSource}
ğŸ”’ CSP í—¤ë” ì¡´ì¬: ${cspHeader ? 'Yes' : 'No'}
ğŸ”¥ Firebase ë„ë©”ì¸ í¬í•¨: ${hasFirebaseDomains ? 'Yes' : 'No'}

${cspHeader ? `ğŸ“‹ í˜„ì¬ CSP ì •ì±…:
${cspHeader.substring(0, 200)}...` : 'âŒ CSP í—¤ë”ê°€ ì—†ìŠµë‹ˆë‹¤.'}

${!hasFirebaseDomains ? 'âš ï¸ Firebase ë„ë©”ì¸ì´ CSPì— í¬í•¨ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!' : 'âœ… Firebase ë„ë©”ì¸ì´ CSPì— í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.'}
                    `;
                    
                    alert(result);
                    console.log('CSP ë¶„ì„ ì™„ë£Œ:', result);
                })
                .catch(error => {
                    console.error('âŒ CSP í—¤ë” í™•ì¸ ì‹¤íŒ¨:', error);
                    alert('âŒ CSP í—¤ë” í™•ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\n\në¸Œë¼ìš°ì € DevTools â†’ Network â†’ Response Headersë¥¼ ì§ì ‘ í™•ì¸í•˜ì„¸ìš”.');
                });
        };
        
        // ìºì‹œ ë° ì„œë¹„ìŠ¤ì›Œì»¤ ì •ë¦¬ í•¨ìˆ˜ (CSP ì™„ì „ ì •ë¦¬)
        window.clearCacheAndReload = function() {
            console.log('ğŸ§¹ ìºì‹œ ë° ì„œë¹„ìŠ¤ì›Œì»¤ ì™„ì „ ì •ë¦¬ ì‹œì‘...');
            
            let cleanupPromises = [];
            
            // ì„œë¹„ìŠ¤ì›Œì»¤ ë“±ë¡ í•´ì œ
            if ('serviceWorker' in navigator) {
                const swPromise = navigator.serviceWorker.getRegistrations().then(function(registrations) {
                    const unregisterPromises = registrations.map(registration => {
                        console.log('ğŸ—‘ï¸ ì„œë¹„ìŠ¤ì›Œì»¤ ë“±ë¡ í•´ì œ:', registration.scope);
                        return registration.unregister();
                    });
                    return Promise.all(unregisterPromises);
                });
                cleanupPromises.push(swPromise);
            }
            
            // ìºì‹œ ìŠ¤í† ë¦¬ì§€ ì •ë¦¬
            if ('caches' in window) {
                const cachePromise = caches.keys().then(function(cacheNames) {
                    return Promise.all(
                        cacheNames.map(function(cacheName) {
                            console.log('ğŸ—‘ï¸ ìºì‹œ ì‚­ì œ:', cacheName);
                            return caches.delete(cacheName);
                        })
                    );
                });
                cleanupPromises.push(cachePromise);
            }
            
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì •ë¦¬
            try {
                localStorage.clear();
                sessionStorage.clear();
                console.log('âœ… ë¡œì»¬/ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ê°€ ì •ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (e) {
                console.log('âš ï¸ ìŠ¤í† ë¦¬ì§€ ì •ë¦¬ ì¤‘ ì˜¤ë¥˜:', e);
            }
            
            // IndexedDB ì •ë¦¬
            if ('indexedDB' in window) {
                try {
                    indexedDB.databases().then(databases => {
                        databases.forEach(db => {
                            indexedDB.deleteDatabase(db.name);
                            console.log('ğŸ—‘ï¸ IndexedDB ì‚­ì œ:', db.name);
                        });
                    });
                } catch (e) {
                    console.log('âš ï¸ IndexedDB ì •ë¦¬ ì¤‘ ì˜¤ë¥˜:', e);
                }
            }
            
            // ëª¨ë“  ì •ë¦¬ ì‘ì—… ì™„ë£Œ í›„ ìƒˆë¡œê³ ì¹¨
            Promise.all(cleanupPromises).then(() => {
                console.log('âœ… ëª¨ë“  ìºì‹œ ì •ë¦¬ ì™„ë£Œ');
                // ê°•ì œ ìƒˆë¡œê³ ì¹¨ (ìºì‹œ ë¬´ì‹œ + íƒ€ì„ìŠ¤íƒ¬í”„)
                const timestamp = Date.now();
                const url = new URL(window.location);
                url.searchParams.set('v', timestamp);
                url.searchParams.set('cache', 'clear');
                window.location.href = url.toString();
            }).catch(error => {
                console.error('âŒ ìºì‹œ ì •ë¦¬ ì¤‘ ì˜¤ë¥˜:', error);
                // ì˜¤ë¥˜ê°€ ìˆì–´ë„ ìƒˆë¡œê³ ì¹¨
                const timestamp = Date.now();
                const url = new URL(window.location);
                url.searchParams.set('v', timestamp);
                url.searchParams.set('cache', 'clear');
                window.location.href = url.toString();
            });
        };
        
        // í˜ì´ì§€ ì´ë™ í•¨ìˆ˜
        window.goToPage = function(page) {
            window.location.href = page;
        };
        
        // ì‚¬ì´ë“œë°” ì„¹ì…˜ ì „í™˜ í•¨ìˆ˜
        function switchSection(sectionName) {
            console.log('ğŸ”„ ì„¹ì…˜ ì „í™˜:', sectionName);
            
            // ëª¨ë“  ì„¹ì…˜ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.section-content').forEach(section => {
                section.classList.add('hidden');
            });
            
            // ëª¨ë“  ì‚¬ì´ë“œë°” ì•„ì´í…œ ë¹„í™œì„±í™”
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // ì„ íƒëœ ì„¹ì…˜ í‘œì‹œ
            const targetSection = document.getElementById(sectionName + '-section');
            if (targetSection) {
                targetSection.classList.remove('hidden');
            }
            
            // ì„ íƒëœ ì‚¬ì´ë“œë°” ì•„ì´í…œ í™œì„±í™”
            const activeItem = document.querySelector(`[data-section="${sectionName}"]`);
            if (activeItem) {
                activeItem.classList.add('active');
            }
        }
        

        // ì‚¬ìš©ì ìƒì„¸ë³´ê¸° í•¨ìˆ˜
        function viewUserDetails(userId) {
            alert(`ì‚¬ìš©ì ID: ${userId}\nìƒì„¸ë³´ê¸° ê¸°ëŠ¥ì€ ì¶”í›„ êµ¬í˜„ ì˜ˆì •ì…ë‹ˆë‹¤.`);
        }

        // ì‚¬ìš©ì ì‚­ì œ í•¨ìˆ˜
        function deleteUser(userId) {
            if (confirm('ì •ë§ë¡œ ì´ ì‚¬ìš©ìë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                // Firebaseì—ì„œ ì‚¬ìš©ì ì‚­ì œ ë¡œì§ êµ¬í˜„
                console.log('ì‚¬ìš©ì ì‚­ì œ:', userId);
                alert('ì‚¬ìš©ì ì‚­ì œ ê¸°ëŠ¥ì€ ì¶”í›„ êµ¬í˜„ ì˜ˆì •ì…ë‹ˆë‹¤.');
            }
        }

        // ì„¹ì…˜ ì „í™˜
        function switchSection(section) {
            // ê¸°ì¡´ í™œì„± ì„¹ì…˜ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.section-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // ê¸°ì¡´ í™œì„± ì‚¬ì´ë“œë°” ì•„ì´í…œ ë¹„í™œì„±í™”
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // ìƒˆ ì„¹ì…˜ í‘œì‹œ
            const targetSection = document.getElementById(section + '-section');
            if (targetSection) {
                targetSection.classList.remove('hidden');
            }
            
            // ìƒˆ ì‚¬ì´ë“œë°” ì•„ì´í…œ í™œì„±í™”
            const activeItem = document.querySelector(`[data-section="${section}"]`);
            if (activeItem) {
                activeItem.classList.add('active');
            }
            
            // íšŒì› ê´€ë¦¬ ì„¹ì…˜ì¸ ê²½ìš° ì‹¤ì‹œê°„ êµ¬ë… ì‹œì‘ (ì´ë¯¸ ì‹œì‘ë˜ì–´ ìˆìœ¼ë©´ ë¬´ì‹œ)
            if (section === 'members' && !usersUnsubscribe) {
                subscribeToUsers();
            }
        }

        // ì „ì—­ í•¨ìˆ˜ë¡œ ë…¸ì¶œ
        window.switchSection = switchSection;
        window.viewUserDetails = viewUserDetails;
        window.deleteUser = deleteUser;
        
        console.log('ğŸš€ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì™„ë£Œ');
    </script>
    
    <style>
        body { font-family: 'Inter', 'Noto Sans KR', sans-serif; }
        .sidebar-item.active { background-color: #ec4899; color: white; }
        .tab-btn.active { background-color: #ec4899; color: white; }
        .filter-btn.active { background-color: #6b7280; color: white; }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 via-blue-50 to-emerald-50 min-h-screen">
    <!-- ë¡œê·¸ì¸ ì„¹ì…˜ -->
    <div id="login-section" class="min-h-screen flex items-center justify-center">
        <div class="bg-white rounded-xl shadow-2xl p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-pink-600">PriceHunter</h1>
                <p class="text-gray-600">ê´€ë¦¬ì ë¡œê·¸ì¸</p>
            </div>
            
            <form onsubmit="event.preventDefault(); adminLogin();" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ì´ë©”ì¼</label>
                    <input type="email" id="admin-email" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-400 focus:outline-none" placeholder="admin@pricehunter.com">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="admin-password" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-400 focus:outline-none" placeholder="ë¹„ë°€ë²ˆí˜¸">
                </div>
                
                <button type="submit" class="w-full bg-gradient-to-r from-pink-500 to-purple-500 text-white font-bold py-3 px-4 rounded-lg hover:from-pink-600 hover:to-purple-600 transition shadow-lg">
                    ğŸ” ë¡œê·¸ì¸
                </button>
            </form>
            
            <div class="mt-6 text-center space-y-3">
                <button onclick="goToPage('index.html')" class="text-pink-600 hover:text-pink-700 text-sm block w-full">
                    ğŸ  ë©”ì¸í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°
                </button>
                <button onclick="createAdminAccount()" class="text-blue-600 hover:text-blue-700 text-sm block w-full">
                    ğŸ”§ í…ŒìŠ¤íŠ¸ ê´€ë¦¬ì ê³„ì • ìƒì„±
                </button>
                <div class="text-xs text-gray-500 mt-2">
                    í…ŒìŠ¤íŠ¸ìš© ê³„ì •: admin@pricehunter.com / admin1234
                </div>
            </div>
        </div>
    </div>

    <!-- ëŒ€ì‹œë³´ë“œ ì„¹ì…˜ -->
    <div id="dashboard-section" class="hidden">
        <div class="flex h-screen">
            <!-- ì‚¬ì´ë“œë°” -->
            <div class="w-64 bg-white shadow-lg">
                <div class="p-6 border-b">
                    <h1 class="text-xl font-bold text-pink-600">PriceHunter</h1>
                    <p class="text-sm text-gray-500">ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</p>
                    <p id="admin-info" class="text-xs text-gray-400 mt-1"></p>
                </div>
                
                <nav class="p-4">
                    <div class="space-y-2">
                        <button class="sidebar-item w-full text-left px-4 py-3 rounded-lg font-semibold hover:bg-pink-50 transition active" data-section="dashboard">
                            ğŸ“Š ëŒ€ì‹œë³´ë“œ
                        </button>
                        <button class="sidebar-item w-full text-left px-4 py-3 rounded-lg font-semibold hover:bg-pink-50 transition" data-section="requests">
                            ğŸ“‹ ì˜ë¢° ê´€ë¦¬
                        </button>
                        <button class="sidebar-item w-full text-left px-4 py-3 rounded-lg font-semibold hover:bg-pink-50 transition" data-section="inquiries">
                            ğŸ’¬ 1:1 ë¬¸ì˜
                        </button>
                        <button class="sidebar-item w-full text-left px-4 py-3 rounded-lg font-semibold hover:bg-pink-50 transition" data-section="members">
                            ğŸ‘¥ íšŒì› ê´€ë¦¬
                        </button>
                    </div>
                </nav>
                
                <div class="absolute bottom-4 left-4 right-4">
                    <button onclick="adminLogout()" class="w-full px-4 py-2 bg-red-500 text-white rounded-lg font-semibold hover:bg-red-600 transition">
                        ğŸ”“ ë¡œê·¸ì•„ì›ƒ
                    </button>
                </div>
            </div>

            <!-- ë©”ì¸ ì½˜í…ì¸  -->
            <div class="flex-1 overflow-auto">
                <!-- ëŒ€ì‹œë³´ë“œ ì„¹ì…˜ -->
                <div id="dashboard-section" class="section-content p-8">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">ğŸ“Š ëŒ€ì‹œë³´ë“œ</h2>
                        <div class="flex gap-2 flex-wrap">
                            <button onclick="goToPage('index.html')" class="px-4 py-2 bg-blue-500 text-white rounded-lg font-semibold hover:bg-blue-600 transition">
                                ğŸ  ë©”ì¸í˜ì´ì§€ë¡œ
                            </button>
                            <button onclick="goToPage('member-dashboard.html')" class="px-4 py-2 bg-green-500 text-white rounded-lg font-semibold hover:bg-green-600 transition">
                                ğŸ‘¤ íšŒì›ëŒ€ì‹œë³´ë“œë¡œ
                            </button>
                            <button onclick="testFirebaseConnection()" class="px-4 py-2 bg-purple-500 text-white rounded-lg font-semibold hover:bg-purple-600 transition">
                                ğŸ”¥ Firebase ì—°ê²° í…ŒìŠ¤íŠ¸
                            </button>
                            <button onclick="checkCSPHeaders()" class="px-4 py-2 bg-indigo-500 text-white rounded-lg font-semibold hover:bg-indigo-600 transition">
                                ğŸ” CSP í—¤ë” í™•ì¸
                            </button>
                            <button onclick="clearCacheAndReload()" class="px-4 py-2 bg-orange-500 text-white rounded-lg font-semibold hover:bg-orange-600 transition">
                                ğŸ§¹ ìºì‹œ ì •ë¦¬ & ìƒˆë¡œê³ ì¹¨
                            </button>
                        </div>
                    </div>
                    
                    <!-- í†µê³„ ì¹´ë“œ -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <div class="flex items-center">
                                <div class="p-3 bg-blue-100 rounded-lg">
                                    <span class="text-2xl">ğŸ“‹</span>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm text-gray-500">ì´ ì˜ë¢°</p>
                                    <p class="text-2xl font-bold text-gray-800" id="total-requests">0</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <div class="flex items-center">
                                <div class="p-3 bg-green-100 rounded-lg">
                                    <span class="text-2xl">âœ…</span>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm text-gray-500">ì™„ë£Œëœ ì˜ë¢°</p>
                                    <p class="text-2xl font-bold text-gray-800" id="completed-requests">0</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <div class="flex items-center">
                                <div class="p-3 bg-orange-100 rounded-lg">
                                    <span class="text-2xl">ğŸ‘¥</span>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm text-gray-500">ì´ íšŒì›</p>
                                    <p class="text-2xl font-bold text-gray-800" id="total-members">0</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <div class="flex items-center">
                                <div class="p-3 bg-purple-100 rounded-lg">
                                    <span class="text-2xl">ğŸ’¬</span>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm text-gray-500">ë¯¸ë‹µë³€ ë¬¸ì˜</p>
                                    <p class="text-2xl font-bold text-gray-800" id="pending-inquiries">0</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ìµœê·¼ í™œë™ -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">ìµœê·¼ ì˜ë¢°</h3>
                            <div id="recent-requests" class="space-y-3">
                                <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">ìµœê·¼ ë¬¸ì˜</h3>
                            <div id="recent-inquiries" class="space-y-3">
                                <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ì˜ë¢° ê´€ë¦¬ ì„¹ì…˜ -->
                <div id="requests-section" class="section-content p-8 hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">ğŸ“‹ ì˜ë¢° ê´€ë¦¬</h2>
                        <div class="flex gap-2">
                            <button onclick="goToPage('index.html')" class="px-4 py-2 bg-blue-500 text-white rounded-lg font-semibold hover:bg-blue-600 transition">
                                ğŸ  ë©”ì¸í˜ì´ì§€ë¡œ
                            </button>
                            <button onclick="goToPage('request.html')" class="px-4 py-2 bg-green-500 text-white rounded-lg font-semibold hover:bg-green-600 transition">
                                ğŸ“ ì˜ë¢°í˜ì´ì§€ë¡œ
                            </button>
                        </div>
                    </div>
                    
                    <!-- ì˜ë¢° ëª©ë¡ -->
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                        <div class="font-bold text-gray-700 p-4 border-b">ì ‘ìˆ˜ëœ ì˜ë¢° ëª©ë¡</div>
                        <div class="grid grid-cols-8 gap-2 px-4 py-2 bg-pink-100 text-sm font-bold text-pink-700">
                            <div class="col-span-1">ì„ íƒ</div>
                            <div class="col-span-2">ì˜ë¢°ë²ˆí˜¸/íšŒì›ëª…</div>
                            <div class="col-span-1 text-center">ì˜ë¢°ì¼ì‹œ</div>
                            <div class="col-span-1 text-center">ì§„í–‰ìƒí™©</div>
                            <div class="col-span-1 text-center">êµ¬ë§¤ë°©ì‹</div>
                            <div class="col-span-1 text-center">êµ¬ë§¤ìƒíƒœ</div>
                            <div class="col-span-1 text-center">ì•Œë¦¼ìƒíƒœ</div>
                        </div>
                        <ul id="request-list" class="bg-pink-50 divide-y divide-pink-100">
                            <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                        </ul>
                    </div>
                    
                    <!-- ì˜ë¢° ìƒì„¸ ë° ê²°ê³¼ ì…ë ¥ -->
                    <div id="detail-section" class="w-full hidden mt-6">
                        <div class="bg-white rounded-xl shadow-lg p-6 mb-4">
                            <div class="mb-2 text-gray-700 font-bold">ì˜ë¢° ìƒì„¸</div>
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div><span class="font-semibold">ì˜ë¢°ë²ˆí˜¸:</span> <span id="detail-num"></span></div>
                                <div><span class="font-semibold">ì œí’ˆëª…:</span> <span id="detail-name"></span></div>
                                <div><span class="font-semibold">ì œí’ˆì„¤ëª…:</span> <span id="detail-desc"></span></div>
                                <div><span class="font-semibold">ì°¸ê³ ì‚¬ì´íŠ¸:</span> <span id="detail-url"></span></div>
                                <div><span class="font-semibold">ê°€ê²©:</span> <span id="detail-price"></span></div>
                                <div><span class="font-semibold">ì´ë¦„:</span> <span id="detail-username"></span></div>
                                <div><span class="font-semibold">ì´ë©”ì¼:</span> <span id="detail-email"></span></div>
                                <div><span class="font-semibold">íœ´ëŒ€í°:</span> <span id="detail-phone"></span></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 1:1 ë¬¸ì˜ ì„¹ì…˜ -->
                <div id="inquiries-section" class="section-content p-8 hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">ğŸ’¬ 1:1 ë¬¸ì˜ ê´€ë¦¬</h2>
                        <div class="flex gap-2">
                            <button onclick="goToPage('index.html')" class="px-4 py-2 bg-blue-500 text-white rounded-lg font-semibold hover:bg-blue-600 transition">
                                ğŸ  ë©”ì¸í˜ì´ì§€ë¡œ
                            </button>
                            <button onclick="goToPage('support.html')" class="px-4 py-2 bg-green-500 text-white rounded-lg font-semibold hover:bg-green-600 transition">
                                ğŸ’¬ ë¬¸ì˜í˜ì´ì§€ë¡œ
                            </button>
                        </div>
                    </div>
                    
                    <!-- ë¬¸ì˜ ëª©ë¡ -->
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-blue-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-blue-700 uppercase tracking-wider">ë¬¸ì˜ë²ˆí˜¸</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-blue-700 uppercase tracking-wider">íšŒì›ëª…</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-blue-700 uppercase tracking-wider">ì œëª©</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-blue-700 uppercase tracking-wider">ìƒíƒœ</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-blue-700 uppercase tracking-wider">ë“±ë¡ì¼ì‹œ</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-blue-700 uppercase tracking-wider">ì‘ì—…</th>
                                    </tr>
                                </thead>
                                <tbody id="inquiries-table-body" class="bg-white divide-y divide-gray-200">
                                    <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- ë¬¸ì˜ ìƒì„¸ ë° ë‹µë³€ -->
                    <div id="inquiry-detail-section" class="w-full hidden mt-6">
                        <div class="bg-white rounded-xl shadow-lg p-6 mb-4">
                            <div class="mb-4">
                                <h3 class="text-lg font-bold text-gray-800 mb-2">ë¬¸ì˜ ìƒì„¸</h3>
                                <div class="grid grid-cols-2 gap-4 text-sm">
                                    <div><span class="font-semibold">ë¬¸ì˜ë²ˆí˜¸:</span> <span id="inquiry-id"></span></div>
                                    <div><span class="font-semibold">ì œëª©:</span> <span id="inquiry-title"></span></div>
                                    <div><span class="font-semibold">íšŒì›ëª…:</span> <span id="inquiry-username"></span></div>
                                    <div><span class="font-semibold">ì´ë©”ì¼:</span> <span id="inquiry-email"></span></div>
                                    <div><span class="font-semibold">ì „í™”ë²ˆí˜¸:</span> <span id="inquiry-phone"></span></div>
                                    <div><span class="font-semibold">ë¬¸ì˜ì¼ì‹œ:</span> <span id="inquiry-date"></span></div>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <h4 class="font-semibold text-gray-700 mb-2">ë¬¸ì˜ ë‚´ìš©</h4>
                                <div id="inquiry-content" class="bg-gray-50 p-4 rounded-lg text-gray-700"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- íšŒì› ê´€ë¦¬ ì„¹ì…˜ -->
                <div id="members-section" class="section-content p-8 hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">ğŸ‘¥ íšŒì› ê´€ë¦¬</h2>
                        <div class="flex gap-2">
                            <button onclick="loadLocalStorageUsers()" class="px-4 py-2 bg-orange-500 text-white rounded-lg font-semibold hover:bg-orange-600 transition">
                                ğŸ”„ localStorage ìƒˆë¡œê³ ì¹¨
                            </button>
                            <button onclick="goToPage('index.html')" class="px-4 py-2 bg-blue-500 text-white rounded-lg font-semibold hover:bg-blue-600 transition">
                                ğŸ  ë©”ì¸í˜ì´ì§€ë¡œ
                            </button>
                            <button onclick="goToPage('member-dashboard.html')" class="px-4 py-2 bg-green-500 text-white rounded-lg font-semibold hover:bg-green-600 transition">
                                ğŸ‘¤ íšŒì›ëŒ€ì‹œë³´ë“œë¡œ
                            </button>
                        </div>
                    </div>
                    
                    <!-- íšŒì› ëª©ë¡ -->
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-green-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-green-700 uppercase tracking-wider">í”„ë¡œí•„</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-green-700 uppercase tracking-wider">íšŒì›ëª…</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-green-700 uppercase tracking-wider">ë¡œê·¸ì¸ ë°©ì‹</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-green-700 uppercase tracking-wider">ì´ë©”ì¼</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-green-700 uppercase tracking-wider">íœ´ëŒ€í°</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-green-700 uppercase tracking-wider">ê°€ì…ì¼</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-green-700 uppercase tracking-wider">ì—…ë°ì´íŠ¸</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-green-700 uppercase tracking-wider">ë°ì´í„° ì†ŒìŠ¤</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-green-700 uppercase tracking-wider">ì‘ì—…</th>
                                    </tr>
                                </thead>
                                <tbody id="members-table-body" class="bg-white divide-y divide-gray-200">
                                    <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ì‚¬ì´ë“œë°” í´ë¦­ ì´ë²¤íŠ¸
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.addEventListener('click', function() {
                    const section = this.getAttribute('data-section');
                    switchSection(section);
                });
            });
        });
    </script>
</body>
</html>
