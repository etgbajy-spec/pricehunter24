<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>의뢰 완료 - PriceHunter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
      body { font-family: 'Inter', 'Noto Sans KR', sans-serif; }
      .animate-pulse-bar {
        animation: pulse-bar 2s infinite linear;
      }
      @keyframes pulse-bar {
        0% { width: 0; }
        100% { width: 100%; }
      }
      /* 텍스트 선택 및 편집 방지 */
      body {
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }
      
      /* 버튼과 링크는 텍스트 선택 허용 */
      button, a {
        -webkit-user-select: text;
        -moz-user-select: text;
        -ms-user-select: text;
        user-select: text;
      }
    </style>
  </head>
  <body class="bg-gradient-to-br from-emerald-50 via-blue-50 to-pink-50 min-h-screen flex items-center justify-center px-2">
    <main class="w-full max-w-lg bg-white/90 rounded-3xl shadow-2xl p-8 md:p-12 flex flex-col items-center text-center backdrop-blur-md mt-8 mb-8">
      <!-- Success Icon -->
      <div class="mb-6 flex flex-col items-center">
        <div class="bg-emerald-100 rounded-full p-4 mb-3 shadow-lg">
          <svg class="w-16 h-16 text-emerald-500" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="11" stroke="currentColor" stroke-width="2.5" fill="white"/>
            <path stroke-linecap="round" stroke-linejoin="round" d="M7 13l3 3 7-7" />
          </svg>
        </div>
        <h1 class="text-2xl md:text-3xl font-extrabold text-emerald-600 mb-2">의뢰가 정상적으로 접수되었습니다!</h1>
        <div class="text-gray-500 text-base mb-2">Request No. <span id="req-num" class="font-bold text-gray-700">#PH-20250717001</span></div>
      </div>
      <!-- Progress Bar -->
      <div class="w-full mb-6">
        <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
          <div class="h-2 bg-gradient-to-r from-emerald-400 to-blue-400 animate-pulse-bar" style="width: 100%"></div>
        </div>
        <div class="flex justify-between text-xs text-gray-400 mt-1">
          <span>접수</span>
          <span>2~3 영업일 내 결과 안내</span>
        </div>
      </div>
      <!-- Request Summary -->
      <div class="w-full bg-gray-50 rounded-2xl p-5 mb-6 shadow-inner text-left">
        <div class="mb-3">
          <span class="font-semibold text-gray-700">제품명:</span>
          <span id="summary-name" class="ml-2 text-gray-900">샘플 제품명</span>
        </div>
        <div class="mb-3">
          <span class="font-semibold text-gray-700">제품설명:</span>
          <span id="summary-desc" class="ml-2 text-gray-900">샘플 제품 상세설명</span>
        </div>
        <div class="mb-3">
          <span class="font-semibold text-gray-700">참고사이트:</span>
          <span id="summary-urls" class="ml-2"></span>
        </div>
        <div class="mb-3">
          <span class="font-semibold text-gray-700">업로드 이미지:</span>
          <span id="summary-images"></span>
        </div>
      </div>
      <!-- Contact Info -->
      <div class="w-full mb-6 text-left">
        <div class="mb-1 text-gray-700 font-semibold">결과 안내 연락처</div>
        <div class="flex flex-col gap-1 text-gray-600 text-sm pl-1">
          <span id="summary-email">이메일: sample@email.com</span>
          <span id="summary-phone">전화번호: 010-1234-5678</span>
          <span id="summary-kakao">카카오: pricehunter_kakao</span>
        </div>
      </div>
      <!-- Friendly Message -->
      <div class="text-lg text-pink-500 font-bold mb-8">최저가 결과로 곧 찾아뵐게요 :)</div>
      <!-- CTA Buttons -->
      <div class="flex flex-col gap-4 w-full">
        <div class="flex flex-col md:flex-row gap-4">
          <a href="index.html" class="flex-1 py-3 rounded-xl bg-gradient-to-r from-blue-400 to-emerald-400 text-white font-bold text-lg shadow hover:scale-105 transition text-center">홈으로 돌아가기</a>
          <a href="member-dashboard.html" class="flex-1 py-3 rounded-xl bg-gradient-to-r from-pink-400 to-amber-400 text-white font-bold text-lg shadow hover:scale-105 transition text-center">회원 대시보드</a>
        </div>
        <button onclick="openReviewForm()" class="w-full py-3 rounded-xl bg-gradient-to-r from-purple-400 to-indigo-400 text-white font-bold text-lg shadow hover:scale-105 transition">
          ✍️ 후기 작성하기
        </button>
      </div>
    </main>

    <!-- 후기 작성 모달 -->
    <div id="review-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-800">후기 작성하기</h3>
                    <button onclick="closeReviewModal()" class="text-gray-500 hover:text-gray-700 text-2xl">×</button>
                </div>
                
                <form id="review-form" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">사용자명</label>
                            <input type="text" id="review-name" required
                                   class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">국가</label>
                            <select id="review-country" required
                                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="대한민국">대한민국</option>
                                <option value="미국">미국</option>
                                <option value="일본">일본</option>
                                <option value="중국">중국</option>
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">후기 요약</label>
                        <input type="text" id="review-desc" required
                               class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="예: 노트북을 정말 싸게 샀어요!">
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">원래 가격</label>
                            <input type="text" id="review-original-price" required
                                   class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                   placeholder="예: 1,200,000원">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">최종 가격</label>
                            <input type="text" id="review-final-price" required
                                   class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                   placeholder="예: 780,000원">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">절약 금액</label>
                            <input type="text" id="review-savings" required
                                   class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                   placeholder="예: 420,000원">
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">절약률</label>
                            <input type="text" id="review-savings-percent" required
                                   class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                   placeholder="예: 35%">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">별점</label>
                            <select id="review-stars" required
                                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="5">⭐⭐⭐⭐⭐ (5점)</option>
                                <option value="4.5">⭐⭐⭐⭐⭐ (4.5점)</option>
                                <option value="4">⭐⭐⭐⭐ (4점)</option>
                                <option value="3.5">⭐⭐⭐⭐ (3.5점)</option>
                                <option value="3">⭐⭐⭐ (3점)</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">구매일</label>
                            <input type="date" id="review-date" required
                                   class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">배송</label>
                            <input type="text" id="review-shipping" required
                                   class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                   placeholder="예: 2일">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">구매방법</label>
                            <select id="review-method" required
                                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="공장 직접구매">공장 직접구매</option>
                                <option value="도매처 연동">도매처 연동</option>
                                <option value="PriceHunter 검증">PriceHunter 검증</option>
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">후기 내용</label>
                        <textarea id="review-content" required rows="4"
                                  class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                  placeholder="제품에 대한 솔직한 후기를 작성해주세요. 구매 과정, 제품 품질, 배송 등에 대해 자유롭게 작성하세요."></textarea>
                    </div>
                    
                    <div class="flex justify-end space-x-4 pt-6">
                        <button type="button" onclick="closeReviewModal()" 
                                class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition">
                            취소
                        </button>
                        <button type="submit" 
                                class="px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition">
                            후기 등록하기
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
      // Generate unique request number (e.g. #PH-20250717001)
      function generateReqNum() {
        const now = new Date();
        const y = now.getFullYear();
        const m = String(now.getMonth()+1).padStart(2,'0');
        const d = String(now.getDate()).padStart(2,'0');
        const rand = String(Math.floor(Math.random()*900)+100);
        return `#PH-${y}${m}${d}${rand}`;
      }
      document.getElementById('req-num').textContent = generateReqNum();
      // (Optional) Fill summary from localStorage/sessionStorage or query params
      // Example: sessionStorage.setItem('request', JSON.stringify({name,desc,url,img,email,phone,kakao}))
      try {
        const req = JSON.parse(sessionStorage.getItem('request'));
        if (req) {
          document.getElementById('summary-name').textContent = req.name || '';
          document.getElementById('summary-desc').textContent = req.desc || '';
          // 참고사이트 여러 개
          const urlsEl = document.getElementById('summary-urls');
          if (req.urls && Array.isArray(req.urls)) {
            urlsEl.innerHTML = req.urls.map(u => {
              if (/^https?:\/\//.test(u)) {
                return `<a href="${u}" target="_blank" class="text-blue-600 underline break-all mr-2">${u}</a>`;
              } else {
                return `<span class="text-gray-700 bg-gray-100 rounded px-2 py-1 mr-2">${u}</span>`;
              }
            }).join('');
          } else if (req.url) {
            urlsEl.innerHTML = `<a href="${req.url}" target="_blank" class="text-blue-600 underline break-all">${req.url}</a>`;
          }
          // 이미지 여러 장
          const imgsEl = document.getElementById('summary-images');
          if (req.images && Array.isArray(req.images)) {
            imgsEl.innerHTML = req.images.map(img => `<img src="${img}" alt="업로드 이미지" class="inline-block h-20 w-auto rounded-xl border border-gray-200 shadow-sm align-middle mr-2 mb-2" />`).join('');
          } else if (req.img) {
            imgsEl.innerHTML = `<img src="${req.img}" alt="업로드 이미지" class="inline-block h-20 w-auto rounded-xl border border-gray-200 shadow-sm align-middle" />`;
          } else {
            imgsEl.innerHTML = '<span class="text-gray-400">(없음)</span>';
          }
          if (req.email) document.getElementById('summary-email').textContent = '이메일: ' + req.email;
          if (req.phone) document.getElementById('summary-phone').textContent = '전화번호: ' + req.phone;
          if (req.kakao) document.getElementById('summary-kakao').textContent = '카카오: ' + req.kakao;
        }
      } catch(e) {}
      
      // 후기 작성 관련 함수들
      function openReviewForm() {
        document.getElementById('review-modal').classList.remove('hidden');
        // 오늘 날짜를 기본값으로 설정
        document.getElementById('review-date').value = new Date().toISOString().split('T')[0];
        
        // 저장된 의뢰 정보가 있으면 자동으로 채우기
        loadRequestDataForReview();
      }
      
      // 저장된 의뢰 정보를 후기 폼에 자동으로 채우기
      function loadRequestDataForReview() {
        try {
          const savedRequest = localStorage.getItem('currentRequestForReview');
          if (savedRequest) {
            const requestData = JSON.parse(savedRequest);
            
            // 폼에 데이터 자동 입력
            if (requestData.productName) {
              document.getElementById('review-desc').value = `${requestData.productName}을 정말 싸게 샀어요!`;
            }
            if (requestData.originalPrice) {
              document.getElementById('review-original-price').value = requestData.originalPrice;
            }
            if (requestData.finalPrice) {
              document.getElementById('review-final-price').value = requestData.finalPrice;
            }
            if (requestData.savings) {
              document.getElementById('review-savings').value = requestData.savings;
            }
            if (requestData.savingsPercent) {
              document.getElementById('review-savings-percent').value = requestData.savingsPercent;
            }
            
            // 후기 내용에 기본 템플릿 제공
            const reviewContent = document.getElementById('review-content');
            if (reviewContent && !reviewContent.value) {
              reviewContent.value = `요청가 ${requestData.originalPrice} → ${requestData.finalPrice}으로 구매! 정말 만족스러운 구매였습니다. 빠른 배송과 좋은 품질에 감사합니다.`;
            }
            
            console.log('✅ 의뢰 정보가 후기 폼에 자동으로 채워졌습니다:', requestData);
          }
        } catch (error) {
          console.error('의뢰 정보 로드 실패:', error);
        }
      }
      
      function closeReviewModal() {
        document.getElementById('review-modal').classList.add('hidden');
      }
      
      // 후기 폼 제출 처리
      document.getElementById('review-form').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const reviewData = {
          name: document.getElementById('review-name').value,
          country: document.getElementById('review-country').value,
          desc: document.getElementById('review-desc').value,
          originalPrice: document.getElementById('review-original-price').value,
          finalPrice: document.getElementById('review-final-price').value,
          savings: document.getElementById('review-savings').value,
          savingsPercent: document.getElementById('review-savings-percent').value,
          stars: parseFloat(document.getElementById('review-stars').value),
          date: document.getElementById('review-date').value,
          shipping: document.getElementById('review-shipping').value,
          method: document.getElementById('review-method').value,
          review: document.getElementById('review-content').value,
          img: 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?auto=format&fit=crop&w=600&q=80',
          badge: '실제 구매자',
          createdAt: new Date(),
          updatedAt: new Date()
        };
        
        try {
          // Firebase에 저장
          if (typeof window.firebaseDb !== 'undefined' && window.firebaseDb) {
            const { collection, addDoc, serverTimestamp } = window.firebaseFirestoreFunctions;
            const reviewsRef = collection(window.firebaseDb, 'reviews');
            
            const reviewToSave = {
              ...reviewData,
              createdAt: serverTimestamp(),
              updatedAt: serverTimestamp(),
              badge: '실제 구매자',
              img: reviewData.img || 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?auto=format&fit=crop&w=600&q=80'
            };
            
            await addDoc(reviewsRef, reviewToSave);
            console.log('✅ Firebase에 후기 저장 완료');
          } else {
            // Firebase가 없으면 로컬 스토리지에 저장
            const reviews = JSON.parse(localStorage.getItem('reviews') || '[]');
            reviews.push({ id: Date.now().toString(), ...reviewData });
            localStorage.setItem('reviews', JSON.stringify(reviews));
            console.log('✅ 로컬 스토리지에 후기 저장 완료');
          }
          
          alert('후기가 성공적으로 등록되었습니다! 메인 페이지에서 확인하실 수 있습니다.');
          closeReviewModal();
          
          // 폼 초기화
          document.getElementById('review-form').reset();
          
          // 저장된 의뢰 정보 정리
          localStorage.removeItem('currentRequestForReview');
          
        } catch (error) {
          console.error('후기 저장 실패:', error);
          alert('후기 저장에 실패했습니다. 다시 시도해주세요.');
        }
      });
    </script>
  </body>
</html> 