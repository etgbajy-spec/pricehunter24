<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="noindex, nofollow" />
    <title>의뢰 완료 - PriceHunter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
      body { font-family: 'Noto Sans KR', sans-serif; }
      .animate-pulse-bar {
        animation: pulse-bar 2s infinite linear;
      }
      @keyframes pulse-bar {
        0% { width: 0; }
        100% { width: 100%; }
      }
      /* 텍스트 선택 및 편집 방지 */
      body {
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }
      
      /* 버튼과 링크는 텍스트 선택 허용 */
      button, a {
        -webkit-user-select: text;
        -moz-user-select: text;
        -ms-user-select: text;
        user-select: text;
      }
    </style>
  </head>
  <body class="bg-gradient-to-br from-emerald-50 via-blue-50 to-pink-50 min-h-screen flex items-center justify-center px-2">
    <main class="w-full max-w-lg bg-white/90 rounded-3xl shadow-2xl p-8 md:p-12 flex flex-col items-center text-center backdrop-blur-md mt-8 mb-8">
      <!-- Success Icon -->
      <div class="mb-6 flex flex-col items-center">
        <div class="bg-emerald-100 rounded-full p-4 mb-3 shadow-lg">
          <svg class="w-16 h-16 text-emerald-500" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="11" stroke="currentColor" stroke-width="2.5" fill="white"/>
            <path stroke-linecap="round" stroke-linejoin="round" d="M7 13l3 3 7-7" />
          </svg>
        </div>
        <h1 class="text-2xl md:text-3xl font-extrabold text-emerald-600 mb-2">의뢰가 정상적으로 접수되었습니다!</h1>
        <div class="text-gray-500 text-base mb-2">Request No. <span id="req-num" class="font-bold text-gray-700">#PH-20250717001</span></div>
      </div>
      <!-- Progress Bar -->
      <div class="w-full mb-6">
        <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
          <div class="h-2 bg-gradient-to-r from-emerald-400 to-blue-400 animate-pulse-bar" style="width: 100%"></div>
        </div>
        <div class="flex justify-between text-xs text-gray-400 mt-1">
          <span>접수</span>
          <span>2~3 영업일 내 결과 안내</span>
        </div>
      </div>
      <!-- Request Summary -->
      <div class="w-full bg-gray-50 rounded-2xl p-5 mb-6 shadow-inner text-left">
        <div class="mb-3">
          <span class="font-semibold text-gray-700">제품명:</span>
          <span id="summary-name" class="ml-2 text-gray-900">(없음)</span>
        </div>
        <div class="mb-3">
          <span class="font-semibold text-gray-700">제품설명:</span>
          <span id="summary-desc" class="ml-2 text-gray-900">(없음)</span>
        </div>
        <div class="mb-3">
          <span class="font-semibold text-gray-700">참고사이트:</span>
          <span id="summary-urls" class="ml-2"></span>
        </div>
      </div>
      <!-- Contact Info -->
      <div class="w-full mb-6 text-left">
        <div class="mb-1 text-gray-700 font-semibold">결과 안내 연락처</div>
        <div class="flex flex-col gap-1 text-gray-600 text-sm pl-1">
          <span id="summary-email">이메일: (없음)</span>
          <span id="summary-phone">전화번호: (없음)</span>
          <span id="summary-kakao" style="display: none;">카카오: (없음)</span>
        </div>
      </div>
      <!-- Friendly Message -->
      <div class="text-lg text-pink-500 font-bold mb-8">최저가 결과로 곧 찾아뵐게요 :)</div>
      <!-- CTA Buttons -->
      <div class="flex flex-col md:flex-row gap-4 w-full">
        <a href="index.html" class="flex-1 py-3 rounded-xl bg-gradient-to-r from-blue-400 to-emerald-400 text-white font-bold text-lg shadow hover:scale-105 transition text-center">홈으로 돌아가기</a>
        <a href="member-dashboard.html" class="flex-1 py-3 rounded-xl bg-gradient-to-r from-pink-400 to-amber-400 text-white font-bold text-lg shadow hover:scale-105 transition text-center">회원 대시보드</a>
      </div>
    </main>
    <script>
      // Generate unique request number (e.g. #PH-20250717001)
      function generateReqNum() {
        const now = new Date();
        const y = now.getFullYear();
        const m = String(now.getMonth()+1).padStart(2,'0');
        const d = String(now.getDate()).padStart(2,'0');
        const rand = String(Math.floor(Math.random()*900)+100);
        return `#PH-${y}${m}${d}${rand}`;
      }
      
      // sessionStorage에서 의뢰 번호 가져오기
      try {
        const req = JSON.parse(sessionStorage.getItem('request'));
        if (req && req.reqNum) {
          document.getElementById('req-num').textContent = req.reqNum;
        } else {
          document.getElementById('req-num').textContent = generateReqNum();
        }
      } catch(e) {
        document.getElementById('req-num').textContent = generateReqNum();
      }
      // sessionStorage에서 의뢰 데이터 가져오기
      try {
        const req = JSON.parse(sessionStorage.getItem('request'));
        console.log('의뢰 데이터:', req);
        
        if (req) {
          // 제품명 표시
          if (req.name) {
            document.getElementById('summary-name').textContent = req.name;
          } else {
            document.getElementById('summary-name').textContent = '(없음)';
          }
          
          // 제품설명 표시
          if (req.desc) {
            document.getElementById('summary-desc').textContent = req.desc;
          } else {
            document.getElementById('summary-desc').textContent = '(없음)';
          }
          
          // 참고사이트 여러 개
          const urlsEl = document.getElementById('summary-urls');
          if (req.urls && Array.isArray(req.urls) && req.urls.length > 0) {
            urlsEl.innerHTML = req.urls.map(u => {
              if (u && /^https?:\/\//.test(u)) {
                return `<a href="${u}" target="_blank" class="text-blue-600 underline break-all mr-2">${u}</a>`;
              } else if (u) {
                return `<span class="text-gray-700 bg-gray-100 rounded px-2 py-1 mr-2">${u}</span>`;
              }
              return '';
            }).filter(Boolean).join('') || '<span class="text-gray-400">(없음)</span>';
          } else if (req.url) {
            urlsEl.innerHTML = `<a href="${req.url}" target="_blank" class="text-blue-600 underline break-all">${req.url}</a>`;
          } else {
            urlsEl.innerHTML = '<span class="text-gray-400">(없음)</span>';
          }
          
          // localStorage에서 사용자 정보 가져오기 (한 번만)
          let currentUser = {};
          try {
            const userStr = localStorage.getItem('currentUser') || localStorage.getItem('user') || '{}';
            currentUser = JSON.parse(userStr);
          } catch(e) {
            console.warn('사용자 정보 파싱 실패:', e);
          }
          
          // 고객 연락처 정보 표시 (의뢰 데이터 우선, 없으면 사용자 정보)
          const displayEmail = req.email || currentUser.email;
          if (displayEmail) {
            document.getElementById('summary-email').textContent = '이메일: ' + displayEmail;
          } else {
            document.getElementById('summary-email').textContent = '이메일: (없음)';
          }
          
          const displayPhone = req.phone || currentUser.phone;
          if (displayPhone) {
            document.getElementById('summary-phone').textContent = '전화번호: ' + displayPhone;
          } else {
            document.getElementById('summary-phone').textContent = '전화번호: (없음)';
          }
          
          // 카카오톡 ID는 고객 정보에서 가져오기 (의뢰 데이터에 없으면 표시 안 함)
          const displayKakao = currentUser.kakao || req.kakao;
          if (displayKakao) {
            document.getElementById('summary-kakao').textContent = '카카오: ' + displayKakao;
            document.getElementById('summary-kakao').style.display = 'block';
          } else {
            // 카카오톡 ID가 없으면 해당 라인 숨김
            document.getElementById('summary-kakao').style.display = 'none';
          }
        } else {
          // sessionStorage에 데이터가 없는 경우 기본값 표시
          document.getElementById('summary-name').textContent = '(없음)';
          document.getElementById('summary-desc').textContent = '(없음)';
          document.getElementById('summary-urls').innerHTML = '<span class="text-gray-400">(없음)</span>';
          
          // localStorage에서 사용자 정보 가져오기
          let currentUser = {};
          try {
            const userStr = localStorage.getItem('currentUser') || localStorage.getItem('user') || '{}';
            currentUser = JSON.parse(userStr);
          } catch(e) {
            console.warn('사용자 정보 파싱 실패:', e);
          }
          
          if (currentUser.email) {
            document.getElementById('summary-email').textContent = '이메일: ' + currentUser.email;
          } else {
            document.getElementById('summary-email').textContent = '이메일: (없음)';
          }
          
          if (currentUser.phone) {
            document.getElementById('summary-phone').textContent = '전화번호: ' + currentUser.phone;
          } else {
            document.getElementById('summary-phone').textContent = '전화번호: (없음)';
          }
          
          if (currentUser.kakao) {
            document.getElementById('summary-kakao').textContent = '카카오: ' + currentUser.kakao;
            document.getElementById('summary-kakao').style.display = 'block';
          } else {
            document.getElementById('summary-kakao').style.display = 'none';
          }
        }
      } catch(e) {
        console.error('의뢰 데이터 로드 실패:', e);
        // 에러 발생 시 기본값 표시
        document.getElementById('summary-name').textContent = '(없음)';
        document.getElementById('summary-desc').textContent = '(없음)';
        document.getElementById('summary-urls').innerHTML = '<span class="text-gray-400">(없음)</span>';
        
        // localStorage에서 사용자 정보 가져오기
        try {
          const userStr = localStorage.getItem('currentUser') || localStorage.getItem('user') || '{}';
          const currentUser = JSON.parse(userStr);
          
          if (currentUser.email) {
            document.getElementById('summary-email').textContent = '이메일: ' + currentUser.email;
          } else {
            document.getElementById('summary-email').textContent = '이메일: (없음)';
          }
          
          if (currentUser.phone) {
            document.getElementById('summary-phone').textContent = '전화번호: ' + currentUser.phone;
          } else {
            document.getElementById('summary-phone').textContent = '전화번호: (없음)';
          }
          
          if (currentUser.kakao) {
            document.getElementById('summary-kakao').textContent = '카카오: ' + currentUser.kakao;
            document.getElementById('summary-kakao').style.display = 'block';
          } else {
            document.getElementById('summary-kakao').style.display = 'none';
          }
        } catch(err) {
          console.error('사용자 정보 로드 실패:', err);
          document.getElementById('summary-email').textContent = '이메일: (없음)';
          document.getElementById('summary-phone').textContent = '전화번호: (없음)';
          document.getElementById('summary-kakao').style.display = 'none';
        }
      }
    </script>
  </body>
</html> 