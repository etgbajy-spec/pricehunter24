<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹¤ì œ ì›¹ì‚¬ì´íŠ¸ ë””ë²„ê¹…</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-8">ğŸŒ ì‹¤ì œ ì›¹ì‚¬ì´íŠ¸ ë””ë²„ê¹…</h1>
        
        <!-- í˜„ì¬ í™˜ê²½ -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">í˜„ì¬ í™˜ê²½</h2>
            <div class="grid grid-cols-2 gap-4 text-sm">
                <div><strong>ë„ë©”ì¸:</strong> <span id="domain"></span></div>
                <div><strong>í”„ë¡œí† ì½œ:</strong> <span id="protocol"></span></div>
                <div><strong>URL:</strong> <span id="url"></span></div>
                <div><strong>User Agent:</strong> <span id="user-agent"></span></div>
            </div>
        </div>
        
        <!-- Firebase ìƒíƒœ -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Firebase ìƒíƒœ</h2>
            <div id="firebase-status" class="text-gray-600">í™•ì¸ ì¤‘...</div>
            <button onclick="checkFirebase()" class="mt-2 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                Firebase ìƒíƒœ í™•ì¸
            </button>
        </div>
        
        <!-- Netlify Functions í…ŒìŠ¤íŠ¸ -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Netlify Functions í…ŒìŠ¤íŠ¸</h2>
            <div class="space-y-4">
                <button onclick="testKakaoExchange()" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">
                    ì¹´ì¹´ì˜¤ êµí™˜ í•¨ìˆ˜ í…ŒìŠ¤íŠ¸
                </button>
                <button onclick="testGrantAdmin()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                    ê´€ë¦¬ì ê¶Œí•œ ë¶€ì—¬ í•¨ìˆ˜ í…ŒìŠ¤íŠ¸
                </button>
            </div>
            <div id="function-result" class="mt-4 p-4 bg-gray-100 rounded text-sm"></div>
        </div>
        
        <!-- Firestore í…ŒìŠ¤íŠ¸ -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Firestore í…ŒìŠ¤íŠ¸</h2>
            <div class="space-y-4">
                <button onclick="testFirestoreRead()" class="bg-orange-500 text-white px-4 py-2 rounded hover:bg-orange-600">
                    Firestore ì½ê¸° í…ŒìŠ¤íŠ¸
                </button>
                <button onclick="testFirestoreWrite()" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
                    Firestore ì“°ê¸° í…ŒìŠ¤íŠ¸
                </button>
            </div>
            <div id="firestore-result" class="mt-4 p-4 bg-gray-100 rounded text-sm"></div>
        </div>
        
        <!-- ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸ -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸</h2>
            <div class="space-y-4">
                <button onclick="testKakaoLogin()" class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600">
                    ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸
                </button>
            </div>
            <div id="kakao-result" class="mt-4 p-4 bg-gray-100 rounded text-sm"></div>
        </div>
        
        <!-- ì½˜ì†” ë¡œê·¸ -->
        <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-semibold mb-4">ì½˜ì†” ë¡œê·¸</h2>
            <div id="console-log" class="bg-gray-900 text-green-400 p-4 rounded font-mono text-sm h-64 overflow-y-auto">
                ì½˜ì†” ë¡œê·¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...
            </div>
            <button onclick="clearLog()" class="mt-2 bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">
                ë¡œê·¸ ì§€ìš°ê¸°
            </button>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="firebase-config.js"></script>

    <script>
        // ì½˜ì†” ë¡œê·¸ í•¨ìˆ˜
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.getElementById('console-log');
            logElement.innerHTML += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(message);
        }

        function clearLog() {
            document.getElementById('console-log').innerHTML = 'ì½˜ì†” ë¡œê·¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...\n';
        }

        // í™˜ê²½ ì •ë³´ í‘œì‹œ
        function displayEnvironment() {
            document.getElementById('domain').textContent = window.location.hostname;
            document.getElementById('protocol').textContent = window.location.protocol;
            document.getElementById('url').textContent = window.location.href;
            document.getElementById('user-agent').textContent = navigator.userAgent;
        }

        // Firebase ìƒíƒœ í™•ì¸
        function checkFirebase() {
            log('ğŸ” Firebase ìƒíƒœ í™•ì¸ ì¤‘...');
            
            if (typeof firebase === 'undefined') {
                document.getElementById('firebase-status').innerHTML = 'âŒ Firebase SDK ë¡œë“œ ì‹¤íŒ¨';
                log('âŒ Firebase SDKê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return;
            }
            
            if (window.firebaseApp && window.firestore && window.auth) {
                const projectId = window.firebaseApp.options.projectId;
                document.getElementById('firebase-status').innerHTML = `âœ… Firebase ì •ìƒ (${projectId})`;
                log(`âœ… Firebase ì •ìƒ ì‘ë™ - í”„ë¡œì íŠ¸: ${projectId}`);
            } else {
                document.getElementById('firebase-status').innerHTML = 'âŒ Firebase ì´ˆê¸°í™” ì‹¤íŒ¨';
                log('âŒ Firebase ì´ˆê¸°í™” ì‹¤íŒ¨');
            }
        }

        // ì¹´ì¹´ì˜¤ êµí™˜ í•¨ìˆ˜ í…ŒìŠ¤íŠ¸
        async function testKakaoExchange() {
            log('ğŸ”„ ì¹´ì¹´ì˜¤ êµí™˜ í•¨ìˆ˜ í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            
            try {
                const response = await fetch('/.netlify/functions/kakao-exchange', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        accessToken: 'test-token'
                    })
                });
                
                const result = await response.text();
                log(`ğŸ“¡ ì¹´ì¹´ì˜¤ êµí™˜ í•¨ìˆ˜ ì‘ë‹µ: ${response.status} - ${result}`);
                document.getElementById('function-result').innerHTML = `
                    <div><strong>ìƒíƒœ:</strong> ${response.status}</div>
                    <div><strong>ì‘ë‹µ:</strong> ${result}</div>
                `;
            } catch (error) {
                log(`âŒ ì¹´ì¹´ì˜¤ êµí™˜ í•¨ìˆ˜ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`);
                document.getElementById('function-result').innerHTML = `
                    <div class="text-red-600"><strong>ì˜¤ë¥˜:</strong> ${error.message}</div>
                `;
            }
        }

        // ê´€ë¦¬ì ê¶Œí•œ ë¶€ì—¬ í•¨ìˆ˜ í…ŒìŠ¤íŠ¸
        async function testGrantAdmin() {
            log('ğŸ”„ ê´€ë¦¬ì ê¶Œí•œ ë¶€ì—¬ í•¨ìˆ˜ í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            
            if (!window.auth.currentUser) {
                log('âŒ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                return;
            }
            
            try {
                const token = await window.auth.currentUser.getIdToken();
                const response = await fetch('/.netlify/functions/grant-admin', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        targetEmail: window.auth.currentUser.email
                    })
                });
                
                const result = await response.text();
                log(`ğŸ“¡ ê´€ë¦¬ì ê¶Œí•œ ë¶€ì—¬ í•¨ìˆ˜ ì‘ë‹µ: ${response.status} - ${result}`);
                document.getElementById('function-result').innerHTML = `
                    <div><strong>ìƒíƒœ:</strong> ${response.status}</div>
                    <div><strong>ì‘ë‹µ:</strong> ${result}</div>
                `;
            } catch (error) {
                log(`âŒ ê´€ë¦¬ì ê¶Œí•œ ë¶€ì—¬ í•¨ìˆ˜ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`);
                document.getElementById('function-result').innerHTML = `
                    <div class="text-red-600"><strong>ì˜¤ë¥˜:</strong> ${error.message}</div>
                `;
            }
        }

        // Firestore ì½ê¸° í…ŒìŠ¤íŠ¸
        async function testFirestoreRead() {
            log('ğŸ”„ Firestore ì½ê¸° í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            
            if (!window.firestore) {
                log('âŒ Firestoreê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return;
            }
            
            try {
                const snapshot = await window.firestore.collection('members').limit(5).get();
                log(`âœ… Firestore ì½ê¸° ì„±ê³µ: ${snapshot.size}ê°œ ë¬¸ì„œ`);
                document.getElementById('firestore-result').innerHTML = `
                    <div class="text-green-600"><strong>ì½ê¸° ì„±ê³µ:</strong> ${snapshot.size}ê°œ ë¬¸ì„œ</div>
                `;
            } catch (error) {
                log(`âŒ Firestore ì½ê¸° ì‹¤íŒ¨: ${error.message}`);
                document.getElementById('firestore-result').innerHTML = `
                    <div class="text-red-600"><strong>ì½ê¸° ì‹¤íŒ¨:</strong> ${error.message}</div>
                `;
            }
        }

        // Firestore ì“°ê¸° í…ŒìŠ¤íŠ¸
        async function testFirestoreWrite() {
            log('ğŸ”„ Firestore ì“°ê¸° í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            
            if (!window.auth.currentUser) {
                log('âŒ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                return;
            }
            
            if (!window.firestore) {
                log('âŒ Firestoreê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return;
            }
            
            try {
                const testData = {
                    name: 'ì‹¤ì œ ì›¹ì‚¬ì´íŠ¸ í…ŒìŠ¤íŠ¸',
                    email: window.auth.currentUser.email,
                    provider: 'test',
                    role: 'viewer',
                    status: 'active',
                    createdAt: new Date(),
                    updatedAt: new Date()
                };
                
                await window.firestore.collection('members').doc(window.auth.currentUser.uid).set(testData, { merge: true });
                log('âœ… Firestore ì“°ê¸° ì„±ê³µ');
                document.getElementById('firestore-result').innerHTML = `
                    <div class="text-green-600"><strong>ì“°ê¸° ì„±ê³µ:</strong> í…ŒìŠ¤íŠ¸ ë°ì´í„° ì €ì¥ë¨</div>
                `;
            } catch (error) {
                log(`âŒ Firestore ì“°ê¸° ì‹¤íŒ¨: ${error.message}`);
                document.getElementById('firestore-result').innerHTML = `
                    <div class="text-red-600"><strong>ì“°ê¸° ì‹¤íŒ¨:</strong> ${error.message}</div>
                `;
            }
        }

        // ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸
        function testKakaoLogin() {
            log('ğŸ”„ ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            
            if (window.location.protocol === 'file:') {
                log('âŒ file:// í”„ë¡œí† ì½œì—ì„œëŠ” ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ì´ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                document.getElementById('kakao-result').innerHTML = `
                    <div class="text-red-600"><strong>ì˜¤ë¥˜:</strong> file:// í”„ë¡œí† ì½œì—ì„œëŠ” ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ì´ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</div>
                `;
                return;
            }
            
            // ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
            const kakaoAuthUrl = `https://kauth.kakao.com/oauth/authorize?client_id=6917a034b74fafd0ac80ab855af5ed6d&redirect_uri=${encodeURIComponent(window.location.origin + '/register.html')}&response_type=code&scope=profile_nickname,account_email`;
            
            log(`ğŸ”— ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ URL: ${kakaoAuthUrl}`);
            document.getElementById('kakao-result').innerHTML = `
                <div class="text-blue-600"><strong>ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ URL:</strong></div>
                <div class="text-xs break-all">${kakaoAuthUrl}</div>
                <button onclick="window.open('${kakaoAuthUrl}', '_blank')" class="mt-2 bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600">
                    ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì—´ê¸°
                </button>
            `;
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸš€ ì‹¤ì œ ì›¹ì‚¬ì´íŠ¸ ë””ë²„ê¹… í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
            displayEnvironment();
            
            // Firebase ì´ˆê¸°í™”
            if (typeof initializeFirebase === 'function') {
                initializeFirebase();
                setTimeout(() => {
                    checkFirebase();
                }, 1000);
            } else {
                log('âŒ Firebase ì´ˆê¸°í™” í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        });
    </script>
</body>
</html>
