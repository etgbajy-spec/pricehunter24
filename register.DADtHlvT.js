import{o as e,a as o,k as t,f as n,s,e as a,c,d as l,b as i,g as r,l as d}from"./firebase.D0v-ztDH.js";function m(e){console.log("🔄 인증 상태 변경:",e?e.email:"로그아웃"),e?(!function(e){const o=document.getElementById("signupSection"),t=document.getElementById("loginSection"),n=document.getElementById("dashboardSection"),s=document.getElementById("userInfo");o&&(o.style.display="none");t&&(t.style.display="none");n&&(n.style.display="block");s&&(s.innerHTML=`\n      <div class="text-center">\n        <h3 class="text-lg font-semibold text-gray-800">환영합니다!</h3>\n        <p class="text-gray-600">${e.email}</p>\n        <p class="text-sm text-gray-500">${e.displayName||"사용자"}</p>\n      </div>\n    `)}(e),p(e)):function(){const e=document.getElementById("signupSection"),o=document.getElementById("loginSection"),t=document.getElementById("dashboardSection");e&&(e.style.display="block");o&&(o.style.display="block");t&&(t.style.display="none")}()}async function u(e){e.preventDefault();const n=document.getElementById("signupEmail").value,s=document.getElementById("signupPassword").value,a=document.getElementById("signupName").value;try{console.log("🔄 이메일 회원가입 시도:",n);const e=(await t(o,n,s)).user;console.log("✅ 이메일 회원가입 성공:",e.uid),await p(e,{name:a,provider:"email"}),b("회원가입이 완료되었습니다!")}catch(c){console.error("❌ 이메일 회원가입 실패:",c),k("회원가입에 실패했습니다: "+c.message)}}async function g(e){e.preventDefault();const t=document.getElementById("loginEmail").value,s=document.getElementById("loginPassword").value;try{console.log("🔄 이메일 로그인 시도:",t);const e=(await n(o,t,s)).user;console.log("✅ 이메일 로그인 성공:",e.uid),await p(e)}catch(a){console.error("❌ 이메일 로그인 실패:",a),k("로그인에 실패했습니다: "+a.message)}}async function y(){try{await s(o),console.log("✅ 로그아웃 완료")}catch(e){console.error("❌ 로그아웃 실패:",e)}}async function p(e,o={}){try{console.log("📝 회원 정보 Firestore 저장 시작:",e.uid);const t={email:e.email,name:o.name||e.displayName||e.email.split("@")[0],provider:o.provider||"email",role:"viewer",status:"active",profileImage:e.photoURL||null,createdAt:a(),updatedAt:a()};console.log("📝 저장할 회원 데이터:",t),await c(l(i,"members",e.uid),t,{merge:!0}),console.log("✅ 회원 정보 Firestore 저장 완료:",e.uid);const n=await r(l(i,"members",e.uid));n.exists()?console.log("✅ 저장 확인됨:",n.data()):console.error("❌ 저장 확인 실패: 문서가 존재하지 않음")}catch(t){console.error("❌ 회원 정보 Firestore 저장 실패:",t),k("회원 정보 저장에 실패했습니다: "+t.message)}}function f(){if("undefined"==typeof Kakao)return console.log("⏳ Kakao SDK 로딩 대기..."),void setTimeout(f,1e3);try{Kakao.init("6917a034b74fafd0ac80ab855af5ed6d"),console.log("✅ Kakao SDK 초기화 완료");const e=document.getElementById("kakaoLoginBtn");e&&e.addEventListener("click",E)}catch(e){console.error("❌ Kakao SDK 초기화 실패:",e)}}function E(){try{console.log("🔄 카카오 로그인 시작..."),Kakao.Auth.login({success:function(e){console.log("✅ 카카오 로그인 성공:",e),async function(e){try{console.log("🔄 카카오 토큰 교환 시작...");const t=await fetch("/.netlify/functions/kakao-exchange",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({accessToken:e})});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const n=await t.json();if(!n.success)throw new Error(n.error||"토큰 교환에 실패했습니다.");console.log("✅ 카카오 토큰 교환 성공"),console.log("📝 교환된 사용자 정보:",n.user),await d(o,n.customToken),b("카카오 로그인이 완료되었습니다!")}catch(t){console.error("❌ 카카오 토큰 교환 실패:",t),k("카카오 로그인에 실패했습니다: "+t.message)}}(e.access_token)},fail:function(e){console.error("❌ 카카오 로그인 실패:",e),k("카카오 로그인에 실패했습니다: "+e.error_description)}})}catch(e){console.error("❌ 카카오 로그인 오류:",e),k("카카오 로그인 중 오류가 발생했습니다.")}}function b(e){const o=document.getElementById("message");o&&(o.className="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4",o.textContent=e,o.style.display="block")}function k(e){const o=document.getElementById("message");o&&(o.className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",o.textContent=e,o.style.display="block")}document.addEventListener("DOMContentLoaded",function(){console.log("🚀 회원가입 페이지 초기화 시작..."),function(){const e=document.getElementById("emailSignupForm");e&&e.addEventListener("submit",u);const o=document.getElementById("emailLoginForm");o&&o.addEventListener("submit",g);const t=document.getElementById("logoutBtn");t&&t.addEventListener("click",y)}(),e(o,m),f()});
